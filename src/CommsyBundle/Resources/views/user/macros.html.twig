{% macro title(item, modifierList, userCount, readCount, readSinceModificationCount, draft, isSelf) %}
    {% import 'CommsyBundle:utils:macros.html.twig' as macros %}
    {% set pathName = '' %}
    {% if item.itemType == 'user' %}
        {% set pathName = 'commsy_user_edit' %}
    {% elseif item.itemType == 'section' %}
        <a name="section{{item.ItemID}}"></a>
        {% set pathName = 'commsy_user_edit' %}
    {% endif %}
    {% if userCount == 0 %}
        {% set userCount = 1 %}
    {% endif %}
    
    <div id="section{{ item.itemId }}" class="cs-edit-section cs-toggle" data-cs-edit="{editUrl: '{{ path(pathName, {'roomId': item.contextId, 'itemId': item.itemId}) }}', cancelEditUrl: '{{ path('commsy_item_canceledit', {'roomId': item.contextId, 'itemId': item.itemId}) }}', draft: '{{ draft }}'}">
        <div class="uk-margin-left uk-margin-right uk-margin-bottom uk-position-relative">
            <div class="uk-grid uk-margin-small-bottom">
                <div class="uk-width-8-10 uk-margin-small-bottom" >
                    <div class="uk-grid">
                        <div class="uk-width-1-1">
                            <h1 class="uk-article-title">{{ item.title|decodeHtmlEntity }} {{ item.fullname|decodeHtmlEntity }}</h1>
                        </div>
                    </div>
                </div>        
                <div class="uk-width-2-10 uk-text-right">
                    {# edit #}
                    {% if is_granted('ITEM_EDIT', item.itemId) and isSelf %}
                        {{ macros.actionIcons('title', item, true) }}
                        {% include 'CommsyBundle:utils:edit_spinner.html.twig' %}
                    {% else %}
                        {{ macros.actionIcons('title', item, false) }}
                    {% endif %}
                </div>
            </div>



            {# title, etc. #}
            <div class="uk-flex">
                <div>
                    <img class="uk-comment-avatar uk-thumbnail uk-border-circle cs-avatar-user-detail" src="{{ app.request.baseURL }}/room/{{ app.request.attributes.get('roomId') }}/user/{{ item.itemID }}/image" alt="">
                </div>
                <div>
                    <table class="uk-table-condensed" style="margin-bottom:30px;">
                        <tbody>
                            
                            {% if not item.email is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'email'|trans({}, 'user')}}:</td>
                                {% if item.isEmailVisible %}
                                    <td><a href="mailto:{{ item.email }}">{{ item.email }}</a></td>
                                {% else %}
                                    <td>{{ 'emailHidden'|trans({}, 'user')}} (<a href="{{ path('commsy_user_send', {'roomId': item.contextId, 'itemId': item.itemId}) }}">{{ 'send email'|trans({}, 'user') }}</a>)</td>
                                {% endif %}
                            </tr>
                            {% endif %}
                            {% if not item.telephone is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'phone'|trans({}, 'user')}}:</td>
                                <td><a href="tel:{{ item.telephone }}">{{ item.telephone }}</a></td>
                            </tr>
                            {% endif %}
                            {% if not item.cellularphone is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'mobile'|trans({}, 'user')}}:</td>
                                <td><a href="tel:{{ item.cellularphone }}">{{ item.cellularphone }}</a></td>
                            </tr>
                            {% endif %}
                            
                            {% if not item.title is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'title'|trans({}, 'user')}}:</td>
                                <td>{{ item.title }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.birthday is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'dateOfBirth'|trans({}, 'user')}}:</td>
                                <td>{{ item.birthday|date('d.m.Y') }}</td>
                            </tr>
                            {% endif %}
                            
                            {% if not item.street is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'street'|trans({}, 'user')}}:</td>
                                <td>{{ item.street }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.zipCode is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'zipCode'|trans({}, 'user')}}:</td>
                                <td>{{ item.zipCode }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.city is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'city'|trans({}, 'user')}}:</td>
                                <td>{{ item.city }}</td>
                            </tr>
                            {% endif %}

                            
                            {% if not item.room is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'room'|trans({}, 'user')}}:</td>
                                <td>{{ item.room }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.organisation is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'organisation'|trans({}, 'user')}}:</td>
                                <td>{{ item.organisation }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.position is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'position'|trans({}, 'user')}}:</td>
                                <td>{{ item.position }}</td>
                            </tr>
                            {% endif %}
                            
                            {% if not item.homepage is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'homepage'|trans({}, 'user')}}:</td>
                                <td>{{ item.homepage }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.msn is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'msn'|trans({}, 'user')}}:</td>
                                <td>{{ item.msn }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.skype is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'skype'|trans({}, 'user')}}:</td>
                                <td>{{ item.skype }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.icq is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'icq'|trans({}, 'user')}}:</td>
                                <td>{{ item.icq }}</td>
                            </tr>
                            {% endif %}
                            {% if not item.yahoo is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'yahoo'|trans({}, 'user')}}:</td>
                                <td>{{ item.yahoo }}</td>
                            </tr>
                            {% endif %}
                            
                            {% if not item.language is empty and not item.language == 'none' %}
                            <tr>
                                <td class="uk-text-bold">{{ 'language'|trans({}, 'user')}}:</td>
                                <td>{{ item.language }}</td>
                            </tr>
                            {% endif %}
                            
                            {% if not item.status is empty %}
                            <tr>
                                <td class="uk-text-bold">{{ 'user status'|trans({}, 'user')}}:</td>
                                <td>{{ macros.userStatus(item) }}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="uk-margin-left uk-margin-right uk-position-relative">
            <div class="uk-width-1-1 uk-padding-remove uk-margin-small-bottom">    
                <div class="uk-grid uk-margin-small-left uk-margin-top-remove">
                    <div class="uk-width-9-10 uk-padding-remove">
                        <div class="toggle-title-{{ item.itemId }}">
                            <div class="uk-panel">
                                <div class="uk-grid">
                                    {#
                                        ***
                                        NOTE: User entries can only be edited by the user himself atm., so displaying the last modificator does not make sense here. 
                                        Since this may change in the future, the corresponding code remains is not deleted here.
                                        ***
                                    #}
                                    {#
                                    <div class="uk-width-1-1">
                                        <div class="uk-flex">
                                            <div class="uk-margin-right">
                                                {% if not item.modificatorItem.isDeleted and item.modificatorItem.isUser %}
                                                    {{ macros.userIconLink(item.modificatorItem) }}
                                                {% else %}
                                                    {{ macros.userIcon(item.modificatorItem) }}
                                                {% endif %}
                                            </div>
                                            <div class="uk-margin-right">
                                                {{ 'last changed'|trans({})|capitalize }}: {{item.modificationDate|date("d.m.Y H:i")}}<br/>
                                                {{ 'changed by'|trans({})|capitalize }}: {{ macros.userFullname(item.modificatorItem) }}
                                            </div>
                                        </div>
                                    </div>
                                    #}
                                </div>
                            </div>
                        </div>
                        <div class="toggle-title-{{ item.itemId }} uk-hidden">
                            <div class="uk-panel">
                                <div class="uk-grid">
                                {#
                                    ***
                                    NOTE: User entries can only be edited by the user himself atm., so displaying the last modificator does not make sense here. 
                                    Since this may change in the future, the corresponding code remains is not deleted here.
                                    ***
                                #}
                                {#    <div class="uk-width-2-5">
                                        <div class="uk-flex">
                                            <div class="uk-margin-right">
                                                {% if not item.modificatorItem.isDeleted and item.modificatorItem.isUser %}
                                                    {{ macros.userIconLink(item.modificatorItem) }}
                                                {% else %}
                                                    {{ macros.userIcon(item.modificatorItem) }}
                                                {% endif %}
                                            </div>
                                            <div class="uk-margin-right">
                                                {{ 'last changed'|trans({})|capitalize }}: {{item.modificationDate|date("d.m.Y H:i")}}<br/>
                                                {{ 'changed by'|trans({})|capitalize }}: {{ macros.userFullname(item.modificatorItem) }}<br/>
                                                {{ 'reference number'|trans({})|capitalize }}: {{ item.itemId }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uk-width-1-5">
                                        <div class="uk-clearfix">
                                            <div class="uk-margin-remove">
                                                {% if not item.creator.isDeleted and item.creator.isUser %}
                                                    {{ macros.userIconLink(item.creator) }}
                                                {% else %}
                                                    {{ macros.userIcon(item.creator) }}
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="uk-clearfix">
                                            {{ 'creator'|trans({})}} 
                                        </div>
                                    </div>
                                    <div class="uk-width-2-5">                           
                                        <div class="uk-clearfix">
                                            <div class="uk-margin-remove">
                                                {% if modifierList[item.itemId] is defined %}
                                                    {% if not modifierList[item.itemId] is empty %}
                                                        <div class="uk-flex">
                                                            {% for modifier in modifierList[item.itemId] %}
                                                                <div class="">
                                                                    {% if not modifier.isDeleted and modifier.isUser %}
                                                                        {{ macros.userIconLink(modifier) }}
                                                                    {% else %}
                                                                        {{ macros.userIcon(modifier) }}
                                                                    {% endif %}
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                        </div>                           
                                        {% if modifierList[item.itemId] is defined %}
                                        {% if not modifierList[item.itemId] is empty %}
                                        <div class="uk-clearfix">
                                            {{ 'editors'|trans({})}} 
                                        </div>
                                        {% endif %}
                                        {% endif %}
                                    </div>   #}
                                </div>
                            </div>
                            <div class="uk-panel uk-margin-top">
                                <div class="uk-grid">
                                    <div class="uk-width-2-5">                           
                                        <div class="uk-clearfix">
                                            <div class="uk-align-left uk-width-1-1">
                                            {{ 'clicked since last editing'|trans({})}}: <br/>
                                                <div class="uk-progress">
                                                    {% set activePercent = (readSinceModificationCount/userCount*100)|round %}
                                                    <div class="uk-progress-bar cs-progress-bar" style="width: {{ activePercent }}%;">{{readSinceModificationCount}}</div>
                                                </div>
                                           </div>
                                        </div>                           
                                    </div>                            
                                    <div class="uk-width-1-5">                            
                                    </div>                            
                                    <div class="uk-width-2-5">                           
                                        <div class="uk-clearfix">
                                            <div class="uk-align-left uk-width-1-1">
                                            {{ 'clicked since creating'|trans({}) }}: <br/>
                                                <div class="uk-progress">
                                                    {% set activePercent = (readCount/userCount*100)|round %}
                                                   <div class="uk-progress-bar cs-progress-bar" style="width: {{ activePercent }}%;">{{readCount}}</div>
                                                </div> 
                                            </div>
                                        </div>                           
                                    </div>                            
                                </div>                        
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
   </div>
{% endmacro %}

{% macro titleSave(item, modifierList, userCount, readCount, readSinceModificationCount, draft, isSelf) %}
    {% import 'CommsyBundle:utils:macros.html.twig' as macros %}
    {% set pathName = '' %}
    {% if item.itemType == 'user' %}
        {% set pathName = 'commsy_user_edit' %}
    {% elseif item.itemType == 'section' %}
        <a name="section{{item.ItemID}}"></a>
        {% set pathName = 'commsy_user_edit' %}
    {% endif %}
    {% if userCount == 0 %}
        {% set userCount = 1 %}
    {% endif %}
    
    <div class="uk-margin-left uk-margin-right uk-margin-bottom uk-position-relative">
        <div class="uk-grid uk-margin-small-bottom">
            <div class="uk-width-8-10 uk-margin-small-bottom" >
                <div class="uk-grid">
                    <div class="uk-width-1-1">
                        <h1 class="uk-article-title">{{ item.title|decodeHtmlEntity }} {{ item.fullname|decodeHtmlEntity }}</h1>
                    </div>
                </div>
            </div>        
            <div class="uk-width-2-10 uk-text-right">
                {# edit #}
                {% if is_granted('ITEM_EDIT', item.itemId) and isSelf %}
                    {{ macros.actionIcons('title', item, true) }}
                    {% include 'CommsyBundle:utils:edit_spinner.html.twig' %}
                {% else %}
                        {{ macros.actionIcons('title', item, false) }}
                {% endif %}
            </div>
        </div>



        {# title, etc. #}
        <div class="uk-flex">
            <div>
                <img class="uk-comment-avatar uk-thumbnail uk-border-circle cs-avatar-user-detail" src="{{ app.request.baseURL }}/room/{{ app.request.attributes.get('roomId') }}/user/{{ item.itemID }}/image" alt="">
            </div>
            <div>
                <table class="uk-table-condensed" style="margin-bottom:30px;">
                    <tbody>
                        
                        {% if not item.email is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'email'|trans({}, 'user')}}:</td>
                            {% if item.isEmailVisible %}
                                <td><a href="mailto:{{ item.email }}">{{ item.email }}</a></td>
                            {% else %}
                                <td>{{ 'emailHidden'|trans({}, 'user')}} (<a href="">ToDo: "send email"-link</a>)</td>
                            {% endif %}
                        </tr>
                        {% endif %}
                        {% if not item.telephone is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'phone'|trans({}, 'user')}}:</td>
                            <td><a href="tel:{{ item.telephone }}">{{ item.telephone }}</a></td>
                        </tr>
                        {% endif %}
                        {% if not item.cellularphone is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'mobile'|trans({}, 'user')}}:</td>
                            <td><a href="tel:{{ item.cellularphone }}">{{ item.cellularphone }}</a></td>
                        </tr>
                        {% endif %}
                        
                        {% if not item.title is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'title'|trans({}, 'user')}}:</td>
                            <td>{{ item.title }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.birthday is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'dateOfBirth'|trans({}, 'user')}}:</td>
                            <td>{{ item.birthday|date('d.m.Y') }}</td>
                        </tr>
                        {% endif %}
                        
                        {% if not item.street is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'street'|trans({}, 'user')}}:</td>
                            <td>{{ item.street }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.zipCode is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'zipCode'|trans({}, 'user')}}:</td>
                            <td>{{ item.zipCode }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.city is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'city'|trans({}, 'user')}}:</td>
                            <td>{{ item.city }}</td>
                        </tr>
                        {% endif %}

                        
                        {% if not item.room is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'room'|trans({}, 'user')}}:</td>
                            <td>{{ item.room }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.organisation is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'organisation'|trans({}, 'user')}}:</td>
                            <td>{{ item.organisation }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.position is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'position'|trans({}, 'user')}}:</td>
                            <td>{{ item.position }}</td>
                        </tr>
                        {% endif %}
                        
                        {% if not item.homepage is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'homepage'|trans({}, 'user')}}:</td>
                            <td>{{ item.homepage }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.msn is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'msn'|trans({}, 'user')}}:</td>
                            <td>{{ item.msn }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.skype is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'skype'|trans({}, 'user')}}:</td>
                            <td>{{ item.skype }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.icq is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'icq'|trans({}, 'user')}}:</td>
                            <td>{{ item.icq }}</td>
                        </tr>
                        {% endif %}
                        {% if not item.yahoo is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'yahoo'|trans({}, 'user')}}:</td>
                            <td>{{ item.yahoo }}</td>
                        </tr>
                        {% endif %}
                        
                        {% if not item.language is empty and not item.language == 'none' %}
                        <tr>
                            <td class="uk-text-bold">{{ 'language'|trans({}, 'user')}}:</td>
                            <td>{{ item.language }}</td>
                        </tr>
                        {% endif %}
                        
                        {% if not item.status is empty %}
                        <tr>
                            <td class="uk-text-bold">{{ 'user status'|trans({}, 'user')}}:</td>
                            <td>{{ macros.userStatus(item) }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="uk-margin-left uk-margin-right uk-position-relative">
        <div class="uk-width-1-1 uk-padding-remove uk-margin-small-bottom">    
            <div class="uk-grid uk-margin-small-left uk-margin-top-remove">
                <div class="uk-width-9-10 uk-padding-remove">
                    <div class="toggle-title-{{ item.itemId }}">
                        <div class="uk-panel">
                            <div class="uk-grid">
                                <div class="uk-width-1-1">
                                    <div class="uk-flex">
                                        <div class="uk-margin-right">
                                            {% if not item.modificatorItem.isDeleted and item.modificatorItem.isUser %}
                                                {{ macros.userIconLink(item.modificatorItem) }}
                                            {% else %}
                                                {{ macros.userIcon(item.modificatorItem) }}
                                            {% endif %}
                                        </div>
                                        <div class="uk-margin-right">
                                            {{ 'last changed'|trans({})|capitalize }}: {{item.modificationDate|date("d.m.Y H:i")}}<br/>
                                            {{ 'changed by'|trans({})|capitalize }}: {{ macros.userFullname(item.modificatorItem) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="toggle-title-{{ item.itemId }} uk-hidden">
                        <div class="uk-panel">
                            <div class="uk-grid">
                                <div class="uk-width-2-5">
                                    <div class="uk-flex">
                                        <div class="uk-margin-right">
                                            {% if not item.modificatorItem.isDeleted and item.modificatorItem.isUser %}
                                                {{ macros.userIconLink(item.modificatorItem) }}
                                            {% else %}
                                                {{ macros.userIcon(item.modificatorItem) }}
                                            {% endif %}
                                        </div>
                                        <div class="uk-margin-right">
                                            {{ 'last changed'|trans({})|capitalize }}: {{item.modificationDate|date("d.m.Y H:i")}}<br/>
                                            {{ 'changed by'|trans({})|capitalize }}: {{ macros.userFullname(item.modificatorItem) }}<br/>
                                            {{ 'reference number'|trans({})|capitalize }}: {{ item.itemId }}
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-width-1-5">
                                    <div class="uk-clearfix">
                                        <div class="uk-margin-remove">
                                            {% if not item.creator.isDeleted and item.creator.isUser %}
                                                {{ macros.userIconLink(item.creator) }}
                                            {% else %}
                                                {{ macros.userIcon(item.creator) }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="uk-clearfix">
                                        {{ 'creator'|trans({})}} 
                                    </div>
                                </div>
                                <div class="uk-width-2-5">                           
                                    <div class="uk-clearfix">
                                        <div class="uk-margin-remove">
                                            {% if modifierList[item.itemId] is defined %}
                                                {% if not modifierList[item.itemId] is empty %}
                                                    <div class="uk-flex">
                                                        {% for modifier in modifierList[item.itemId] %}
                                                            <div class="">
                                                                {% if not modifier.isDeleted and modifier.isUser %}
                                                                    {{ macros.userIconLink(modifier) }}
                                                                {% else %}
                                                                    {{ macros.userIcon(modifier) }}
                                                                {% endif %}
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                    </div>                           
                                    {% if modifierList[item.itemId] is defined %}
                                    {% if not modifierList[item.itemId] is empty %}
                                    <div class="uk-clearfix">
                                        {{ 'editors'|trans({})}} 
                                    </div>
                                    {% endif %}
                                    {% endif %}
                                </div>                            
                            </div>                        
                        </div>
                        <div class="uk-panel uk-margin-top">
                            <div class="uk-grid">
                                <div class="uk-width-2-5">                           
                                    <div class="uk-clearfix">
                                        <div class="uk-align-left uk-width-1-1">
                                        {{ 'clicked since last editing'|trans({})}}: <br/>
                                            <div class="uk-progress">
                                                {% set activePercent = (readSinceModificationCount/userCount*100)|round %}
                                                <div class="uk-progress-bar cs-progress-bar" style="width: {{ activePercent }}%;">{{readSinceModificationCount}}</div>
                                            </div>
                                       </div>
                                    </div>                           
                                </div>                            
                                <div class="uk-width-1-5">                            
                                </div>                            
                                <div class="uk-width-2-5">                           
                                    <div class="uk-clearfix">
                                        <div class="uk-align-left uk-width-1-1">
                                        {{ 'clicked since creating'|trans({}) }}: <br/>
                                            <div class="uk-progress">
                                                {% set activePercent = (readCount/userCount*100)|round %}
                                               <div class="uk-progress-bar cs-progress-bar" style="width: {{ activePercent }}%;">{{readCount}}</div>
                                            </div> 
                                        </div>
                                    </div>                           
                                </div>                            
                            </div>                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endmacro %}
