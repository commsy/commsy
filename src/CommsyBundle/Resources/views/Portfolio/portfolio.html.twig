<div class="uk-overflow-container">
    <table id="commsy-portfolio" class="uk-table" border="0">
        <!-- table header row - first cell is empty and sticky, the other cells show the categories-->
        <tr>
            <th class="">
                <div class="uk-panel uk-panel-box uk-panel-box-secondary uk-panel-box-portfolio">
                    <div class="uk-panel-badge">
                    </div>
                    <h3 class="uk-panel-title uk-text-right">
                        <a href="{{ path('commsy_portfolio_edit', {'roomId': roomId, 'portfolioId': portfolioId}) }}" data-uk-tooltip title="{{ 'edit portfolio'|trans({}, 'portfolio') }}" data-uk-tooltip title="{{ 'edit'|trans({}, 'portfolio') }}" data-uk-tooltip title="{{ 'edit'|trans({}, 'portfolio') }}"><i class="uk-icon-edit"></i></a>
                    </h3>
                    <div class="portfolio-content portfolio-description">
                        <span class="uk-text-bold">{{ portfolio.title }}</span><br/>
                        <span class="uk-text-small"><i>{{ user.fullname }}</i></span><br/>
                        {{ portfolio.description }}
                    </div>
                </div>
            </th>
            {% for firstTag in portfolio.tags %}
                {% if firstTag.row == 0 %}
                    <th>
                        <div class="uk-panel uk-panel-box uk-panel-box-secondary uk-panel-box-portfolio">
                            <div class="uk-panel-badge">
                            </div>
                            <h3 class="uk-panel-title uk-text-right">
                                <a href="" data-uk-tooltip title="{{ 'edit'|trans({}, 'portfolio') }}"><i class="uk-icon-edit"></i></a>
                            </h3>
                            <div class="portfolio-content">
                                {{ firstTag.title }}
                            </div>
                        </div>
                    </th>
                {% endif %}
            {% endfor %}
            <th id="portfolio-add-column" class="uk-text-top">
                <a href="" data-uk-tooltip title="{{ 'add column'|trans({}, 'portfolio') }}"><i class="uk-icon-plus uk-icon-small"></i></a>
            </th>
        </tr>
        <!-- rows with categories column (first column; sticky) and content -->
        {% set column = -1 %} <!-- offset of -1 to compensate header column -->
        {% for firstTag in portfolio.tags %}
            {% if firstTag.row != 0 %}
                <tr>
                    {% if firstTag.column == 0 %}
                        <th class="">
                            <div class="uk-panel uk-panel-box uk-panel-box-secondary uk-panel-box-portfolio">
                                <div class="uk-panel-badge">
                                </div>
                                <h3 class="uk-panel-title uk-text-right">
                                    <a href="" data-uk-tooltip title="{{ 'edit'|trans({}, 'portfolio') }}"><i class="uk-icon-edit"></i></a>
                                </h3>
                                <div class="portfolio-content">
                                    {{ firstTag.title }}
                                </div>
                            </div>
                        </th>
                        {% set row = 0 %}
                        {% for secondTag in portfolio.tags %}
                            {% if secondTag.row == 0 %}
                                {% set foundContent = false %}
                                {% set content = '<ul class="uk-list uk-list-line">' %}
                                {% set firstTagId = '' %}
                                {% set secondTagId = '' %}
                                {% for link in linkPositions %}
                                    {% for linkData in link %}
                                        {% if (linkData[0] == firstTag.t_id and linkData[1] == secondTag.t_id) or (linkData[1] == firstTag.t_id and linkData[0] == secondTag.t_id) %}
                                            {% set foundContent = true %}
                                            {% set firstTagId = firstTag.t_id %}
                                            {% set secondTagId = secondTag.t_id %}
                                            {% for firstLink in portfolio.links|keys %}
                                                {% for secondLink in portfolio.links|keys %}
                                                    {% if (firstLink == firstTag.t_id and secondLink == secondTag.t_id) %}
                                                        {% for firstLinkEntry in portfolio.links[firstLink] %}
                                                            {% for secondLinkEntry in portfolio.links[secondLink] %}
                                                                {% if (firstLinkEntry.itemId == secondLinkEntry.itemId) %}
                                                                    {% set content = content ~ '<li><a href=' ~ path('commsy_' ~ firstLinkEntry.itemType ~ '_detail', {'roomId': roomId, 'itemId': firstLinkEntry.itemId}) ~ '>' ~ firstLinkEntry.title|decodeHtmlEntity ~ '</a></li>' %}
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endfor %}
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                                {% set content = content ~ '</ul>' %}
                                <td>
                                    <div class="uk-panel uk-panel-box uk-panel-box-secondary">
                                        <div class="uk-panel-badge">
                                        </div>
                                        <h3 class="uk-panel-title uk-text-right">
                                            {% if foundContent %}
                                                <a href="{{ path('commsy_portfolio_detail', {'roomId': roomId, 'portfolioId': portfolioId, 'firstTagId': firstTagId, 'secondTagId': secondTagId}) }}" data-uk-tooltip title="{{ 'details'|trans({}, 'portfolio') }}"><i class="uk-icon-list"></i></a>
                                            {% else %}
                                                <a href="{{ path('commsy_portfolio_detail', {'roomId': roomId, 'portfolioId': portfolioId, 'firstTagId': firstTag.t_id, 'secondTagId': secondTag.t_id}) }}" data-uk-tooltip title="{{ 'details'|trans({}, 'portfolio') }}"><i class="uk-icon-list"></i></a>
                                            {% endif %}
                                        </h3>
                                        {% if foundContent %}
                                            <div class="portfolio-content">
                                                {{ content|raw }}
                                            </div>
                                            {% set annotationCount = 0 %}
                                            {% if portfolio.numAnnotations[column][row] is defined %}
                                                {% set annotationCount = portfolio.numAnnotations[column][row] %}
                                            {% endif %}
                                            <i class="uk-icon-comments-o uk-text-muted"></i> <span class="uk-text-muted">({{ annotationCount }})</span>
                                        {% else %}
                                            <div class="portfolio-content-empty">
                                            </div>
                                            <i class="uk-icon-comments-o uk-text-muted"></i> <span class="uk-text-muted">(0)</span>
                                        {% endif %}
                                    </div>
                                </td>
                            {% endif %}
                            {% set row = row + 1 %}
                        {% endfor %}
                    {% endif %}
                </tr>
            {% endif %}
            {% set column = column + 1 %}
        {% endfor %}
        <tr>
            <td id="portfolio-add-row">
                <a href="" data-uk-tooltip title="{{ 'add row'|trans({}, 'portfolio') }}"><i class="uk-icon-plus uk-icon-small"></i></a>
            </td>
        </tr>
    </table>
</div>