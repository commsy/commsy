if(!this.JSON)this.JSON={};
(function(){function a(f){return f<10?"0"+f:f}function b(f){h.lastIndex=0;return h.test(f)?'"'+f.replace(h,function(k){var g=o[k];if(typeof g==="string")return g;return"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+f+'"'}function d(f,k){var g,l,r,t,v=m,E,s=k[f];if(s&&typeof s==="object"&&typeof s.toJSON==="function")s=s.toJSON(f);if(typeof i==="function")s=i.call(k,f,s);switch(typeof s){case "string":return b(s);case "number":return isFinite(s)?String(s):"null";case "boolean":case "null":return String(s);
case "object":if(!s)return"null";m+=j;E=[];if(typeof s.length==="number"&&!s.propertyIsEnumerable("length")){t=s.length;for(g=0;g<t;g+=1)E[g]=d(g,s)||"null";r=E.length===0?"[]":m?"[\n"+m+E.join(",\n"+m)+"\n"+v+"]":"["+E.join(",")+"]";m=v;return r}if(i&&typeof i==="object"){t=i.length;for(g=0;g<t;g+=1){l=i[g];if(typeof l==="string")if(r=d(l,s))E.push(b(l)+(m?": ":":")+r)}}else for(l in s)if(Object.hasOwnProperty.call(s,l))if(r=d(l,s))E.push(b(l)+(m?": ":":")+r);r=E.length===0?"{}":m?"{\n"+m+E.join(",\n"+
m)+"\n"+v+"}":"{"+E.join(",")+"}";m=v;return r}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,j,o={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(f,k,g){var l;j=m="";if(typeof g==="number")for(l=0;l<g;l+=1)j+=" ";else if(typeof g==="string")j=g;if((i=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return d("",
{"":f})};if(typeof JSON.parse!=="function")JSON.parse=function(f,k){function g(r,t){var v,E,s=r[t];if(s&&typeof s==="object")for(v in s)if(Object.hasOwnProperty.call(s,v)){E=g(s,v);if(E!==undefined)s[v]=E;else delete s[v]}return k.call(r,t,s)}if(f==null||f=="")return null;var l;c.lastIndex=0;if(c.test(f))f=f.replace(c,function(r){return"\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(f.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+f+")");return typeof k==="function"?g({"":l},""):l}throw new SyntaxError("JSON.parse");}})();if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this instanceof Array){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}};Array.prototype.remove=function(a){if(this instanceof Array){for(var b=0;b<this.length;b++)if(this[b]===a){this.splice(b,1);return true}return false}};
Array.prototype.add=function(a){this instanceof Array&&this.indexOf(a)==-1&&this.push(a)};Array.prototype.clone=function(){if(this instanceof Array)return this.slice(0)};if(!Array.prototype.each)Array.prototype.each=function(a){if(this instanceof Array)for(var b=0;b<this.length;b++)if(a.call(this[b])===false)return};String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};utility={};
utility.createCallback=function(a,b){return{trigger:b!==undefined?b:function(){},owner:a!==undefined?a:window}};utility.triggerCallback=function(a,b){return b instanceof Array?a.trigger.apply(a.owner,b):a.trigger.call(a.owner,b)};utility.throwError=function(a){throw a;};utility.getAbsolutePosition=function(a){return utility.getRelativePosition(a,null)};
utility.getRelativePosition=function(a,b){if(!a)return null;var d;d={left:a.offsetLeft-a.scrollLeft,top:a.offsetTop-a.scrollTop};var c;if(a!==b)for(c=a.offsetParent;c&&c!==b;){d.left+=c.offsetLeft-c.scrollLeft;d.top+=c.offsetTop-c.scrollTop;c=c.offsetParent}return d};utility.getRelativeOffset=function(a,b){var d=utility.getRelativePosition(b,null);a.style.position="static";var c=utility.getRelativePosition(a,null);d={left:c.left-d.left,top:c.top-d.top};a.style.position="relative";return d};
utility.setupStyle=function(a,b){b=b?b:document;b.createStyleSheet?b.createStyleSheet(a):$(b.createElement("link")).attr("rel","stylesheet").attr("type","text/css").attr("href",a).appendTo(b.getElementsByTagName("head")[0])};
utility.getFreeName=function(a,b){function d(m,j,o){if(j==0)for(var i,f=0;f<26;f++){i=m+String.fromCharCode(f+65);if(j==0&&!o.getElementById(i))return i}else for(f=0;f<26;f++){i=m+String.fromCharCode(f+65);i=d(i,j-1,o);if(i!==undefined)return i}}if(b===undefined)b="";for(var c,h=0;(c=d(b,h,a))===undefined;)h++;return c};utility.numberChildElements=function(a){a.contents().each(function(){if(this.nodeType==1&&!this.id)this.id=utility.getFreeName(this.ownerDocument)})};
utility.syncListsUnordered=function(a,b,d,c,h,m){b=b.clone();for(var j,o=[],i=0;i<a.length;i++){var f=a[i];j=false;for(var k=0;k<b.length;k++){var g=b[k];if(h(f,g)){j=true;d(g,f);b.remove(g);break}}if(!j)if(!m||!m(f))o.push(f)}for(i=0;i<b.length;i++){g=b[i];d=c(g);d!=null&&a.push(d)}for(i=0;i<o.length;i++)a.remove(o[i])};
utility.createShadowedArray=function(a,b,d){a.push=function(){for(var c=0;c<arguments.length;c++)b.call(a,arguments[c],a.length+c);return Array.prototype.push.call(a,arguments)};a.splice=function(){for(var c=arguments[0];c<arguments[0]+arguments[1];c++)d.call(a,c);for(c=2;c<arguments.length;c++)b.call(a,arguments[c],arguments[0]+c-2);return Array.prototype.splice.call(a,arguments)};a.remove=function(){var c=a.indexOf(arguments[0]);c>-1&&d.call(a,c);return Array.prototype.remove.call(a,arguments)}};
utility.isInteger=function(a){return!a.length==0&&utility.strContainsOnly(a.substr(0,1)=="-"?a.substr(1):a,"0123456789")};utility.strContainsOnly=function(a,b){for(var d=0;d<a.length;d++)if(b.indexOf(a.charAt(d))==-1)return false;return true};jQuery.fn.replaceElement=function(a,b){for(var d=0;d<this.length;d++)if(this[d]==a){this[d]=b;return}};jQuery.fn.removeMarkerClass=function(){return this.removeClass("marker transparent highlight mine red")};
utility.ClearFormattingConstants={removeAll:1,removeStyle:2,removeClass:4,removeId:8,cleanServer:16,removeNoAttrSpan:32,removeEmptySpan:64};
utility.clearFormatting=function(a,b){function d(){$(this).contents().insertBefore(this);$(this).remove()}var c;c=b.is("div.body")?$("*",b):b.add($("*",b));a&utility.ClearFormattingConstants.removeAll&&c.each(function(){for(var o=this.attributes,i=0;i<o.length;i++)this.removeAttribute(o[i].nodeName)});a&utility.ClearFormattingConstants.removeId&&c.removeAttr("id");a&utility.ClearFormattingConstants.removeStyle&&c.removeAttr("style").filter("font,sub,sup,i,u,s,b,strong,em").each(d);if(a&utility.ClearFormattingConstants.removeClass){var h=
c.filter("img.equation");c.removeClass();h.addClass("equation")}a&utility.ClearFormattingConstants.removeNoAttrSpan&&c.filter("span:empty").each(function(){var o=this.attributes;if(o!=null)for(var i=0;i<o.length;i++)if(o[i].nodeValue&&o[i].nodeValue!="")return false;d.call(this)});a&utility.ClearFormattingConstants.removeEmptySpan&&c.filter("span").each(function(){var o=$(this);o.children().length==0&&o.text().length==0&&d.call(this)});a&utility.ClearFormattingConstants.cleanMarker&&c.removeMarkerClass();
if(a&utility.ClearFormattingConstants.cleanServer){c.filter("pre").each(function(){$(this).children("br").each(function(){$(this).replaceWith(this.ownerDocument.createTextNode("\n"))})});c.not("h1,h2,h3,table,tbody,tr,td,th,span,img,a,p,pre,ol,ul,li,br,sub,sup").each(function(){var o=$(this),i=o.is("strong,b"),f=o.is("em,i"),k=o.is("strike"),g=o.is("u");if(i||f||k||g){var l=$(this.ownerDocument.createElement("span"));i&&l.css("font-weight","bold");f&&l.css("font-style","italic");if(k||g){i=[];k&&
i.push("line-through");g&&i.push("underline");l.css("text-decoration",i.join(" "))}o.replaceWith(l.append(o.contents()))}else o.is("style,script")?o.remove():d.call(this)});var m=["class","id","style","src","alt","title","href","colspan"],j={"0":["marker","transparent","focus","mine","red"],td:["r"],th:["r"],img:["equation","block"]};c=c.filter("h1,h2,h3,table,tbody,tr,td,th,span,img,a,p,pre,ol,ul,li,br,sub,sup").each(function(){var o=this.tagName.toLowerCase(),i=this.attributes;if(i!=null)for(var f=
0;f<i.length;f++){var k=i[f].nodeName.toLowerCase();if(m.indexOf(k)==-1)this.removeAttribute(i[f].nodeName);else if(k=="class"){k=i[f].nodeValue.split(" ");for(var g=[],l=0;l<k.length;l++)if(j["0"].indexOf(k[l])>-1||j[o]&&j[o].indexOf(k[l])>-1)g.push(k[l]);if(g.length>0)i[f].nodeValue=g.join(" ");else this.removeAttribute("class")}}});c.contents().filter(function(){return this.nodeType==8}).remove();c.each(function(){var o=$(this);if(o.attr("style")!==undefined){var i={};[{attr:["font-weight","font-style",
"text-align","text-decoration","direction"]},{is:"img",attr:["styleFloat","cssFloat","width","height","padding","padding-top","padding-right","padding-bottom","padding-left"]},{is:"h1,h2,h3,h4,h5,h6,p,pre",attr:["margin","margin-left","direction"]}].each(function(){if(this.is===undefined||o.is(this.is))for(var f=0;f<this.attr.length;f++){var k=o[0].style[utility.camelCase(this.attr[f],true,"-")];if(k!==undefined&&k!=""&&k!="0px"&&k!="0pt")i[this.attr[f]]=k}});o.removeAttr("style").css(i)}})}};
utility.camelCase=function(a,b,d){if(d===undefined)d="_";var c="";a.split(d).each(function(){c+=this[b?"toLowerCase":"toUpperCase"].call(this.substr(0,1))+this.substr(1);b=false});return c};utility.ucfirst=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)};
utility.getMessageForUploadError=function(a){switch(a){case client.ServerErrors.moveError:return lang.ERROR_MOVE;case client.ServerErrors.illegalType:return lang.ERROR_TYPE;case client.ServerErrors.notEnoughQuota:return lang.ERROR_QUOTA;case client.ServerErrors.fileTooBig:return lang.ERROR_TOO_BIG;case client.ServerErrors.wrongPass:return lang.WRONG_PASSWORD;case client.ServerErrors.serverError:return lang.DATABASE_ERROR;default:return lang.ERROR_WHILE_UPLOADING}};
utility.parseNumRange=function(a){a=a.replace(/ /g,"");a=a.replace(/;/g,",");var b=[];a=a.split(",");for(var d=0;d<a.length;d++){var c=a[d].split("-");if(c.length>0)c[0]=parseInt(c[0]);if(c.length>1)c[1]=parseInt(c[1]);if(c.length==2)for(var h=Math.min(c[0],c[1]);h<=Math.max(c[0],c[1]);h++)b.indexOf(h)==-1&&b.push(h);else c.length==1&&b.indexOf(c[0])==-1&&b.push(c[0])}return b};
utility.createCardsForPages=function(a,b){var d=[];a.each(function(){var c=new client.data.Card,h=lang.SLIDE+" "+this.toString()+" "+lang.FROM.toLowerCase()+" "+b.title;if(h.length>60)h=h.substr(0,57)+"...";c.title=h;c.cardType=client.data.CardTypeConstants.pdf;c.pdf=b;c.page=this;d.push(c)});return d};utility.titleSorter=function(a,b){var d=a.title,c=b.title;if(d==c)return 0;return d.toUpperCase()>c.toUpperCase()?1:-1};
utility.getUserInfo=function(a){var b=$(document.createElement("span")).addClass("modifier");if(a.current){a="("+lang.YOU+")";b.addClass("you")}else a=a.name?a.name:a.id;return b.text(a)};utility.getChangeInfo=function(a,b,d){var c=$(document.createElement("div")).addClass("changes");a=utility.getUserInfo(a).appendTo(c);var h=$(document.createElement("span")).addClass("modified");h.text(utility.getChangeString(b)).appendTo(c);d&&h.after(a);return c};
utility.getChangeString=function(a){function b(c,h,m){if(typeof c!="string")c=c.toString();for(;c.length<m;)c=h+c;return c}var d=new Date;d.setDate(d.getDate()-1);a=a instanceof Date?a:new Date(a*1E3);return a.getTime()<d.getTime()?a.getFullYear()+"-"+b(a.getMonth()+1,"0",2)+"-"+b(a.getDate(),"0",2):b(a.getHours(),"0",2)+":"+b(a.getMinutes(),"0",2)};utility.plural=function(a){a=a.toLowerCase();if(a.substr(a.length-1)!="s")a+="s";return a};
utility.createPanelDialog=function(a,b,d,c,h,m){a=utility.createPanel(a,b,c);a.click(function(j){j.stopPropagation()});b=utility.createToolbar(true).addClass("pad clear").appendTo(a);a.toolbar=b;if(d!==undefined&&h!="-"){if(h==null)h=lang.OK;utility.createMenuItem(null,"ok",h,d,null).attr("accesskey","o").addClass("right").appendTo(b)}if(d!==undefined&&m!="-"){if(m==null)m=lang.CANCEL;utility.createMenuItem(null,"cancel",m,d,null).attr("accesskey","n").addClass("right").appendTo(b)}return a};
utility.createPanel=function(a,b,d){var c=$(document.createElement("div"));b!==null&&c.addClass("dialog");b&&c.css(b);if(d){b=$(document.createElement("h3")).text(d).makeCollapsible();c.append(b)}c.append(a);return c};
jQuery.createEditableLabel=function(){function a(h,m){h.stopPropagation();if(h.type!="keypress"||h.keyCode==13||h.keyCode==27){var j=h.data;j.field.hide();j.link.show();if(!(m&&m.ignore))if(this.value&&this.value.length>0&&(h.type!="keypress"||h.keyCode==13)){var o={cancel:false,focus:true,text:this.value,oldText:j.link.text()};j.link.triggerHandler("afteredit",o);o.cancel!==true&&j.link.text(o.text);h.preventDefault();o.focus&&j.link.get(0).focus()}}}var b=utility.createLink().addClass("label pointer"),
d=$(document.createElement("input")).hide().attr("type","text"),c={link:b,field:d};d.bind("keypress",c,a).bind("blur",c,a).click(function(h){h.stopPropagation()});b.bind("click",c,function(h){h.stopPropagation();h.preventDefault();h=h.data;var m=h.link.text(),j={cancel:false,text:m};h.link.triggerHandler("beforeedit",j);if(j.cancel!==true){h.field.val(m).addClass(h.link.attr("class")).removeClass("pointer").attr("size",m.length>0?m.length:20);j.maxlength&&h.field.attr("maxlength",j.maxlength);h.link.hide();
h.field.show();h.field[0].focus();h.field[0].select()}});return b.add(d).extend({cancelEdit:function(){d.triggerHandler("blur")},text:function(){d.val.apply(d,arguments);var h=b.text.apply(b,arguments);return arguments.length==0?h:this}})};utility.createLink=function(a,b,d){var c=$(document.createElement("a")).attr("href","javascript:void(0)");a!==undefined&&c.text(a);b!==undefined&&c.bind("click",d,b);return c};
utility.createMenu=function(){var a=$(document.createElement("div")).addClass("menu");a.bind("keypress",a,function(b){b.which==27&&!b.shiftKey&&!b.altKey&&!b.metaKey&&b.data.remove()});return a};utility.createMenuItem=function(a,b,d,c,h){d=utility.createLink(d).addClass("item");d.toggleClass("okay",b=="ok");if(c)d.bind("click",h?h:d,c);if(!h&&b)d.action=b;a&&a!=""&&d.addClass("icon").css("background-image","url('"+config.imagePath+a+"')");return d};
utility.createMenuItemSeparator=function(){return $(document.createElement("div")).css("border-top","1px dashed #666").css("margin","4px")};utility.createToolbar=function(a){return $(document.createElement("div")).addClass("toolbar").toggleClass("emboss",a===true).toggleClass("simple",a!==true)};
utility.createButton=function(a,b,d,c,h){a=utility.createLink().addClass("icon").css("background-image","url('"+config.imagePath+a+"')").attr("title",d);if(c)a.bind("click",h?h:a,c);if(!h&&b!==undefined&&b!=null)a.action=b;return a};utility.createMenuButton=function(a,b,d,c,h){a=utility.createLink(a).addClass("item").attr("title",d?d:"");if(c)a.bind("click",h?h:a,c);if(!h&&b)a.action=b;return a};utility.createButtonSeparator=function(){return $(document.createElement("span"))};
utility.createToolbarSeparator=function(){return $(document.createElement("span"))};jQuery.fn.makeCollapsible=function(a){return this.addClass("collapsible expanded pointer").bind("click",a,function(b){var d=$(this).toggleClass("expanded");b=b.data||d.next();jQuery.fn[d.hasClass("expanded")?"slideDown":"slideUp"].call(b)})};jQuery.fn.disableContextMenu=function(){return this.bind("contextmenu",function(a){a.preventDefault()})};
jQuery.setupPanelShifting=function(a,b,d,c,h){a={container:a,content:b,button:d,initialLeftContainer:a.get(0).offsetLeft,initialLeftContent:b.get(0).offsetLeft,shiftContainer:c,shiftContent:h!==undefined?h:c,handler:function(m){var j=this;if(m!==undefined){j=m.data;m.stopPropagation()}m=$(this);var o=j.content;j.container.stop().animate({left:m.hasClass("active")?j.initialLeftContainer:j.initialLeftContainer-c});o.stop().animate({left:m.hasClass("active")?j.initialLeftContent:j.initialLeftContent+
h});m.toggleClass("active")},restore:function(m,j){if(m===undefined)m=function(){$(this).remove()};if(this.button!==undefined){this.button.unbind("click",this.handler);this.button.removeClass("active")}this.container.stop();this.content.stop();jQuery.fn[j?"css":"animate"].apply(this.container,[{left:this.initialLeftContainer}]);jQuery.fn[j?"css":"animate"].apply(this.content,[{left:this.initialLeftContent},{complete:m}]);j&&this.content.each(m);this.callback!==undefined&&this.callback.call(this)},
setup:function(){this.button.bind("click",this,this.handler)}};d!==undefined?a.setup():a.handler();return a};
utility.setupAlerts=function(a){utility.alertbar=$(document.createElement("div")).addClass("mb-cont alert").hide().appendTo(a!==undefined?a:document.body).bind("click",function(b){b.stopPropagation()});$(document.createElement("h2")).text(lang.ALERT_HEADER).appendTo(utility.alertbar);utility.alertbar.label=$(document.createElement("div")).addClass("pad").appendTo(utility.alertbar);a=utility.createToolbar(true).addClass("pad").appendTo(utility.alertbar);utility.alertbar.button=utility.createMenuItem(null,
"ok",lang.OK).addClass("alert-item").click(utility.removeAlerts).appendTo(a);utility.alertSave=window.alert;window.alert=function(b){if(b===undefined||!typeof b)b="undefined";utility.alertbar.label.text(b);utility.alertbar.show();utility.alertbar.button.get(0).focus()}};utility.removeAlerts=function(){utility.alertbar!==undefined&&utility.alertbar.hide()};utility.destroyAlerts=function(){window.alert=utility.alertSave;if(utility.alertbar){utility.alertbar.parent().remove();utility.alertbar.empty()}delete utility.alertbar};
utility.setupLoader=function(a){if(!utility.loader){a=$(document.createElement("div")).addClass("mb-cont loader").appendTo(a!==undefined?a:document.body);utility.loader=$(document.createElement("div")).addClass("text-loader").hide().appendTo(a);$(document.createElement("div")).text(lang.LOADING+"...").appendTo(utility.loader)}};utility.showLoader=function(){if(utility.loader){window.clearTimeout(utility.loaderTimeout);utility.loader.show()}};
utility.hideLoader=function(){utility.loaderTimeout=window.setTimeout(function(){utility.loader.hide()},config.LOADER_DELAY)};utility.destroyLoader=function(){utility.loader&&utility.loader.parent().remove();utility.loader=undefined};
utility.setupHoverHandler=function(a,b,d,c,h,m){function j(f){window.clearTimeout(o);var k=function(){window.clearTimeout(o);d()};if(f.data>0)i=window.setTimeout(k,f.data);else k.call()}if(h===undefined)h=500;if(m===undefined)m=1E3;var o=-1,i=-1;a.bind("contextmenu",function(f){window.clearTimeout(i);d();f.preventDefault()});a.bind(m==-1?"click":"mouseenter",m,j);b.bind("mouseenter",0,j);a.add(b).bind("mouseleave",function(){window.clearTimeout(i);window.clearTimeout(o);o=window.setTimeout(function(){c()},
h)})};
utility.createInput=function(a,b){if(b===undefined)b=document;var d=function(){var h=$(this);h.hasClass("grey")&&h.removeClass("grey").val("")},c=$(b.createElement("input")).attr("type","text");c.bind("keypress",function(h){h.type=="keypress"&&h.keyCode!=13&&h.stopImmediatePropagation()});c.val=function(h){var m=$(this);h!==undefined&&m.removeClass("grey");return m.val(h)};c.blur(function(){var h=$(this),m=h.val();if(!m||m.length==0)h.addClass("grey").val(a).one("focus",d).one("keydown",d)});c.triggerHandler("blur");
return c};utility.createCloser=function(){return utility.createLink().attr("title",lang.CLOSE).addClass("closer right")};
utility.setupDesktop=function(a){a.addClass("mb-desk");["center left","center middle","center right","center markerbar","bottom left","bottom middle","bottom right","bottom bar"].each(function(){$(document.createElement("div")).addClass("desktop background "+this).appendTo(a)});a.cardTools=a.children().disableContextMenu();a.shoutboxLink=utility.createLink().appendTo(a).addClass("button shoutbox-link").attr({accesskey:"!",title:lang.GIVE_US_FEEDBACK}).disableContextMenu();a.noteContainer=$(document.createElement("div")).appendTo(a).addClass("note-container");
a.fullContainer=$(document.createElement("div")).appendTo(a).addClass("full-container").hide()};utility.closeFloat=function(){if(utility.currentFloat!==undefined){if(utility.currentFloat.closeHandler){var a=utility.currentFloat.closeHandler;delete utility.currentFloat.closeHandler;a.call(utility.currentFloat)}utility.currentFloat.fadeOut("normal",function(){$(this).remove()})}utility.currentFloat=undefined};
utility.requestFloat=function(a,b,d){utility.closeFloat();utility.currentFloat=$(document.createElement("div")).addClass("float-container").bind("click",function(c){c.stopPropagation()});utility.currentFloat.closeHandler=d;$(document.body).one("click",utility.closeFloat);utility.createCloser().appendTo(utility.currentFloat).one("click",utility.closeFloat);(b=b||$.browser.msie||$.browser.mozilla)?utility.currentFloat.css("top",0).hide().appendTo(a).fadeIn():utility.currentFloat.css("top",-400).appendTo(a).animate({top:0});
return utility.currentFloat};jQuery.buttonCode=function(a){if(jQuery.browser.msie){switch(a){case 4:return 2;case 1:return 0;case 2:return 1;case 0:return 0}return 0}return a};utility.mozilla={};utility.mozilla.setupEnterKeyHandler=function(a,b){a=a||document;a.addEventListener("keydown",utility.mozilla._keyDownHandler,false);a.addEventListener("DOMNodeInserted",utility.mozilla._domInsertionHandler,false);a.addEventListener("keyup",utility.mozilla._keyUpHandler,false);utility.mozilla._callback=b};
utility.mozilla._keyDownHandler=function(a){if(a.keyCode==13&&!a.altKey&&!a.metaKey&&!a.ctrlKey&&!a.shiftKey){a=a.currentTarget.defaultView.getSelection().getRangeAt(0);var b=a.endContainer;if(!(b.parentNode.firstChild==b&&a.startOffset==0)){if(b.nodeType!=1)b=b.parentNode;b.setAttribute("_mb_temp","true");utility.mozilla._waitForInsertion=false;utility.mozilla._destElement=b}}};var waitForInsertion;
utility.mozilla._domInsertionHandler=function(a){var b=utility.mozilla._destElement;if(b){a=a.target;if(a.nodeType==1&&a.getAttribute("_mb_temp")==b.getAttribute("_mb_temp")&&utility.mozilla._waitForInsertion==true){a.removeAttribute("_mb_temp");utility.mozilla._callback(b,a);b.removeAttribute("_mb_temp");utility.mozilla._destElement=null;utility.mozilla._waitForInsertion=false}if(a.nextSibling){var d=a.ownerDocument.body;b=b;do if(a.nextSibling==b){a.removeAttribute("_mb_temp");utility.mozilla._callback(b,
a);utility.mozilla._waitForInsertion=true;break}while((b=b.parentNode)&&b!=d)}}};utility.mozilla._keyUpHandler=function(a){if(a.keyCode==13&&utility.mozilla._destElement){utility.mozilla._destElement.removeAttribute("_mb_temp");utility.mozilla._destElement=null;utility.mozilla._waitForInsertion=false}};
utility.mozilla.removeEnterKeyHandler=function(a){a=a||document;a.removeEventListener("keydown",utility.mozilla._keyDownHandler,false);a.removeEventListener("DOMNodeInserted",utility.mozilla._domInsertionHandler,false);a.removeEventListener("keyup",utility.mozilla._keyUpHandler,false)};
jQuery.fn.takeSelection=function(a){for(var b=jQuery.getSelection({parent:this,context:this.get(0).ownerDocument});b.is("tbody,tr,td,th");)b=b.contents(":first");a.insertBefore(b.filter(":first"));if(b.length==1&&b.is("span")&&b.attr("id")==""){var d=b;b=b.contents();d.remove()}return a.append(b)};
jQuery.fn.insertNearSelection=function(a,b){var d=jQuery.getSelection({parent:this,context:this.get(0).ownerDocument,collapse:b});if(d.length==0)return false;for(d=d.filter(":first");d.is("tbody,tr,td,th");)d=d.contents(":first");var c=a.insertBefore(d);d.remove();return c};
jQuery.fn.selectNodes=function(a){if(this.length==0)return false;var b=this.get(0).ownerDocument;if(jQuery.browser.msie){var d;this.each(function(){if(this.nodeType==1)if(d){var j=this.ownerDocument.body.createTextRange();j.moveToElementText(this);d.compareEndPoints("StartToStart",j)==1&&d.setEndPoint("StartToStart",j);d.compareEndPoints("EndToEnd",j)==-1&&d.setEndPoint("EndToEnd",j)}else{d=this.ownerDocument.body.createTextRange();d.moveToElementText(this)}});if(d){a!==undefined&&a.collapse!==undefined&&
d.collapse(a.collapse);d.select()}}else{b=b.defaultView.getSelection();if(!b)return;b.removeAllRanges();var c=this.getFirstAndLast();if(!c.first)return;var h=c.first.ownerDocument.createRange();h.selectNodeContents(c.first);var m=c.last.ownerDocument.createRange();m.selectNodeContents(c.last);d=c.first.ownerDocument.createRange();d.setStart(c.first,h.startOffset);d.setEnd(c.last,m.endOffset);if(c.last==c.first&&c.last.tagName.toLowerCase()=="br"){d.setStartBefore(c.first);d.setEndAfter(c.first)}a!==
undefined&&a.collapse!==undefined&&d.collapse(a.collapse);b.addRange(d)}return this};
jQuery.getSelection=function(a){function b(B,J){if(J instanceof jQuery)J=J.get(0);var u=false;do{u=B==J;B=B.parentNode}while(!u&&B!=null);return u}function d(B,J){var u=B.ownerDocument.createElement("span"),w=B,G=B.parentNode;if(!J&&G.childNodes.length==1&&G.tagName.toLowerCase()=="span")return G;if(J)if(c){var M=J.text.length,x=B.nodeValue.length;if(M==x&&B.parentNode.tagName.toLowerCase()=="span"&&B.parentNode.childNodes.length==1)return B.parentNode;var I=B.ownerDocument.body.createTextRange();
utility.moveToElementText(I,B);I.setEndPoint("EndToStart",J);I=I.text.length;if(I>0)if(I<x)w=B=B.splitText(I);else{w=B.nextSibling;B=null}if(I<x&&M+I<x)w=B=B.splitText(M).previousSibling}else{if(B.nodeType==h&&B.parentNode.childNodes.length==1&&J.startOffset==0&&J.endOffset==B.nodeValue.length&&B.parentNode.tagName.toLowerCase()=="span")return B.parentNode;J.surroundContents(u);return u}G.insertBefore(u,w);B&&u.appendChild(B);return u}var c=jQuery.browser.msie,h=3;a=jQuery.extend({context:document,
disableSurrounding:false,returnNullIfCollapsed:false,allowTextNodes:false,parent:null},a!==undefined?a:{});var m;if(c){a.context.parentWindow.focus();m=a.context.selection}else{a.context.defaultView.focus();m=a.context.defaultView.getSelection()}var j=m.isCollapsed||m.type=="None";if(j&&a.returnNullIfCollapsed)return null;var o=[],i=[];if(c){var f=m.createRange();i.push(f);if(m.type=="Text"&&f.text.length==0){j=true;if(a.returnNullIfCollapsed)return null}}else for(var k=0;k<m.rangeCount;k++)i.push(m.getRangeAt(k));
for(k=0;k<i.length;k++){f=i[k];if(a.collapse!==undefined){f.collapse(a.collapse);j=true}if(c&&!f.parentElement)for(var g=0;g<f.length;g++)o.push(f.item(g));else{var l=[];g=c?f.parentElement():f.commonAncestorContainer;var r=c?utility.getOuter(f,false):f.endContainer,t=c?m.type=="None"?r:utility.getOuter(f,true):f.startContainer;if(t==t.ownerDocument.body&&j){t=t.ownerDocument.createTextNode("");t.ownerDocument.body.appendChild(t)}if(!(a.parent!=null&&(!b(t,a.parent)||!b(r,a.parent))))if(!a.disableSurrounding&&
(t.nodeType==h&&t==r||t.nodeType==h&&j)){var v;v=d(t,f);o.push(v)}else{var E;if(t.nodeType==h){if(!a.disableSurrounding){j=false;if(c){var s=a.context.body.createTextRange();utility.moveToElementText(s,t);s.setEndPoint("StartToStart",f);j=s.text.length==0}else{s=a.context.createRange();s.selectNode(t);s.setStart(t,f.startOffset);j=s.collapsed}if(j)E=true;else t=d(t,s)}}else if(!c)if(t.childNodes.length>f.startOffset)t=t.childNodes[f.startOffset];s=[t];v=t;if(t!=g)for(;(v=v.parentNode)&&v!=g;)s.unshift(v);
var D;if(r.nodeType==h){if(!a.disableSurrounding){j=false;if(c){v=a.context.body.createTextRange();utility.moveToElementText(v,r);v.setEndPoint("EndToEnd",f);j=v.text.length==0}else{v=a.context.createRange();v.selectNode(r);v.setEnd(r,f.endOffset);j=v.collapsed}if(j)D=true;else r=d(r,v)}}else if(!c)r=(D=r.childNodes.length!=f.endOffset)?r.childNodes[f.endOffset]:r.lastChild?r.lastChild:r;f=[r];v=r;if(r!=g)for(;(v=v.parentNode)&&v!=g;)f.unshift(v);var q=s.length>f.length?f.length:s.length;v=-1;var H,
A;for(g=0;g<q;g++){H=s[g];A=f[g];if(H!=A){v=g;break}}E||l.push(t);if(v>-1){for(g=s.length-1;g>v;g--){t=s[g];for(a.disableSurrounding&&l.push(t);t=t.nextSibling;)l.push(t)}for(a.disableSurrounding&&l.push(H);(H=H.nextSibling)&&H!=A;)if(H.nodeType!=h||a.allowTextNodes||!a.disableSurrounding)l.push(H);a.disableSurrounding&&H!=null&&l.push(H);for(g=v+1;g<f.length;g++){t=f[g];s=l.length;for(a.disableSurrounding&&l.splice(s,0,t);t=t.previousSibling;)l.splice(s,0,t)}D||l.push(r)}for(g=0;g<l.length;g++){r=
l[g];if(r.nodeType==h){if(r.nodeValue.length>0||l.length==1)if(a.disableSurrounding)a.allowTextNodes?o.push(r):o.push(r.parentNode);else o.push(d(r))}else o.push(r)}}}}a.disableSurrounding||(c?m.empty():m.removeAllRanges());return jQuery(o)};
jQuery.storeSelection=function(a){var b=jQuery.browser.msie,d=0,c;if(b){a.context.parentWindow.focus();a=a.context.selection;c=a.createRange();c.collapse(true);d={};a=utility.getOuter(c,true,d);d=d.offset}else{a.context.defaultView.focus();a=a.context.defaultView.getSelection();if(!a)return;try{c=a.getRangeAt(0)}catch(h){return}c.collapse(true);a=c.endContainer}var m=-1;if(a.nodeType==3){if(!b)d=c.startOffset;b=a.parentNode;for(c=0;c<b.childNodes.length;c++)if(b.childNodes[c]===a){m=c;break}a=b}else if(!b){if((d=
a.childNodes.item(c.startOffset))&&d.nodeType==1)a=d;if(!a)return;d=-1}return{id:a.getAttribute("id"),offset:m,textOffset:d}};
jQuery.restoreSelection=function(a,b){if(!a.id)return false;var d=jQuery.browser.msie,c=b.context.getElementById(a.id);if(!c)return false;if(a.offset>-1&&!d)if(c.childNodes.length>a.offset)c=c.childNodes[a.offset];else return;var h;try{if(d){h=b.context.body.createTextRange();h.moveToElementText(c);a.textOffset>-1&&h.moveStart("character",a.textOffset);h.collapse(true);h.select()}else{var m=b.context.defaultView.getSelection();m.removeAllRanges();h=b.context.createRange();h.selectNodeContents(c);
c.nodeType==1&&c.tagName.toLowerCase()=="br"&&h.setStartBefore(c);a.textOffset>-1&&h.setStart(c,a.textOffset);h.collapse(true);m.addRange(h)}}catch(j){return false}return true};
utility.moveToElementText=function(a,b){if(b.nodeType==1)a.moveToElementText(b);else{var d=b.parentNode;a.moveToElementText(d);for(var c=0,h=0;h<d.childNodes.length;h++){c=d.childNodes[h];if(c==b){a.moveStart("character",1);a.moveStart("character",-1);a.collapse(true);a.moveEnd("character",b.length);return}if(c.nodeType==3){c=c.length;a.moveStart("character",c);for(c="";(c=a.text.substr(0,1))&&(c=="\n"||c=="\r");)a.moveStart("word",1)}else{var m=c.ownerDocument.body.createTextRange();m.moveToElementText(c);
a.setEndPoint("StartToEnd",m)}}}};
utility.getOuter=function(a,b,d){var c=a.duplicate();c.collapse(b);a=c.parentElement();var h=a.ownerDocument.body.createTextRange();h.moveToElementText(a);h.setEndPoint("EndToStart",c);c=h.text;c=utility.removeBreaks(c);c=c.length;if(d!==undefined)d.offset=c;for(d=a.firstChild;d;){if(d.nodeType==3){c-=d.nodeValue.length;if(b?c<0:c<=0)return d}else if(d.firstChild){d=d.firstChild;continue}if(d.nextSibling)d=d.nextSibling;else for(;d=d.parentNode;){if(d==a)return a;if(d.nextSibling){d=d.nextSibling;
break}}}return a};utility.removeBreaks=function(a){for(var b="",d=0;d<a.length;d++)if(a.charAt(d)!="\r"&&a.charAt(d)!="\n")b+=a.charAt(d);return b};jQuery.fn.getFirstAndLast=function(){var a,b;this.each(function(){for(var d=this;d!=this.ownerDocument.body&&(d=d.parentNode););if(d)if(a)b=this;else a=b=this});return{first:a,last:b}};jQuery.fn.containsVisibleElements=function(){for(var a=0;a<this.length;a++){for(var b=this[a];(b=b.parentNode)&&b!=this[a].ownerDocument.body;);if(b)return true}return false};
jQuery.fn.getRangeHeight=function(){var a=this.getFirstAndLast(),b=utility.getAbsolutePosition(a.first).top;return utility.getAbsolutePosition(a.last).top+a.last.offsetHeight-b};
jQuery.fn.toRangeString=function(){function a(j,o){var i=[];if(j.parentNode){do{for(var f=-1,k=0;k<j.parentNode.childNodes.length;k++)if(j.parentNode.childNodes[k]==j){f=k;break}i.unshift({id:j.id,pos:f,tag:j.tagName})}while((j=j.parentNode)&&j.parentNode&&j!=o);return i}}var b=this.get(),d=[];if(b.length>0){bodyNode=$(b[0]).closest("div.body").get(0);for(var c=0;c<b.length;c++){for(var h=b[c],m=h;(m=m.parentNode)&&m!=bodyNode;);m&&d.push(a(h,bodyNode))}return JSON.stringify(d)}else return null};
jQuery.fn.focusFirstEditable=function(){var a=$("(a,input,button,select,textarea):first",this);a.length==1&&a.get(0).focus();return this};
jQuery.fromRangeString=function(a,b){function d(o,i){for(var f=o.length-1;f>-1;f--){var k=o[f],g=k.id!=""?i.ownerDocument.getElementById(k.id):null;if(!g&&f==0)g=i;if(g){for(f=f+1;f<o.length;f++){k=o[f];if(g.childNodes.length>k.pos&&g.childNodes[k.pos].nodeType==1)g=g.childNodes.length>k.pos?g.childNodes[k.pos]:g;else{k=g.getElementsByTagName(k.tag);if(!k||!k[0])break;g=k[0]}}return g==i?null:g}}return null}if(a==null)return null;for(var c=JSON.parse(a),h=[],m=0;m<c.length;m++){var j=d(c[m],b);j&&
h.push(j)}return jQuery(h)};jQuery.getSelectionText=function(a){a=a?a:document;return jQuery.browser.msie?a.selection.createRange().text:a.defaultView.getSelection().toString()};jQuery.clearSelection=function(a){a=a?a:document;jQuery.browser.msie?a.selection.empty():a.defaultView.getSelection().removeAllRanges()};
jQuery.hasSelection=function(a){if(a instanceof jQuery)a=a.get(0).ownerDocument;a=a?a:document;if(jQuery.browser.msie){a=a.selection;if(a.type=="None")return false;if(a.type=="Text")return a.createRange().text.length>0;return true}else{a=a.defaultView.getSelection();return a!=null&&!a.isCollapsed}};
jQuery.fn.htmlWithStructure=function(a){function b(j,o){for(var i=o.childNodes.length-1;i>=0;i--){var f=j.childNodes[i],k=o.childNodes[i];if(f!==undefined&&k!==undefined){f.nodeType==1&&k.nodeType==1&&b(f,k);m.indexOf(f)==-1&&k.parentNode.removeChild(k)}}}var d=this.get(0).ownerDocument,c=d.body;if(jQuery.browser.msie){var h="<div>"+$(d.body).html()+"</div>";d=$(h,d).get(0)}else d=$(c).clone().get(0);var m=[];this.each(function(){function j(i){if(i.nodeType==1)for(var f=0;f<i.childNodes.length;f++){m.push(i.childNodes[f]);
j(i.childNodes[f])}}var o=this;for(j(o);o!=o.ownerDocument.body;){m.push(o);o=o.parentNode}m.push(o)});b(c,d);a!==undefined&&$("*",d).each(a);return $(d).html()};jQuery.balloon={FOCUS_CLASS:"balloonFocus",IMAGE_BODY:"balloon-body.gif",IMAGE_TOP:"balloon-top.gif",IMAGE_BOTTOM:"balloon-bottom.gif"};jQuery.balloon.BalloonPositionConstants={topLeft:0,topMiddle:1,topRight:2,bottomLeft:3,bottomMiddle:4,bottomRight:5,centerLeft:6,centerMiddle:7,centerRight:8};
jQuery.showBalloon=function(a,b,d,c,h,m,j,o){function i(g,l){g!==undefined&&g!=null&&g.call(this,null);if(l!==undefined)if(l instanceof Array){var r;if(r=l.shift())return r.call(this,l)}return null}var f=$(document.createElement("div"));b instanceof jQuery?f.append(b):f.html(b);if(h&&m){if(h[m]==true)return i.apply(a[0],[c,j]);var k=$(document.createElement("input")).attr({type:"checkbox",id:b=utility.getFreeName(document)}).appendTo(f).bind("click",function(){if(this.checked)h[m]=true;else delete h[m]});
if(o){k.get(0).checked=true;h[m]=true}$(document.createElement("label")).attr({"for":b}).text(lang.DO_NOT_SHOW_AGAIN).insertAfter(k)}o=f.addClass("balloon").click(function(g){g.stopPropagation()});a.addClass(jQuery.balloon.FOCUS_CLASS);o.element=a;o.remove=function(){this.element.removeClass(jQuery.balloon.FOCUS_CLASS);jQuery.fn.fadeOut.apply(this,[200,function(){$(this).remove()}])};$(document.createElement("img")).attr({src:config.imagePath+"remark-small.png"}).css({"float":"left","padding-right":3}).prependTo(f);
utility.createButton("close-small.png",null,lang.CLOSE).css({"float":"right",width:16,height:16}).bind("click",[a[0],c,j],function(g){$(g.data[0]).removeClass(jQuery.balloon.FOCUS_CLASS);i.apply(g.data[0],g.data.slice(1,3));$(this).parent().fadeOut(300,function(){$(this).remove()})}).prependTo(f);j=a.closest("div.mb-cont");if(j.length==0)j=a.parent();o.appendTo(j);c={width:200};a=a.get(0);f=utility.getRelativePosition(a,j.get(0));f={l:f.left,t:f.top};f.r=f.l+a.offsetWidth;f.b=f.t+a.offsetHeight;b=
j.height();j=j.width();switch(d){case jQuery.balloon.BalloonPositionConstants.topLeft:c.right=j-f.l+5;c.bottom=b-f.t+5;break;case jQuery.balloon.BalloonPositionConstants.topMiddle:c.right=j-f.l-108-a.offsetWidth/2;c.bottom=b-f.t+5;break;case jQuery.balloon.BalloonPositionConstants.topRight:c.left=f.r;c.bottom=b-f.t+5;break;case jQuery.balloon.BalloonPositionConstants.bottomLeft:c.right=j-f.l+5;c.top=f.b+5;break;case jQuery.balloon.BalloonPositionConstants.bottomMiddle:c.right=j-f.l-Math.round(a.offsetWidth/
2+108);c.top=f.b+5;break;case jQuery.balloon.BalloonPositionConstants.bottomRight:c.left=f.r;c.top=f.b+5;break;case jQuery.balloon.BalloonPositionConstants.centerLeft:c.right=j-f.l+5;c.bottom=b-f.t+5-a.offsetHeight;break;case jQuery.balloon.BalloonPositionConstants.centerRight:c.left=f.r;c.bottom=b-f.t+5-a.offsetHeight;break}o.hide().css(c).fadeIn();return o};
(function(a){a.ui=a.ui||{};if(!a.ui.version){a.extend(a.ui,{version:"1.8.2",plugin:{add:function(b,d,c){b=a.ui[b].prototype;for(var h in c){b.plugins[h]=b.plugins[h]||[];b.plugins[h].push([d,c[h]])}},call:function(b,d,c){if((d=b.plugins[d])&&b.element[0].parentNode)for(var h=0;h<d.length;h++)b.options[d[h][0]]&&d[h][1].apply(b.element,c)}},contains:function(b,d){return document.compareDocumentPosition?b.compareDocumentPosition(d)&16:b!==d&&b.contains(d)},hasScroll:function(b,d){if(a(b).css("overflow")==
"hidden")return false;d=d&&d=="left"?"scrollLeft":"scrollTop";var c=false;if(b[d]>0)return true;b[d]=1;c=b[d]>0;b[d]=0;return c},isOverAxis:function(b,d,c){return b>d&&b<d+c},isOver:function(b,d,c,h,m,j){return a.ui.isOverAxis(b,c,m)&&a.ui.isOverAxis(d,h,j)},keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,
NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});a.fn.extend({_focus:a.fn.focus,focus:function(b,d){return typeof b==="number"?this.each(function(){var c=this;setTimeout(function(){a(c).focus();d&&d.call(c)},b)}):this._focus.apply(this,arguments)},enableSelection:function(){return this.attr("unselectable","off").css("MozUserSelect","")},disableSelection:function(){return this.attr("unselectable","on").css("MozUserSelect",
"none")},scrollParent:function(){var b;b=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",
1))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(b){if(b!==undefined)return this.css("zIndex",b);if(this.length){b=a(this[0]);for(var d;b.length&&b[0]!==document;){d=b.css("position");if(d=="absolute"||d=="relative"||d=="fixed"){d=parseInt(b.css("zIndex"));if(!isNaN(d)&&d!=0)return d}b=b.parent()}}return 0}});a.extend(a.expr[":"],{data:function(b,d,c){return!!a.data(b,c[3])},focusable:function(b){var d=b.nodeName.toLowerCase(),c=a.attr(b,"tabindex");return(/input|select|textarea|button|object/.test(d)?
!b.disabled:"a"==d||"area"==d?b.href||!isNaN(c):!isNaN(c))&&!a(b)["area"==d?"parents":"closest"](":hidden").length},tabbable:function(b){var d=a.attr(b,"tabindex");return(isNaN(d)||d>=0)&&a(b).is(":focusable")}})}})(jQuery);
(function(a){var b=a.fn.remove;a.fn.remove=function(d,c){return this.each(function(){if(!c)if(!d||a.filter(d,[this]).length)a("*",this).add(this).each(function(){a(this).triggerHandler("remove")});return b.call(a(this),d,c)})};a.widget=function(d,c,h){var m=d.split(".")[0],j;d=d.split(".")[1];j=m+"-"+d;if(!h){h=c;c=a.Widget}a.expr[":"][j]=function(o){return!!a.data(o,d)};a[m]=a[m]||{};a[m][d]=function(o,i){arguments.length&&this._createWidget(o,i)};c=new c;c.options=a.extend({},c.options);a[m][d].prototype=
a.extend(true,c,{namespace:m,widgetName:d,widgetEventPrefix:a[m][d].prototype.widgetEventPrefix||d,widgetBaseClass:j},h);a.widget.bridge(d,a[m][d])};a.widget.bridge=function(d,c){a.fn[d]=function(h){var m=typeof h==="string",j=Array.prototype.slice.call(arguments,1),o=this;h=!m&&j.length?a.extend.apply(null,[true,h].concat(j)):h;if(m&&h.substring(0,1)==="_")return o;m?this.each(function(){var i=a.data(this,d),f=i&&a.isFunction(i[h])?i[h].apply(i,j):i;if(f!==i&&f!==undefined){o=f;return false}}):this.each(function(){var i=
a.data(this,d);if(i){h&&i.option(h);i._init()}else a.data(this,d,new c(h,this))});return o}};a.Widget=function(d,c){arguments.length&&this._createWidget(d,c)};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(d,c){this.element=a(c).data(this.widgetName,this);this.options=a.extend(true,{},this.options,a.metadata&&a.metadata.get(c)[this.widgetName],d);var h=this;this.element.bind("remove."+this.widgetName,function(){h.destroy()});this._create();
this._init()},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(d,c){var h=d,m=this;if(arguments.length===0)return a.extend({},m.options);if(typeof d==="string"){if(c===undefined)return this.options[d];h={};h[d]=c}a.each(h,function(j,
o){m._setOption(j,o)});return m},_setOption:function(d,c){this.options[d]=c;if(d==="disabled")this.widget()[c?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",c);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(d,c,h){var m=this.options[d];c=a.Event(c);c.type=(d===this.widgetEventPrefix?d:this.widgetEventPrefix+d).toLowerCase();h=h||{};if(c.originalEvent){d=
a.event.props.length;for(var j;d;){j=a.event.props[--d];c[j]=c.originalEvent[j]}}this.element.trigger(c,h);return!(a.isFunction(m)&&m.call(this.element[0],c,h)===false||c.isDefaultPrevented())}}})(jQuery);
(function(a){a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(d){return b._mouseDown(d)}).bind("click."+this.widgetName,function(d){if(b._preventClickEvent){b._preventClickEvent=false;d.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(b){b.originalEvent=b.originalEvent||{};if(!b.originalEvent.mouseHandled){this._mouseStarted&&
this._mouseUp(b);this._mouseDownEvent=b;var d=this,c=b.which==1,h=typeof this.options.cancel=="string"?a(b.target).parents().add(b.target).filter(this.options.cancel).length:false;if(!c||h||!this._mouseCapture(b))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==false;if(!this._mouseStarted){b.preventDefault();
return true}}this._mouseMoveDelegate=function(m){return d._mouseMove(m)};this._mouseUpDelegate=function(m){return d._mouseUp(m)};a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);a.browser.safari||b.preventDefault();return b.originalEvent.mouseHandled=true}},_mouseMove:function(b){if(a.browser.msie&&!b.button)return this._mouseUp(b);if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault()}if(this._mouseDistanceMet(b)&&
this._mouseDelayMet(b))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==false)?this._mouseDrag(b):this._mouseUp(b);return!this._mouseStarted},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=b.target==this._mouseDownEvent.target;this._mouseStop(b)}return false},_mouseDistanceMet:function(b){return Math.max(Math.abs(this._mouseDownEvent.pageX-
b.pageX),Math.abs(this._mouseDownEvent.pageY-b.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);
(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper==
"original"&&!/^(?:r|a|f)/.test(this.element.css("position")))this.element[0].style.position="relative";this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this}},_mouseCapture:function(b){var d=
this.options;if(this.helper||d.disabled||a(b.target).is(".ui-resizable-handle"))return false;this.handle=this._getHandle(b);if(!this.handle)return false;return true},_mouseStart:function(b){var d=this.options;this.helper=this._createHelper(b);this._cacheHelperProportions();if(a.ui.ddmanager)a.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-
this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(b);this.originalPageX=b.pageX;this.originalPageY=b.pageY;d.cursorAt&&this._adjustOffsetFromHelper(d.cursorAt);d.containment&&this._setContainment();if(this._trigger("start",b)===false){this._clear();return false}this._cacheHelperProportions();
a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(b,true);return true},_mouseDrag:function(b,d){this.position=this._generatePosition(b);this.positionAbs=this._convertPositionTo("absolute");if(!d){d=this._uiHash();if(this._trigger("drag",b,d)===false){this._mouseUp({});return false}this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||
this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";a.ui.ddmanager&&a.ui.ddmanager.drag(this,b);return false},_mouseStop:function(b){var d=false;if(a.ui.ddmanager&&!this.options.dropBehaviour)d=a.ui.ddmanager.drop(this,b);if(this.dropped){d=this.dropped;this.dropped=false}if(!this.element[0]||!this.element[0].parentNode)return false;if(this.options.revert=="invalid"&&!d||this.options.revert=="valid"&&d||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,
d)){var c=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==false&&c._clear()})}else this._trigger("stop",b)!==false&&this._clear();return false},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(b){var d=!this.options.handle||!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==
b.target)d=true});return d},_createHelper:function(b){var d=this.options;b=a.isFunction(d.helper)?a(d.helper.apply(this.element[0],[b])):d.helper=="clone"?this.element.clone():this.element;b.parents("body").length||b.appendTo(d.appendTo=="parent"?this.element[0].parentNode:d.appendTo);b[0]!=this.element[0]&&!/(fixed|absolute)/.test(b.css("position"))&&b.css("position","absolute");return b},_adjustOffsetFromHelper:function(b){if(typeof b=="string")b=b.split(" ");if(a.isArray(b))b={left:+b[0],top:+b[1]||
0};if("left"in b)this.offset.click.left=b.left+this.margins.left;if("right"in b)this.offset.click.left=this.helperProportions.width-b.right+this.margins.left;if("top"in b)this.offset.click.top=b.top+this.margins.top;if("bottom"in b)this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],
this.offsetParent[0])){b.left+=this.scrollParent.scrollLeft();b.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var b=this.element.position();return{top:b.top-
(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;if(b.containment==
"parent")b.containment=this.helper[0].parentNode;if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&
b.containment.constructor!=Array){var d=a(b.containment)[0];if(d){b=a(b.containment).offset();var c=a(d).css("overflow")!="hidden";this.containment=[b.left+(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0)-this.margins.left,b.top+(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0)-this.margins.top,b.left+(c?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),
10)||0)-this.helperProportions.width-this.margins.left,b.top+(c?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}}else if(b.containment.constructor==Array)this.containment=b.containment},_convertPositionTo:function(b,d){if(!d)d=this.position;b=b=="absolute"?1:-1;var c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],
this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(c[0].tagName);return{top:d.top+this.offset.relative.top*b+this.offset.parent.top*b-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:c.scrollTop())*b),left:d.left+this.offset.relative.left*b+this.offset.parent.left*b-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():
h?0:c.scrollLeft())*b)}},_generatePosition:function(b){var d=this.options,c=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(c[0].tagName),m=b.pageX,j=b.pageY;if(this.originalPosition){if(this.containment){if(b.pageX-this.offset.click.left<this.containment[0])m=this.containment[0]+this.offset.click.left;if(b.pageY-this.offset.click.top<this.containment[1])j=this.containment[1]+
this.offset.click.top;if(b.pageX-this.offset.click.left>this.containment[2])m=this.containment[2]+this.offset.click.left;if(b.pageY-this.offset.click.top>this.containment[3])j=this.containment[3]+this.offset.click.top}if(d.grid){j=this.originalPageY+Math.round((j-this.originalPageY)/d.grid[1])*d.grid[1];j=this.containment?!(j-this.offset.click.top<this.containment[1]||j-this.offset.click.top>this.containment[3])?j:!(j-this.offset.click.top<this.containment[1])?j-d.grid[1]:j+d.grid[1]:j;m=this.originalPageX+
Math.round((m-this.originalPageX)/d.grid[0])*d.grid[0];m=this.containment?!(m-this.offset.click.left<this.containment[0]||m-this.offset.click.left>this.containment[2])?m:!(m-this.offset.click.left<this.containment[0])?m-d.grid[0]:m+d.grid[0]:m}}return{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:c.scrollTop()),left:m-this.offset.click.left-
this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:c.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false},_trigger:function(b,d,c){c=c||this._uiHash();a.ui.plugin.call(this,b,[d,c]);if(b=="drag")this.positionAbs=
this._convertPositionTo("absolute");return a.Widget.prototype._trigger.call(this,b,d,c)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});a.extend(a.ui.draggable,{version:"1.8.2"});a.ui.plugin.add("draggable","connectToSortable",{start:function(b,d){var c=a(this).data("draggable"),h=c.options,m=a.extend({},d,{item:c.element});c.sortables=[];a(h.connectToSortable).each(function(){var j=a.data(this,"sortable");
if(j&&!j.options.disabled){c.sortables.push({instance:j,shouldRevert:j.options.revert});j._refreshItems();j._trigger("activate",b,m)}})},stop:function(b,d){var c=a(this).data("draggable"),h=a.extend({},d,{item:c.element});a.each(c.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;c.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(b);this.instance.options.helper=this.instance.options._helper;
c.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",b,h)}})},drag:function(b,d){var c=a(this).data("draggable"),h=this;a.each(c.sortables,function(){this.instance.positionAbs=c.positionAbs;this.instance.helperProportions=c.helperProportions;this.instance.offset.click=c.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=
1;this.instance.currentItem=a(h).clone().appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return d.helper[0]};b.target=this.instance.currentItem[0];this.instance._mouseCapture(b,true);this.instance._mouseStart(b,true,true);this.instance.offset.click.top=c.offset.click.top;this.instance.offset.click.left=c.offset.click.left;this.instance.offset.parent.left-=c.offset.parent.left-this.instance.offset.parent.left;
this.instance.offset.parent.top-=c.offset.parent.top-this.instance.offset.parent.top;c._trigger("toSortable",b);c.dropped=this.instance.element;c.currentItem=c.element;this.instance.fromOutside=c}this.instance.currentItem&&this.instance._mouseDrag(b)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",b,this.instance._uiHash(this.instance));this.instance._mouseStop(b,true);this.instance.options.helper=
this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();c._trigger("fromSortable",b);c.dropped=false}})}});a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),d=a(this).data("draggable").options;if(b.css("cursor"))d._cursor=b.css("cursor");b.css("cursor",d.cursor)},stop:function(){var b=a(this).data("draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}});a.ui.plugin.add("draggable","iframeFix",{start:function(){var b=
a(this).data("draggable").options;a(b.iframeFix===true?"iframe":b.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css(a(this).offset()).appendTo("body")})},stop:function(){a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}});a.ui.plugin.add("draggable","opacity",{start:function(b,d){b=a(d.helper);d=a(this).data("draggable").options;
if(b.css("opacity"))d._opacity=b.css("opacity");b.css("opacity",d.opacity)},stop:function(b,d){b=a(this).data("draggable").options;b._opacity&&a(d.helper).css("opacity",b._opacity)}});a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("draggable");if(b.scrollParent[0]!=document&&b.scrollParent[0].tagName!="HTML")b.overflowOffset=b.scrollParent.offset()},drag:function(b){var d=a(this).data("draggable"),c=d.options,h=false;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!=
"HTML"){if(!c.axis||c.axis!="x")if(d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity)d.scrollParent[0].scrollTop=h=d.scrollParent[0].scrollTop+c.scrollSpeed;else if(b.pageY-d.overflowOffset.top<c.scrollSensitivity)d.scrollParent[0].scrollTop=h=d.scrollParent[0].scrollTop-c.scrollSpeed;if(!c.axis||c.axis!="y")if(d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity)d.scrollParent[0].scrollLeft=h=d.scrollParent[0].scrollLeft+c.scrollSpeed;else if(b.pageX-
d.overflowOffset.left<c.scrollSensitivity)d.scrollParent[0].scrollLeft=h=d.scrollParent[0].scrollLeft-c.scrollSpeed}else{if(!c.axis||c.axis!="x")if(b.pageY-a(document).scrollTop()<c.scrollSensitivity)h=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed);else if(a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity)h=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed);if(!c.axis||c.axis!="y")if(b.pageX-a(document).scrollLeft()<c.scrollSensitivity)h=a(document).scrollLeft(a(document).scrollLeft()-
c.scrollSpeed);else if(a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity)h=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed)}h!==false&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}});a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("draggable"),d=b.options;b.snapElements=[];a(d.snap.constructor!=String?d.snap.items||":data(draggable)":d.snap).each(function(){var c=a(this),h=c.offset();this!=b.element[0]&&b.snapElements.push({item:this,
width:c.outerWidth(),height:c.outerHeight(),top:h.top,left:h.left})})},drag:function(b,d){for(var c=a(this).data("draggable"),h=c.options,m=h.snapTolerance,j=d.offset.left,o=j+c.helperProportions.width,i=d.offset.top,f=i+c.helperProportions.height,k=c.snapElements.length-1;k>=0;k--){var g=c.snapElements[k].left,l=g+c.snapElements[k].width,r=c.snapElements[k].top,t=r+c.snapElements[k].height;if(g-m<j&&j<l+m&&r-m<i&&i<t+m||g-m<j&&j<l+m&&r-m<f&&f<t+m||g-m<o&&o<l+m&&r-m<i&&i<t+m||g-m<o&&o<l+m&&r-m<f&&
f<t+m){if(h.snapMode!="inner"){var v=Math.abs(r-f)<=m,E=Math.abs(t-i)<=m,s=Math.abs(g-o)<=m,D=Math.abs(l-j)<=m;if(v)d.position.top=c._convertPositionTo("relative",{top:r-c.helperProportions.height,left:0}).top-c.margins.top;if(E)d.position.top=c._convertPositionTo("relative",{top:t,left:0}).top-c.margins.top;if(s)d.position.left=c._convertPositionTo("relative",{top:0,left:g-c.helperProportions.width}).left-c.margins.left;if(D)d.position.left=c._convertPositionTo("relative",{top:0,left:l}).left-c.margins.left}var q=
v||E||s||D;if(h.snapMode!="outer"){v=Math.abs(r-i)<=m;E=Math.abs(t-f)<=m;s=Math.abs(g-j)<=m;D=Math.abs(l-o)<=m;if(v)d.position.top=c._convertPositionTo("relative",{top:r,left:0}).top-c.margins.top;if(E)d.position.top=c._convertPositionTo("relative",{top:t-c.helperProportions.height,left:0}).top-c.margins.top;if(s)d.position.left=c._convertPositionTo("relative",{top:0,left:g}).left-c.margins.left;if(D)d.position.left=c._convertPositionTo("relative",{top:0,left:l-c.helperProportions.width}).left-c.margins.left}if(!c.snapElements[k].snapping&&
(v||E||s||D||q))c.options.snap.snap&&c.options.snap.snap.call(c.element,b,a.extend(c._uiHash(),{snapItem:c.snapElements[k].item}));c.snapElements[k].snapping=v||E||s||D||q}else{c.snapElements[k].snapping&&c.options.snap.release&&c.options.snap.release.call(c.element,b,a.extend(c._uiHash(),{snapItem:c.snapElements[k].item}));c.snapElements[k].snapping=false}}}});a.ui.plugin.add("draggable","stack",{start:function(){var b=a(this).data("draggable").options;b=a.makeArray(a(b.stack)).sort(function(c,h){return(parseInt(a(c).css("zIndex"),
10)||0)-(parseInt(a(h).css("zIndex"),10)||0)});if(b.length){var d=parseInt(b[0].style.zIndex)||0;a(b).each(function(c){this.style.zIndex=d+c});this[0].style.zIndex=d+b.length}}});a.ui.plugin.add("draggable","zIndex",{start:function(b,d){b=a(d.helper);d=a(this).data("draggable").options;if(b.css("zIndex"))d._zIndex=b.css("zIndex");b.css("zIndex",d.zIndex)},stop:function(b,d){b=a(this).data("draggable").options;b._zIndex&&a(d.helper).css("zIndex",b._zIndex)}})})(jQuery);
(function(a){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var b=this.options,d=b.accept;this.isover=0;this.isout=1;this.accept=a.isFunction(d)?d:function(c){return c.is(d)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[];a.ui.ddmanager.droppables[b.scope].push(this);
b.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var b=a.ui.ddmanager.droppables[this.options.scope],d=0;d<b.length;d++)b[d]==this&&b.splice(d,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(b,d){if(b=="accept")this.accept=a.isFunction(d)?d:function(c){return c.is(d)};a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var d=a.ui.ddmanager.current;this.options.activeClass&&
this.element.addClass(this.options.activeClass);d&&this._trigger("activate",b,this.ui(d))},_deactivate:function(b){var d=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);d&&this._trigger("deactivate",b,this.ui(d))},_over:function(b){var d=a.ui.ddmanager.current;if(!(!d||(d.currentItem||d.element)[0]==this.element[0]))if(this.accept.call(this.element[0],d.currentItem||d.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);
this._trigger("over",b,this.ui(d))}},_out:function(b){var d=a.ui.ddmanager.current;if(!(!d||(d.currentItem||d.element)[0]==this.element[0]))if(this.accept.call(this.element[0],d.currentItem||d.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",b,this.ui(d))}},_drop:function(b,d){var c=d||a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return false;var h=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var m=
a.data(this,"droppable");if(m.options.greedy&&!m.options.disabled&&m.options.scope==c.options.scope&&m.accept.call(m.element[0],c.currentItem||c.element)&&a.ui.intersect(c,a.extend(m,{offset:m.element.offset()}),m.options.tolerance)){h=true;return false}});if(h)return false;if(this.accept.call(this.element[0],c.currentItem||c.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",
b,this.ui(c));return this.element}return false},ui:function(b){return{draggable:b.currentItem||b.element,helper:b.helper,position:b.position,offset:b.positionAbs}}});a.extend(a.ui.droppable,{version:"1.8.2"});a.ui.intersect=function(b,d,c){if(!d.offset)return false;var h=(b.positionAbs||b.position.absolute).left,m=h+b.helperProportions.width,j=(b.positionAbs||b.position.absolute).top,o=j+b.helperProportions.height,i=d.offset.left,f=i+d.proportions.width,k=d.offset.top,g=k+d.proportions.height;switch(c){case "fit":return i<
h&&m<f&&k<j&&o<g;case "intersect":return i<h+b.helperProportions.width/2&&m-b.helperProportions.width/2<f&&k<j+b.helperProportions.height/2&&o-b.helperProportions.height/2<g;case "pointer":return a.ui.isOver((b.positionAbs||b.position.absolute).top+(b.clickOffset||b.offset.click).top,(b.positionAbs||b.position.absolute).left+(b.clickOffset||b.offset.click).left,k,i,d.proportions.height,d.proportions.width);case "touch":return(j>=k&&j<=g||o>=k&&o<=g||j<k&&o>g)&&(h>=i&&h<=f||m>=i&&m<=f||h<i&&m>f);default:return false}};
a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,d){var c=a.ui.ddmanager.droppables[b.options.scope]||[],h=d?d.type:null,m=(b.currentItem||b.element).find(":data(droppable)").andSelf(),j=0;a:for(;j<c.length;j++)if(!(c[j].options.disabled||b&&!c[j].accept.call(c[j].element[0],b.currentItem||b.element))){for(var o=0;o<m.length;o++)if(m[o]==c[j].element[0]){c[j].proportions.height=0;continue a}c[j].visible=c[j].element.css("display")!="none";if(c[j].visible){c[j].offset=
c[j].element.offset();c[j].proportions={width:c[j].element[0].offsetWidth,height:c[j].element[0].offsetHeight};h=="mousedown"&&c[j]._activate.call(c[j],d)}}},drop:function(b,d){var c=false;a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(this.options){if(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance))c=c||this._drop.call(this,d);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)){this.isout=1;
this.isover=0;this._deactivate.call(this,d)}}});return c},drag:function(b,d){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,d);a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var c=a.ui.intersect(b,this,this.options.tolerance);if(c=!c&&this.isover==1?"isout":c&&this.isover==0?"isover":null){var h;if(this.options.greedy){var m=this.element.parents(":data(droppable):eq(0)");if(m.length){h=a.data(m[0],"droppable");
h.greedyChild=c=="isover"?1:0}}if(h&&c=="isover"){h.isover=0;h.isout=1;h._out.call(h,d)}this[c]=1;this[c=="isout"?"isover":"isout"]=0;this[c=="isover"?"_over":"_out"].call(this,d);if(h&&c=="isout"){h.isout=0;h.isover=1;h._over.call(h,d)}}}})}}})(jQuery);client={};client.markers={};client.data={};client.pageplugins={};client.pageplugins.displayplugins={};client.widgets={};client.integration={};config={};config.imagePath=null;config.CARD_LIMITS=[50];config.MIN_BOX_LEVEL=1;config.MAX_BOX_LEVEL=4;
config.MAX_TEXT_SIZE=1536;config.LOADER_DELAY=500;config.TAG_COLORS=["FF6600","FFFF00","99FF00","33FF00","FF3300","FF99CC","FFAAAA","00FF66","FF0099","66CCFF","33BBFF","CCCCCC","333333","009933","0033FF","0099FF"];config.TERMS_URL="terms.php";config.fadeNavi=false;config.MAX_LIST_COUNT=30;
client.lang={code:"en",ANNOTATION:"Remark",ANSWER:"Answer",ANSWER_RIGHT:"Knew it",ANSWER_TOO_LONG:"Answer is too long.",ANSWER_UNSURE:"Repeat again later",ANSWER_WRONG:"I was wrong",BOLD:"Bold",CANCEL:"Cancel",CAPTCHA:"Security code",CAPTCHA_MISSING:"Security code missing",CARD_EMPTY:"(This page is empty)",NOTE_SHEET:"Page",CLICK_TO_ENTER:"(Click here to edit the page)",CLOSE:"Close",CONFIRM_CLOSE:"All unsaved changes will be lost. Would you like to proceed?",CONFIRM_REQUEST_SENT:"A confirmation email has been sent to your email address",
ACCOUNT_CREATED:"Your account has been created, use your credentials to log in",CONNECTION_DOWN:"The connection was lost. Try reloading the page.",CONNECTION_ERROR:"Could not establish a connection. Try reloading the page.",COULD_NOT_UPDATE_TOPIC:"Could not update the folder",COULDNT_COPY_IMAGE:"Could not copy the image to the destination folder",CREATE:"Create",DEFINITION:"Definition",RELATED_TERM:"What the selection defines",DEFINITION_QUESTION:"What is the definition of:",DELETE:"Delete",DESCRIBE_ISSUE:"(Enter your question here)",
DESCRIPTION:"Describe the new feature",MEDIABIRD_DESCRIPTION:"Mediabird is an addon for your Learning Management System that allows you to edit and annotate notes collaboratively. This allows for giving feedback, discussing questions and exchanging ideas. Mediabird is the first system to combine the wiki and forum idea in an intelligent way.",BROWSER_BAD_TEXT:'<h3>Your browser or browser version is not supported. Update your browser or install the recommended browser <a href="http://www.getfirefox.com" target="_blank">Firefox</a></h3>',
SAVE:"Save",CANNOT_DELETE_LAST:'Cannot delete the last remaining page. Click on "Back to overview..." to delete the whole folder.',EDITOR_TITLE:"Editor",EMAIL:"Email",EMAIL_MISSING:"Email missing",INVALID_EMAIL:"You have entered an invalid email address",ENTER_FEEDBACK:"(Enter your feedback here)",ENTER_ANNOTATION:"(Enter your annotation here)",ENTER_COMMENT:"(Enter your comment here)",ENTER_ANSWER:"(Enter your answer here)",ENTER_DEFINITION:"(Enter your definition of the expression here)",SUGGEST_ANSWER:"(Suggest your answer here)",
ENTER_EXPRESSION:"(Specify or copy selected expression here)",ENTER_QUESTION:"(Enter your question here)",ERROR_REMOVING_USER:"Could not remove the selected user.",ERROR_FUNCTION_DISABLED:"This function has been disabled by the administrator.",ERROR_MOVE:"Error during file upload",ERROR_TYPE:"Invalid file type",ERROR_QUOTA:"You have reached the quota limit of your account",ERROR_SENDING_CONFIRM:"There was an error sending the confirmation email",ERROR_TOO_BIG:"The file you have selected is too big",
ERROR_WHILE_UPLOADING:"The file could not be uploaded",FLOAT_LEFT:"Wrap text to the right",FLOAT_NONE:"No float",FLOAT_RIGHT:"Wrap text to the left",FLOAT_STYLE:"Alignment",GET_NEW_CAPTCHA:"Get a new code",GET_PASSWORD:"Forgot password",GO:"Go",GOTO_ANSWER:"Show answer",GOTO_QUESTION:"Show question again",SHOW_CONTEXT:"Show context",SHOW_EDITOR:"Edit page",CONTEXT:"Context",HEIGHT:"Height",HIGHLIGHT:"Highlight",HTML_CODE:"HTML Code",CODE:"Code",IN:"in",INDENT:"Increase depth",INSERT:"Insert",INSERT_HTML:"HTML",
INSERT_HTML_TIP:"Insert HTML code or edit HTML of selection",INSERT_CODE:"Typewriter Text",INSERT_CODE_TIP:"Text formatted with a typewriter-like font",INSERT_IMAGE:"Image",INSERT_IMAGE_TIP:"Upload picture or use existing one",INSERT_LATEX:"Equation",INSERT_LATEX_TIP:"LaTeX formula",AUTO_CONVERT_LATEX:"Automatic",AUTO_CONVERT_EXPLANATION:"Automatically converts LaTeX code from the current page into equations",AUTO_LATEX_NO_JOBS:"No LaTeX code was found on the page",LATEX_SOURCE:"Equation",INSERT_LINK:"Link",
INSERT_LINK_TIP:"Location of another web site or email address",INSERTORDEREDLIST:"Enumeration",INSERTUNORDEREDLIST:"Bullet points",INVALID:'The value "#" is invalid',ISSUE:"Question",ITALIC:"Italic",INVITE:"Invite",JUST_ENABLED:"Your account has been successfully activated. Use the form below to log in",LEVEL:"Level",LINK_HEADING:"Link editor",LINK_TYPE:"Link type",LINK_REQUIRES_SELECTION:"Please select some text you would like to link",LOCATION:"Location",LOGON:"Log in",COULD_NOT_CLOSE_SESSION:"Could not log you out. Reload the page and try again.",
NAME:"Name",NAME_MISSING:"Name missing",NO_ANSWER:"You didn't enter an answer.",NO_ANNOTATION:"You didn't enter a remark.",NO_FEEDBACK:"You didn't enter your feedback.",NO_DEFINITION:"You didn't enter a definition.",NO_QUESTION:"You didn't enter a question.",NO_EXPRESSION:"You didn't entered an expression.",NO_CARD_TITLE:"(none selected)",NO_FLASH_CARDS:"The current page does not contain any flash cards",NO_URL_GIVEN:"Please specify the location of the image you want to insert",NO_MARKER_FOR_DEL:"Select tag which you want to delete first",
NOT_CONFIRMED:"Please confirm your email address using the link from the confirmation email sent to you",OK:"OK",OTHER_ERROR:"Error while accessing script",OUTDENT:"Decrease depth",PADDING_BOTTOM:"Bottom",PADDING_LEFT:"Left",PADDING_RIGHT:"Right",PADDING_STYLE:"Padding style",PADDING_TOP:"Top",PARA:"Paragraph",PASS_MISSING:"Password missing",PASS_NOT_MATCHING:"Passwords mismatch",PASSWORD_ERROR:"Could not retrieve your password",PASSWORD:"Password",PASSWORD_AGAIN:"Repeat password",PASSWORD_SENT:"An email with your password has been sent to the email address associated with your account",
QUESTION_EDIT:"Click to edit ",QUESTION:"Question",RELATED_QUESTION:"Question for repetition",QUESTION_TOO_LONG:"Question too long",REDO:"Redo",REMOVE_FORMAT:"Clear formatting",REMOVE:"Remove",REMOVE_THIS:"Delete item",RENAME:"Rename",RENDERING_FAILED:"Rendering of equation did not succeed.",REP_LEVEL:"Marked for repetition",SHARE:"Share",REPEAT:"Repeat",REPEAT_TITLE:"Do you <strong>remember the highlighted parts?</strong>",REVIEW_RIGHT:"Knew it",REVIEW_UNSURE:"Decide later",REVIEW_WRONG:"Repeat again",
SEL_REQUIRED_HIGHLIGHT:"Please select where you want to insert.",SET:"Set",SESSION_CREATION_ERROR:"The was an error creation the session.",SESSION_FINISHED:"Training finished!",SESSION_ABORTED:"The page loading was aborted",SESSION_INVALID:"An invalid reply was sent. This might be a bug or a session timeout. Try reloading the page.",SIGN_UP:"Register new account",STRIKE_THROUGH:"Strike through",TERMS_ACCEPT:'I have read and understood the <a href="%s" target="_blank">Terms of Use</a>.',TERMS:"Terms of Use",
TERMS_MISSING:"You have to accept the Terms of Use",TITLE:"Title",MEDIABIRD_TITLE:"Mediabird Study Notes",TOPIC:"Folder",TOPIC_EMPTY:"The folder does not contain any pages and cannot be opened.",TOPICS:"Folder list",TYPE_CARD:"Page",TYPE_EMAIL:"Email",TYPE_URL:"URL",UNDERLINE:"Underline",UNTITLED:"Untitled",UPDATE:"Update",UPLOAD_BUTTON:"Upload",PICTURE:"Picture",URL_INVALID:"The location you have specified is invalid",USER_EMAIL_TAKEN:"The email address you have entered is already in use by another account",
USER_NAME_TAKEN:"The user name you have chosen is already in use by another account",WIDTH:"Width",WRONG_PASSWORD:"The combination of user name and password is wrong.",WRONG_SECURITY:"Security code entered incorrectly",IMAGE_ADJUST_HEADING:"Adjust image properties",IMAGE_UPLOAD_HEADING:"Upload new picture",IMAGE_LOCATION_HEADING:"Use given location",PENDING:"Pending",COULD_NOT_UPDATE_RIGHT:"Could not update permission to the server",NONE:"None",HIGHLIGHTER_EXPLANATION:"<p>Now, <strong>highlight some text</strong> on the page</p>",
TOO_MUCH_CONTENT:'<h3>Optimal page size</h3><p>To make this page easier to get, <strong>keep it short</strong>.</p><p class="add-hint">Insert <strong>further pages</strong> for the additional content using the insert sheet button.</p>',IMAGE_EDITOR:"Image editor",MOVE_TO_TRASH:"Cut this item (Highlight button allows for re-inserting it later)",CARD_UPDATE_PENDING:"Your notes are being saved. If you abort the process of saving, all changes will be lost.",CARD_UPDATE_FAILURE:"Uploading of your notes about #### failed. Would you like to try again?",
DISMISS_DATA:"Revert changes",RETRY_UPLOAD:"Retry saving",INSERT_PAGE:"Insert page",BACK:"Back",CREATE_NEW_TOPIC:"New folder",COULD_NOT_SYNC_TRAINING:"Training data could not be synchronized",COULD_NOT_LOAD_CARD:"Could not retrieve the selected page",YOU:"You",CHECK_OUT_TRY_AGAIN:"Try again",LATEX_EDITOR:"Equation editor, LaTeX",BLOCK_MODE:"block mode",RESET_SIZE:"Reset size",HELP:"Help...",LATEX_HELP_LINK:"http://www.mediabird.net/en/about/latex",SAVE_AS_CARD:"Save as flash card",INSERT_TABLE:"Table",
INSERT_TABLE_TIP:"Insert table near cursor",LOGOUT:"Log out",OPEN_SHEET:"Open sheet ",ALERT_HEADER:"Info",GIVE_US_FEEDBACK:"Give us some feedback",SEND_FEEDBACK:"Send feedback",SEND:"Send",MESSAGE_EMPTY:"Your message is empty",THANKS_FEEDBACK:"Thanks for your feedback.",FOLLOW_LINK:"Follow link",EDIT_LINK:"Edit link",INSERT_COLUMN:"Insert column",INSERT_ROW:"Insert row",DELETE_COLUMN:"Delete column",DELETE_ROW:"Delete row",TOPIC_COULD_NOT_BE_UPDATED:"The folder could not be updated. You cannot delete a page that is being edited by someone else",
SWITCH_TO_FULL:"View the page with all advanced features",MAX_NO_OF_CARDS_IN_TOPIC:"You have reached the maximum number of pages per folder. Create a new folder in the overview.",PDF_INSERT_EXPLANATION:"Insert PDF sheet...",PDF_UPLOAD:"Import PDF files",PDF_UPLOAD_HEADING:"Upload file",CHOOSE_PDF:"Choose PDF file",INSERT_PDF_PASSWORD:"The PDF file is encrypted. Please enter password to unlock it.",INSERT_PDF_PASSWORD_AGAIN:"You've entered a wrong password. Please try again.",IMPORT_PDF_PAGE:"Import pages from the selected PDF file",
PAGE_NUMBER:"Page number",YES:"Yes",ALREADY_GIVEN:"Unlocked",NO:"No",AUTHORIZE_PDF_IMPORT:"The PDF file is encrypted. Enter the password to import a page from the file.",NUMBER_OUT_OF_RANGE:"Number out of range",NO_PDF_SELECTED:"You haven't selected a PDF file. You can upload one from your computer using the form above.",GENERAL_PDF_AUTH_ERROR:"An error occurred while checking the password.",PAGE_NUM_REQUIRED:"Please enter a page number to proceed",REPETITION:"Repetition",TAG_LIST_HEADERS:["Tag",
"Color","Show above thumbs"],DROP_TAG:"Drop tag to filter",REMOVE_FILTER_TAG:"Stop filtering by this tag",REMOVE_TAG:"Remove this tag from the selected pages",X_CARDS_WILL_BE_DELETED:"# pages will be deleted. Do you wish to continue?",COULD_NOT_UPDATE_TAGS:"Could not update tags",SLIDE:"Slide",FROM:"From",ADD_TAG:"Add tag",NEXT:"Next",PREVIOUS:"Previous",GOTO_TITLE:"Show page this user is currently working on",QUESTION_BOX_TITLE:"Browse unsolved items of this user",COULD_NOT_LOAD_USERS:"Could not load collaborators",
USER_HAS_NO_PROBLEMS:"There are no question for this user",ALREADY_ON_USERS_CARD:"You are already viewing the page your buddy is viewing",USER_INFO_HTML:'<h3><span class="name"/></h3><table><tr><td>Email address</td><td><a class="email"/></td></tr><tr><td>Online</td><td><span class="online"/></td></tr><tr><td>Using Mediabird</td><td><span class="active"/></td></tr><tr><td>Unsolved items</td><td><a class="questions"/></td></tr><tr><td>On page</td><td><a class="card"/></td></tr><tr><td>Access rights</td><td class="access"></td></tr></table>',
SET_RIGHT_HEADER:"Specify access level",ACCESS:{OWNER:"Owner",FULL:"Full access",WRITE:"View, feedback and edit",READ:"View and feedback",NONE:"None"},PROBLEM_BROWSE_HTML:'<h3>Browsing questions of <em class="name"/> on page margin</h3><p class="links"> | <span class="current"/> | </p>',PROBLEM_MARKER_HTML:'<h3>Browsing <em class="info"/> on page margin</h3><p class="links"> | <span class="current"/> | </p>',BROWSE_TYPES:{open:"unsolved items",solved:"answered items",repeat:"repeatable items"},START_TRAINING:'<hr/><div><a class="s">Memorize</a> these items.</div>',
INVITE_BY_EMAIL:"Invite by email",ENTER_EMAIL:"Enter email address",SHARE_THIS_NOTE_FOLDER:"Share this folder",SHARE_EXPLANATION:"Simply drag users from the list onto the bar below the page to share the current folder with them.",LOCKED:"Locked",EMPTY:"Empty",EMAIL_IN_USE:"That user has already got access to this folder",NEW:"New",NOTES_ON:"Notes on",REPEAT_THIS_ANSWER:"Use this answer when memorizing this question",DELETE_THIS_ANSWER:"Delete this answer",STAR_THIS_ANSWER:"Star this answer",EXAM_PREPARATION:"Preparation",
NEVER:"Never",STATS_HEADER:"Preparation status of your selection",PREPARE_SELECTED:"Continue preparation",NO_CARDS_INFO:"No flash cards among selection",EXAM_TOPIC_LIST_HEADERS:["Page","Flash card ratio","Progress","Last training"],TOPIC_LIST_HEADERS:["Title","Collaborators","Changes"],PDF_LIST_HEADERS:["Title","Page count","Encrypted","Upload date"],FILTER_NOTES_BY:"Only show notes tagged with",NOTE_FOLDERS:"Folders",TAGS:"Tags",PDF_FILES:"PDF Files",UPLOAD_PDF:"Upload PDF file",PDF_TOPIC_USAGE_HEADERS:["Folder",
"Featured slides"],TOPICS_FEATURING_PDF:"Folders featuring slides from this PDF",CREATE_FROM_PDF:"Create folder using this PDF",UNLOCK_PDF:"Unlock this PDF",QUESTIONS:"Questions",GLOSSARY:"Glossary",LINKS:"References",SAVE_TERM:"Save definition",QUESTION_TOPIC_LIST_HEADERS:["Question","Answers","Questioner","Last Update"],GLOSSARY_TOPIC_LIST_HEADERS:["Term","Definitions","Creator","Last Update"],LINK_TOPIC_LIST_HEADERS:["Title","Location","Changes"],QUICK_QUESTION:"Enter question",QUESTION_SAVE_ERROR:"Could not save your question",
QUESTION_RETRIEVE_ERROR:"Could not retrieve questions from the server",QUESTION_UPLOAD_ERROR:"Could not update question",COULD_NOT_LOAD_RELATED:"Could not load related objects. Some items will be missing.",CURRENT_MARKER_REMOVED:"The current marker has been removed.",COULD_NOT_LOAD_QUESTION:"Could not load the messages.",SHARING_NEEDS_ACCESS:"You need to be the owner to share these notes with further people.",PDF_LOCKED_INFO:"This PDF file requires a password to be unlocked.",BACK_TO_OVERVIEW:"< Back to overview",
START_TAKING_NOTES:"Start taking notes on this PDF",ENTER_TITLE:"Enter the title of the new folder",ENTER_NEW_TITLE:"Enter a new title",RENAME_NEEDS_SELECTION:"Please select the folder you want to rename",LOADING:"Loading",NUM_OF_SHEETS:"Number of pages",NUM_OF_CARDS:"Number of flash cards",FLASH_CARDS_PER_SHEET:"Flash cards per page",AVG_TIME_SINCE_TRAINING:"Average time since last training (days)",PREP_SCORE:"Preparation score",SEE_RANGE:"directly referring to the selection",COULD_NOT_LOAD_CARDS:"Could not load related flashcards",
SHEETS_LOCKED:"Some pages are being edited by other users and cannot be deleted right now",TOPIC_CHANGED_MEANTIME:"The folder has been changed meanwhile. Try again.",COULD_NOT_LOAD_TOPIC:"Could not refresh the folder",SESSION_ERROR:"Could not refresh your session, try reloading the page",COPY_FILE_FOR_INSERTION:"You cannot use slides from this PDF file since you do not upload it. Would you like to create a copy of the PDF file and proceed using the copy?",COULD_NOT_COPY_PDF:"Could not copy the PDF file, try again",
INSERT_MARKER:"Insert or highlight",INSERT_PLUGIN_HEADING:"Content",INSERT_MARKER_HEADING:"Margin",INSERT_CLIPBOARD_HEADING:"Clipboard",INSERT_LOST_HEADING:"Lost markers",BIGGER:"Bigger",SMALLER:"Smaller",NOT_SHARABLE:"This item cannot be shared since you are not allowed to share markers with this folder.",SHARE_TOOLTIP:"Activate this option to allow other users to view, edit and delete this marker",LINK_TYPES:["Internet","Learning Environment","Buddy","Different page","Book","Article","Wikipedia article",
"YouTube video","CoboCards card set","Email address"],LINK:"Link",LINK_RETRIEVE_ERROR:"References could not be loaded",COULD_NOT_LOAD_LINK:"Could not load reference",LINK_UPLOAD_ERROR:"Could not store reference",FILTER_VIEW:"Filter by tag",LINK_INCOMPLETE:"To insert a new reference please provide title and url.",EXPLAIN_WIKI_INSERTION:"To insert content from Wikipedia or the Web: open the page in a separate window or tab. Select the text you want to insert and copy it. Switch back to Mediabird and paste it onto the page.",
EXPLAIN_WORD_INSERTION:"To insert content from Microsoft Word, copy the content you'd like to insert and paste it onto the page.",INSERT_WIKIPEDIA:"From Wikipedia",INSERT_WEB:"From the Web",INSERT_WORD:"From Word",CARD_LOCK:"Card lock",SWITCH_BOX:"Show/hide box view",BOX_LABELS:{open:"Unsolved Items",solved:"Answered Items",repeat:"Repeatable Items"},EXPLAIN_BOX:{open:'<h3>Unsolved Items</h3><p class="add-hint">There are no unsolved items right now. In order to ask a question, <b>click on the highlight button</b> and select "Ask question".</p>',
solved:'<h3>Answered Items</h3><p class="add-hint">Click on <b>Unsolved Items</b> to answer questions of your team mates. Once you or your team mates have answered some questions, <b>click here again</b> to review them.</p>',repeat:'<h3>Repeatable Items</h3><p class="add-hint">There are no repetition markers or flash cards, yet. To <b>easily prepare for tests or presentations</b>, use the highlight button to link your notes with <b>questions you would like to prepare</b>.</p>'},COULD_NOT_REFRESH_TOPICS:"Could not refresh folder list",
NO_USERS_SELECTED:"You haven't selected any user",BLOG_SYM:"D",BLOG_EXPLANATION:"This page belongs to the study diary",WIKI_SYM:"W",WIKI_EXPLANATION:"This page belongs to the wiki",INSERT_TAG:"Insert tag",CREATE_LINK:"Create reference",QUICK_LINK:"Enter location",LINK_SAVE_ERROR:"Could not save your link",TOPIC_COUNT_REACHED:"You have reached the topic limit",TAG_CARD_LIMIT_REACHED:"Only 6 different tags can be attached to a single card",RELATED_CARDS_LINK:"This link is in use on these pages",RELATED_CARDS_QUESTION:"This item is linked on these pages",
NO_RELATED_CARDS_LINK:"This link is not in use on any page",NO_RELATED_CARDS_QUESTION:"This question is not linked on any page",CHECK_IN:"You're editing, click to save and let others edit",CARD_LOCKED_HTML:"<p><b>Someone else is editing</b>, click 'try again' to try again</p>",CARD_LOCKED_TITLE:"Someone else is editing, click here for more options",CARD_DONE:"You are done with editing this page, click to make further changes",CARD_DEFAULT:"Click to edit this page and prevent others from changing it at the same time",
LINK_EDIT:"Edit link",PDF_EXPLAIN:'This is slide <b class="p"/> from the PDF <b class="n"/>.',EXAM_STAT_HEADERS:["","Value"],ENTER_TITLE_FOR_REF:"You need to enter a title",ENTER_URL_FOR_REF:"You need to specify a location",NOT_ALL_USERS_FOUND:"Not all users could be found",ANNOTATE:"Remark",ANNOTATE_TIP:"Statement or hint related to selection",FEEDBACK:"Feedback",FEEDBACK_TIP:"Feedback or hint to selection",ASK_QUESTION:"Ask question",ASK_QUESTION_TIP:"Question related to selection",ANSWER_LINK:"Insert flash card",
ANSWER_LINK_TIP:"Pair of question and answer related to selection",DEFINE_SELECTION:"Define",DEFINE_SELECTION_TIP:"Definition related to selection",THIS_DEFINES:"Specify term",THIS_DEFINES_TIP:"Term defined by selection",REP_MARKER:"Repeat later",REP_MARKER_TIP:"Remind about selection when memorizing",QUESTION_TO_SELECTION:"Repeat with question",QUESTION_TO_SELECTION_TIP:"Ask question about selection when memorizing",REFERENCE:"Reference",REFERENCE_TIP:"Source or citation the selection refers to",
DO_NOT_SHOW_AGAIN:"Do not show again",DATABASE_ERROR:"Database error",CARD_CHANGED_WHILE:"Page changed meanwhile, some changes might be lost",OPEN_TOPIC:"Open folder",TRAIN_TOPIC:"Memorize folder",RENAME_FORBIDDEN:"You are not allowed to renamed this folder",COURSE_NOTES:"Course notes",DELETE_TABLE:"Delete table",DELETE_TOPICS_CONFIRM:"Are you sure you want to completely remove the selected folder and all of its content?\n\nThis cannot be undone.",COULD_NOT_DELETE_TOPIC:"Could not delete the selected folder",
DELETE_NEEDS_SELECTION:"Please select the folder you wish to delete",DELETE_FORBIDDEN:"You need to be the owner to delete a folder",DELETE_UPLOAD_CONFIRM:"Are you sure you want to delete this PDF file?",COULD_NOT_DELETE_UPLOAD:"Could not delete the selected file",EXPORT:"Export",EXPORT_HEADER:'Exported version of <em class="t"/> as of <em class="d"/>.',EXPORT_NEEDS_SELECTION:"Please select the folder you wish to export",NO_HTML_AMONG_SELECTION:"There are only PDF slides among your selection. These cannot be exported right now",
EMPTY_EXPORT:"(empty)",EXPORT_HINT:"Hint: You can now select all content from above and press Ctrl+C. Then switch to your favorite office application and press Ctrl+V",EXPLAIN_LOCKED_SLIDE:"This PDF file is still locked. Go back to the overview and click on PDF files. Then unlock it by clicking on the arrow in front of its entry.",TAG_ALREADY_EXISTS:"This tag has already been attached",ZOOM:"Zoom",ADJUST_SIZE:"Adjust size",WORKFLOW_OPTIONS:"Workflow options",MARK_NONE:"No change",MARK_ISSUE_SOLVED:"Mark question solved",
MARK_FEEDBACK_SOLVED:"Mark feedback read",MARK_ISSUE_FORCE:"Question remains open",CONVERT_ISSUE_FORCE:"Convert to question",CONVERT_FEEDBACK_FORCE:"Convert to feedback",COULD_NOT_LOAD_QUESTION:"Could not load question",COULD_NOT_LOAD_CHECK:"Could not load check",COULD_NOT_SAVE_QUESTION:"Could not save the question",COULD_NOT_SAVE_CHECK:"Could not save the check",CHECKBOX_EDITOR_HEADER:"Check",CHECK:"Check",SELECT_ALL:"Select all",CONFIRMED:"Confirmed",USER:"User",STATUS:"Status",CHECKBOX_HELP_NEW:"Select users you would like to confirm that they have seen this item.",
CHECKBOX_HELP:"See below who has seen and checked this item.",CHECK_TITLE_PENDING:"Nobody has confirmed this item yet. Click for details.",CHECK_TITLE_HALF:"Not everybody has confirmed this item yet. Click for details.",CHECK_TITLE_COMPLETE:"Everyone has confirmed this item. Click for details.",CHECK_NO_SHARE_HTML:'You are the <strong>only user with access</strong> to the current document. You <strong>need to share</strong> this note folder in order to work with checks. To do so, <strong>click the "+"-button</strong> on the lower panel.',
CHECK_TIP:"Request a read confirmation from your team",CONFIRM:"Confirm",CONFIRM_TITLE:"Click to mark this item as read",SELECT_AT_LEAST_ONE:"Please select at least one user",CHECK_CREATOR:"(requested confirmation)",COULD_NOT_SEND_FEEDBACK:"Failed to send feedback.",REMOVE_MARKER_TITLE:"Remove this item from the document. Does not actually delete the item itself but the link between the document and the item.",LEAVE_TOPIC_CONFIRM:"Are you sure you want to remove the folder from your available folders?",
COULD_NOT_LEAVE_TOPIC:"Could not remove folder",INTRO_FOLDER_TITLE:"First Steps: Create Folder",INTRO_FOLDER_HTML:'Click on <div class="toolbar emboss inline"><a class="item okay">New folder</a></div> to create a new folder.',INTRO_EDIT_TITLE:"First Steps: Enter Text",INTRO_EDIT_HTML:"Click on the page and <strong>enter some text</strong> or copy and paste content from another place.",INTRO_HIGHLIGHT_TITLE:"First Steps: Ask Question",INTRO_HIGHLIGHT_HTML:'<ul><li>Click on <img title="Insert or Highlight" src="images/marker.png"> and choose "<strong>Ask question</strong>".</li><li><strong>Highlight some text</strong> that you have entered.</li></ul>',
INTRO_SHARE_TITLE:"First Steps: Share Folder",INTRO_SHARE_HTML:'<ul><li><strong>Enter a question</strong> and click <div class="toolbar emboss inline"><a class="item okay">Save</a></div>.</li><li>In order to get feedback on your notes, you need to share them.</li><li>Click on <img src="images/list-add.png" title="Share Folder"> right of your avatar to share your notes.</li></ul>',SHARE_FOLDER_TIP:"Share Folder",ADD_PAGE_TIP:"Add page or insert PDF slide",TAG_FILTER_EXPLANATION:"<p><b>Drag and drop tags here</b> from below and above the page thumbnails to filter the view.</p>",
CARD_TRASH_EXPLANATION:"<p><b>Drag and drop thumbnails here</b> to delete the corresponding page.</p>",TAG_FILTER_TIP:"Drag and drop tags here from below and above the page thumbnails to filter the view.",CARD_TRASH_TIP:"Drag and drop page thumbnails here to delete the corresponding pages.</p>",REMOVE_USER:"Remove user",REMOVE_USER_CONFIRM:"# will not be able to access the folder anymore. Are you sure you want to do this?",SELECT_FOR_INSERTION:"Select where you would like to insert the item first."};
client.lang.de={code:"de",ANNOTATION:"Anmerkung",ANSWER:"Antwort",ANSWER_RIGHT:"Wusste ich",ANSWER_TOO_LONG:"Antwort ist zu lang.",ANSWER_UNSURE:"Sp\u00e4ter wiederholen",ANSWER_WRONG:"Nicht gewusst",BOLD:"Fett",CANCEL:"Abbrechen",CAPTCHA:"Sicherheitscode",CAPTCHA_MISSING:"Tippe den Sicherheitscode ab und trage ihn links ein",CARD_EMPTY:"(Diese Seite ist leer)",NOTE_SHEET:"Seite",CLICK_TO_ENTER:"(Klicke hier, um dir Notizen zu machen)",CLOSE:"Schlie\u00dfen",CONFIRM_CLOSE:"Wenn du best\u00e4tigst, gehen alle nicht gespeicherten \u00c4nderungen verloren.",
CONFIRM_REQUEST_SENT:"Eine Best\u00e4tigungsmail wurde an deine E-Mail-Adresse versandt.",ACCOUNT_CREATED:"Das Konto wurde erfolgreich eingerichtet, du kannst dich nun einloggen.",CONNECTION_DOWN:"Die Verbindung konnte nicht aufrechterhalten werden. Versuche erneut zu laden.",CONNECTION_ERROR:"Die Verbindung ist abgebrochen. Versuche erneut zu laden.",COULD_NOT_UPDATE_TOPIC:"Mappe konnte nicht aktualisiert werden",COULDNT_COPY_IMAGE:"Bild konnte nicht kopiert werden",CREATE:"Erstellen",DEFINITION:"Definition",
DEFINITION_QUESTION:"Wie lautet die Definition f\u00fcr:",DELETE:"L\u00f6schen",DESCRIPTION:"Beschreibe die neue Funktionalit\u00e4t",MEDIABIRD_DESCRIPTION:"Mediabird ist ein Zusatzmodul f\u00fcr Ihr Lernmanagement-System, mit dem Sie Texte gemeinsam bearbeiten, mit Randnotizen versehen und diese intelligent nutzen k\u00f6nnen. Au\u00dferdem ist Mediabird das erste System, das die viel genutzten St\u00e4rken von Wiki und Forum innovativ kombiniert. Mit Mediabird ist es viel einfacher Tests zu meistern, Vortr\u00e4ge vorzubereiten oder Dokumentationen anzulegen.",
BROWSER_BAD_TEXT:'<h3>Dein Browser oder die Browserversion wird von Mediabird nicht unterst\u00fctzt. Aktualisiere deinen Browser oder installiere den von uns empfohlenen Browser <a href="http://www.getfirefox.com" target="_blank">Firefox</a></h3>',CANNOT_DELETE_LAST:'Kann die letzte Seite nicht l\u00f6schen. Klicke auf "Zur\u00fcck zur \u00dcbersicht", um die Mappe zu entfernen.',EDITOR_TITLE:"Editor",EMAIL:"E-Mail",EMAIL_MISSING:"E-Mail fehlt.",INVALID_EMAIL:"Du hast eine ung\u00fcltige E-Mail-Adresse eingegeben.",
DESCRIBE_ISSUE:"(Gib hier deine Frage ein)",ENTER_FEEDBACK:"(Gib hier dein Feedback ein)",ENTER_ANNOTATION:"(Gib hier deine Anmerkung ein)",ENTER_ANSWER:"(Gib hier deine Antwort ein)",ENTER_DEFINITION:"(Gib hier deine Definition ein)",SUGGEST_ANSWER:"(Schlage hier eine Antwort vor)",ENTER_EXPRESSION:"(Gib hier den zur Auswahl geh\u00f6rigen Ausdruck an)",ENTER_QUESTION:"(Gib hier die Frage ein)",ERROR_CHANGING_STATUS:"Die Zugriffsrechte f\u00fcr diese Gruppe konnte nicht aktualisiert werden. Versuche es noch einmal.",
ERROR_FUNCTION_DISABLED:"Die Funktion wurde durch den Administrator deaktiviert.",ERROR_MOVE:"Fehler beim Hochladen der Datei.",ERROR_TYPE:"Der Dateityp ist unzul\u00e4ssig. Bitte w\u00e4hle nur Bild-Dateien aus.",ERROR_QUOTA:"Du hast das Speicherlimit deines Accounts erreicht.",ERROR_SENDING_CONFIRM:"Beim versenden der Best\u00e4tigungsemail ist ein Fehler aufgetreten.",ERROR_TOO_BIG:"Das ausgew\u00e4hlte Bild ist zu gro\u00df.",ERROR_WHILE_UPLOADING:"Das Bild konnte nicht hochgeladen werden.",FLOAT_LEFT:"Rechts umbrechen",
FLOAT_NONE:"Nicht umbrechen",FLOAT_RIGHT:"Links umbrechen",FLOAT_STYLE:"Ausrichtung",GET_NEW_CAPTCHA:"Neuen Code generieren",GET_PASSWORD:"Passwort vergessen",GO:"Los",GOTO_ANSWER:"Antwort zeigen",GOTO_QUESTION:"Frag nochmal",SHOW_CONTEXT:"Kontext zeigen",SHOW_EDITOR:"Seite bearbeiten",CONTEXT:"Kontext",HEIGHT:"H\u00f6he",HIGHLIGHT:"Hervorheben",HTML_CODE:"HTML Code",CODE:"Code",IN:"in",INDENT:"Mehr einr\u00fccken",INSERT_HTML:"HTML",INSERT_CODE:"Schreibmaschinen-Text",INSERT_IMAGE:"Bild",INSERT:"Einf\u00fcgen",
INSERT_LATEX:"Formel",AUTO_CONVERT_LATEX:"Automatik",AUTO_CONVERT_EXPLANATION:"Konvertiert automatisch LaTeX-Code der aktuellen Seites zu Formeln",AUTO_LATEX_NO_JOBS:"Es wurde kein LaTeX-Code auf der Seite gefunden",LATEX_SOURCE:"Formel",INSERT_LINK:"Link",INSERTORDEREDLIST:"Nummerierung",INSERTUNORDEREDLIST:"Aufz\u00e4hlung",ISSUE:"Frage",ITALIC:"Kursiv",INVITE:"Einladen",JUST_ENABLED:"Dein Account ist erfolgreich aktiviert worden. Zum Einloggen, das untere Formular benutzen.",LEVEL:"Ebene",LINK_HEADING:"Link-Editor",
LINK_TYPE:"Link-Typ",LINK_REQUIRES_SELECTION:"Zum Einf\u00fcgen eines Links ist eine Textauswahl notwendig",LOCATION:"Ziel",LOGON:"Anmelden",COULD_NOT_CLOSE_SESSION:"Sitzung konnte nicht geschlossen werden. Zum Start einer neuen Sitzung die Seite neuladen.",NAME:"Name",NAME_MISSING:"Benutzername fehlt",NO_ANSWER:"Du hast keine Antwort eingegeben.",NO_ANNOTATION:"Du hast keine Anmerkung eingegeben.",NO_FEEDBACK:"Du hast kein Feedback eingegeben.",NO_DEFINITION:"Du hast keine Definition eingegeben.",
NO_QUESTION:"Du hast keine Frage eingegeben.",NO_EXPRESSION:"Du hast keinen Ausdruck eingegeben.",NO_CARD_TITLE:"(nichts ausgew\u00e4hlt)",NO_FLASH_CARDS:"Keiner der Seiten in dieser Mappe enth\u00e4lt Fragekarten. Es kann nichts ge\u00fcbt werden.",NO_URL_GIVEN:"Um ein Bild aus einer URL einzuf\u00fcgen, muss ein Adresse angegeben werden.",NO_MARKER_FOR_DEL:"W\u00e4hle das Element aus, das du als erstes l\u00f6schen m\u00f6chtest",NOT_CONFIRMED:"Bitte best\u00e4tige deine E-Mail-Adresse, durch klicken auf den Link in der dir zugesendeten Best\u00e4tigungsemail.",
OK:"OK",OTHER_ERROR:"Fehler bei Skriptzugriff.",OUTDENT:"Weniger einr\u00fccken",PADDING_BOTTOM:"Unten",PADDING_LEFT:"Links",PADDING_RIGHT:"Rechts",PADDING_STYLE:"Abstand",PADDING_TOP:"Oben",PARA:"Absatz",PASS_MISSING:"Password fehlt",PASS_NOT_MATCHING:"Passw\u00f6rter stimmen nicht \u00fcberein",PASSWORD_ERROR:"Es ist ein Fehler bei der Passwortabfrage aufgetreten.",PASSWORD:"Passwort",PASSWORD_AGAIN:"Wiederhole Passwort",PASSWORD_SENT:"Eine E-Mail mit deinem Passwort wurde an die zum Account geh\u00f6rende E-Mail-Adresse geschickt.",
QUESTION_EDIT:"Editiere die ",QUESTION:"Lernkarte",QUESTION_TOO_LONG:"Frage ist zu lang.",REDO:"Wiederholen",REMOVE_FORMAT:"Formatierung aufheben",REMOVE:"Entfernen",REMOVE_THIS:"Element entfernen",RENAME:"Umbenennen",RENDERING_FAILED:"Formel konnte nicht gerendert werden.",REP_LEVEL:"Zur Wiederholung vorgemerkt",SHARE:"Freigeben",REPEAT:"Wiederholen",REPEAT_TITLE:"<strong>Erinnerst du die unten markierte Auswahl?</strong>",REVIEW_RIGHT:"Gewusst",REVIEW_UNSURE:"Sp\u00e4ter entscheiden",REVIEW_WRONG:"Sp\u00e4ter wiederholen",
SEL_REQUIRED_HIGHLIGHT:"Makiere bitte die Stelle, an der du einf\u00fcgen m\u00f6chtest.",SET:"Setzen",SESSION_CREATION_ERROR:"Beim Anlegen der Sitzung ist ein Fehler aufgetreten.",SESSION_FINISHED:"\u00dcbung abgeschlossen!",SESSION_ABORTED:"Das Laden wurde abgebrochen",SESSION_INVALID:"Eine ung\u00fcltige Antwort wurde gesendet. Grund k\u00f6nnte ein Fehler oder eine Zeit\u00fcberschreitung sein. Versuche die Seite neuzuladen",SIGN_UP:"Registrieren",STRIKE_THROUGH:"Durchstreichen",TERMS_ACCEPT:'Ich habe die <a href="%s" target="_blank">AGB</a> gelesen und verstanden.',
TERMS:"Nutzungsbedingungen",TERMS_MISSING:"Du hast die Nutzungsbedingungen akzeptiert",TITLE:"Titel",TOPIC:"Mappe",TOPIC_EMPTY:"Die Mappe enth\u00e4lt keine Seiten und kann daher nicht ge\u00f6ffnet werden.",TOPICS:"Mappenliste",TYPE_EMAIL:"E-Mail-Adresse",TYPE_URL:"URL",UNDERLINE:"Unterstreichen",UNTITLED:"Unbenannt",UPDATE:"Aktualisieren",UPLOAD_BUTTON:"Hochladen",PICTURE:"Bild",URL_INVALID:"Eingegebene URL ist ung\u00fcltig",USER_EMAIL_TAKEN:"Die von dir eingegebene E-Mail-Adresse wird bereits von einem anderen Benutzerkonto verwendet.",
USER_NAME_TAKEN:"Der ausgew\u00e4hlte Benutzername wird bereits von einem anderen Benutzerkonto verwendt.",WIDTH:"Breite",WRONG_PASSWORD:"Die Kombination von Benutzername und Passwort ist falsch.",WRONG_SECURITY:"Der eingegeben Sicherheitscode ist falsch",IMAGE_ADJUST_HEADING:"Bildeigenschaften anpassen",IMAGE_UPLOAD_HEADING:"Neues Bild hochladen",IMAGE_LOCATION_HEADING:"Folgende URL nehmen",PENDING:"Offen",COULD_NOT_UPDATE_RIGHT:"Konnte die Berechtigungen nicht auf dem Server aktualisieren",NONE:"keine",
HIGHLIGHTER_EXPLANATION:"<p><strong>Markiere nun Text auf der Seite</strong></p>",TOO_MUCH_CONTENT:'<h3>Optimale Inhaltsmenge</h3><p>F\u00fcr besseres Verst\u00e4ndnis sollte auf Seiten nicht mehr stehen als bis hier passt.</p><p class="add-hint">F\u00fcge mit der Einf\u00fcgen-Funktion <strong>weitere Seiten</strong> f\u00fcr die zus\u00e4tzlichen Inhalte ein.</p>',LATEX_EDITOR:"Formel-Editor, LaTeX",IMAGE_EDITOR:"Bild-Editor",MOVE_TO_TRASH:"Element ausschneiden (Textmarker erlaubt sp\u00e4teres Einf\u00fcgen in dieser Sitzung)",
CARD_UPDATE_PENDING:"Deine Notizen werden gespeichert. Wenn du diesen Vorgang abbrichst, gehen alle \u00c4nderungen verloren.",CARD_UPDATE_FAILURE:"Konnte die Notizen zu #### nicht speichern. Willst du es nochmal probieren?",DISMISS_DATA:"\u00c4nderungen verwerfen",RETRY_UPLOAD:"Speichern erneut probieren",INSERT_PAGE:"Seite einf\u00fcgen",BACK:"Zur\u00fcck",CREATE_NEW_TOPIC:"Neue Mappe anlegen",COULD_NOT_SYNC_TRAINING:"Trainingsdaten konnten nicht synchronisiert werden",COULD_NOT_LOAD_CARD:"Die ausgew\u00e4hlte Seite konnte nicht gefunden werden",
YOU:"Du",CARD_LOCKED_HTML:"<p><b>Jemand anders editiert gerade</b>, klicke auf 'Nochmal versuchen', um zu editieren.</p>",CARD_LOCKED_TITLE:"Jemand anders editiert gerade, klicke hier f\u00fcr weitere Optionen",CHECK_OUT_TRY_AGAIN:"Nochmal versuchen",BLOCK_MODE:"Blockmodus",RESET_SIZE:"Gr\u00f6\u00dfe zur\u00fccksetzen",HELP:"Hilfe...",LATEX_HELP_LINK:"http://www.mediabird.net/de/about/latex",SAVE_AS_CARD:"Als Fragekarte speichern",INSERT_TABLE:"Tabelle",LOGOUT:"Abmelden",OPEN_SHEET:"\u00d6ffne Zettel ",
ALERT_HEADER:"Info",GIVE_US_FEEDBACK:"Gib uns Feedback",SEND_FEEDBACK:"Feedback geben",SEND:"Senden",MESSAGE_EMPTY:"Deine Nachricht ist leer",THANKS_FEEDBACK:"Danke f\u00fcr dein Feedback.",FOLLOW_LINK:"Link \u00f6ffnen",EDIT_LINK:"Bearbeiten",INSERT_COLUMN:"Spalte einf\u00fcgen",INSERT_ROW:"Zeile einf\u00fcgen",DELETE_COLUMN:"Spalte l\u00f6schen",DELETE_ROW:"Zeile l\u00f6schen",TOPIC_COULD_NOT_BE_UPDATED:"Die Mappe konnte nicht aktualisiert werden. Du kannst keine Seiten entfernen, die gerade editiert werden.",
SAVE:"Speichern",SWITCH_TO_FULL:"Seite mit erweiterter Funktionalit\u00e4t bearbeiten",MAX_NO_OF_CARDS_IN_TOPIC:"Du hast die H\u00f6chstzahl an Seiten dieser Mappe erreicht. Lege eine neue Mappe in der \u00dcbersicht an",PDF_INSERT_EXPLANATION:"PDF-Seite einf\u00fcgen...",PDF_UPLOAD:"PDF-Datei importieren",PDF_UPLOAD_HEADING:"Datei hochladen",CHOOSE_PDF:"PDF-Datei ausw\u00e4hlen",INSERT_PDF_PASSWORD:"Die PDF-Datei ist verschl\u00fcsselt. Bitte gib das Passwort ein, um die PDF zu benutzen.",INSERT_PDF_PASSWORD_AGAIN:"Das Passwort war leider falsch. Bitte gib erneut das Passwort ein.",
PDF_LIST_HEADERS:["Titel","Seitenanzahl","Verschl\u00fcsselt","Erstellung"],IMPORT_PDF_PAGE:"Seiten aus oben ausgew\u00e4hlter PDF-Datei importieren",PAGE_NUMBER:"Seitenzahl",YES:"Ja",ALREADY_GIVEN:"Freigeschaltet",NO:"Nein",AUTHORIZE_PDF_IMPORT:"Die PDF-Datei ist verschl\u00fcsselt. Zum Importieren von Seiten gib bitte das PDF-Passwort ein.",NUMBER_OUT_OF_RANGE:"Seitenzahl au\u00dferhalb des m\u00f6glichen Bereichs",NO_PDF_SELECTED:"Du hast keine PDF-Datei ausgew\u00e4hlt. Du kannst PDF-Dateien mit dem Formular oben hochladen.",
GENERAL_PDF_AUTH_ERROR:"Beim \u00dcberpr\u00fcfen des Passworts ist ein Fehler aufgetreten.",PAGE_NUM_REQUIRED:"Bitte gib eine Seitenzahl ein, um fortzufahren",REPETITION:"Wiederholung",TAG_LIST_HEADERS:["Schlagwort","Farbe","\u00dcber Vorschau anzeigen"],DROP_TAG:"Schlagwort zum Filtern herziehen",REMOVE_FILTER_TAG:"Nicht mehr nach diesem Schlagwort filtern",REMOVE_TAG:"Dieses Schlagwort von der Auswahl entfernen",X_CARDS_WILL_BE_DELETED:"# Seiten werden gel\u00f6scht. M\u00f6chtest du fortfahren?",
COULD_NOT_UPDATE_TAGS:"Konnte Schlagw\u00f6rter nicht aktualisieren",SLIDE:"Folie",FROM:"Von",ADD_TAG:"Schlagwort hinzuf\u00fcgen",NEXT:"Weiter",PREVIOUS:"Zur\u00fcck",GOTO_TITLE:"Zur von diesem Benutzer ge\u00f6ffneten Seite wechseln",QUESTION_BOX_TITLE:"Durch offene Punkte dieses Nutzers navigieren",COULD_NOT_LOAD_USERS:"Konnte die Teampartner nicht laden",USER_HAS_NO_PROBLEMS:"Dieser Nutzer hat keine Fragen",ALREADY_ON_USERS_CARD:"Du bist bereits auf derselben Seite wie dein Teampartner",USER_INFO_HTML:'<h3><span class="name"/></h3><table><tr><td>E-Mail-Adresse</td><td><a class="email"/></td></tr><tr><td>Online</td><td><span class="online"/></td></tr><tr><td>Benutzt Mediabird</td><td><span class="active"/></td></tr><tr><td>Offene Fragen</td><td><a class="questions"/></td></tr><tr><td>Ge\u00f6ffnete Seite</td><td><a class="card"/></td></tr><tr><td>Rechte</td><td class="access"></td></tr></table>',
SET_RIGHT_HEADER:"Rechte festlegen",ACCESS:{OWNER:"Besitzer",FULL:"Voller Zugriff",WRITE:"Lesen, Feedback und Editieren",READ:"Lesen und Feedback",NONE:"Keine"},PROBLEM_BROWSE_HTML:'<h3>Navigiere durch offene Punkte von <em class="name"/> auf Seitenrand</h3><p class="links"> | <span class="current"/> | </p>',PROBLEM_MARKER_HTML:'<h3>Navigiere durch <em class="info"/> auf Seitenrand</h3><p class="links"> | <span class="current"/> | </p>',BROWSE_TYPES:{open:"ungel\u00f6ste Punkte",solved:"beantwortete Punkte",
repeat:"wiederholbare Punkte"},START_TRAINING:'<hr/><div>Diese Elemente <a class="s">vorbereiten</a>.</div>',INVITE_BY_EMAIL:"Per E-Mail einladen",ENTER_EMAIL:"E-Mail-Adresse eingeben",SHARE_THIS_NOTE_FOLDER:"Diese Mappe freigeben",SHARE_EXPLANATION:"Ziehe einfach Benutzer aus der Liste auf die Leiste unter dem Notizblock.",LOCKED:"Gesch\u00fctzt",EMPTY:"Leer",EMAIL_IN_USE:"Dieser User benutzt bereits Mediabird",NEW:"Neu",NOTES_ON:"Notizen zu",QUICK_QUESTION:"Gib eine Frage ein",REPEAT_THIS_ANSWER:"Diese Antwort zur Wiederholung der Frage w\u00e4hlen",
DELETE_THIS_ANSWER:"Diese Antwort l\u00f6schen",STAR_THIS_ANSWER:"Diese Antwort positiv bewerten",EXAM_PREPARATION:"Vorbereitung",NEVER:"Niemals",STATS_HEADER:"Vorbereitungsstand deiner Auswahl",PREPARE_SELECTED:"Vorbereitung fortsetzen",NO_CARDS_INFO:"Keine Fragekarten unter der Auswahl",EXAM_TOPIC_LIST_HEADERS:["Seite","Fragekartenanteil","Fortschritt","Letzte Vorbereitung"],TOPIC_LIST_HEADERS:["Titel","Teampartner","Letzte \u00c4nderung"],FILTER_NOTES_BY:"Zeige nur Notizen mit Schlagwort",NOTE_FOLDERS:"Mappen",
TAGS:"Schlagw\u00f6rter",PDF_FILES:"PDF-Dateien",UPLOAD_PDF:"PDF-Datei hochladen",PDF_TOPIC_USAGE_HEADERS:["Mappe","Benutzte Folien"],TOPICS_FEATURING_PDF:"Mappen, welche Folien dieser PDF beinhalten",CREATE_FROM_PDF:"Mappe mit dieser PDF anlegen",UNLOCK_PDF:"PDF freischalten",QUESTIONS:"Fragen",LINKS:"Verweise",GLOSSARY:"Glossar",SAVE_TERM:"Definition speichern",QUESTION_TOPIC_LIST_HEADERS:["Frage","Antworten","Fragensteller","Letzte \u00c4nderung"],GLOSSARY_TOPIC_LIST_HEADERS:["Begriff","Definitionen",
"Autor","Letzte \u00c4nderung"],LINK_TOPIC_LIST_HEADERS:["Titel","Ort","Letzte \u00c4nderung"],QUESTION_SAVE_ERROR:"Konnte deine Frage nicht abspeichern",QUESTION_RETRIEVE_ERROR:"Konnte die Fragen nicht laden",QUESTION_UPLOAD_ERROR:"Konnte die Frage nicht speichern",COULD_NOT_LOAD_RELATED:"Konnte nicht alle Objekte laden. Ein paar Elemente fehlen.",CURRENT_MARKER_REMOVED:"Der aktuelle Marker wurde entfernt.",COULD_NOT_LOAD_QUESTION:"Konnte die Nachrichten nicht laden.",SHARING_NEEDS_ACCESS:"Nur die Besitzer k\u00f6nnen diese Mappe weiteren Personen freigeben.",
PDF_LOCKED_INFO:"Diese PDF-Datei muss mit einem Passwort freigeschaltet werden.",BACK_TO_OVERVIEW:"< Zur\u00fcck zur \u00dcbersicht",START_TAKING_NOTES:"Notizen zu dieser PDF-Datei machen",ENTER_TITLE:"Gib den Titel der neuen Mappe ein",ENTER_NEW_TITLE:"Gib einen neuen Titel ein",RENAME_NEEDS_SELECTION:"Bitte w\u00e4hle die Mappe die umbenannt werden soll",LOADING:"Lade",NUM_OF_SHEETS:"Anzahl Seiten",NUM_OF_CARDS:"Anzahl Fragekarten",FLASH_CARDS_PER_SHEET:"Fragekarten pro Seite",AVG_TIME_SINCE_TRAINING:"Mittlere Zeit seit letzter Wiederholung (Tage)",
PREP_SCORE:"Stand der Vorbereitung",RELATED_TERM:"Was die Auswahl definiert",ENTER_COMMENT:"(Hier Kommentar schreiben)",RELATED_QUESTION:"Frage f\u00fcr Wiederholung",SEE_RANGE:"direkt zur Markierung",COULD_NOT_LOAD_CARDS:"Konnte die Fragekarten nicht laden",SHEETS_LOCKED:"Ein paar der Seiten werden gerade von anderen Nutzern editiert und k\u00f6nnen jetzt nicht gel\u00f6scht werden",TOPIC_CHANGED_MEANTIME:"Die Mappe hat sich zwischenzeitlich ver\u00e4ndert. Bitte probiere es nochmal.",COULD_NOT_LOAD_TOPIC:"Konnte die Mappe nicht neuladen",
SESSION_ERROR:"Konnte die Session nicht aktualisieren, bitte lade die Seite neu",COPY_FILE_FOR_INSERTION:"Du kannst diese PDF-Seiten nicht benutzen, da du sie nicht selbst hochgeladen hast. M\u00f6chtest du eine Kopie erstellen und mit dieser fortfahren?",COULD_NOT_COPY_PDF:"Konnte die PDF-Datei nicht kopieren. Versuche es erneut.",INSERT_MARKER:"Einf\u00fcgen oder highlighten",FILTER_VIEW:"Ansicht nach Schlagwort filtern",WIKIPEDIA:"wikipedia",COULD_NOT_LOAD_LINK:"Konnte Link nicht laden",LINK_RETRIEVE_ERROR:"Konnte die Verweise nicht laden",
INSERT_PLUGIN_HEADING:"Inhalt",INSERT_MARKER_HEADING:"Textrand",INSERT_CLIPBOARD_HEADING:"Zwischenablage",INSERT_LOST_HEADING:"Verlorene Markierungen",BIGGER:"Gr\u00f6\u00dfer",SMALLER:"Kleiner",LINK_INCOMPLETE:"F\u00fcr einen neuen Verweis m\u00fcssen Titel und URL angegeben werden",NOT_SHARABLE:"Dieses Element kann nicht freigegeben werden, weil du nicht ausreichend Zugriffsrechte hast.",SHARE_TOOLTIP:"Aktiviere diese Option um anderen Nutzern deinen Marker freizugeben. Diese k\u00f6nnen ihn bearbeiten und auch l\u00f6schen.",
EXPLAIN_WIKI_INSERTION:"Um Inhalte aus Wikipedia oder einer anderen Webseite einzuf\u00fcgen kannst du diese einfach in einem separaten Tab oder Fenster \u00f6ffnen. Markiere dann eine interessante Textstelle und kopiere sie mit der Tastenkombination Strg+ C. Wenn du zur\u00fcck zu Mediabird wechselst kannst du den Inhalt dann mit Strg + V einf\u00fcgen.",EXPLAIN_WORD_INSERTION:"Um Inhalte aus Word einzuf\u00fcgen, kannst du sie einfach in Word kopieren und auf der Seite einf\u00fcgen.",INSERT_WIKIPEDIA:"Aus Wikipedia",
INSERT_WEB:"Aus dem Internet",CARD_LOCK:"Zettelschloss",SWITCH_BOX:"Kasten vergr\u00f6\u00dfern/verkleinern",BOX_LABELS:{open:"Ungel\u00f6ste Punkte",solved:"Beantwortete Punkte",repeat:"Wiederholbare Punkte"},EXPLAIN_BOX:{open:'<h3>Ungel\u00f6ste Punkte</h3><p class="add-hint">Es gibt gerade keine ungel\u00f6sten Punkte. Um eine Frage zu stellen, <b>klicke auf den Textmarker</b> und w\u00e4hle "Frage stellen".</p>',solved:'<h3>Beantwortete Punkte</h3><p class="add-hint">Klicke auf <b>Ungel\u00f6ste Punkte</b>, um Fragen und Feedback deiner Teampartner zu beantworten. Sobald du oder deine Mitstreiter ein paar Fragen beantwortet haben, <b>klick hier nochmal</b>, um sie dir anzuschauen.</p>',
repeat:'<h3>Wiederholbare Punkte</h3><p class="add-hint">Es gibt noch keine Wiederholungsmarker oder Fragekarten. Um dich <b>einfach auf Tests oder Pr\u00e4sentationen vorzubereiten</b>, benutze den Textmarker, um deine Notizen mit <b>Test- und Verst\u00e4ndnis-Fragen</b> zu verkn\u00fcpfen, die dir bei der weiteren Vorbereitung helfen.</p>'},COULD_NOT_REFRESH_TOPICS:"Konnte die Mappen nicht aktualisieren",INSERT_TAG:"Schlagwort einf\u00fcgen",LINK_TYPES:["Internet","Lernumgebung","Teampartner","Andere Seite",
"Buch","Artikel","Wikipedia-Artikel","YouTube-Video","CoboCards-Karteikasten","E-Mail-Adresse"],LINK:"Verkn\u00fcpfung",LINK_UPLOAD_ERROR:"Konnte den Verweis nicht hochladen",INSERT_WORD:"Aus Microsoft Word",NO_USERS_SELECTED:"Du hast keinen Benutzer ausgew\u00e4hlt",BLOG_SYM:"T",BLOG_EXPLANATION:"Diese Seite geh\u00f6rt zum Lerntagebuch",WIKI_SYM:"W",WIKI_EXPLANATION:"Diese Seite geh\u00f6rt zum Wiki",CREATE_LINK:"Verweis erstellen",QUICK_LINK:"Gib eine Adresse an",LINK_SAVE_ERROR:"Konnte den Verweis nicht aktualisieren",
TOPIC_COUNT_REACHED:"Du hast das Limit an Mappen erreicht",TAG_CARD_LIMIT_REACHED:"Es k\u00f6nnen nur 6 verschiedene Tags an jede Seite angeheftet werden",RELATED_CARDS_LINK:"Dieser Verweis befindet sich auf folgenden Seiten",RELATED_CARDS_QUESTION:"Dieses Element befindet sich auf folgenden Seiten",NO_RELATED_CARDS_LINK:"Dieser Verweis wird auf keinen Seiten verwendet",NO_RELATED_CARDS_QUESTION:"Diese Frage wird auf keinen Seiten verwendet",CHECK_IN:"Die Seite wird bearbeitet, klicken um zu speichern und die Seite zum Editieren freizugeben",
CARD_DONE:"Bearbeitung dieser Seite ist abgeschlossen, klicken um sie wieder zu bearbeiten",CARD_DEFAULT:"Klicken um Seite zu bearbeiten und w\u00e4hrenddessen zur Bearbeitung durch andere zu sperren",LINK_EDIT:"Verweis bearbeiten",PDF_EXPLAIN:'Dies ist Folie <b class="p"/> von der PDF-Datei <b class="n"/>.',EXAM_STAT_HEADERS:["","Wert"],ENTER_TITLE_FOR_REF:"Du musst einen Titel eingeben, um einen Verweis zu erstellen",ENTER_URL_FOR_REF:"Du muss eine Adresse eingeben, um einen Verweis zu erstellen",
NOT_ALL_USERS_FOUND:"Nicht alle Benutzer konnten gefunden werden",INVALID:'Der Wert "#" ist ung\u00fcltig',ERROR_REMOVING_USER:"Konnte die gew\u00e4hlte Person nicht entfernen.",ANNOTATE:"Anmerken",ANNOTATE_TIP:"Kommentar oder Hinweis zur Auswahl",FEEDBACK:"Feedback",FEEDBACK_TIP:"Feedback oder Hinweis zur Auswahl",ASK_QUESTION:"Frage stellen",ASK_QUESTION_TIP:"Frage zur Auswahl",ANSWER_LINK:"Fragekarte einf\u00fcgen",ANSWER_LINK_TIP:"Frage-Antwort-Paar mit Bezug zur Auswahl",DEFINE_SELECTION:"Definieren",
DEFINE_SELECTION_TIP:"Definition mit Bezug zur Auswahl",THIS_DEFINES:"Begriff angeben",THIS_DEFINES_TIP:"Begriff den die Auswahl erkl\u00e4rt",REP_MARKER:"Wiederholen",REP_MARKER_TIP:"W\u00e4hrend Vorbereitung an Auswahl erinnern",QUESTION_TO_SELECTION:"Mit Frage wiederholen",QUESTION_TO_SELECTION_TIP:"W\u00e4hrend Vorbereitung Frage zur Auswahl stellen",REFERENCE:"Verweisen",REFERENCE_TIP:"Quelle oder Zitat zur Auswahl",DO_NOT_SHOW_AGAIN:"Nicht erneut zeigen",DATABASE_ERROR:"Datenbankfehler",CARD_CHANGED_WHILE:"Die Seite wurde zwischenzeitlich ver\u00e4ndert. M\u00f6glicherweise sind Inhalte verloren gegangen",
OPEN_TOPIC:"Mappe \u00f6ffnen",TRAIN_TOPIC:"Mappe vorbereiten",RENAME_FORBIDDEN:"Der Ersteller erlaubt dir nicht, diese Mappe umzubenennen",COURSE_NOTES:"Kursnotizen",DELETE_TABLE:"Tabelle l\u00f6schen",DELETE_TOPICS_CONFIRM:"Bist du sicher, dass du die ausgew\u00e4hlte Mappe und ihren gesamten Inhalt l\u00f6schen willst?\n\nDies kann nicht r\u00fcckg\u00e4ngig gemacht werden.",COULD_NOT_DELETE_TOPIC:"Konnte die gew\u00e4hlte Mappe nicht l\u00f6schen",DELETE_NEEDS_SELECTION:"Bitte w\u00e4hle die Mappe die gel\u00f6scht werden soll",
DELETE_FORBIDDEN:"Du musst der Besitzer der Mappe sein, um sie l\u00f6schen zu k\u00f6nnen",DELETE_UPLOAD_CONFIRM:"Bist du sicher, dass du diese PDF-Datei l\u00f6schen willst?",COULD_NOT_DELETE_UPLOAD:"Konnte die gew\u00e4hlte Datei nicht l\u00f6schen",TYPE_CARD:"Seite",EXPORT:"Exportieren",EXPORT_HEADER:'Exportierte Version von <em class="t"/> vom <em class="d"/>.',EXPORT_NEEDS_SELECTION:"Bitte w\u00e4hle die zu exportierende Mappe aus",NO_HTML_AMONG_SELECTION:"Es befinden sich nur PDF-Folien in deiner Auswahl. Diese lassen sich noch nicht exportieren",
EMPTY_EXPORT:"(leer)",EXPORT_HINT:"Tipp: Du kannst nun das Resultat markieren und dann mit der Tastenkombination Strg+C kopieren. Wenn du dann nach Word wechselst, kannst du die Inhalte dort einf\u00fcgen mit der Tastenkombination Ctrl+V",EXPLAIN_LOCKED_SLIDE:'Du musst noch das Passwort f\u00fcr diese PDF-Folie eingeben. Gehe zur\u00fcck zur \u00dcbersicht und suche die Datei unter "PDF-Dateien". Klicke dann auf den Pfeil vor der Datei, um sie zu entsperren.',TAG_ALREADY_EXISTS:"Dieses Schlagwort ist bereits angeheftet",
ADJUST_SIZE:"Vergr\u00f6\u00dfern/verkleinern",WORKFLOW_OPTIONS:"Workflow-Funktionen",MARK_NONE:"Nicht \u00e4ndern",MARK_ISSUE_SOLVED:"Frage ist gel\u00f6st!",MARK_FEEDBACK_SOLVED:"Feedback wurde gelesen",MARK_ISSUE_FORCE:"Frage bleibt ungel\u00f6st",CONVERT_ISSUE_FORCE:"In Frage umwandeln",CONVERT_FEEDBACK_FORCE:"In Feedback umwandeln",INSERT_HTML_TIP:"HTML-Code einf\u00fcgen oder HTML-Code der Auswahl bearbeiten",INSERT_CODE_TIP:"Mit Schreibmaschinen-Schrift formatierter Text",INSERT_IMAGE_TIP:"Bild hochladen oder existentes Bild einf\u00fcgen",
INSERT_LATEX_TIP:"LaTeX-Formel",INSERT_LINK_TIP:"Webseite oder E-Mail-Adresse",INSERT_TABLE_TIP:"Tabelle nahe dem Cursor einf\u00fcgen",COULD_NOT_LOAD_CHECK:"Konnte das Check-Element nicht laden",COULD_NOT_SAVE_QUESTION:"Konnte die Frage nicht speichern",COULD_NOT_SAVE_CHECK:"Konnte das Check-Element nicht speichern",CHECKBOX_EDITOR_HEADER:"Check",CHECK:"Check",SELECT_ALL:"Alle ausw\u00e4hlen",CONFIRMED:"Best\u00e4tigt",USER:"Nutzer",STATUS:"Status",CHECKBOX_HELP_NEW:"W\u00e4hle alle Nutzer aus, von denen du eine Lesebest\u00e4tigung erhalten willst.",
CHECKBOX_HELP:"Unten siehst du, wer diesen Eintrag gesehen und best\u00e4tigt hat.",CHECK_TITLE_PENDING:"Bisher hat niemand den Check best\u00e4tigt. F\u00fcr Details klicken.",CHECK_TITLE_HALF:"Es haben noch nicht alle best\u00e4tigt. F\u00fcr Details klicken.",CHECK_TITLE_COMPLETE:"Alle haben best\u00e4tigt. F\u00fcr Details klicken.",CHECK_NO_SHARE_HTML:'Du bist der <strong>einzige mit Zugriff</strong> auf die Mappe. Du musst <strong>Nutzer einladen</strong> um mit Checks zu arbeiten. Um dies zu tun <strong>klicke auf den "+"-Knopf</strong> in der unteren Leiste.',
CHECK_TIP:"Eine Lesebest\u00e4tigung vom Team anfordern",CONFIRM:"Best\u00e4tigen",CONFIRM_TITLE:"Klicken um dieses Element als gelesen zu markieren",SELECT_AT_LEAST_ONE:"Bitte w\u00e4hle mindestens einen Nutzer aus",CHECK_CREATOR:"(forderte die Best\u00e4tigung an)",COULD_NOT_SEND_FEEDBACK:"Senden des Feedback fehlgeschlagen.",REMOVE_MARKER_TITLE:"Entfernt dieses Element vom Dokument. Das Element bleibt bestehen, lediglich die Verkn\u00fcpfung wird aufgehoben.",LEAVE_TOPIC_CONFIRM:"Bist du sicher, dass du die Mappe entfernen m\u00f6chtest?",
COULD_NOT_LEAVE_TOPIC:"Konnte die Mappe nicht entfernen",INTRO_FOLDER_TITLE:"Erste Schritte: Mappe erstellen",INTRO_FOLDER_HTML:'Klicke auf <div class="toolbar emboss inline"><a class="item okay">Neue Mappe anlegen</a></div> um eine neue Mappe zu erstellen.',INTRO_EDIT_TITLE:"Erste Schritte: Text eingeben",INTRO_EDIT_HTML:"Klicke auf die Seite und <strong>gib ein bisschen Text ein</strong> oder f\u00fcge ihn ein.",INTRO_HIGHLIGHT_TITLE:"Erste Schritte: Frage stellen",INTRO_HIGHLIGHT_HTML:'<ul><li>Klicke auf <img title="Einf\u00fcgen oder highlighten" src="images/marker.png"> und w\u00e4hle "<strong>Frage stellen</strong>".</li><li><strong>Markiere etwas vom Text</strong> den du gerade eingegeben hast.</li></ul>',
INTRO_SHARE_TITLE:"Erste Schritte: Mappe freigeben",INTRO_SHARE_HTML:'<ul><li><strong>Gib eine Frage ein</strong> und klicke auf <div class="toolbar emboss inline"><a class="item okay">Speichern</a></div>.</li><li>Um Feedback zu deinen Notizen zu erhalten, musst du sie freigeben.</li><li>Klicke auf <img src="images/list-add.png" title="Mappe freigeben"> rechts von deinem Avatar um die Mappe freizugeben.</li></ul>',SHARE_FOLDER_TIP:"Mappe freigeben",ADD_PAGE_TIP:"Seite hinzuf\u00fcgen oder PDF-Seite einf\u00fcgen",
TAG_FILTER_EXPLANATION:"<p><b>Ziehe Schlagw\u00f6rter hierher</b> (von unter und \u00fcber den Seiten-Vorschaubildern) um nach ihnen zu filtern.</p>",CARD_TRASH_EXPLANATION:"<p><b>Ziehe Seiten hierher</b> um sie zu l\u00f6schen.</p>",TAG_FILTER_TIP:"Ziehe Schlagw\u00f6rter hierher (von unter und \u00fcber den Seiten-Vorschaubildern) um nach ihnen zu filtern.",CARD_TRASH_TIP:"Ziehe Seiten hierher um sie zu l\u00f6schen.",REMOVE_USER:"Nutzer entfernen",REMOVE_USER_CONFIRM:"# wird keine Zugriff mehr auf die Mappe haben. Bist du sicher, dass du fortfahren m\u00f6chtest?",
SELECT_FOR_INSERTION:"Markiere zuerst, wo das Element eingef\u00fcgt werden soll."};client.data.Object=function(a){if(a!==undefined){this.id=a.id;this.created=a.created?a.created:new Date(0);this.modified=a.modified?a.modified:new Date(0)}};client.data.Object.prototype.clone=function(){return new (client.data.Object.resolveType(this.type))(this)};client.data.Object.prototype.getModInfo=function(a){if(this.modifier)a.modifier=this.modifier;if(this.modified)a.modified=this.modified;return a};
client.data.Object.prototype.id=null;client.data.Object.prototype.type=null;client.data.Object.resolveType=function(a){a=utility.ucfirst(a);return client.data[a]};client.data.TopicAccessConstants={noAccess:0,allowViewingCards:1,allowSearchingCards:2,allowCopyingCards:4,allowEditingContent:8,allowAlteringMarkers:16,allowAddingCards:32,allowRearrangingCards:64,allowRemovingCards:128,allowRename:256,presetReadOnly:7,presetWriteAccess:63,presetFullAccess:511,owner:1023};
client.data.Topic=function(a){client.data.Object.call(this,a);this.type="topic";a=a!==undefined?a:{};this.title=a.title!==undefined?a.title:lang.UNTITLED;this.author=null;this.access=client.data.TopicAccessConstants.none;this.lastRefresh=0;var b=[];this.addRight=function(c){if(b.indexOf(c)==-1){c.topic=this;b.push(c)}if(c.user.current)this.access=c.access};this.removeRight=function(c){if(c.user.current)this.access=client.data.TopicAccessConstants.none;b.remove(c);c.topic=null};this.getRights=function(){return b.clone()};
this.getUsers=function(){var c=[];b.each(function(){this.access!=client.data.TopicAccessConstants.noAccess&&c.push(this.user)});return c};this.getCollaboratorCount=function(c){var h=0;b.each(function(){if(this.access!=client.data.TopicAccessConstants.noAccess&&!this.user.current&&(!c||this.user.online))h++});return h};this.getCollaborators=function(c){var h=[];b.each(function(){if(this.access!=client.data.TopicAccessConstants.noAccess&&!this.user.current&&(!c||this.user.online))h.push(this.user)});
return h};this.getUserRight=function(c){var h;b.each(function(){if(this.user===c){h=this;return false}});return h};this.isShared=function(){var c=false;b.each(function(){if(this.access!=client.data.TopicAccessConstants.noAccess&&!this.user.current){c=true;return false}});return c};this.getRightCount=function(){return b.length};this.getAccessMask=function(){return this.access};this.getRightsCount=function(){return b.length};this.clearRights=function(){b.each(function(){this.topic=null});b=[]};this.isEditable=
function(){return(this.access&client.data.TopicAccessConstants.presetWriteAccess)==client.data.TopicAccessConstants.presetWriteAccess};this.userRemovable=function(c){if(this.access!=client.data.TopicAccessConstants.owner)return false;var h;b.each(function(){if(this.user===c){h=this;return false}});return h?h.mask!=client.data.TopicAccessConstants.owner:false};this.isTaggable=function(){return(this.access&client.data.TopicAccessConstants.allowEditingContent)!=0};this.isStructurable=function(){return(this.access&
client.data.TopicAccessConstants.presetFullAccess)==client.data.TopicAccessConstants.presetFullAccess};this.isSharable=function(){return(this.access&client.data.TopicAccessConstants.owner)==client.data.TopicAccessConstants.owner};var d=[];this.each=function(c){for(var h=0;h<d.length;h++)if(c.call(d[h])==false)return};this.addCard=function(c){d.add(c);c.topic=this};this.removeCard=function(c){d.remove(c);c.topic=null};this.getCard=function(c){return d[c]};this.getCards=function(){return d.clone()};
this.insertCardAt=function(c,h){if(d[h]===undefined)d[h]=c;else d.splice(h,0,c);c.topic=this};this.getIndexOfCard=function(c){return d.indexOf(c)};this.getCardCount=function(){return d.length};this.getMarkers=function(){var c=[];d.each(function(){c=c.concat(this.getMarkers())});return c};this.getCardById=function(c){for(var h=0;h<d.length;h++){var m=d[h];if(m.id==c)return m}return null};this.clearCards=function(){for(;d.length>0;)this.removeCard(d[0])};this.sortCards=function(){d.sort(function(c,
h){return c.index-h.index})};this.transformStatic=function(){for(var c=[],h=0;h<d.length;h++)d[h].transformStatic().each(function(){this.index=h;c.push(this)});var m={title:this.title,category:this.category,cards:c};if(this.id!=null){m.id=this.id;m.modified=this.modified}return m};this.containsObject=function(c){var h=this,m=false;c.relatedMarkers&&c.relatedMarkers.each(function(){if(this.card&&this.card.topic&&this.card.topic===h){m=true;return false}});return m}};client.data.Topic.prototype=new client.data.Object;
client.data.Topic.getAccessLabel=function(a){var b=lang.NONE;if((a&client.data.TopicAccessConstants.presetReadOnly)==client.data.TopicAccessConstants.presetReadOnly){b=lang.GROUP_ACCESS_READONLY;if((a&client.data.TopicAccessConstants.presetWriteAccess)==client.data.TopicAccessConstants.presetWriteAccess){b=lang.GROUP_ACCESS_WRITE;if((a&client.data.TopicAccessConstants.presetFullAccess)==client.data.TopicAccessConstants.presetFullAccess){b=lang.GROUP_ACCESS_STRUCTURE;if((a&client.data.TopicAccessConstants.owner)==
client.data.TopicAccessConstants.owner)b=lang.GROUP_ACCESS_OWNER}}}return b};
client.data.Card=function(a){client.data.Object.call(this,a);this.type="card";a=a!==undefined?a:{};this.checkedOut=false;this.checkOutTime=null;this.title=a.title!==undefined?a.title:lang.UNTITLED;this.content=a.content!==undefined?a.content:null;this.cardType=a.type!==undefined?a.type:client.data.CardTypeConstants.html;this.pdf=undefined;this.page=0;this.needsPassword=undefined;this.isHtml=function(){return this.cardType==client.data.CardTypeConstants.html||this.cardType==client.data.CardTypeConstants.wiki||
this.type==client.data.CardTypeConstants.blog};this.isPdf=function(){return this.cardType==client.data.CardTypeConstants.pdf};this.index=this.topic=null;this.lastRefresh=0;var b=a.markers!==undefined?a.markers:[];this.needsLoading=true;this.isShared=function(){if(!this.topic)return false;return this.topic.isShared()};this.getTitle=function(){return this.title};this.each=function(c){for(var h=0;h<b.length;h++)if(c.call(b[h])==false)return};this.addMarker=function(c){if(c&&b.indexOf(c)==-1){c.card=
this;b.push(c)}};this.addMarkers=function(c){for(var h=0;h<c.length;h++)this.addMarker(c[h])};this.removeMarker=function(c){c.card=null;b.remove(c)};this.clearMarkers=function(){for(var c=0;c<b.length;c++)b[c].card=null;b.splice(0,b.length)};this.getMarkers=function(){return b.clone()};this.insertMarkerAt=function(c,h){c.card=this;b.splice(h,0,c)};this.getIndexOfMarker=function(c){return b.indexOf(c)};this.getMarkerById=function(c){for(var h=0;h<b.length;h++)if(b[h].id==c)return b[h]};this.getMarkerCount=
function(){return b.length};this.transformStatic=function(){var c={title:this.title};if(this.id)c.id=this.id;else{c.type=this.cardType;if(this.cardType==client.data.CardTypeConstants.pdf){c.uploadId=this.pdf.id;c.page=this.page}}return[c]};var d=a.tags!==undefined?a.tags:[];this.getTags=function(){return d.clone()};this.hasTag=function(c){c instanceof Array||(c=[c]);for(var h=0;h<c.length;h++)if(d.indexOf(c[h])>-1)return true;return false};this.getTagCount=function(){return d.length};this.addTag=
function(c){var h=false;d.each(function(){if(this===c||c.title.length>0&&this.title.toLowerCase()==c.title.toLowerCase()){h=true;return false}});h||d.push(c)};this.removeTag=function(c){d.remove(c)};this.removeTags=function(){d.splice(0,d.length)};this.getTrainableMarkers=function(){if(!this.needsLoading){var c=[];b.each(function(){this.trainable()&&c.push(this)});return c}}};client.data.Card.prototype=new client.data.Object;client.data.Card.LINK_PREFIX="note://";
client.data.CardTypeConstants={html:0,pdf:1,wiki:2,blog:3};
client.data.User=function(a){client.data.Object.call(this,a);this.type="user";a=a!==undefined?a:{};this.name=a.name!==undefined?a.name:null;this.email=a.email!==undefined?a.email:"";this.id=a.id!==undefined?a.id:-1;this.settings=a.settings!==undefined?a.settings:{};this.online=a.online!==undefined?a.online:false;this.active=a.active!==undefined?a.active:false;this.current=false;this.questions=[];this.needsLoading=true;this.picUrl=this.currentCard=this.lastRefresh=null;this.getIcon=function(){return config.imagePath+
["buddy.png","buddy-active.png","buddy-invited.png"][this.online?1:this.active?0:2]}};client.data.User.prototype=new client.data.Object;client.data.ExternalUser=function(a){client.data.Object.call(this,a);this.type="ExternalUser";a=a!==undefined?a:{};this.name=a.name?a.name:"";this.email=a.email?a.email:"";this.id=a.id?a.id:-1;this.mb_id=a.mb_id?a.mb_id:-1;this.getIcon=function(){return config.imagePath+"buddy-invited.png"}};client.data.ExternalUser.prototype=new client.data.Object;
client.data.Right=function(a){client.data.Object.call(this,a);this.type="right";a=a!==undefined?a:{};this.user=a.user!==undefined?a.user:null;this.access=a.access!==undefined?a.access:client.data.TopicAccessConstants.noAccess;this.toString=function(){return client.data.Right.accessLevelString(this.access)};this.className=function(){return client.data.Right.accessLevelString(this.access,true)};this.topic=null;this.transformStatic=function(){if(this.id)return{id:b.id,mask:access};var b={mask:this.access};
if(this.user instanceof client.data.ExternalUser)b.externalId=this.user.id;else if(this.user.id&&!this.user.wasUnshared)b.userId=this.user.id;else{this.user.needsLoading=true;b.email=this.user.email}return b}};
client.data.Right.accessLevelString=function(a,b){return a==client.data.TopicAccessConstants.owner?!b?lang.ACCESS.OWNER:"owner":(a&client.data.TopicAccessConstants.presetFullAccess)==client.data.TopicAccessConstants.presetFullAccess?!b?lang.ACCESS.FULL:"full":(a&client.data.TopicAccessConstants.presetWriteAccess)==client.data.TopicAccessConstants.presetWriteAccess?!b?lang.ACCESS.WRITE:"write":(a&client.data.TopicAccessConstants.presetReadOnly)==client.data.TopicAccessConstants.presetReadOnly?!b?lang.ACCESS.READ:
"read":!b?lang.ACCESS.NONE:""};client.data.Right.prototype=new client.data.Object;client.data.Relation=function(a){client.data.Object.call(this,a);this.type="relation";this.remove=false;a=a!==undefined?a:{};this.object=a.object?a.object:undefined;this.marker=a.marker?a.marker:undefined;this.clone=function(){var b=new client.data.Relation;b.object=this.object;return b}};client.data.Relation.prototype=new client.data.Object;
client.data.LinkTypeConstants={external:0,platform:1,user:2,card:3,book:4,article:5,wikipedia:6,youtube:7,cobocards:8,mailto:9};
client.data.Link=function(a){client.data.Object.call(this,a);this.type="link";a=a!==undefined?a:{};this.loaded=false;this.url=a.url!==undefined?a.url:"about:blank";this.title=a.title!==undefined?a.title:"-";this.typeNum=a.type?a.type:0;this.user=a.user?a.user:0;this.getIcon=function(b){var d;switch(this.typeNum){case client.data.LinkTypeConstants.platform:d="link";break;case client.data.LinkTypeConstants.wikipedia:d="wikipedia";break;default:d="link-ext"}return!b?d+"-small.png":d+".png"};this.getTypeString=
function(){var b=lang.LINK_TYPES[this.typeNum];return b?b:lang.LINK_TYPES[0]};this.getTitle=function(){var b=this.title;return b=b.length>=60?b:b.substr(0,57)+"..."};this.detectLinkType=function(b){b=this.url.toLowerCase();return b.substr(0,client.data.Card.LINK_PREFIX.length)==client.data.Card.LINK_PREFIX?client.data.LinkTypeConstants.card:b.substr(0,7)=="mailto:"?client.data.LinkTypeConstants.mailto:b.search("wikipedia.org")>-1?client.data.LinkTypeConstants.wikipedia:config.linkPrefix!==undefined&&
b.search(config.linkPrefix.toLowerCase())==0?client.data.LinkTypeConstants.platform:b.search("youtube.com")>-1?client.data.LinkTypeConstants.youtube:client.data.LinkTypeConstants.external};this.getTarget=function(){var b=config.linkPrefix,d;if(config.reference!==undefined)d=config.reference.target!==undefined?config.reference.target:"_self";return target=b!==undefined&&this.url.toLowerCase().search(b.toLowerCase())==0?d:"_blank"};this.considerMod=true};client.data.Link.prototype=new client.data.Object;
client.data.QuestionModeConstants={question:0,annotation:1,definition:2,issue:3,relatedQuestion:4,relatedTerm:5,feedback:6,feedbackSolved:7,issueForce:8,issueSolved:9};
client.data.Question=function(a){client.data.Object.call(this,a);this.type="question";a=a!==undefined?a:{};this.loaded=false;this.body=a.body||a.question?a.body||a.question:"";this.user=a.user?a.user:"-";this.transformStatic=function(){return{id:this.id,type:this.type,question:this.body,mode:this.mode,userId:this.user.id}};this.mode=a.mode?a.mode:client.data.QuestionModeConstants.question;this.getTitle=function(){return client.data.Question.titleString(this.mode)};this.getIcon=function(h){return client.data.Question.iconString({mode:this.mode,
big:h,answers:b,body:this.body})};this.needsRange=function(){return this.mode==client.data.QuestionModeConstants.relatedTerm||this.mode==client.data.QuestionModeConstants.relatedQuestion||this.mode==client.data.QuestionModeConstants.feedback};this.needsQuestion=function(){return true};this.needsAnswer=function(){return this.mode==client.data.QuestionModeConstants.question||this.mode==client.data.QuestionModeConstants.definition||this.mode==client.data.QuestionModeConstants.issueSolved||this.mode==
client.data.QuestionModeConstants.feedbackSolved};this.isOpen=function(){return this.mode==client.data.QuestionModeConstants.issue&&b.length==0||this.mode==client.data.QuestionModeConstants.issueForce||this.mode==client.data.QuestionModeConstants.feedback};this.isPending=function(){return this.mode==client.data.QuestionModeConstants.issue&&b.length>0};this.isAlert=function(){return this.isOpen()};this.allowAnswer=function(){return this.mode!=client.data.QuestionModeConstants.relatedQuestion||this.body};
var b=[];this.getAnswerCount=function(){return b.length};this.getAnswers=function(){return b.clone()};this.addAnswer=function(h){b.add(h);h.question=this};this.removeAnswer=function(h){b.remove(h);delete h.question};var d=[];this.addVote=function(h){d.add(h);h.question=this};this.removeVote=function(){d.remove(vote);delete vote.question;delete vote.answer};this.getVoteInfo=function(h,m){var j=false,o=0;d.each(function(){if(this.answer===h&&this.enabled!==false){if(this.user===m)j=true;o++}});return{votedFor:j,
voteCount:o}};this.getVoteFor=function(h){var m;d.each(function(){if(this.answer===h){m=this;return false}});return m};var c;this.getStar=function(){return c};this.setStar=function(h){c&&delete c.question;c=h;c.question=this};this.unsetStar=function(){if(c){delete c.question;delete c.answer;c=undefined}};this.getStarredAnswer=function(){if(c)return c.answer;else if(b.length>0)return b[0]};this.trainable=function(){return[client.data.QuestionModeConstants.question,client.data.QuestionModeConstants.definition,
client.data.QuestionModeConstants.issueSolved,client.data.QuestionModeConstants.relatedQuestion].indexOf(this.mode)>-1&&(!this.needsAnswer()||b.length>0)};this.relatedMarkers=[];this.considerMod=true};
client.data.Question.titleString=function(a){switch(a){case client.data.QuestionModeConstants.question:return lang.QUESTION;case client.data.QuestionModeConstants.relatedQuestion:return this.body?lang.RELATED_QUESTION:lang.REP_LEVEL;case client.data.QuestionModeConstants.annotation:return lang.ANNOTATION;case client.data.QuestionModeConstants.feedback:case client.data.QuestionModeConstants.feedbackSolved:return lang.FEEDBACK;case client.data.QuestionModeConstants.definition:return lang.DEFINITION;
case client.data.QuestionModeConstants.relatedTerm:return lang.RELATED_TERM;case client.data.QuestionModeConstants.issue:case client.data.QuestionModeConstants.issueForce:case client.data.QuestionModeConstants.issueSolved:return lang.ISSUE;default:return lang.EDITOR_TITLE}};
client.data.Question.iconString=function(a){var b=a.big;switch(a.mode){case client.data.QuestionModeConstants.question:case client.data.QuestionModeConstants.issueSolved:return"flashcard"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.definition:return"definition"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.relatedTerm:return"def-rel"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.relatedQuestion:return a.body?"rep-quest"+(!b?"-small":"")+".png":
"repetition"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.feedback:return"feedback"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.annotation:case client.data.QuestionModeConstants.feedbackSolved:return"remark"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.issueForce:return"problem"+(!b?"-small":"")+".png";case client.data.QuestionModeConstants.issue:return a.answers&&a.answers.length>0?"prob-ans"+(!b?"-small":"")+".png":"problem"+(!b?"-small":"")+
".png";default:return""}};client.data.Question.prototype=new client.data.Object;client.data.Answer=function(a){client.data.Object.call(this,a);this.type="answer";a=a!==undefined?a:{};this.body=a.body||a.answer?a.body||a.answer:"";this.user=a.user?a.user:"-";this.transformStatic=function(){return{id:this.id,type:this.type,answer:this.body,userId:this.user.id}};this.considerMod=true};client.data.Answer.prototype=new client.data.Object;
client.data.Star=function(a){client.data.Object.call(this,a);this.type="star";a=a!==undefined?a:{};this.answer=a.answer?a.answer:null;this.question=undefined;this.user=a.user?a.user:"-";this.transformStatic=function(){return{id:this.id,type:this.type,answerId:this.answer.id,userId:this.user.id}}};client.data.Star.prototype=new client.data.Object;
client.data.Vote=function(a){client.data.Object.call(this,a);this.type="vote";a=a!==undefined?a:{};this.answer=a.answer?a.answer:null;this.user=a.user?a.user:"-";this.transformStatic=function(){return{id:this.id,type:this.type,answerId:this.answer.id,userId:this.user.id}};this.considerMod=true};client.data.Vote.prototype=new client.data.Object;client.data.FlashcardResultConstants={none:0,right:1,neutral:2,wrong:3};
client.data.Flashcard=function(a){client.data.Object.call(this,a);this.type="flashcard";this.dependent=true;a=a!==undefined?a:{};this.loaded=false;this.marker=a.marker?a.marker:null;this.relation=a.relation?relation:undefined;this.level=config.MIN_BOX_LEVEL;this.answerTime=a.time?a.time:0;var b=[0,0,0,0,0];this.getLastResults=function(){return b.clone()};this.setLastResults=function(d){b=d.clone()};this.addResult=function(d){for(var c=1;c<b.length;c++)b[c-1]=b[c];b[b.length-1]=d};this.reset=function(){this.level=
config.MIN_BOX_LEVEL;b=[0,0,0,0,0];this.answerTime=0};this.title=null;this.getPrepScore=function(){var d=b[1]==client.data.FlashcardResultConstants.right&&b[2]==client.data.FlashcardResultConstants.right&&b[3]==client.data.FlashcardResultConstants.right&&b[4]==client.data.FlashcardResultConstants.right,c=new Date,h=new Date(this.answerTime*1E3);c=(c.getTime()-h.getTime())/1E3/3600/24;return c<=7?d?1:0:d?Math.max(0.25,1-(c-7)*0.03):0};this.relatedMarkers=[];this.getMarker=function(){return this.relatedMarkers[0]};
this.transformStatic=function(){return{id:this.id,results:b,answerTime:this.answerTime,level:this.level}}};client.data.Flashcard.prototype=new client.data.Object;client.data.FlashcardContents=function(){this.showCard=false;this.backSide=this.frontSide=null;this.showSelfAssessmentButtons=true};
client.data.Tag=function(a){client.data.Object.call(this,a);this.type="tag";a=a!==undefined?a:{};this.title=a.title!==undefined?a.title:"";this.color=a.color!==undefined?a.color:"00FF66";this.showText=a.showText!==undefined?a.showText:false};client.data.Tag.prototype=new client.data.Object;
client.data.File=function(a){client.data.Object.call(this,a);this.type="file";a=a!==undefined?a:{};this.filename=a.filename!==undefined?a.filename:"";this.title=a.title;this.pageCount=a.pageCount;this.encrypted=a.encrypted;this.user=a.user;this.created=a.created!==undefined?a.created:new Date(0);this.fileType=a.type!==undefined?a.type:client.data.FileTypeConstants.image};client.data.File.prototype=new client.data.Object;client.data.FileTypeConstants={image:0,pdf:1,equation:2};
client.data.CheckStatusConstants={unchecked:0,checked:1};
client.data.Check=function(a){client.data.Object.call(this,a);this.type="check";a=a!==undefined?a:{};this.loaded=false;this.user=a.user?a.user:0;this.statusses=[];this.loadCheckStatusses=function(b){var d=this;d.statusses=[];b.each(function(){d.statusses.push(this)})};this.createCheckStatusses=function(b){b.each(function(){this.statusses.push({user:this,status:client.data.CheckStatusConstants.unchecked})})};this.considerCheckUpdate=function(b){var d=null;this.statusses.each(function(){if(this.id==
b.id){this.status=b.status;this.modified=b.modified;d=this;return false}});return d};this.actionRequired=function(){var b=false,d=this.user.current;this.statusses.each(function(){if((d||this.user.current)&&this.status==client.data.CheckStatusConstants.unchecked){b=true;return false}});return b};this.relatedMarkers=[];this.considerMod=true;this.isPending=function(b){return b.status==client.data.CheckStatusConstants.unchecked};this.getStatusString=function(b){return this.isPending(b)?lang.PENDING:lang.CONFIRMED};
this.getProgress=function(){var b=this.statusses.length;if(b==0)return 0;var d=0;this.statusses.each(function(){this.status==client.data.CheckStatusConstants.checked&&d++});return d/b};this.getTitle=function(){var b=this.getProgress();return b==0?lang.CHECK_TITLE_PENDING:b==1?lang.CHECK_TITLE_COMPLETE:lang.CHECK_TITLE_HALF};this.getIcon=function(b){var d=this.getProgress();if(b)return"check-full.png";return d==0?"check-small.png":d==1?"check-full-small.png":"check-half-small.png"}};
client.data.Check.prototype=new client.data.Object;
client.ServerInterface=function(a){function b(){u--;if(u<1){utility.hideLoader();u=0}}function d(n,z,C,L,U){u++;utility.showLoader();if(config.customArgs!==undefined&&typeof config.customArgs=="object")z=$.extend($.extend({},config.customArgs),z);var Y={};for(var W in z)Y[config.prefixData?"data["+W+"]":W]=z[W];if(A&&z.action=="up"){W=JSON.stringify(A.settings);if(W!=N)Y[config.prefixData?"data[Settings]":"Settings"]=N=W}C={url:n,args:z,action:z.action,data:C,callback:U,type:L};n={type:"POST",url:n,
data:Y,success:h,error:m,dataType:L,getTag:function(){return arguments.callee.tag}};if(config.syncAjax)n.async=false;n.getTag.tag=C;return c(n)}function c(n){o();return jQuery.ajax(n)}function h(n){b();if(n==null)n={r:client.ServerErrors.noReply};var z=this.getTag();j(z);if(n.r!=client.ServerErrors.okay){n.error=n.r;delete n.r;utility.triggerCallback(z.callback,[n,z.data])}else{delete n.r;n.success=true;switch(z.url){case t:a:{n=n;switch(z.action){case E:break;case s:n.success=true;utility.triggerCallback(z.callback,
n);break a;case D:A=F.users([n.user])[0];A.current=true;k();o();break;case q:window.clearTimeout(G);r.call(w,null);break}utility.triggerCallback(z.callback,{success:true})}break;case v:l(n,z);break}}}function m(n){b();var z=this.getTag();j(z);if(z!==undefined)if(utility.triggerCallback(z.callback,[{error:client.ServerErrors.noReply},z.data]))return;if(n.status===undefined||n.status==404)alert(lang.CONNECTION_ERROR);else n.status==0?alert(lang.SESSION_ABORTED):alert(lang.SESSION_INVALID)}function j(n){n.action==
"sess"&&[n.data.cardToCheckIn,n.data.card].each(function(){if(this){if(this.checkingOut)this.checkingOut=false;if(this.checkingIn)this.checkingIn=false}})}function o(){window.clearTimeout(G);G=window.setTimeout(i,H*1E3)}function i(){return d(v,{action:"keep"},null,"json",utility.createCallback(w,f))}function f(n){if(!n.success){window.clearTimeout(G);alert(lang.CONNECTION_DOWN)}}function k(){if(!A.settings||A.settings=="")A.settings={};A.online=true;N=JSON.stringify(A.settings)}function g(n,z,C,L){var U=
R[n+"s"],Y="i"+z,W=U[Y];if(W===undefined&&!C){n=utility.ucfirst(n);W=L!==undefined?new L:new client.data[n];W.id=z;U.push(U[Y]=W)}return W}function l(n,z){var C=n.t;delete n.success;delete n.t;var L={};if(n.unknownUsers!==undefined){L.unknownUsers=n.unknownUsers;delete n.unknownUsers}if(z.action=="sess"){L.checkedInCard=z.data.cardToCheckIn;L.card=z.data.card;L.checkIn=n.checkInResult;delete n.checkInResult;L.checkOut=n.checkOutResult;delete n.checkOutResult;if(z.data.card!==undefined){z.data.card.lastRefresh=
C;if(z.data.refreshTopic)z.data.card.topic.lastRefresh=C}if(n.markers!==undefined){var U=[],Y=n.markers;(z.data.refreshTopic?z.data.card.topic:z.data.card).getMarkers().each(function(){var fa=false,aa=this;Y.each(function(){if(this.id==aa.id){fa=true;return false}});fa||U.push(aa.id)});F.removedMarkerIds(U)}I=C}z.action=="auth"&&R.cards.each(function(){this.cardType==client.data.CardTypeConstants.pdf&&this.pdf===z.data&&delete this.needsPassword});for(var W in n){var ea=F[W].apply(w,[n[W],C]);L[W.replace("Ids",
"")]=ea;if(C!==undefined&&(z.action=="load"&&z.data&&z.data.isRefresh||z.action=="init")){W=="topics"&&ea.each(function(){if(!this.lastRefresh)this.lastRefresh=C});x[W]=C}}if(z.action=="load"){z.data.objects.each(function(){if(this.needsLoading)this.needsLoading=false;if(this.lastRefresh!==undefined&&this.lastRefresh instanceof Date)this.lastRefresh=new Date});z.data=z.data.tag}z.data&&z.data.refreshTime&&z.data.refreshTime.each(function(){this.lastRefresh=C});for(W in n){if(W=="tagColors")W="tags";
if(M[W]!==undefined&&L[W]!==undefined){var ga={type:W};ga[W]=L[W];M[W].each(function(){this.call(window,ga)})}}for(W in n){if(W=="removedUploadIds")W="files";if(W=="removedTopicIds")W="topics";if(M[W]!==undefined){ga={type:W};ga[W]=[];M[W].each(function(){this.call(window,ga)})}}L.success=true;utility.triggerCallback(z.callback,[L,z.data])}function r(){w=this;A=null;J=J?J:[];B=B?B:[];x={};I=0;R={topics:[],rights:[],cards:[],markers:[],relations:[],users:[],externalUsers:[],tags:[],files:[],relations:[],
links:[],questions:[],answers:[],stars:[],votes:[],flashcards:[],checks:[]};M={cards:[],contents:[],markers:[],users:[],sessions:[],topics:[],files:[],tags:[],questions:[],flashcards:[],links:[],checks:[]}}var t=config.logonPath?config.logonPath:"logon.php",v=a.sessionPath?a.sessionPath:"session.php",E="retrievepassword",s="signup",D="signin",q="signout",H=config.keepAliveInterval?config.keepAliveInterval:720,A,B;this.addDisplayPlugin=function(n){B.push(n)};this.removeDisplayPlugin=function(n){B.splice(B.indexOf(n),
1)};this.getDisplayPlugins=function(){return B.clone()};var J;this.addMarkerType=function(n){J.push(n)};this.removeMarkerType=function(n){J.remove(n)};this.getMarkerTypes=function(){return J.clone()};var u=0,w,G;this.getCurrentUser=function(){return A};this.resumeSession=function(n){A=F.users([n])[0];A.current=true;k();o()};this.getFiles=function(n){var z=[];R.files.each(function(){if(n===undefined||this.fileType==n)z.push(this)});return z};this.getTopics=function(){return R.topics.clone()};this.getTopicCount=
function(){return R.topics.length};this.getQuestions=function(){return R.questions.clone()};this.getObjects=function(n){return R[utility.plural(n)].clone()};var M;this.registerSyncHandler=function(n,z){M[n]!==undefined&&M[n].add(z)};this.unregisterSyncHandler=function(n,z){M[n]!==undefined&&M[n].remove(z)};this.init=function(n){return d(v,{action:"init"},null,"json",n)};var x;this.refresh=function(n,z,C){var L=["Topic","Markers","Files","User","Question","Link","Flashcard"],U={action:"load"},Y=new Date,
W=false,ea=[];for(var ga in n)if(L.indexOf(ga)==-1)return false;else if(n[ga]){var fa={},aa=utility.plural(ga),Fa=x[aa];if(Fa!==undefined){if(!C&&Y.getTime()-Fa*1E3<6E3)continue;fa.fromTime=Fa}var Da=[];R[aa].each(function(){ea.push(this);Da.push(this.id)});if(Da.length>0)fa.loadedIds=Da;U[ga]=JSON.stringify(fa);W=true}return W||C?d(v,U,{objects:ea,isRefresh:true},"json",z):null};this.prepareLoad=function(n,z){if(z===undefined)z={};n.each(function(){var C=utility.ucfirst(this.type),L=utility.plural(this.type);
if(z[C]===undefined){z[C]={};z[C][L]=[]}z[C][L].push(this)});return z};this.load=function(n,z,C){var L=["Topic","Content","Markers","Files","User","Question","Check","Link","Flashcard"],U={action:"load"},Y=[];for(var W in n)if(L.indexOf(W)==-1)return false;else if(n[W]){var ea={},ga=W.toLowerCase();if(ga.substr(ga.length-1)!="s")ga+="s";var fa=[];if(n[W][ga]&&n[W][ga].length>0){n[W][ga].each(function(){Y.add(this);fa.push(this.id)});ea.restrictIds=fa}var aa=[];if(n[W].parents){n[W].parents.each(function(){Y.add(this);
aa.push(this.id)});ea.parentIds=aa}ea.fromTime=n[W].fromTime?n[W].fromTime:undefined;U[W]=JSON.stringify(ea)}return d(v,U,{tag:C,objects:Y},"json",z)};this.loadCards=function(n,z){var C=[];n.each(function(){this.isHtml()&&C.push(this)});var L={Markers:{parents:n}};if(C.length>0)L.Content={contents:C};return this.load(L,z,{refreshTime:n})};this.loadCard=function(n,z){return this.loadCards([n],z)};this.loadFiles=function(n){return this.refresh({Files:true},n)};this.update=function(n,z,C){var L=["Topic",
"TagColor","Content","Markers","Question","Check","Link","Flashcard"],U={action:"up"};for(var Y in n)if(L.indexOf(Y)==-1)return false;else if(n[Y])U[Y]=JSON.stringify(n[Y]);return d(v,U,C,"json",z)};this.updateTopic=function(n,z,C){if(n.id){z.id=n.id;z.modified=n.modified}return this.update({Topic:z},C,n)};this.updateCard=function(n,z,C){var L={};if(z.content!==undefined&&n.checkedOut)L.Content={id:n.id,content:z.content,modified:n.contentModified};if(z.title)L.Topic={id:n.topic.id,modified:n.topic.modified,
cards:[{id:n.id,title:z.title}]};if(z.markers||z.deletedMarkerIds)L.Markers={markers:z.markers,deletedMarkerIds:z.deletedMarkerIds};return this.update(L,C,{card:n,data:z})};this.backtrace=function(n,z,C){var L=["Question","Link","Flashcard","Check"],U={action:"backtrace"},Y=[];for(var W in n)if(L.indexOf(W)==-1)return false;else if(n[W]){var ea={},ga=W.toLowerCase();if(ga.substr(ga.length-1)!="s")ga+="s";var fa=[];if(n[W][ga]&&n[W][ga].length>0){n[W][ga].each(function(){Y.add(this);fa.push(this.id)});
ea.ids=fa}else return false;U[W]=JSON.stringify(ea)}return d(v,U,{tag:C,objects:Y},"json",z)};this.suggestFeature=function(n,z){return d(v,{action:"feedback",desc:n},null,"json",z)};this.copy=function(n,z,C){var L=["Files"],U={action:"copy"};for(var Y in n)if(L.indexOf(Y)==-1)return false;else if(n[Y])U[Y]=JSON.stringify(n[Y]);return d(v,U,C,"json",z)};this.del=function(n,z,C){var L=["Files","Topic"];if(n.length>1)return false;var U={action:"del"};for(var Y in n)if(L.indexOf(Y)==-1)return false;else if(n[Y]){var W=
[];n[Y].each(function(){W.push(this.id)});U[Y]=JSON.stringify(W)}return d(v,U,C,"json",z)};this.getCardsWithMarker=function(n,z){return d(v,{action:GET_CARDS_WITH_MARKER_ACTION,tool:n},null,"json",z)};this.retrievePassword=function(n,z,C){return d(t,{email:n,captcha:z,action:E},null,"json",C)};this.signUp=function(n,z,C,L,U){return d(t,{name:n,password:z,email:C,captcha:L,action:s},null,"json",U)};this.openSession=function(n,z,C){return d(t,{name:n,password:z,action:D},null,"json",C)};this.changePassword=
function(n,z,C){return d(v,{current:n,newpass:z,action:"changePass"},null,"json",C)};this.deleteAccount=function(n,z){return d(v,{current:n,action:"deleteAccount"},null,"json",z)};this.abortRequest=function(n){try{if(n!==undefined){n.abort();b()}}catch(z){}};this.renderEquation=function(n,z){return d(v,{action:"render",eq:n},null,"json",z)};this.getCard=function(n){return g("card",n)};this.getRelation=function(n){return g("relation",n)};this.authorizeFile=function(n,z,C){return d(v,{action:"auth",
id:n.id,password:z},n,"json",C)};this.closeSession=function(n){return d(t,{action:q},null,"json",n)};this.getTagColor=function(){var n=config.TAG_COLORS.clone();R.tags.each(function(){n.remove(this.color)});return n.length>0?n[0]:config.TAG_COLORS[Math.floor(Math.random()*(config.TAG_COLORS.length-1))]};this.getTags=function(){var n=[];R.tags.each(function(){this.title&&n.push(this)});return n};this.loadUsers=function(n,z){return this.load({User:{users:n}},z)};var I;this.updateSession=function(n,
z){var C={action:"sess",options:{}};if(n.card&&n.card.id){C.options.cardId=n.card.id;C.options.cardTime=n.card.lastRefresh;if(n.refreshTopic){C.options.topicId=n.card.topic.id;C.options.topicTime=n.card.topic.lastRefresh}if(n.checkOut){n.card.checkingOut=true;C.options.checkOut=1}}if(n.cardToCheckIn&&n.cardToCheckIn.id){n.cardToCheckIn.checkingIn=true;C.options.checkInId=n.cardToCheckIn.id}C.options=JSON.stringify(C.options);return d(v,C,n,"json",z)};var N,F={};F.topics=function(n){for(var z=[],C=
0;C<n.length;C++){var L=n[C],U=g("topic",L.id);if(L.title)U.title=L.title;if(L.license!==undefined)U.license=L.license;if(L.modified!==undefined)U.modified=L.modified;if(L.modifier!==undefined)U.modifier=g("user",L.modifier);if(L.rights){var Y=[],W=L.rights;U.getRights().each(function(){var O=false,ka=this;W.each(function(){if(this.id==ka.id){O=true;return false}});O||Y.push(ka.id)});F.removedRightIds(Y);F.rights(L.rights).each(function(){U.addRight(this)});U.access==client.data.TopicAccessConstants.none&&
F.removedTopicIds([U.id])}if(L.cards){for(var ea=[],ga=L.cards,fa=U.getCards(),aa=0;aa<fa.length;aa++){for(var Fa=false,Da=fa[aa],Ga=0;Ga<ga.length;Ga++)if(ga[Ga].id==Da.id){Fa=true;break}Fa||ea.push(Da.id)}F.removedCardIds(ea);L=F.cards(L.cards);for(aa=0;aa<L.length;aa++)U.addCard(L[aa]);U.sortCards()}z.push(U)}return z};F.deletedTags=function(n){n.each(function(){var z=g("tag",this.id);this.from.each(function(){g("card",this).removeTag(z)})})};F.rights=function(n){var z=[];n.each(function(){var C=
g("right",this.id);if(this.modified!==undefined)C.modified=this.modified;if(this.mask!==undefined)C.access=this.mask;if(this.userId!==undefined)C.user=g("user",this.userId);z.push(C)});return z};F.cards=function(n){for(var z=[],C=0;C<n.length;C++){var L=n[C],U=g("card",L.id);if(L.tags!==undefined){U.removeTags();for(var Y=0;Y<L.tags.length;Y++)U.addTag(g("tag",L.tags[Y]))}if(L.index!==undefined)U.index=L.index;if(L.title!==undefined)U.title=L.title;if(L.type!==undefined)U.cardType=L.type;if(L.modified!==
undefined)U.modified=L.modified;if(L.modifier!==undefined)U.modifier=g("user",L.modifier);if(L.type==client.data.CardTypeConstants.pdf){U.pdf=g("file",L.uploadId);U.page=L.page;U.needsPassword=L.needsPassword}z.push(U)}return z};F.contents=function(n){var z=[];n.each(function(){var C=g("card",this.id),L=C.contentModified;C.contentModified=this.modified;if(this.content!==undefined)C.content=this.content;if(!L||C.contentModified>L)z.push(C)});return z};F.checkedOutCardIds=function(n){n.each(function(){var z=
g("card",this);z.checkedOut=true;z.checkOutTime=new Date})};F.checkedInCardIds=function(n){n.each(function(){var z=g("card",this);z.checkedOut=false;z.checkOutTime=null})};F.markers=function(n){var z=[];n.each(function(){var C;if(this.tool!==undefined)C=client.markers[utility.ucfirst(this.tool)+"Marker"];var L=g("marker",this.id,C===undefined,C);if(!L)return true;if(this.modified!==undefined)L.modified=this.modified;else return true;this.shared!==undefined&&L.setShared(this.shared==1);this.relations!==
undefined&&this.relations.each(function(){var U=g(this.type,this.relatedId),Y=g("relation",this.id);Y.object=U;L.addRelation(Y)});if(this.range!==undefined)L.rangeStore=this.range;if(this.userId){L.user=g("user",this.userId);L.isMine=L.user===A}if(this.cardId){C=g("card",this.cardId);L.card&&L.card!==C&&L.card.removeMarker(L);C.addMarker(L)}L.hasChanged||L.restore();z.push(L)});return z};F.externalUsers=function(n){var z=[];n.each(function(){var C=g("externalUser",this.id);delete this.id;C=$.extend(C,
this);z.push(C)});return z};F.users=F.sessions=function(n){var z=[];n.each(function(){var C=g("user",this.userId||this.id);this.id&&delete C.wasUnshared;delete this.id;delete this.userId;if(this.lastLogin!==undefined){C.lastLoginStamp=this.lastLogin;C.lastLogin=new Date(this.lastLogin*1E3);delete this.lastLogin}C.modified=this.modified;delete this.modified;if(this.cardId!==undefined){C.currentCard=g("card",this.cardId,true);delete this.cardId}C=$.extend(C,this);delete C.needsLoading;z.push(C);C.lastRefresh=
new Date});return z};F.settings=function(n){A.settings=n;N=JSON.stringify(n)};F.files=function(n){var z=[];n.each(function(){var C=g("file",this.id);if(this.created!==undefined){C.created=this.created;delete this.created}if(this.type!==undefined)C.fileType=this.type;if(this.encrypted!==undefined)C.encrypted=this.encrypted==1;if(this.userId!==undefined){C.user=g("user",this.userId);delete this.userId}$.extend(C,this);z.push(C)});return z};F.questions=function(n){n instanceof Array||(n=[n]);var z=[];
n.each(function(){var C=g("question",this.id);C.loaded=true;delete C.needsLoading;if(this.mode!==undefined)C.mode=this.mode;if(this.question)C.body=this.question;if(this.modified)C.modified=this.modified;if(this.userId)C.user=g("user",this.userId);if(this.modifier)C.modifier=g("user",this.modifier);this.answers&&F.answers(this.answers).each(function(){C.addAnswer(this)});this.votes&&F.votes(this.votes).each(function(){C.addVote(this)});this.stars&&F.stars(this.stars).each(function(){C.setStar(this)});
C.lastRefresh=new Date;z.push(C)});return z};F.flashcards=function(n){var z=[];n.each(function(){var C=g("flashcard",this.id);C.loaded=true;delete C.needsLoading;C.modified=this.modified;if(this.answerTime)C.answerTime=this.answerTime;this.results&&C.setLastResults(this.results);if(this.level)C.level=this.level;z.push(C)});return z};F.links=function(n){var z=[];n.each(function(){var C=g("link",this.id);C.loaded=true;delete C.needsLoading;if(this.userId!==undefined){C.user=g("user",this.userId);delete C.userId}if(this.modifier)C.modifier=
g("user",this.modifier);if(this.type!==undefined){C.typeNum=this.type;delete this.type}$.extend(C,this);C.lastRefresh=new Date;z.push(C)});return z};F.answers=function(n){var z=[];n.each(function(){var C=g("answer",this.id);C.body=this.answer;C.modified=this.modified;if(this.userId)C.user=g("user",this.userId);z.push(C)});return z};F.votes=function(n){var z=[];n.each(function(){var C=g("vote",this.id);C.modified=this.modified;if(this.userId)C.user=g("user",this.userId);if(this.answerId)C.answer=g("answer",
this.answerId);z.push(C)});return z};F.stars=function(n){var z=[];n.each(function(){var C=g("star",this.id);C.modified=this.modified;if(this.userId)C.user=g("user",this.userId);if(this.answerId)C.answer=g("answer",this.answerId);z.push(C)});return z};F.removedIds=function(n,z,C){var L=[];z.each(function(){var U=g(n,this,true);if(U!==undefined){var Y=R[utility.plural(n)];Y.remove(U);delete Y["i"+this];C!==undefined&&C.call(U);L.push(U)}});return L};F.removedMarkerIds=function(n){return F.removedIds("marker",
n,function(){this.card&&this.card.removeMarker(this)})};F.removeRelationHook=function(){this.marker!==undefined&&this.marker.removeRelation(this)};F.removedRelationIds=function(n){return F.removedIds("relation",n,F.removeRelationHook)};F.removedFileIds=function(n){return F.removedIds("files",n)};F.removedCardIds=function(n){return F.removedIds("card",n,function(){var z=this;R.users.each(function(){this.currentCard==z&&delete this.currentCard});if(this.topic!==undefined){this.topic.removeCard(this);
this.topic=undefined}})};F.removedTopicIds=function(n){return F.removedIds("topic",n)};F.removedUploadIds=F.removedFileIds=function(n){return F.removedIds("file",n)};F.cleanRelated=function(n){var z=[];R.relations.each(function(){n.indexOf(this.object)>-1&&z.push(this)});z.each(function(){R.relations.remove(this);this.marker&&this.marker.removeRelation(this)});return n};F.removedLinkIds=function(n){return F.cleanRelated(F.removedIds("link",n))};F.removedFlashcardIds=function(n){return F.cleanRelated(F.removedIds("flashcard",
n))};F.removedQuestionIds=function(n){return F.cleanRelated(F.removedIds("question",n))};F.removedAnswerIds=function(n){return F.removedIds("answer",n,function(){this.question&&this.question.removeAnswer(this)})};F.removedStarIds=function(n){return F.removedIds("star",n,function(){this.question&&this.question.unsetStar()})};F.removedVoteIds=function(n){return F.removedIds("vote",n,function(){this.question&&this.question.removeVote(this)})};F.removedRightIds=function(n){return F.removedIds("right",
n,function(){this.user.wasUnshared=true;if(this.topic!==undefined){this.topic.removeRight(this);this.topic=undefined}})};F.removedUserIds=F.removedSessionIds=function(n){return F.removedIds("user",n)};F.tags=function(n){n.each(function(){var z=g("tag",this.id);z.title=this.title;if(!z.custom)z.color=this.color})};F.tagColors=function(n){n.each(function(){var z=g("tag",this.tagId);if(this.userColor){z.color=this.userColor;z.custom=true}if(this.showText!==undefined)z.showText=this.showText>0})};F.markerInfos=
function(n){var z=[];n.each(function(){var C=g("marker",this.id,true),L=g("card",this.cardId);z.push({card:L,marker:C})});return z};F.removedCheckIds=function(n){return F.removedIds("check",n)};F.checks=function(n){var z=[];n.each(function(){var C=g("check",this.id);C.loaded=true;C.modified=this.modified;if(this.userId)C.user=g("user",this.userId);if(this.modifier)C.modifier=g("user",this.modifier);var L=[];this.checkStatusses.each(function(){L.push({user:g("user",this.userId),status:this.status,
modified:this.modified,id:this.id})});C.loadCheckStatusses(L);C.lastRefresh=new Date;z.push(C)});return z};F.checkStatusses=function(n){var z=[];n.each(function(){var C=this;R.checks.each(function(){var L=this.considerCheckUpdate(C);L&&z.push(L)})});return z};this.getUsers=function(){return R.users.clone()};this.getExternalUsers=function(){return R.externalUsers.clone()};var R;r.call(this,null);this.destroy=function(){M=R=x=B=J=w=null}};client.data.FileTypeConstants={image:0,pdf:1};
client.ServerErrors={okay:0,accessDenied:1,locked:2,invalidData:3,invalidPage:4,invalidEmail:5,invalidRevision:6,serverError:7,disabled:8,wrongPass:9,wrongCaptcha:10,nameNotUnique:11,emailNotUnique:12,moveError:13,illegalType:14,notEnoughQuota:15,fileTooBig:16,uploadFailed:17,limitCountReached:18,noReply:1024};
client.Page=function(a,b,d){var c=[];this.container=a;this.header=d;this.server=b;this.getLoadedPlugins=function(){return c.clone()};this.unloadAll=function(){for(;c.length>0;)this.unloadPagePlugin(c[0])};this.loadPagePlugin=function(h){if(c.indexOf(h)==-1){h.page=this;h.load();c.each(function(){if(this!==h){this.onPluginLoad(h);h.onPluginLoad(this)}});c.push(h)}};this.unloadPagePlugin=function(h){if(c.indexOf(h)!=-1){c.each(function(){this!==h&&this.onPluginRemove(h)});h.unload();h.page=null;c.remove(h)}}};
client.Widget=function(){};client.Widget.prototype.load=function(){};client.Widget.prototype.unload=function(){};client.Widget.prototype.destroy=function(){};
client.widgets.Editor=function(a){function b(){if(!H){s.bind("mouseup",c).bind("paste",h).bind("dragend",h);$(document).bind("keyup",c).bind("dragdrop",h).bind("drop",h).bind("keydown",o);H=true;client.widgets.Editor.current=E}}function d(){if(H){s.unbind("mouseup",c).unbind("paste",h).unbind("dragend",h);$(document).unbind("keyup",c).unbind("dragdrop",h).unbind("drop",h).unbind("keydown",o);H=false}}function c(){window.clearTimeout(B);B=window.setTimeout(j,a.timeout);if(!u){s.triggerHandler("beginchange");
s.triggerHandler("change");u=true}window.clearTimeout(J);J=window.setTimeout(g,r)}function h(x){c(x);window.clearTimeout(w);w=window.setTimeout(m,t)}function m(){s.triggerHandler("afterdrop")}function j(){if(u){s.triggerHandler("endchange");B=undefined;u=false}}function o(x){var I=!x.ctrlKey&&!x.altKey&&!x.metaKey;if(x.which==9&&I){x.preventDefault();i(x.shiftKey?"outdent":"indent",null)}else if(x.which==67&&x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();E.clearFormatting(utility.ClearFormattingConstants.removeStyle|
utility.ClearFormattingConstants.removeClass)}else if(x.which==109&&x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();i("subscript",null)}else if(x.which==54&&x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();i("superscript",null)}else if(x.which==66&&!x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();i("bold",null);g()}else if((x.which==73||x.which==69)&&!x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();i("italic",null);g()}else if(x.which==85&&!x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();
i("underline",null);g()}else if(x.which==80&&x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();i("FormatBlock",$.browser.msie?"Paragraph":"p")}else if(x.which>=49&&x.which<=51&&!x.altKey&&x.metaKey){x.preventDefault();i("FormatBlock",($.browser.msie?"Heading ":"h")+(x.which-48))}else if(x.which==76&&x.shiftKey&&!x.altKey&&x.metaKey){x.preventDefault();i("insertunorderedlist",null);g()}else{if(x.which==13&&!x.altKey&&!x.metaKey&&!x.ctrlKey&&!x.shiftKey)if(!$.browser.msie)if((I=window.getSelection())&&
I.rangeCount>0&&I.isCollapsed){I=I.getRangeAt(0);var N=I.endContainer,F=$(E.document.createElement("ul")).append(E.document.createElement("li"));if(N.nodeType==3)if(N.nodeValue.length>2&&(N.nodeValue.substr(0,2)=="* "||N.nodeValue.substr(0,2)=="- ")){for(x=N;(x=x.parentNode)&&x.tagName.toLowerCase()!="li"&&x!=s[0];);if(x==s[0]){N.nodeValue=N.nodeValue.substr(2);$(N).wrap(F);I.selectNodeContents(N);I.collapse(false)}return}for(;N.nodeType!=1||window.getComputedStyle(N,"").display.toLowerCase()!="block";)N=
N.parentNode;if(N==s[0]||$.browser.safari&&N.tagName=="DIV"&&N.parentNode==s[0]){i("FormatBlock","p");return}}if(x.which==8||x.which==46)c()}}function i(x,I){try{if(document.queryCommandEnabled(x)){var N=false;if($.browser.msie&&(x=="bold"||x=="italic"||x=="strikeThrough"||x=="underline"))try{N=document.queryCommandState(x)}catch(F){N=false}c();document.execCommand(x,false,I);N&&f(x)}}catch(R){}}function f(x){var I=$.getSelection({parent:s,disableSurrounding:true,returnNullIfCollapsed:true});if(I){(I.is("div.body")?
$("*",I):I.add($("*",I))).each(function(){var N=$(this);switch(x){case "italic":N.css("font-style")=="italic"&&N.css("font-style","normal");break;case "bold":N.css("font-style")=="bolder"&&$(this).css("font-weight","normal");break;case "strikeThrough":case "underline":var F=N.css("text-decoration").split(" "),R=F.length;F.remove(x=="underline"?"underline":"line-through");if(F.length<R){F.length==0&&F.push("none");N.css("text-decoration",F.join(" "))}break}});g()}}function k(){for(var x=0;x<M.length;x++){var I=
M[x],N;try{N=document.queryCommandState(I.action)}catch(F){N=false}I.toggleClass("active",N)}}function g(){q&&s.triggerHandler("change")}function l(x){x=x.data;client.widgets.Editor.current!=E&&E.focus();x=x.action;switch(x){case "bigger":case "smaller":x=x=="bigger";var I=$.getSelection({parent:s,disableSurrounding:true,returnNullIfCollapsed:false}),N=0;if(I.closest("p").length>0)N=0;else if(I.closest("h3").length>0)N=1;else if(I.closest("h2").length>0)N=2;else if(I.closest("h1").length>0)N=3;N+=
x?1:-1;if(N>3||N<0)return;N>0?i("FormatBlock",($.browser.msie?"Heading ":"h")+(4-N).toString()):i("FormatBlock",$.browser.msie?"Paragraph":"p");break;case "removeFormat":E.clearFormatting(utility.ClearFormattingConstants.removeStyle|utility.ClearFormattingConstants.removeClass);c();break;default:i(x,null);g();break}}var r=250,t=20,v=a.node;a=$.extend({timeout:7E3},a);var E,s;s=$(document.createElement("div")).addClass("mb-body body");s.appendTo(v);E=this;H=false;E.document=document;E.body=s;E.window=
window;var D=false;this.load=function(x){if(!D){s.bind("focus",b).bind("blur",d);D=true}if(x){if(x.content){A=undefined;s.html(x.content)}x.isEditor!==undefined&&this.changeMode(x.isEditor);x.loadHandler&&x.loadHandler.call(this)}};this.unload=function(){s.empty();A=undefined;window.clearTimeout(B);window.clearTimeout(J);j();if(D){s.unbind("focus",b).unbind("blur",d);D=false}};this.destroy=function(){if(E){s.remove();delete s;E.document=null;E.body=null;E.window=null;delete A;if(client.widgets.Editor.current==
E)client.widgets.Editor.current=null;G=E=undefined}};var q;this.changeMode=function(x){s.attr("contentEditable",x?"true":"false");q=x;return true};var H;this.isFocussed=function(){return H};var A,B,J,u,w,G;this.setupToolbar=function(x){if(G===undefined){G=x&&x.node?x.node:utility.createToolbar().prependTo(v).css("overflow","hidden");var I=[utility.createButton("format-bold.png","bold",lang.BOLD,l),utility.createButton("format-italic.png","italic",lang.ITALIC,l),utility.createButton("format-strike.png",
"strikeThrough",lang.STRIKE_THROUGH,l),utility.createButton("format-underline.png","underline",lang.UNDERLINE,l),utility.createButtonSeparator(),utility.createButton("format-clear.png","removeFormat",lang.REMOVE_FORMAT,l),utility.createButtonSeparator(),utility.createButton("format-bullets.png","insertunorderedlist",lang.INSERTUNORDEREDLIST,l),utility.createButton("format-numbers.png","insertorderedlist",lang.INSERTORDEREDLIST,l),utility.createButtonSeparator(),utility.createButton("format-outdent.png",
"outdent",lang.OUTDENT,l),utility.createButton("format-indent.png","indent",lang.INDENT,l),utility.createButtonSeparator(),utility.createButton("format-smaller.png","smaller",lang.SMALLER,l),utility.createButton("format-bigger.png","bigger",lang.BIGGER,l)];M=[];M.push(I[0],I[1],I[2],I[3],I[10],I[11]);for(var N=0;N<I.length;N++){var F=I[N];F.appendTo(G);x&&x.additionalHandlers&&x.additionalHandlers[N]&&F.bind("click",x.additionalHandlers[N]);x&&x.additionalItems&&x.additionalItems[N]&&x.additionalItems[N].appendTo(G)}s.bind("change",
k);return G}};var M;this.clearFormatting=function(x,I){var N=I!==undefined?I:$.getSelection({parent:s,disableSurrounding:true,returnNullIfCollapsed:true});N||(N=s.children());utility.clearFormatting(x,N);g()};this.isEditor=function(){return q};this.getContent=function(){return s?s.html():null};this.getContentText=function(){return s?s.text():null};this.focus=function(){s.focus();H||b({})};this.fixListNesting=function(){$("ul,ol",s).each(function(){var x=this.parentNode.tagName.toUpperCase();if(x==
"OL"||x=="UL")if(this.previousSibling&&this.previousSibling.tagName&&this.previousSibling.tagName.toUpperCase()=="LI")this.previousSibling.appendChild(this);else{x=$(this);x.children().insertBefore(this);x.remove()}})}};client.widgets.Editor.current=null;client.widgets.Editor.prototype=new client.Widget;
client.widgets.PngEditor=function(a){function b(v){v.preventDefault();if(i=k==true){g=l=undefined;f={x:$.browser.safari?v.clientX:v.pageX,y:$.browser.safari?v.clientY:v.pageY};c(f);o.css({left:f.x,top:f.x,height:0,width:0}).show();$(document).one("mouseup",h)}}function d(v){v.preventDefault();if(i===true){g={x:$.browser.safari?v.clientX:v.pageX,y:$.browser.safari?v.clientY:v.pageY};c(g);o.css({left:f.x<g.x?f.x:g.x,top:f.y<g.y?f.y:g.y,width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)})}}function c(v){var E=
utility.getAbsolutePosition(j[0]);v.x-=E.left;v.y-=E.top}function h(v){v.stopPropagation();v.preventDefault();if(i){if(g!==undefined&&g.x!=f.x&&g.y!=f.y&&a.drawFinishedHandler!==undefined){l=new client.widgets.PngEditor.Area({l:f.x<g.x?f.x:g.x,t:f.y<g.y?f.y:g.y,r:f.x>g.x?f.x:g.x,b:f.y>g.y?f.y:g.y});a.drawFinishedHandler.apply(window,[l,v,g])}i=false}}function m(v){var E=$(document.createElement("div")).addClass("area").css({left:v.l,height:v.b-v.t,top:v.t,width:v.r-v.l}).appendTo(j);v.div=E;t.push(v);
return v}var j,o;(function(){j=$(document.createElement("div")).appendTo(a.node);j.addClass("png-editor");j.bind("click",function(v){v.stopPropagation();a.mainClickHandler!==undefined&&a.mainClickHandler.call(this,v)});j.bind("mousedown",b);j.bind("mousemove",d);j.img=$(document.createElement("img")).disableContextMenu().appendTo(j);a.imageSizeChanged!==undefined&&j.img.bind("load",function(){a.imageSizeChanged(this.offsetWidth,this.offsetHeight)});o=$(document.createElement("div")).hide().appendTo(j);
o.addClass("marquee")})();var i,f,k,g,l;this.hasLastArea=function(){return l!==undefined};this.getLastArea=function(){return l};var r,t;this.load=function(v){t=[];a.imageSizeChanged!==undefined&&r&&r==v.url&&j.img.triggerHandler("load");j.img.attr("src",v.url);r=v.url;v.areas.each(function(){m(this)})};this.addArea=function(v){return m(v)};this.removeArea=function(v){if(t.indexOf(v)>-1){v.div!==undefined&&v.div.remove();t.remove(v)}};this.getAreas=function(){return t.clone()};this.getSelection=function(){if(k==
true&&l!==undefined)return l;return null};this.setDrawingMode=function(v){if(v){k=true;j.addClass("drawing")}else{k=false;j.removeClass("drawing")}l=undefined;o.hide()};this.unload=function(){t=undefined};this.destroy=function(){j.remove();j=o=undefined}};client.widgets.PngEditor.Area=function(a){$.extend(this,a)};client.widgets.PngEditor.Area.prototype.l=0;client.widgets.PngEditor.Area.prototype.t=0;client.widgets.PngEditor.Area.prototype.b=0;client.widgets.PngEditor.Area.prototype.r=0;
client.widgets.PngEditor.Area.prototype.tag=null;client.widgets.PngEditor.Area.prototype.div=null;
client.widgets.TreeView2=function(a){function b(){if(this.item==null)this.item=$(document.createElement("tr"));if(this.subItems){var E=this.item.get();this.subItems.each(function(){b.call(this);this.render();for(var s=this._item.get(),D=0;D<s.length;D++)E.push(s[D])});this._item=$(E)}else this._item=this.item}function d(){if(k){if(!r){r=$(document.createElement("tr")).addClass("header").appendTo(k);a.headers.each(function(){var B=$(document.createElement("th")).addClass("column").appendTo(r);B.text(this.title);
if(this.sortable){B.sortKey=this.sortKey;B.addClass("pointer").bind("click",B,h).mousedown(function(J){J.preventDefault()})}})}m();var E=[],s=0,D=j.length;if(o){s=i*f;D=f}for(var q=s;q<s+D&&q<j.length;q++)E.push(j[q]);if(l){var H=[];l.each(function(){H.indexOf(this)==-1&&this._item.appendTo(g)})}l=E;var A=r;l.each(function(){b.call(this);this.render();A.after(this._item);A=this._item.eq(this._item.length-1)});if(o&&j.length>f){t||(t=$(document.createElement("tr")).addClass("paginate").appendTo(k).attr("colspan",
a.headers.length));t.empty().show();E=$(document.createElement("td")).attr("colspan",a.headers.length).addClass("paginate").appendTo(t);s=$(document.createElement("div")).addClass("paginate").appendTo(E);E=Math.ceil(j.length/f);D=utility.createLink("previous").addClass("page prev").toggleClass("active",i==0).appendTo(s);i>0&&D.bind("click",i-1,c);for(D=0;D<E;D++)if(D<=2||D>=i-1&&D<=i+1||D>=E-2){q=utility.createLink(D+1).addClass("page num").toggleClass("active",i==D).appendTo(s);D!=i&&q.bind("click",
D,c);needDots=true}else if(needDots){q=$(document.createElement("span")).addClass("dots").text("...").appendTo(s);needDots=false}s=utility.createLink("next").addClass("page next").toggleClass("active",i==E-1).appendTo(s);i<E-1&&s.bind("click",i+1,c)}else t&&t.hide()}}function c(E){i=E.data;d()}function h(E){E=E.data;v&&v!==E&&v.removeClass("asc desc");E.hasClass("asc")?E.removeClass("asc").addClass("desc"):E.removeClass("desc").addClass("asc");v=E;d()}function m(){if(v){var E=v.hasClass("desc");j.sort(function(s,
D){var q=D;if(E){D=s;s=q}var H,A;if(v.sortKey!==undefined){H=s.info[v.sortKey];A=D.info[v.sortKey]}if(H==A)return 0;return typeof H=="string"?H.toUpperCase()>A.toUpperCase()?1:-1:A-H})}}var j=[];this.getCheckedItems=function(){var E=[];j.each(function(){this.check()&&E.push(this)});return E};this.getItems=function(){return j.clone()};this.addItems=function(E){if(j.length==0)j=E.clone();else E.each(function(){j.add(this)});d()};this.removeItems=function(E){E.each(function(){j.remove(this)});d()};var o,
i,f;this.paginate=function(E,s){if(E){o=true;f=E;i=s?s:i?i:0}else o=false;d()};var k,g;this.load=function(){k=$(document.createElement("table")).addClass("treeview").appendTo(a.container);g=$(document.createElement("table"));d()};this.getContainer=function(){return k};this.unload=function(){if(k){k.remove();k=undefined}if(g){g.empty();g=undefined}i=0;l=v=r=t=undefined;j=[]};var l,r,t,v};client.widgets.TreeView2.prototype=new client.Widget;
client.widgets.TreeViewHeader=function(a){this.title=a.title;this.sortable=a.sortable;this.sortKey=a.sortKey};client.widgets.TreeViewItem2=function(a){$.extend(this,a)};client.widgets.TreeViewItem2.prototype.item=null;client.widgets.TreeViewItem2.prototype.info=null;client.widgets.TreeViewItem2.prototype.subItems=null;client.widgets.TreeViewItem2.prototype.check=function(a){var b=$("input[type=checkbox]:first",this.item);if(a==undefined)return b.is(":checked");else b.get(0).checked=a==true};
client.widgets.TreeViewItem2.prototype.expand=function(a){var b=this._item.slice(1);if(a!==undefined)b.toggleClass("hidden",!a);else return!b.hasClass("hidden")};
client.widgets.TextTreeViewItem=function(a){client.widgets.TreeViewItem2.call(this,a);this.render=function(){if(!this.rendered){this.addClasses&&this.item.addClass(this.addClasses);for(var b=0;b<this.info.length;b++){var d=$(document.createElement("td"));if(this.items)if(typeof this.items[b]=="string")d.text(this.items[b]);else{this.items[b].appendTo(d);this.items[b].addClasses&&d.addClass(this.items[b].addClasses)}else d.text(this.info[b]);d.appendTo(this.item);b==0&&this.icon&&$(document.createElement("img")).addClass("icon").attr("src",
config.imagePath+this.icon).prependTo(d);if(b==0&&this.showCheck){var c=$('<input type="checkbox"/>').bind("click",this,function(m){var j=this.checked;m.data.onCheck&&m.data.onCheck(j)});d.prepend(c);if(this.initialCheck)c.get(0).checked=true}if(b==0&&this.showExpander){var h=utility.createLink().addClass("expander").bind("click",this,function(m){var j=$(this).toggleClass("expanded").hasClass("expanded");m.data.expand(j);m.data.onExpand&&m.data.onExpand(j)});d.prepend(h);if(this.initialCheck)c.get(0).checked=
true}}this.rendered=true}}};client.widgets.TextTreeViewItem.prototype=new client.widgets.TreeViewItem2;
client.widgets.Slider=function(a){function b(i){var f=i.data.px+(i.pageX-i.data.x),k=[0,i.data.width*(i.data.steps.length-1)];if(f<k[0])f=k[0];if(f>k[1])f=k[1];i.data.slider.css("left",f);k=Math.floor(f/i.data.width);f=f%i.data.width;var g=i.data.steps[k];if(f>0&&k<i.data.steps.length-1)g+=f/i.data.width*(i.data.steps[k+1]-i.data.steps[k]);g=Math.round(g);i.data.snapRadius>1&&i.data.steps.each(function(){if(Math.abs(g-this)<i.data.snapRadius){g=this;return false}});if(a.valueChanging!==undefined)if(a.valueChanging(d,
g)===false)g=o;d.setValue(g);a.valueChanged!==undefined&&a.valueChanged.call(d,g)}var d=this,c,h,m,j;(function(){j=a.steps;c=$(document.createElement("div")).addClass("zoom-control").appendTo(a.node);c.mousedown(function(k){k.preventDefault()});m=97/(j.length-1);var i=0;j.each(function(){var k=$(document.createElement("div")).addClass("mark").appendTo(c);k.css("left",Math.floor(m*i));$(document.createElement("div")).addClass("line").appendTo(k);$(document.createElement("div")).addClass("num").text(this.toString()).appendTo(k);
i++});$(document.createElement("div")).addClass("horizon").appendTo(c);h=$(document.createElement("div")).addClass("slider").appendTo(c);var f={slider:h,steps:j,width:m,snapRadius:a.snapRadius};h.bind("mousedown",f,function(k){k.data.x=k.pageX;k.data.y=k.pageY;k.data.px=k.data.slider[0].offsetLeft;$(document).bind("mousemove",f,b);$(document).one("mouseup",f,function(){$(document).unbind("mousemove",b)})})})();var o;this.getValue=function(){return o};this.setValue=function(i){o=i;for(var f=0;f<j.length-
1;f++)j[f]<=i&&j[f+1]>=i&&h.css("left",Math.floor(f*m+(i-j[f])/(j[f+1]-j[f])*m))};this.load=function(i){i.value&&d.setValue(i.value)};this.unload=function(){};this.destroy=function(){c.remove();d=null}};client.widgets.Slider.prototype=new client.Widget;
client.widgets.TagDisplay=function(a){function b(){j.children("div.item").remove();f=[];a.autoSize&&j.css({width:"auto"});var g=o!==undefined?o[0].offsetWidth:0;i.each(function(){var l=$(document.createElement("div")).addClass("item");o!==undefined?l.insertBefore(o):l.appendTo(j);l.mousedown(function(v){v.preventDefault()});var r={tag:this,item:l};f.push(r);if(m){var t=utility.createLink().addClass("remover").appendTo(l);a.removeTitle!==undefined&&t.attr("title",a.removeTitle);t.bind("click",r,c)}if(a.showCheckboxes){t=
$(document.createElement("input")).attr({type:"checkbox"}).addClass("checkbox");if(k)t[0].checked=k(this);$(document.createElement("div")).addClass("check").append(t).appendTo(l);a.checkTitle!==undefined&&t.attr("title",a.checkTitle);t.bind($.browser.msie?"click":"change",r,d);$.browser.msie||t.click(function(v){v.stopPropagation()});l.addClass("pointer").bind("click",r,function(){var v=$("input[type=checkbox]:first",this);v.attr("checked",!v.is(":checked")).triggerHandler($.browser.msie?"click":
"change")})}$(document.createElement("div")).addClass("color").css("background-color","#"+this.color).appendTo(l);l.append(document.createTextNode(this.title));g+=l[0].offsetWidth+2});if(a.addWidth!==undefined)g+=a.addWidth;a.autoSize&&j.css({width:g})}function d(g){g.stopPropagation();g.data.checked=this.checked;a.tagChecked!==undefined&&a.tagChecked.call(h,g.data)}function c(g){g=g.data;if(a.tagRemoving!==undefined)if(a.tagRemoving.call(h,g.tag)===false)return false;g.item.remove();f.remove(g);
i.remove(g.tag);a.tagRemoved!==undefined&&a.tagRemoved.call(h,g.tag)}var h=this,m,j,o;(function(){function g(r){r.stopPropagation();var t=r.data;if(r.keyCode==13&&r.type=="keydown"||r.type=="click")if(t.hasClass("grey"))t.get(0).focus();else(r=t.val())&&r.length>0&&a.tagCreated(r)!==false&&t.val("").get(0).focus()}j=$(document.createElement("div")).addClass("tag-display").appendTo(a.node);a.autoSize&&j.css({margin:"0 auto",width:0});if(a.showRemovers)m=true;if(a.tagCreated!==undefined){o=utility.createToolbar().appendTo(j);
inputPanel=$(document.createElement("div")).appendTo(o).addClass("input-box");var l=utility.createInput(lang.ADD_TAG).attr("accesskey","t").appendTo(inputPanel);utility.createButton("list-add.png",null,lang.INSERT_TAG).appendTo(o).bind("click",l,g);o.field=l;a.maxLength!==undefined&&l.attr("maxlength",a.maxLength);l.bind("keydown",l,g)}})();this.allowEdit=function(g){m=g?true:false;i&&b();o&&o.toggle(g)};this.focus=function(){o!==undefined&&o.field.get(0).focus()};this.getContainer=function(){return j};
var i,f,k;this.load=function(g){i=g.tags.clone();k=g.initChecked;b();k=undefined};this.addTag=function(g){i.push(g);b()};this.getCheckedTags=function(){var g=[];f.each(function(){this.checked&&g.push(this.tag)});return g};this.getTags=function(){return i.clone()};this.clearTags=function(){i=[];b()};this.removeTag=function(g){if(i.indexOf(g)>-1){i.remove(g);b()}};this.unload=function(){};this.destroy=function(){j.remove();h=j=o=null}};client.widgets.TagDisplay.prototype=new client.Widget;
client.widgets.ThumbnailBar=function(a){function b(){v&&v.remove();v=undefined}function d(){var w=false;s.each(function(){if(this.filter){w=true;return false}});return w}function c(){if(D===undefined)D=[];var w=d();k.toggleClass("filtered",w);var G=false;D.clone().each(function(){if(s.indexOf(this.thumb)==-1){if(this.item.hasClass("selected"))G=true;this.item.remove();D.remove(this)}});for(var M=0,x,I=0;I<s.length;I++){for(var N=undefined,F=false,R=I;R<D.length;R++)if(D[R].thumb===s[I]){N=D[R];if(R!=
I){D.splice(R,1);F=true;D.splice(I,0,N)}break}if(N===undefined){N=h(s[I]);D.splice(I,0,N);F=I<s.length-1}if(F)if(I==0)N.item.prependTo(l);else I>0&&D[I-1].item.after(N.item);s[I].render(true);N.item.toggleClass("active",s[I]===q);if(s[I]===q){x=N.item;H||i.scrollIntoView(x)}N.item.toggle(!s[I].filter);M+=s[I].filter?0:1;if(s[I].filter&&N.item.hasClass("selected")){N.item.removeClass("selected");G=true}}if(A!=-1&&x!==undefined)if(!w){M=A*2+1;x=I=x;N=A;do{I=I.prev("div.thumb");x=x.next("div.thumb");
N>0?I.add(x).show():I.add(x).hide();N--}while(I.length>0||x.length>0)}if(r!==undefined){r.toggle(!w&&!t);if(!w&&!t)M+=1}w=2;if(q!==undefined)w+=2;a.noAutoSize||l.css("width",M*f+w+"em");G&&m();a.uiUpdated!==undefined&&a.uiUpdated.call(i)}function h(w){var G=$(document.createElement("div")).addClass("thumb item"),M;if(D.length>0)M=D[D.length-1].item;M!==undefined?G.insertAfter(M):G.appendTo(l);w.owner=i;w.item=G;w.render();M={addClasses:false,delay:300,scrollSpeed:1,revert:true,start:function(){var x=
true,I=arguments.callee.thumb;if(a.thumbDragStart!==undefined)x=a.thumbDragStart.call(this,I)!==false;if(x){E=I;$(this).css({opacity:0.2})}return x},stop:function(){$(this).css({opacity:1});a.thumbDragEnd!==undefined&&a.thumbDragEnd.call(this,E);E=undefined},helper:"clone",appendTo:k};M.start.thumb=w;G.draggable(M);G.droppable({addClasses:false,accept:j,hoverClass:"dragover",over:function(x,I){var N=$(this),F=N.parent().children("div.thumb");N.toggleClass("left",F.index(N)<F.index(I.draggable))},
drop:o});return{thumb:w,item:G}}function m(){J=true;a.selectionChanged!==undefined&&!B&&a.selectionChanged.call(i)}function j(w){if(E===undefined)return false;var G=$(this);if(w.index(G)!=-1)return false;if(!u)return false;if(A!=-1)return false;if(a.thumbMoving!==undefined&&a.thumbMoving.call(i,E)===false)return false;if(d())return false;return true}function o(w,G){var M=$(this),x=G.draggable,I=x.parent().children("div.thumb").index(x),N=M.parent().children("div.thumb").index(M);if(N!=I){var F=true;
if(a.thumbMoved!==undefined)if(a.thumbMoved.apply(M,[E,I,N])===false)F=false;x.draggable("option","revertDuration",0);if(F){M=s[I];s.splice(I,1);s.splice(N,0,M);c()}E=undefined;return F}}var i=this,f=6,k,g,l,r;(function(){s=[];k=$(document.createElement("div")).addClass("thumb-bar").appendTo(a.node);g=$(document.createElement("div")).addClass("bar").appendTo(k);l=$(document.createElement("div")).addClass("wrapper").appendTo(g);if(a.thumbAdding!==undefined){r=$(document.createElement("div")).addClass("thumb add").appendTo(l);
var w=utility.createLink().addClass("thumb").appendTo(r).append($(document.createElement("img")).attr("src",config.imagePath+"list-add.png"));w.bind("click",function(G){G.stopPropagation();b();a.thumbAdding.call(this,function(M){if(!v){v=utility.createMenu();v.appendTo(k);var x=utility.getRelativePosition(this,k[0]);x.top+=this.offsetHeight;v.css(x)}v.append(M.bind("click",b))})});w.mousedown(function(G){G.preventDefault()})}$(document.body).one("click",b)})();var t;this.allowAdd=function(w){t=w===
false;r.toggle(w)};this.getContainer=function(){return k};var v,E;this.getDraggedThumb=function(){return E};var s;this.getThumb=function(w,G){var M;s.each(function(){if(this.get()===w){M=this;return false}});if(M!==undefined)return M;else if(G!==undefined){M=G(w);s.push(M);return M}};var D,q;this.load=function(w){if(w!==undefined){s=w.thumbs.clone();q=w.currentThumb?w.currentThumb:q&&s.indexOf(q>-1)?q:undefined;if(w.noScroll!==undefined)H=w.noScroll}s&&c()};var H=false;this.setScrolling=function(w){H=
w?false:true};this.scrollIntoView=function(w){var G=w[0].offsetLeft;w=w[0].offsetWidth/2;w-=g.width()/2;g.animate({scrollLeft:G+w})};this.updateThumbnail=function(w){var G=false;D&&D.each(function(){if(this.thumb===w||this.thumb.get()===w||w===undefined){G=true;this.thumb.render(true);return w===undefined}});return G};var A=-1;this.limitDisplayCount=function(w){if(A!==w)if(w!==undefined){A=w;c()}else A!=-1&&c()};this.fadeInInactive=function(){$("div.thumb.reduced",k).stop().animate({opacity:1})};
this.fadeOutInactive=function(){var w=$("div.thumb.active:visible",k),G=w;w=w;var M=1;do{G=G.prevAll("div.thumb:visible:first");w=w.nextAll("div.thumb:visible:first");M-=0.2;if(M<0.4)M=0.4;G.add(w).addClass("reduced").stop().animate({opacity:M},4E3)}while(G.length>0||w.length>0)};this.setCurrentThumb=function(w){if(q!==w){q=w;$("div.thumb.active",k).removeClass("active");D.each(function(){if(this.thumb===w){i.scrollIntoView(this.item.addClass("active"));return false}});m()}};this.getCurrentThumb=
function(){return q};this.getSelectedThumbs=function(){var w=[];D.each(function(){this.item.hasClass("selected")&&w.push(this.thumb)});return w};this.hasSelection=function(){return l.children("div.selected").length>0};this.clearSelection=function(){var w=false;D.each(function(){if(this.item.hasClass("selected")){this.item.removeClass("selected");w=true}});w&&m()};this.selectThumb=function(w,G){w instanceof Array||(w=[w]);D.each(function(){if(w.indexOf(this.thumb)>-1){if(this.item.hasClass("selected")!=
(G!==false)){this.item.toggleClass("selected");m()}return false}})};var B=false,J=false;this.beginUpdate=function(){J=false;B=true};this.endUpdate=function(){B=false;J&&m()};this.triggerSelectionChanged=m;var u=true;this.allowMoving=function(w){u=w};this.removeThumb=function(w){s.remove(w);delete w.owner;c()};this.addThumb=function(w){s.push(w);c()};this.getThumbs=function(){return s.clone()};this.getObjects=function(){var w=[];s.each(function(){w.push(this.get())});return w};this.unload=function(){s.each(function(){delete this.owner});
q=undefined;s=[];c()};this.destroy=function(){k.remove();i=k=null}};client.widgets.ThumbnailBar.prototype=new client.Widget;client.widgets.Thumb=function(a){if(a&&a.render)this.render=a.render;this.filter=false};client.widgets.Thumb.prototype.render=function(){};client.widgets.Thumb.prototype.get=function(){};client.widgets.Thumb.prototype.item=undefined;
client.widgets.UserThumb=function(a,b){this.user=a;this.get=function(){return this.user};var d,c,h,m,j;this.render=function(o){if(!o){this.item.empty();d=utility.createLink().addClass("thumb").appendTo(this.item);c=$(document.createElement("img")).addClass("pic").appendTo(d);d.bind("dragstart",function(i){i.preventDefault()});d.disableSelection();$(document.createElement("span")).addClass("name").text(this.user.name).appendTo(d);if(b){d.bind("click",this,function(i){b.userClicked.call(this,i.data)});
h=utility.createLink().addClass("right-box").attr("title",lang.GOTO_TITLE).appendTo(d);o=b.getUserRight();!this.user.current&&o.topic.isSharable()&&h.bind("click",this,function(i){i.stopPropagation();var f=[client.data.TopicAccessConstants.presetReadOnly,client.data.TopicAccessConstants.presetWriteAccess,client.data.TopicAccessConstants.presetFullAccess,client.data.TopicAccessConstants.owner],k=b.getUserRight(i.data.user);i=$(document.createElement("div"));$(document.createElement("h3")).text(lang.SET_RIGHT_HEADER).appendTo(i);
for(var g=$(document.createElement("ul")).appendTo(i),l=0;l<f.length;l++){var r=$(document.createElement("li")).appendTo(g);utility.createLink(client.data.Right.accessLevelString(f[l])).bind("click",{right:k,access:f[l],panel:i},function(t){var v=t.data.right,E=t.data.access;t.data.panel.balloon.remove();b.adjustUserRight(v,E)}).appendTo(r)}f=jQuery.balloon.BalloonPositionConstants.topRight;k=$(this);f=$.showBalloon(k,i,f);i.balloon=f;$(document.body).one("click",f,function(t){t.data.remove()})});
m=utility.createLink().addClass("go-to-box").attr("title",lang.GOTO_TITLE).hide().appendTo(d);m.bind("click",this,function(i){i.stopPropagation();b.goToClicked.call(this,i.data)});j=utility.createLink().addClass("question-box").attr("title",lang.QUESTION_BOX_TITLE).hide().appendTo(d);j.bind("click",this,function(i){i.stopPropagation();b.questionClicked.call(this,i.data)})}if(this.selectOnClick){this.item.toggleClass("selected",this.initSelect==true);d.bind("click",this,function(i){i.data.item.toggleClass("selected")})}this.item.addClass("user");
this.user.email&&this.user.email!=this.user.name&&d.attr("title",this.user.email)}if(this.user.picUrl!=null){o=this.user.picUrl;c.addClass("buddy-pic")}else o=this.user.getIcon();if(!c.attr("src")||c.attr("src")!=o)c.attr("src",o);this.item.toggleClass("primary",this.primary===true);if(b){o=b.getQuestionCount(this.user);j.toggle(o>0).text(o);o=b.getShowGoTo(this.user);m.toggle(o);o=b.getUserRight(this.user);h.attr({lev:o.className(),title:o.toString()})}};this.setSelected=function(o){this.item.toggleClass("selected",
o)};this.isSelected=function(){return this.item.hasClass("selected")}};client.widgets.UserThumb.prototype=new client.widgets.Thumb;
client.widgets.ShareBar=function(a){function b(){if(a.beforeAdd!==undefined&&a.beforeAdd.call()===false)return false;i&&i.remove();i=$(document.createElement("div")).addClass("add-panel");i.click(function(E){E.stopPropagation()});i.appendTo(o.getContainer());var l=$(document.createElement("div")).addClass("content").appendTo(i);utility.createCloser().appendTo(l).click(d);$(document.createElement("h3")).text(lang.SHARE_THIS_NOTE_FOLDER).appendTo(l);$(document.createElement("p")).text(lang.SHARE_EXPLANATION).appendTo(l);
var r=new client.widgets.ThumbnailBar({node:l,noAutoSize:true,thumbMoving:function(){return false}});r.getContainer().addClass("add-bar");i.userBar=r;i.invitedUsers=[];c(false);var t;if(a.addEmailBuddy){$(document.createElement("h3")).text(lang.INVITE_BY_EMAIL).appendTo(l);var v=utility.createToolbar().appendTo(l);t=utility.createInput(lang.ENTER_EMAIL).appendTo(v);t.keydown(function(E){if(E.keyCode==13)if((E=$(this).val())&&E.length>0)if(E=a.addEmailBuddy.call(j,E)){i.invitedUsers.push(E);E=new client.widgets.UserThumb(E);
E.selectOnClick=true;E.initSelect=true;r.addThumb(E);$(this).val("").get(0).focus()}});t[0].focus()}if(a.addUsers!==undefined){v=utility.createToolbar(true).addClass("pad").appendTo(l);utility.createMenuItem(null,"ok",lang.INVITE).addClass("right").appendTo(v).bind("click",function(E){E.stopPropagation();var s=[];if(t!==undefined&&!t.hasClass("grey"))if((E=t.val())&&E.length>0){if(user=a.addEmailBuddy.call(j,E))s.push(user);t.val("")}r.getSelectedThumbs().each(function(){s.add(this.user)});a.addUsers(s);
d()});$(document.createElement("div")).addClass("clear").appendTo(l)}$(document.body).one("click",d);return false}function d(){i&&i.remove();i=undefined}function c(l){if(i){o.getObjects().each(function(){i.invitedUsers.remove(this)});var r=[];a.getUsers!==undefined&&a.getUsers(l).each(function(){var t=new client.widgets.UserThumb(this);t.selectOnClick=a.addUsers!==undefined;r.push(t)});i.invitedUsers.each(function(){var t=new client.widgets.UserThumb(this);t.selectOnClick=a.addUsers!==undefined;r.push(t)});
i.userBar.load({thumbs:r})}}function h(l){var r=o.getContainer();l=l.data;var t=l.hasClass("expanded");r=$("div.bar",r).height()+6;var v=a.node.parent().height()-r;l.toggle(v<0);t&&v<0?a.node.css({"z-index":115,top:v,height:r}):a.node.css({height:"auto",top:0,zIndex:$.browser.msie?0:"auto"})}function m(l){if(l===undefined){l={users:o.getObjects()};l.primaryUser=g}else if(l.primaryUser){l.users.remove(l.primaryUser);l.users.splice(0,0,l.primaryUser);g=l.primaryUser}var r=[];l.users.each(function(){var t=
o.getThumb(this,function(v){return new client.widgets.UserThumb(v,a.userInterface)});t.primary=this===l.primaryUser;r.push(t)});o.load({thumbs:r,noScroll:l.noScroll})}var j=this,o,i,f,k;(function(){o=new client.widgets.ThumbnailBar({node:a.node,thumbMoving:function(){return false},thumbAdding:b,noAutoSize:true,thumbDragStart:function(t){if(t.primary!=true){if(a.removingUser!==undefined&&!a.removingUser(t.user))return false;f.fadeIn()}},thumbDragEnd:function(){f.fadeOut()}});var l=o.getContainer().addClass("share-bar"),
r=$("div.thumb.add:first",l).addClass("special").attr("title",lang.SHARE_FOLDER_TIP);if(a.removedUser!==undefined){f=$(document.createElement("div")).addClass("thumb special add").hide().insertAfter(r);r=utility.createLink().addClass("thumb").appendTo(f);$(document.createElement("img")).attr("src",config.imagePath+"delete.png").appendTo(r);f.droppable({addClasses:false,accept:function(){return o.getDraggedThumb()!==undefined},over:function(t,v){v.helper.addClass("delete")},out:function(t,v){v.helper.removeClass("delete")},
hoverClass:"dragover",drop:function(t,v){var E=o.getDraggedThumb();if(E!==undefined){v.helper.remove();window.setTimeout(function(){a.removedUser.call(this,E.user)===true&&o.removeThumb(E)},1)}}})}k=utility.createLink().attr("title",lang.ADJUST_SIZE).text("...").hide().addClass("expander").appendTo(l);k.bind("click",function(){$(this).toggleClass("expanded")});k.bind("click",k,h);l=$("div.bar:first",l);a.addUser!==undefined&&l.droppable({addClasses:false,accept:function(){return i!==undefined&&i.userBar.getDraggedThumb()},
hoverClass:"dragover",drop:function(t,v){var E=i.userBar.getDraggedThumb();v.helper.remove();window.setTimeout(function(){a.addUser.call(this,E.user)},1)}})})();this.allowAdd=function(l){o.allowAdd(l)};this.reloadAddBar=function(){c(true)};this.getContainer=function(){return o.getContainer()};this.getUsers=function(){return o.getObjects()};this.load=function(l){$(window).bind("resize",k,h);l!==undefined?m(l):m()};this.getThumb=function(l){return o.getThumb(l)};this.updateStates=function(){o.updateThumbnail()};
var g;this.unload=function(){$(window).unbind("resize",k,h);o.unload()};this.destroy=function(){o.destroy();j=o=null}};client.widgets.ShareBar.prototype=new client.Widget;
client.widgets.CardThumb=function(a,b){function d(j,o){if(b.showChangeFrom){var i=b.showChangeFrom.getTime();i=o.modified*1E3>i;j.toggleClass("changed",i);var f=$("div.changes:first",j);f.empty();if(i){utility.getChangeInfo(o.modifier,o.modified).children().appendTo(f);f.toggleClass("small",b.smallChanges);b.smallChanges||f.children("span").wrap('<div class="line"/>')}}}function c(j,o){if(o.isHtml()){j.children().not("div.attr").remove();$(document.createElement("div")).addClass("title").text(o.title).attr("title",
o.title).appendTo(j);if(o.content){j.removeClass("empty");var i=o.content.replace(/(<br>)/gi," $1").replace(/<[^>]+>/gi,"").replace(/\s+/g," ");if(i.length>100)i=i.substr(0,100);$(document.createElement("div")).addClass("summary").html(i).appendTo(j)}else{j.addClass("empty");$(document.createElement("div")).addClass("summary empty").text("("+lang.EMPTY+")").appendTo(j)}}else{j.children().not("img").remove();if(!o.needsPassword&&o.pdf){img=j.children("img");if(img.length==0)img=$(document.createElement("img")).attr("src",
config.viewPath+"&id="+o.pdf.id+"&page="+o.page+"&thumb=1").appendTo(j)}else j.append($(document.createElement("span")).addClass("error").text("("+lang.LOCKED+")"));j.attr("title",o.title)}}function h(j,o){var i=$("div.tags.title",j).empty(),f=$("div.tags.bottom",j).empty();o.getTags().each(function(){var k=$(document.createElement("div")).addClass("tag color").css("background-color","#"+this.color).attr("title",this.title).appendTo(f);if(this.showText)k=k.add($(document.createElement("span")).addClass("tag title").css("color",
"#"+this.color).text(this.title).appendTo(i));b.tagClicked!==undefined&&k.bind("click",this,function(l){l.stopPropagation();l.preventDefault();b.tagClicked(l.data)});b.tagDblClicked!==undefined&&k.bind("dblclick",this,function(l){l.stopPropagation();l.preventDefault();b.tagDblClicked(l.data)});if(b.container!==undefined&&!$.browser.msie){var g={addClasses:false,delay:300,revert:true,start:function(){$(this).css({opacity:0.4});b.tagDragStart!==undefined&&b.tagDragStart();utility.draggedTag=arguments.callee.tag},
stop:function(){$(this).css({opacity:1});utility.draggedTag=undefined},scroll:false,helper:"clone",opacity:0.8,appendTo:b.container};g.start.tag=this;k.css("cursor","move").draggable(g);$.browser.safari&&k.bind("mousedown",function(l){l.preventDefault()})}});f.css("width",o.getTagCount()+"em")}this.card=a;this.get=function(){return this.card};var m;this.render=function(j){if(!j){this.item.empty();$(document.createElement("div")).addClass("tags title").appendTo(this.item);m=utility.createLink().addClass("thumb").appendTo(this.item);
a.isHtml()&&m.addClass("html");if(a.cardType==client.data.CardTypeConstants.wiki||a.cardType==client.data.CardTypeConstants.blog){attr=$(document.createElement("div")).addClass("attr").appendTo(m);if(a.cardType==client.data.CardTypeConstants.blog){attr.text(lang.BLOG_SYM);attr.attr("title",lang.BLOG_EXPLANATION)}else{attr.text(lang.WIKI_SYM);attr.attr("title",lang.WIKI_EXPLANATION)}}a.cardType==client.data.CardTypeConstants.pdf&&m.addClass("pdf");m.bind("dragstart",function(o){o.preventDefault()});
m.disableSelection();b.cardClicked!==undefined&&m.bind("click",this,function(o){o.stopPropagation();var i=o.data;if(b.multiSelect&&(o.ctrlKey||o.shiftKey)){var f=i.item,k=f.parent().children("div.thumb.item:visible"),g=k.filter(".active");if(o.shiftKey&&g.length==1){k.removeClass("selected");o=k.index(f);g=k.index(g);k.slice(o<g?o:g,(o<g?g:o)+1).addClass("selected")}else{!f.hasClass("active")&&g.length==1&&k.filter(".selected").length==0&&g.addClass("selected");f.toggleClass("selected")}i.owner.scrollIntoView(f);
i.owner.triggerSelectionChanged()}else{i.owner.clearSelection();b.cardClicked(i)}});b.cardDblClicked!==undefined&&m.bind("dblclick",this,function(o){b.cardDblClicked(o.data)});$(document.createElement("div")).addClass("tags bottom").appendTo(this.item);$(document.createElement("div")).addClass("changes").appendTo(this.item)}if(this.lastModified!==a.modified){if(!a.needsLoading)this.lastModified=a.modified;c(m,a);h(this.item,a);d(this.item,a)}}};client.widgets.CardThumb.prototype=new client.widgets.Thumb;
client.widgets.ThumbnailNavigation=function(a){function b(){H&&H.remove();H=undefined}function d(A){if(A===undefined)A={cards:g.getObjects()};var B=r.getTags(),J=0,u=[],w;A.cards.each(function(){var G=g.getThumb(this,function(M){return new client.widgets.CardThumb(M,a.cardInterface)});if(this===A.currentCard)w=G;G.filter=B.length>0&&!this.hasTag(B);G.filter||J++;u.push(G)});g.load({thumbs:u,noScroll:A.noScroll,currentThumb:w});if(J==0&&B.length>0){r.clearTags();d()}else{g.load({thumbs:u});h()}}function c(){h();
a.selectionChanged!==undefined&&a.selectionChanged.call(f)}function h(){var A=[],B=f.getSelectedCards(),J=g.getCurrentThumb();if(B.length==0&&J)B=[J.card];if(B.length>0)A=B.pop().getTags();A.clone().each(function(){var u=this;B.each(function(){if(this.getTags().indexOf(u)==-1){A.remove(u);return false}})})}function m(){var A=r.getTags();return utility.draggedTag!==undefined&&A.indexOf(utility.draggedTag)==-1}function j(A,B){r.addTag(utility.draggedTag);B.draggable.draggable("option","revertDuration",
0);d();return true}function o(){if(g.getDraggedThumb()===undefined)return false;return true}function i(A,B){B.draggable.draggable("option","revertDuration",0);var J=g.getDraggedThumb();if(J!==undefined&&a.cardTrashed(J)===true){B.helper.remove();B.draggable.remove();g.removeThumb(J)}}var f=this,k,g,l,r,t,v,E,s,D;(function(){g=new client.widgets.ThumbnailBar({node:a.node,selectionChanged:c,thumbDragStart:function(B){return a.cardMoving(B.card)},thumbMoved:function(B,J,u){return a.cardMoved.apply(f,
[B.card,J,u])}});k=g.getContainer().addClass("thumb-navi");k.addClass("extendable");v=$(document.createElement("div")).addClass("thumb add").appendTo(k);v.toggleClass("red",config.reduceFeatureSet===true);if(a.cardAdding!==undefined){s=utility.createLink().attr("title",lang.ADD_PAGE_TIP).addClass("thumb").appendTo(v).append($(document.createElement("img")).attr("src",config.imagePath+"sheet-add.png"));s.bind("click",function(B){B.stopPropagation();b();H=utility.createMenu();H.appendTo(k);H.click(function(J){J.stopPropagation();
b()});B=utility.getRelativePosition(this,k[0]);B.top+=this.offsetHeight;B.left-=8;H.css(B);a.cardAdding.call(f,function(J){return H.append(J)})});s.mousedown(function(B){B.preventDefault()})}if(a.cardTrashed!==undefined){E=utility.createLink().attr("title",lang.CARD_TRASH_TIP).addClass("thumb").appendTo(v).append($(document.createElement("img")).attr("src",config.imagePath+"sheet-remove.png"));E.click(function(){q&&q.remove();q=undefined;var B=$(document.createElement("div")).html($(lang.CARD_TRASH_EXPLANATION));
q=jQuery.showBalloon($(this),B,jQuery.balloon.BalloonPositionConstants.centerLeft)});E.droppable({addClasses:false,accept:o,over:function(B,J){J.helper.addClass("delete")},out:function(B,J){J.helper.removeClass("delete")},hoverClass:"dragover",drop:i})}D=utility.createLink().attr("title",lang.TAG_FILTER_TIP).addClass("thumb").appendTo(v).append($(document.createElement("img")).attr("src",config.imagePath+"search.png"));D.bind("click",function(B){B.stopPropagation();$(this).toggleClass("active");searchOverlay.toggle()});
searchOverlay=$(document.createElement("div")).addClass("overlay").hide().appendTo(v);utility.createCloser().appendTo(searchOverlay).click(function(){$(this).parent().fadeOut()});$(document.createElement("h3")).text(lang.FILTER_VIEW).appendTo(searchOverlay);var A=utility.createToolbar().appendTo(searchOverlay);t=$(document.createElement("div")).addClass("filter-drop").text(lang.DROP_TAG).appendTo(A);t.click(function(){q&&q.remove();q=undefined;var B=$(document.createElement("div")).html($(lang.TAG_FILTER_EXPLANATION));
q=jQuery.showBalloon($(this),B,jQuery.balloon.BalloonPositionConstants.bottomLeft)});r=new client.widgets.TagDisplay({node:A,showRemovers:true,removeTitle:lang.REMOVE_FILTER_TAG,tagRemoved:function(){d()}});r.load({tags:[]});A=$(document.createElement("div")).addClass("clear zoom").appendTo(searchOverlay);$(document.createElement("h3")).text(lang.ZOOM).appendTo(A);l=new client.widgets.Slider({node:A,steps:[50,100,200],snapRadius:9,valueChanged:function(B){$("div.bar:first",k).css("font-size",B.toString()+
"%")}});l.load({value:100});D.add(t).droppable({addClasses:false,accept:m,hoverClass:"dragover",drop:j});k.dblclick(function(){r.clearTags();d()});k.click(function(){f.clearSelection();d()});$(document.body).one("click",b);a.cardInterface.container=k;a.cardInterface.tagClicked=function(B){g.beginUpdate();g.clearSelection();g.getThumbs().each(function(){this.card.hasTag(B)&&this.item.addClass("selected")});g.triggerSelectionChanged();g.endUpdate()};a.cardInterface.tagDblClicked=function(B){r.clearTags();
r.addTag(B);d()}})();this.allowEdit=function(A){s.add(E).toggle(A)};this.getContainer=function(){return k};var q,H;this.load=function(A){A!==undefined?d(A):d()};this.setScrolling=function(A){return g.setScrolling(A)};this.getThumb=function(A){return g.getThumb(A)};this.updateThumbnail=function(A){return g.updateThumbnail(A)};this.updateThumbnails=function(){return g.updateThumbnail()};this.updateTags=function(A){return this.updateThumbnail(A)};this.limitDisplayCount=function(A){g.limitDisplayCount(A)};
this.setCurrentCard=function(A){g.setCurrentThumb(g.getThumb(A))};this.getCurrentCard=function(){var A=g.getCurrentThumb();if(A)return A.card};this.getSelectedCards=function(){var A=[];g.getSelectedThumbs().each(function(){A.push(this.card)});return A};this.clearSelection=function(){g.clearSelection()};this.selectCard=function(A,B){g.selectThumb(A instanceof client.widgets.CardThumb?A:g.getThumb(A),B)};this.allowMoving=function(A){g.allowMoving(A)};this.removeCard=function(A){g.removeThumb(g.getThumb(A))};
this.addCard=function(A){g.addThumb(new client.widgets.CardThumb(A,a.cardInterface))};this.getCards=function(){return g.getObjects()};this.unload=function(){g.unload();l.load({value:100});r.clearTags()};this.destroy=function(){l.destroy();r.destroy();g.destroy();k.remove();f=k=null}};client.widgets.ThumbnailNavigation.prototype=new client.Widget;
client.widgets.FlashcardPanel=function(a){function b(i){a.dotClicked!==undefined&&a.dotClicked.apply(this,[i.data,i])}function d(i){var f=i.parent().parent().get(0);i=f.offsetLeft;f=f.offsetWidth/2;f-=o.width()/2;o.animate({scrollLeft:i+f})}var c=a.node,h;this.getContainer=function(){return h};h=$(document.createElement("div")).addClass("flashcard-panel").appendTo(c);var m,j,o;this.load=function(i){o=$(document.createElement("div")).addClass("bar").appendTo(h);j=$(document.createElement("div")).addClass("wrapper").appendTo(o);
m=[];i.items.each(function(){var f=$(document.createElement("div")).addClass("col").appendTo(j);f.css("height",config.MAX_BOX_LEVEL*2+"em");for(var k=config.MAX_BOX_LEVEL;k>=config.MIN_BOX_LEVEL;k--){var g=$(document.createElement("div")).addClass("box").toggleClass("max",k==config.MAX_BOX_LEVEL).appendTo(f);if(this.level==k){g=$(document.createElement("div")).addClass("dot").toggleClass("me",this.isMe).bind("click",this,b).appendTo(g);g.toggleClass("known",this.getPrepScore()==1);g.toggleClass("new",
this.level==config.MIN_BOX_LEVEL);m.push({item:g,dot:this})}}});j.css({width:i.items.length*2+"em",height:(config.MAX_BOX_LEVEL-config.MIN_BOX_LEVEL+1)*2+"em"})};this.setCurrentDot=function(i,f){var k;m.each(function(){var g=this.dot===i;this.item.toggleClass("active",g).closest("div.col").toggleClass("active",g);this.item.toggleClass("last",this.dot===f);if(g)k=this});k!==undefined&&d(k.item)};this.unload=function(){o!==undefined&&o.remove();o=undefined};this.destroy=function(){this.unload();c=null}};
client.widgets.FlashcardPanel.prototype=new client.Widget;client.PagePlugin=function(){};client.PagePlugin.prototype.page=null;client.PagePlugin.prototype.load=function(){};client.PagePlugin.prototype.unload=function(){};client.PagePlugin.prototype.onPluginLoad=function(){};client.PagePlugin.prototype.onPluginRemove=function(){};
client.pageplugins.Logon=function(){function a(){b();this.page.unloadPagePlugin(E);E=null}function b(){$(document.body).bind("click",g);B=$(document.createElement("div")).addClass("mb-cont login");A=$(document.createElement("div")).addClass("mb-logon");$(document.createElement("h1")).text(lang.MEDIABIRD_TITLE).appendTo(A);J=k("login");$(document.createElement("tr")).append($(document.createElement("td"))).append($(document.createElement("td")).append($(document.createElement("div")).append(utility.createLink(lang.LOGON).bind("click",
m).attr("accesskey","L")))).appendTo(J.content);$(document.createElement("tr")).append($(document.createElement("td"))).append($(document.createElement("td")).append($(document.createElement("div")).addClass("rel").append(utility.createLink(lang.SIGN_UP).bind("click",i).attr("accesskey","R")))).appendTo(J.content);$(document.createElement("tr")).append($(document.createElement("td"))).append($(document.createElement("td")).append($(document.createElement("div")).addClass("rel").append(utility.createLink(lang.GET_PASSWORD).bind("click",
j).attr("accesskey","G")))).appendTo(J.content);$(document.createElement("form")).attr({action:"server/logon.php",method:"POST",target:"_blank"}).bind("submit",m).append(J.content.css({"float":"right","margin-left":30,"padding-left":10,"border-left":"1px solid #999"})).append($(document.createElement("input")).css("display","none").attr({type:"submit"})).appendTo(A);$(document.createElement("div")).text(lang.MEDIABIRD_DESCRIPTION).appendTo(A);if($.browser.msie&&$.browser.version<"7.0"||$.browser.safari&&
$.browser.version<"400"||!$.browser.msie&&!$.browser.mozilla&&!$.browser.safari)$(lang.BROWSER_BAD_TEXT).appendTo(A);A.appendTo(B);B.appendTo(v.page.container);l()}function d(u){if(u.success){alert(lang.PASSWORD_SENT);l();g()}else{s&&r(s.captchaImage);if(u.error==client.ServerErrors.wrongCaptcha)alert(lang.WRONG_SECURITY);else if(u.error==client.ServerErrors.invalidEmail)alert(lang.INVALID_EMAIL);else u.error==client.ServerErrors.disabled?alert(lang.ERROR_FUNCTION_DISABLED):alert(lang.PASSWORD_ERROR)}}
function c(u){if(u.success){u.mailsent?alert(lang.CONFIRM_REQUEST_SENT):alert(lang.ACCOUNT_CREATED);l()}else{D&&r(D.captchaImage);if(u.error==client.ServerErrors.wrongCaptcha)alert(lang.WRONG_SECURITY);else if(u.error==client.ServerErrors.invalidEmail)alert(lang.INVALID_EMAIL);else if(u.error==client.ServerErrors.emailNotUnique)alert(lang.USER_EMAIL_TAKEN);else if(u.error==client.ServerErrors.nameNotUnique)alert(lang.USER_NAME_TAKEN);else if(u.error==client.ServerErrors.serverError)alert(lang.ERROR_SENDING_CONFIRM);
else u.error==client.ServerErrors.disabled&&alert(lang.ERROR_FUNCTION_DISABLED)}}function h(u){if(u.success){utility.removeAlerts();v.gotoOverview()}else if(u.error==client.ServerErrors.wrongPass)alert(lang.WRONG_PASSWORD);else u.error==client.ServerErrors.disabled?alert(lang.NOT_CONFIRMED):alert(lang.SESSION_CREATION_ERROR)}function m(u){u.preventDefault();u.stopPropagation();g();u=J.nameField.val()!="";var w=J.passField.val()!="";J.nameError.css("display",!u?"block":"none");J.passError.css("display",
!w?"block":"none");if(u&&w){u=J.nameField.val();w=J.passField.val();v.page.server.openSession(u,w,utility.createCallback(v,h));J.passField.val("")}}function j(u){u.stopPropagation();if(!s){l();u={};u.top=this.offsetHeight+5;u.left=this.offsetWidth-375;s=k("lost");H=utility.createPanelDialog(s.content,u,o).css("width","370px").appendTo(this.parentNode);r(s.captchaImage)}}function o(u){switch(u.data.action){case "ok":u=s.emailField.val()!="";var w=s.captchaField.val().length==6;s.emailError.css("display",
!u?"block":"none");s.captchaError.css("display",!w?"block":"none");if(u&&w){u=s.emailField.val();w=s.captchaField.val();v.page.server.retrievePassword(u,w,utility.createCallback(v,d));s.emailField.val("")}else return;break;case "cancel":l();break}}function i(u){u.stopPropagation();if(!D){l();u={};u.top=this.offsetHeight+3;u.left=this.offsetWidth-435;D=k("signup");q=utility.createPanelDialog(D.content,u,f).css("width",420).appendTo(this.parentNode);r(D.captchaImage)}}function f(u){switch(u.data.action){case "ok":u=
D.nameField.val()!="";var w=D.passField.val()!="",G=D.passField2.val()!=""&&D.passField2.val()==D.passField.val(),M=D.emailField.val()!="",x=D.captchaField.val().length==6,I=D.termsCheckbox.attr("checked")==true;D.nameError.css("display",!u?"block":"none");D.passError.css("display",!w?"block":"none");D.passError2.css("display",!G?"block":"none");D.emailError.css("display",!M?"block":"none");D.captchaError.css("display",!x?"block":"none");D.termsError.css("display",!I?"block":"none");if(u&&w&&M&&x&&
I){u=D.nameField.val();w=D.passField.val();G=D.emailField.val();M=D.captchaField.val();v.page.server.signUp(u,w,G,M,utility.createCallback(v,c))}else return;break;case "cancel":l();break}}function k(u){var w=$(document.createElement("table")).addClass("logonform"),G={content:w};if(u!="lost"){$(document.createElement("tr")).append($(document.createElement("td")).addClass("right").append($(document.createElement("label")).text(lang.NAME).attr({"for":"nameField"+u,accesskey:"n"}))).append($(document.createElement("td")).append(G.nameField=
$(document.createElement("input")).attr("type","text").attr({id:"nameField"+u,size:"15"})).append(G.nameError=$(document.createElement("span")).addClass("error").text(lang.NAME_MISSING))).appendTo(w);$(document.createElement("tr")).append($(document.createElement("td")).addClass("right").append($(document.createElement("label")).text(lang.PASSWORD).attr({"for":"passField"+u,accesskey:"p"}))).append($(document.createElement("td")).append(G.passField=$(document.createElement("input")).attr("type","text").attr({type:"password",
id:"passField"+u,size:"15"})).append(G.passError=$(document.createElement("span")).addClass("error").text(lang.PASS_MISSING))).appendTo(w)}if(u=="signup"){$(document.createElement("tr")).append($(document.createElement("td")).addClass("right").append($(document.createElement("label")).text(lang.PASSWORD_AGAIN).attr({"for":"passField2"+u}))).append($(document.createElement("td")).append(G.passField2=$(document.createElement("input")).attr({type:"password",id:"passField2"+u,size:"15"})).append(G.passError2=
$(document.createElement("span")).addClass("error").text(lang.PASS_NOT_MATCHING))).appendTo(w);var M=$(document.createElement("span")).html(lang.TERMS_ACCEPT.replace("%s",config.TERMS_URL));M.children("a").css("float","none");$(document.createElement("tr")).append($(document.createElement("td")).addClass("right").append($(document.createElement("label")).text(lang.TERMS))).append($(document.createElement("td")).append(G.termsCheckbox=$(document.createElement("input")).attr({type:"checkbox",size:"15"})).append(M).append(G.termsError=
$(document.createElement("span")).addClass("error").text(lang.TERMS_MISSING))).appendTo(w)}if(u!="login"){$(document.createElement("tr")).append($(document.createElement("td")).addClass("right").append($(document.createElement("label")).text(lang.EMAIL).attr({"for":"emailField"+u}))).append($(document.createElement("td")).append(G.emailField=$(document.createElement("input")).attr({type:"text",id:"emailField"+u,size:"15"})).append(G.emailError=$(document.createElement("span")).addClass("error").text(lang.EMAIL_MISSING))).appendTo(w);
$(document.createElement("tr")).append($(document.createElement("td")).css({"vertical-align":"top","padding-top":"5px"}).addClass("right").append($(document.createElement("label")).text(lang.CAPTCHA).attr({"for":"captchaField"+u}))).append($(document.createElement("td")).append(utility.createToolbar().append(G.captchaField=$(document.createElement("input")).attr({type:"text",id:"captchaField"+u,size:"6",maxlength:"6"})).append(G.captchaImage=$(document.createElement("img")).css({"float":"left"})).append(utility.createButtonSeparator()).append(utility.createButton("view-refresh.png",
null,lang.GET_NEW_CAPTCHA).bind("click",G.captchaImage,r))).append(G.captchaError=$(document.createElement("span")).addClass("error").text(lang.CAPTCHA_MISSING))).appendTo(w)}w.bind("keydown",function(x){if(x.keyCode==13){x.stopPropagation();if(D){f({data:{action:"ok"}});x.preventDefault()}if(s){o({data:{action:"ok"}});x.preventDefault()}}});return G}function g(){if(D){q.remove();D=null}if(s){H.remove();s=null}}function l(){g();J.nameField.val("");J.passField.val("");J.nameError.css("display","none");
J.passError.css("display","none")}function r(u){(u instanceof jQuery?u:u.data).attr({src:"restricted/captcha.php?q="+(new Date).getTime()})}function t(){$(document.body).unbind("click",g);if(A){A.remove();B.remove()}}client.PagePlugin.call(this);var v;this.load=function(){v=this;client.PagePlugin.prototype.load.call(this)};this.loadLogon=function(){b()};var E;this.gotoOverview=function(){E=new client.pageplugins.Overview({sessionEndCallback:utility.createCallback(this,a)});t();this.page.loadPagePlugin(E)};
this.unload=function(){t();v=E=null;client.PagePlugin.prototype.unload.call(this)};var s,D,q,H,A,B,J;this.justEnabled=function(){A&&A.children(":first").after($(document.createElement("h3")).text(lang.JUST_ENABLED))}};client.pageplugins.Logon.prototype=new client.PagePlugin;
client.pageplugins.Overview=function(a){function b(K){if(K.success){var S=config.customLoadCard;if(S&&!isNaN(S))window.setTimeout(function(){var ha=F.page.server.getCard(S);if(ha&&ha.topic){F.hide();n.openCard(ha)}},1);else config.reduceFeatureSet&&F.page.server.getTopicCount()==0&&window.setTimeout(function(){var ha=$(document.createElement("input")).val(lang.COURSE_NOTES);D({data:ha})},1)}}function d(){var K;if(F.page.header!==undefined){K=F.page.server.getCurrentUser();K=utility.ucfirst(K.name);
K=$(document.createElement("span")).addClass("user-info").text(K+" \u2013 ").prependTo(F.page.header);qa=$(utility.createLink(lang.LOGOUT)).addClass("logout-link").prependTo(F.page.header);qa.label=K}else{var S=$("a#mediabirdLogout");if(S.length==1)qa=S}if(qa!==undefined){qa.bind("click",G);if(K!==undefined)qa=qa.add(K)}ea=$(document.createElement("div")).addClass("mb-cont overview").appendTo(F.page.container);ea.toggleClass("reduce",config.reduceFeatureSet===true);ga=utility.createToolbar(true).addClass("top gradient").appendTo(ea);
K=$(document.createElement("table")).addClass("main").appendTo(ea);S=$(document.createElement("tr")).appendTo(K);K=$(document.createElement("td")).addClass("category-col").appendTo(S);$(document.createElement("td")).addClass("sep-col").appendTo(S);S=$(document.createElement("td")).addClass("list-col").appendTo(S);aa=$(document.createElement("div")).addClass("category-panel").appendTo(K);fa=new client.widgets.TagDisplay({showCheckboxes:true,tagChecked:g,node:S});Fa=$(document.createElement("div")).addClass("list-panel").appendTo(S)}
function c(){ua=window.setTimeout(c,N);F.page.server.refresh({Topic:true,User:true},utility.createCallback(this,h))}function h(K){K.error&&alert(lang.COULD_NOT_REFRESH_TOPICS)}function m(){var K=ga.get(0).offsetHeight;K+=6;K=ea.get(0).clientHeight-K;if(K>0){aa.css("height",K);if(Ha)K-=fa.getContainer().height()+12;K>0&&Fa.css("height",K)}}function j(){$(document.createElement("div")).hide().addClass("info").appendTo(fa.getContainer());for(var K=[],S=0;S<lang.TOPIC_LIST_HEADERS.length;S++)K.push({title:lang.TOPIC_LIST_HEADERS[S],
sortable:true,sortKey:S});S=$(document.createElement("div"));Da=new client.widgets.TreeView2({headers:K,container:S});K=$(document.createElement("div"));var ha=$(document.createElement("div")).appendTo(K);Ga=new client.widgets.TreeView2({container:ha,headers:[new client.widgets.TreeViewHeader({title:lang.TAG_LIST_HEADERS[0],sortable:true,sortKey:0}),new client.widgets.TreeViewHeader({title:lang.TAG_LIST_HEADERS[1],sortable:true,sortKey:1}),new client.widgets.TreeViewHeader({title:lang.TAG_LIST_HEADERS[2]})]});
Ga.toolbar=utility.createToolbar(true).addClass("gradient top").appendTo(K);na=new client.pageplugins.OverviewCategory({title:lang.NOTE_FOLDERS,type:"topic",container:S,buttons:[utility.createMenuItem(null,"create",lang.CREATE_NEW_TOPIC,t).addClass("permanent okay"),utility.createMenuItem(null,"rename",lang.RENAME,t),utility.createMenuItem(null,"export",lang.EXPORT,t),utility.createMenuItem(null,"delete",lang.DELETE,t)],filter:true,filterNote:lang.FILTER_NOTES_BY,updateList:H});va=new client.pageplugins.OverviewCategory({title:lang.TAGS,
type:"static",container:K,buttons:[],updateList:u});O=[na,va];F.page.server.getMarkerTypes().each(function(){if(this.getCategories!==undefined)O=O.concat(this.getCategories())});O.each(o);Ea={}}function o(){this.overviewInterface=ka;this.container.hide().appendTo(Fa);this.buttons.each(function(){this.hasClass("permanent")&&this.clone(true).appendTo(ga)})}function i(){aa.empty();O.each(function(){this.link=utility.createLink(this.title).bind("click",this,function(K){f(K.data)}).toggleClass("active",
xa===this).appendTo(aa)})}function f(K){if(xa!==K){K.link.addClass("active").siblings().removeClass("active");ga.children().not("a.permanent").remove();xa=K;Fa.children().not(ga).hide();K.buttons.each(function(){this.hasClass("permanent")||this.clone(true).appendTo(ga)});var S=fa.getContainer().toggle(K.filter);$("div.info:first",S).toggle(K.filterNote!==undefined).text(K.filterNote);k();K.container.show();g()}}function k(){if(xa.type=="topic"){var K=F.page.server.getTags();K.sort(utility.titleSorter);
fa.load({tags:K,initChecked:function(){return false}});Ha=K.length!=0&&xa.filter;fa.getContainer().toggle(Ha)}else{Ha=false;fa.unload()}m()}function g(){if(xa)if(xa.type=="topic"){var K=fa.getCheckedTags(),S=F.page.server.getTopics();if(K.length>0){var ha=[];S.each(function(){var ia=false;this.each(function(){if(this.hasTag(K)){ia=true;return false}});ia&&ha.push(this)});S=ha}xa.updateList(S)}else xa.updateList()}function l(){if(xa){k();g()}}function r(){xa&&g()}function t(K){K.stopPropagation();
switch(K.data.action){case "create":K=$(document.createElement("div")).addClass("dialog top").click(function(ra){ra.stopPropagation()});$(document.createElement("h3")).text(lang.ENTER_TITLE).appendTo(K);var S=utility.createToolbar(true).appendTo(K),ha=utility.createInput(lang.TITLE).addClass("auto");ha.bind("keypress",ha,D).appendTo(S);utility.createMenuItem(null,"ok",lang.GO).bind("click",ha,D).appendTo(S);$(document.body).one("click",s);s();ab=K.css({top:this.offsetHeight+3,left:this.offsetLeft}).appendTo(this.parentNode);
ha[0].focus();break;case "rename":K=Da.getItems();var ia;K.each(function(){if(this.check())ia=this.tag});if(ia!==undefined){if(ia.access<client.data.TopicAccessConstants.allowRename){alert(lang.RENAME_FORBIDDEN);return}(K=prompt(lang.ENTER_NEW_TITLE,ia.title))&&K.length>0&&F.page.server.updateTopic(ia,{title:K},utility.createCallback(this,function(ra){if(ra.success)ra.reverted?alert(lang.TOPIC_COULD_NOT_BE_UPDATED):g();else alert(lang.COULD_NOT_UPDATE_TOPIC)}))}else alert(lang.RENAME_NEEDS_SELECTION);
break;case "delete":K=Da.getItems();K.each(function(){if(this.check())ia=this.tag});if(ia!==undefined)if(ia.access<client.data.TopicAccessConstants.owner){if(K=confirm(lang.LEAVE_TOPIC_CONFIRM)){K={deletedRightIds:[ia.getUserRight(F.page.server.getCurrentUser()).id]};F.page.server.updateTopic(ia,K,utility.createCallback(this,function(ra){ra.success?g():alert(lang.COULD_NOT_LEAVE_TOPIC)}))}}else(K=confirm(lang.DELETE_TOPICS_CONFIRM))&&F.page.server.del({Topic:[ia]},utility.createCallback(this,function(ra){ra.success?
g():alert(lang.COULD_NOT_DELETE_TOPIC)}));else alert(lang.DELETE_NEEDS_SELECTION);break;case "export":K=Da.getItems();K.each(function(){if(this.check())ia=this.tag});if(ia!==undefined){var la=[];ia.getCards().each(function(){this.isHtml()&&la.push(this)});if(la.length==0){alert(lang.NO_HTML_AMONG_SELECTION);return}K={topic:ia,cards:la};v.call(K);w(la,utility.createCallback(K,v))}else alert(lang.EXPORT_NEEDS_SELECTION);break}}function v(){if(ya===undefined){ya=$(document.createElement("div"));var K=
$(document.createElement("h3")).html(lang.EXPORT_HEADER).appendTo(ya),S=$(document.createElement("div")).appendTo(ya);K.makeCollapsible();$(document.createElement("h3")).html(lang.EXPORT_HINT).appendTo(ya);$("em.t",K).text(this.topic.title);$("em.d",K).text(utility.getChangeString(this.topic.modified));ya.editor=new client.widgets.Editor({node:S});ya.closeHandler=function(){ya=undefined};ka.showPanel(ya)}ya.cards=this.cards;ya.editor.load({isEditor:false,loadHandler:E});ya.editor.body.addClass("export")}
function E(){if(ya&&ya.html&&ya.editor.body){var K=ya.cards,S=ya.editor.body,ha=ya.editor.document;S.addClass("export");K.each(function(){$(ha.createElement("h1")).addClass("title").text(this.title).appendTo(S);$(ha.createElement("div")).html(this.content?this.content:lang.EMPTY_EXPORT).appendTo(S)})}}function s(){ab&&ab.remove();ab=undefined}function D(K){var S=K.data;if(!S.hasClass("grey")){K=new client.data.Topic;for(var ha=0;ha<I;ha++){var ia=new client.data.Card;ia.title=lang.TYPE_CARD+" "+(ha+
1);K.addCard(ia)}S=S.val();K.title=S.length>0?S:lang.UNTITLED;s();F.page.server.updateTopic(K,K.transformStatic(),utility.createCallback(F,q))}}function q(K){if(K.success&&K.topics){F.hide();n.openTopic(K.topics[0])}else K.error==client.ServerErrors.limitCountReached?alert(lang.TOPIC_COUNT_REACHED):alert(lang.COULD_NOT_UPDATE_TOPIC)}function H(K){for(var S=[],ha=R.lastLogin,ia=0;ia<K.length;ia++){var la=K[ia],ra=utility.createLink(la.title).bind("click",la,function(Ia){F.hide();n.openTopic(Ia.data)});
la.getCardCount()>0&&ra.attr({title:lang.OPEN_TOPIC});var Ja=$(document.createElement("div")).addClass("collabs"),Ba=la.getUsers();Ba.remove(F.page.server.getCurrentUser());var Za=null;if(Ba.length>0)for(userIndex=0;userIndex<Ba.length;userIndex++){var Wa=Ba[userIndex],bb=la.getUserRight(Wa).access==client.data.TopicAccessConstants.owner;Ja.append($(document.createElement("span")).text(Wa.name?Wa.name:Wa.id).addClass("user").toggleClass("owner",bb));Za=Za||this.name}else Ja.addClass("empty").text("("+
lang.NONE+")");var fb=[la.modifier,la.modified];la.each(function(){if(this.modified>fb[1])fb=[this.modifier,this.modified]});Ba=utility.getChangeInfo.apply(la,fb);Wa=$(document.createElement("div")).addClass("thumb-navi");Wa=new client.widgets.TreeViewItem2({panel:Wa,loaded:false,render:function(){if(!this.loaded){this.item.empty().addClass("hidden");$(document.createElement("td")).attr("colspan",3).append(this.panel).appendTo(this.item);this.loaded=true}}});Ja.addClasses=Ba.addClasses="col-small";
ra=new client.widgets.TextTreeViewItem({items:[ra,Ja,Ba],info:[la.title,Za,fb[1]],subItems:[Wa],addClasses:"topic border",showExpander:true,showCheck:true,onExpand:B,onCheck:A});new Date(la.modified*1E3)>ha&&!la.modifier.current&&$(document.createElement("span")).addClass("changed").text(lang.NEW).appendTo(Ba);ra.tag=la;ra.date=fb[1];S.push(ra)}S.sort(function(Ia,T){return T.date-Ia.date});Da.unload();Da.addItems(S);Da.paginate(config.MAX_LIST_COUNT);Da.load()}function A(K){var S=this;S.item.toggleClass("selected",
K);K&&Da.getItems().each(function(){if(this!==S){this.check(false);this.item.add(this.subItems[0].item).removeClass("selected")}})}function B(K){var S=this;if(K&&!S.loaded){S.loaded=true;K=S.tag;S.topicBar=new client.widgets.ThumbnailBar({node:S.subItems[0].panel});S.topicBar.allowMoving(false);$("div.bar",S.topicBar.getContainer()).css({"font-size":"75%"});K=K.getCards();S.thumbs=[];var ha={bar:S.topicBar,showChangeFrom:R.lastLogin,smallChanges:true,cardClicked:function(ia){this.bar.setCurrentThumb(ia)},
cardDblClicked:function(ia){F.hide();n.openCard(ia.card)}};K.each(function(){S.thumbs.push(new client.widgets.CardThumb(this,ha))});J.call(S);w(K,utility.createCallback(S,J))}}function J(){this.topicBar.load({thumbs:this.thumbs})}function u(){var K=F.page.server.getTags();K.sort(utility.titleSorter);var S=[];K.each(function(){if(this.id){var ha=$(document.createElement("div")).addClass("color-tag").css("background-color","#"+this.color);ha.addClass("pointer").bind("click",this,function(la){la.stopPropagation();
var ra=utility.getRelativePosition(this,Fa.get(0));ra.top+=this.offsetHeight;ra.left-=4;ra=$(document.createElement("div")).addClass("menu").css({width:72,height:Math.ceil(config.TAG_COLORS.length/4)*16}).css(ra).appendTo(Fa);for(var Ja=0;Ja<config.TAG_COLORS.length;Ja++)$(document.createElement("div")).addClass("color-tag").css("background-color","#"+config.TAG_COLORS[Ja]).appendTo(ra).css("cursor","pointer").bind("click",{color:config.TAG_COLORS[Ja],node:this,tag:la.data},function(Ba){Ba.stopPropagation();
Ba.data.tag.newColor=Ba.data.color;$(Ba.data.node).css("background-color","#"+Ba.data.color);Ga.colorDiv.remove()});Ga.colorDiv!==undefined&&Ga.colorDiv.remove();Ga.colorDiv=ra;$(document.body).one("click",function(){Ga.colorDiv!==undefined&&Ga.colorDiv.remove()})});var ia=$(document.createElement("input")).attr("type","checkbox");ia[0].checked=this.showText===true;ha.addClasses=ia.addClasses="col-small middle";ha=new client.widgets.TextTreeViewItem({info:[this.title,this.color,null],items:[this.title,
ha,ia]});ha.tag=this;S.push(ha)}});Ga.unload();Ga.addItems(S);Ga.paginate(config.MAX_LIST_COUNT);Ga.load();K=Ga.toolbar.toggle(S.length>0).empty();utility.createMenuItem(null,"ok",lang.SAVE,null).addClass("right").attr("accesskey","o").appendTo(K).bind("click",S,function(ha){var ia=[];ha.data.each(function(){var la=this.tag,ra=la.newColor;delete la.newColor;var Ja=this.items[2][0].checked,Ba={},Za=false;if(ra!==undefined&&ra!=la.color){Ba.color=ra;Za=true}if(Ja!=la.showText){Ba.showText=Ja?1:0;Za=
true}if(Za){Ba.tagId=la.id;ia.push(Ba)}});ia.length>0&&F.page.server.update({TagColor:{tagColors:ia}},utility.createCallback(F,function(la){la.success||alert(lang.COULD_NOT_UPDATE_TAGS)}))})}function w(K,S){var ha=false;K.each(function(){if(this.needsLoading){ha=true;return false}});ha&&F.page.server.loadCards(K,S)}function G(K){K!==undefined&&K.stopPropagation();n.saveCard();if(qa&&qa.label){qa.remove();label.remove();delete qa}M()}function M(){F.page.server.closeSession(utility.createCallback(this,
x))}function x(K){K.success?utility.triggerCallback(a.sessionEndCallback,null):alert(lang.COULD_NOT_CLOSE_SESSION)}client.PagePlugin.call(this);var I=4,N=15E3,F,R,n,z,C,L,U,Y,W;this.load=function(){F=this;R=F.page.server.getCurrentUser();ka=new client.pageplugins.OverviewInterface({loadCards:w,openCard:function(S){F.hide();S instanceof client.data.Topic?n.openTopic(S):n.openCard(S)},getUsers:function(){return F.page.server.getUsers()},getLastLogin:function(){return R.lastLogin},getFilterTags:function(){return fa.getCheckedTags()},
callPowerFunction:function(S,ha){if(Ea[S]!==undefined){F.hide();Ea[S].call(this,ha)}},showPanel:function(S){S?utility.requestFloat(ea,false,S.closeHandler).append(S):utility.closeFloat()}});var K=config.customLoadCard;if(K===undefined){K=location.hash.substr(1);if(K.length>0)config.customLoadCard=parseInt(K)}d();j();this.page.server.registerSyncHandler("topics",l);this.page.server.registerSyncHandler("files",r);this.page.server.init(utility.createCallback(F,b));this.showOverview();z=new client.pageplugins.Trainer;
n=new client.pageplugins.MainView;C=new client.pageplugins.File;L=new client.pageplugins.Question;U=new client.pageplugins.Link;Y=new client.pageplugins.Check;W=new client.pageplugins.Introduction;this.page.loadPagePlugin(n);this.page.loadPagePlugin(C);this.page.loadPagePlugin(z);this.page.loadPagePlugin(L);this.page.loadPagePlugin(U);this.page.loadPagePlugin(Y);this.page.loadPagePlugin(W);W.showHelp(ea,lang.INTRO_FOLDER_TITLE,lang.INTRO_FOLDER_HTML,1)};var ea,ga,fa,aa,Fa,Da,Ga,O,ka,na,va,Ea,ua,wa;
this.show=function(){if(!wa){ea.show();window.clearTimeout(ua);if(ua)c();else ua=window.setTimeout(c,N);$(window).bind("resize",m);m();wa=true}};this.hide=function(){window.clearTimeout(ua);if(wa){$(window).unbind("resize",m);ea.hide();wa=false}};this.onPluginLoad=function(K){if(K.getPowerFunctions!==undefined)Ea=$.extend(Ea,K.getPowerFunctions());if(K.getCategories!==undefined){K=K.getCategories();if(K.length>0){O=O.concat(K);K.each(o);i()}}};this.showOverview=function(){window.location.hash="#";
this.show();if(!xa&&O.length>0){i();f(O[0])}else xa&&g()};var xa;this.showCategory=f;var Ha;this.hideOverview=function(){ea.toggle(false)};var ab,ya,qa;this.closeSession=function(){G()};this.unload=function(){this.hide();O.each(function(){this.overviewInterface=undefined;this.destroy!==undefined&&this.destroy()});this.page.server.unregisterSyncHandler("topics",l);this.page.server.unregisterSyncHandler("files",r);this.page.unloadPagePlugin(L);this.page.unloadPagePlugin(C);this.page.unloadPagePlugin(z);
this.page.unloadPagePlugin(n);this.page.unloadPagePlugin(U);R=null;qa!==undefined&&qa.remove();ea.remove();F=ka=ea=null}};client.pageplugins.Overview.prototype=new client.PagePlugin;
client.pageplugins.OverviewCategory=function(a){this.title=a.title;this.icon=a.icon!==undefined?a.icon:"";this.type=a.type!==undefined?a.type:"static";this.container=a.container;this.buttons=a.buttons!==undefined?a.buttons:[];this.filterNote=a.filterNote!==undefined?a.filterNote:undefined;this.filter=a.filter!==undefined?a.filter:false;this.updateList=a.updateList!==undefined?a.updateList:function(){}};client.pageplugins.OverviewInterface=function(a){a&&$.extend(this,a)};
client.pageplugins.OverviewInterface.prototype.loadCards=function(){};client.pageplugins.OverviewInterface.prototype.openCard=function(){};client.pageplugins.OverviewInterface.prototype.getLastLogin=function(){};client.pageplugins.OverviewInterface.prototype.getFilterTags=function(){};client.pageplugins.OverviewInterface.prototype.callPowerFunction=function(){};
client.pageplugins.Introduction=function(){var a;this.load=function(){var c=this.page.server.getCurrentUser().settings;if(c.notepad===undefined)c.notepad={};a=c.notepad};var b,d;this.showHelp=function(c,h,m,j){if(!(d!==undefined&&(j!=d||b)&&j!=d+1)){b&&b.remove();d=j;j=$(document.createElement("div"));$(document.createElement("h3")).text(h).appendTo(j);$(document.createElement("div")).html(m).appendTo(j);(b=jQuery.showBalloon(c,j,false,function(){delete b},a,"intro"))&&b.css({bottom:65,right:20})}};
this.unload=function(){b.remove()}};client.pageplugins.Introduction.prototype=new client.PagePlugin;
client.pageplugins.MainView=function(){function a(){c();if(ca){var e=ca.getCollaboratorCount(true)+1;if(ca.isShared())delay=Math.max(Math.round(Wa/e),Za)}else delay=-1;if(delay>=0)ob=window.setTimeout(b,delay*1E3)}function b(e){if(e&&typeof e=="object")Z.page.server.updateSession(e,utility.createCallback(Z,d));else{e={};if(T){e.card=T;if(T.checkedOut){var p=new Date;p=T.checkedOut&&p.getTime()-T.checkOutTime.getTime()>Ba*1E3;if(!T.checkedOut||p)e.checkOut=true}}if(Db&&mb){window.clearTimeout(pb);
e.cardToCheckIn=Db;mb=undefined}p=new Date;if(!qb||p.getTime()-qb.getTime()>bb)e.refreshTopic=true;if(e.cardToCheckIn!==undefined||e.card!==undefined){qb=p;Z.page.server.updateSession(e,utility.createCallback(Z,d))}else a()}s()}function d(e){a();if(e.error)e.error==client.ServerErrors.invalidPage?la():alert(lang.SESSION_ERROR);else{if(e.checkOut!==undefined&&e.checkOut!=client.ServerErrors.okay){W();sa.closeCard();sa.openCard(T,false)}else if(e.checkOut===client.ServerErrors.okay){ea();if(T===e.card){if(!sa.isEditor()||
e.contents&&e.contents.indexOf(T)>-1)sa.switchMode(true)}else b({cardToCheckIn:e.card})}e.sessions!==undefined&&n();s()}}function c(){ob!==undefined&&window.clearTimeout(ob);ob=undefined}function h(e){e.cards.each(function(){Q.updateThumbnail(this)});L()}function m(e){e.contents.each(function(){Q.updateThumbnail(this)})}function j(e){var p=false,y=false,P=e.questions||e.checks;for(var V in e){P=e[V];P instanceof Array&&P&&P.length>0&&P.each(function(){this.relatedMarkers.each(function(){if(this.card&&
this.card.topic===ca)p=true;if(this.card===T){this.postLoad();y=true}})})}if(p&&ca){window.setTimeout(n,1);window.setTimeout(z,1)}y&&window.setTimeout(sa.updateMarkers,1)}function o(e){e.removedMarkers&&e.removedMarkers.length>0&&f(e.removedMarkers)}function i(e){if(e.markers&&e.markers.length>0){f(e.markers);k()}}function f(e){var p=false;e.each(function(){if(this.card&&this.card.topic===ca){this.postLoad();p=true}});if(p&&ca){window.setTimeout(n,1);window.setTimeout(z,1)}}function k(){if(T){var e=
[],p=T.topic.getMarkers();p.each(function(){this.getRelations().each(function(){this.object.loaded||e.push(this.object)})});if(e.length>0){var y=Z.page.server.prepareLoad(e);Z.page.server.load(y,utility.createCallback(Z,g),p)}}}function g(e,p){if(e.success){delete e.success;var y=[],P=[];p.each(function(){this.relations.each(function(){P.push(this)})});for(var V in e)e[V]instanceof Array&&e[V].each(function(){var ba=this;P.each(function(){this.object===ba&&y.add(this.marker)})});y.each(function(){this.postLoad()})}else alert(lang.COULD_NOT_LOAD_RELATED)}
function l(){Q.load()}function r(){var e=Z.page.server.getTopics();db.clone().each(function(){if(this.relation instanceof client.data.Topic&&e.indexOf(this.relation)==-1||this.relation instanceof client.data.Card&&(this.relation.topic==null||e.indexOf(this.relation.topic)==-1))db.remove(this)});var p=e.indexOf(ca)>-1;if(p){gb.text(ca.title);if(T){if(!T.topic||!T.topic.getCardById(T.id)){sa.closeCard();T=null;p==true?Z.openCard(ca.getCard(0),ca.isEditable()):wa()}R(true)}}else wa()}function t(){Qa=
$(document.createElement("div")).hide().addClass("mb-cont mainview");Qa.toggleClass("reduce",config.reduceFeatureSet===true);nb=$(document.createElement("div")).addClass("top-panel").appendTo(Qa);La=$(document.createElement("div")).addClass("title-container").appendTo(Qa);Xa=utility.createLink(lang.BACK_TO_OVERVIEW).addClass("overview-back").appendTo(La).click(function(ta){ta.stopPropagation();Z.hide();wa()});gb=$(document.createElement("div")).addClass("topic-title").appendTo(La);Q=new client.widgets.ThumbnailNavigation({node:nb,
cardInterface:{multiSelect:true,cardClicked:function(ta){T!==ta.card&&Z.openCard(ta.card)},showChangeFrom:Z.page.server.getCurrentUser().lastLogin,smallChanges:true,setHash:true},cardTrashed:xa,cardMoving:Ha,cardMoved:ab,cardAdding:ya});rb=$(document.createElement("div")).addClass("center-panel").appendTo(Qa);za=$(document.createElement("div")).appendTo(rb);utility.setupDesktop(za);H(za);var e=$(document.createElement("div")).addClass("super-container").appendTo(nb),p=$(document.createElement("div")).addClass("header-wrapper").appendTo(e),
y=$(document.createElement("div")).addClass("header-bar").appendTo(p);za.headerBar=y;["center left","center middle","center right","center markerbar"].each(function(){$(document.createElement("div")).addClass("desktop background "+this).appendTo(y)});var P=$(document.createElement("div")).addClass("panel").appendTo(y);p=$(document.createElement("div")).addClass("title-bar").appendTo(P);Aa=new client.widgets.TagDisplay({node:p,maxLength:30,showRemovers:true,tagCreated:K,tagRemoving:S,removeTitle:lang.REMOVE_TAG});
$(document.createElement("div")).addClass("clear").appendTo(p);P=utility.createToolbar().addClass("border").appendTo(P);za.toolbar=P;X=$(document.createElement("div")).addClass("bottom-bar").appendTo(Qa);Cb=$(document.createElement("div")).addClass("share panel").appendTo(X);Ma="share";var V={node:Cb,userInterface:Ka,beforeAdd:B,getUsers:J,addUser:u,addUsers:u,removingUser:w,removedUser:G};Pa=$(document.createElement("div")).addClass("box panel").appendTo(X);ma=$(document.createElement("div")).addClass("card box").appendTo(Pa);
Ta={open:null,solved:null,repeat:null};var ba=$(document.createElement("div")).addClass("memory-panel").appendTo(Pa);if(config.reduceFeatureSet){Ya=utility.createLink().attr("title",lang.SWITCH_TO_FULL).addClass("box switch").appendTo(ma);Ya.attr("href",config.fullLocationFromOverlay);config.reference!==undefined&&config.reference.target!==undefined?Ya.attr("target",config.reference.target):Ya.attr("target","_parent");Ya.click(function(){event.stopImmediatePropagation();if(fa()==false){event.preventDefault();
Eb=true}})}else{Ya=utility.createLink().attr("title",lang.SWITCH_BOX).addClass("box").appendTo(ma);Ya.click(function(){U(true)});hb={};for(var da in Ta){Ta[da]=utility.createLink().appendTo(ba).addClass("count "+da).bind("click",da,q);$(document.createElement("span")).addClass("label").text(lang.BOX_LABELS[da]).appendTo(Ta[da]);$(document.createElement("span")).addClass("count").appendTo(Ta[da]);hb[da]=$(document.createElement("div")).addClass("box "+da).hide().appendTo(Ya)}}$(document.createElement("div")).addClass("clear").appendTo(X);
if(config.emailInvites)V.addEmailBuddy=A;Ca=new client.widgets.ShareBar(V);Z.page.container.append(Qa);Na=utility.createLink().attr("title",lang.CARD_LOCK).addClass("always padlock").appendTo(P);Na.click(function(){if(T.checkedOut)if(Z.saveCard())Fa();else Fb=mb=true;else{E();window.clearTimeout(pb);pb=window.setTimeout(aa,fb*1E3)}});da=utility.createLink().attr("title",lang.INSERT_MARKER).addClass("always highlight").appendTo(P);za.pdfInfo=$(document.createElement("div")).addClass("pdf").hide().appendTo(P);
$.browser.msie&&$.browser.version=="7.0"&&nb.add(X).css("z-index",30);sa=new client.pageplugins.NoteDisplay({container:za.noteContainer,desktop:za,sizeHandler:function(ta){ta.left=za.get(0).offsetLeft;delete ta.height;za.headerBar.css(ta);L()},header:p,superContainer:e,scrollContainer:rb,pen:da,toolbar:P,beginEdit:v})}function v(){if(sa.isEditor()){E();window.clearTimeout(pb)}}function E(){T.checkedOut==false&&!T.checkingOut&&ca.isEditable()&&T.isHtml()&&b({checkOut:true,card:T})}function s(){if(T){Na.toggle(T.isHtml()&&
T.topic.isEditable());Na.toggleClass("editing",T.checkedOut);Na.toggleClass("locked",tb!==undefined);Na.toggleClass("checked-in",!T.checkedOut&&T.modifier.current);if(Na.hasClass("editing"))Na.attr("title",lang.CHECK_IN);else if(Na.hasClass("locked"))Na.attr("title",lang.CARD_LOCKED_TITLE);else Na.hasClass("checked-in")?Na.attr("title",lang.CARD_DONE):Na.attr("title",lang.CARD_DEFAULT)}}function D(){var e={open:[],solved:[],repeat:[]};ca.getMarkers().clone().each(function(){var p=this.getBoxNumber();
if(p!==false)switch(p){case 0:e.open.add(this);break;case 1:e.solved.add(this);break;case 2:e.repeat.add(this);break}});return eb=e}function q(e){var p=function(){return D()[e.data]};markers=p();var y;if(markers.length>0){y=$(document.createElement("div")).html(lang.PROBLEM_MARKER_HTML);$("em.info",y).text(lang.BROWSE_TYPES[e.data]);if(e.data=="repeat"){var P=$(document.createElement("div")).html(lang.START_TRAINING).appendTo(y);$("a.s",P).attr("href","javascript:void(0)").bind("click",{markerFunc:p},
function(V){V=V.data.markerFunc();if(V.length>0){Z.hide();pa.trainMarkers(V)}})}N(p,y,$(this),jQuery.balloon.BalloonPositionConstants.topMiddle)}else{ga();y=$(document.createElement("div")).html(lang.EXPLAIN_BOX[e.data]);p=$(document.createElement("img")).attr("src",config.imagePath+ub[e.data]).addClass("like-button");$("p.add-hint",y).before(p);oa=jQuery.showBalloon($(this),y,jQuery.balloon.BalloonPositionConstants.topMiddle)}}function H(e){config.feedbackPath===undefined||config.feedbackPath=="internal"?
e.shoutboxLink.bind("click",Da):e.shoutboxLink.attr({target:"_blank",href:config.feedbackPath})}function A(e){e=e.toLowerCase();var p=Z.page.server.getCurrentUser(),y=p.email&&p.email.toLowerCase()==e;Z.page.server.getUsers().each(function(){if(this.email&&this.email.toLowerCase()==e){y=true;return false}});if(y){alert(lang.EMAIL_IN_USE);return false}else return new client.data.User({email:e,name:e,online:false,invited:true,id:null})}function B(){if(!ca)return false;var e=ca.access==client.data.TopicAccessConstants.owner;
e||alert(lang.SHARING_NEEDS_ACCESS);return e}function J(e){var p=Z.page.server.getUsers(),y=Z.page.server.getExternalUsers();Ca.getUsers().each(function(){p.remove(this)});var P=[];p.clone().each(function(){if(this.name==null)P.push(this);else this.wasUnshared&&!this.email&&p.remove(this)});P.length>0&&!e&&Z.page.server.loadUsers(P,utility.createCallback(Z,function(V){V.success?Ca.reloadAddBar():alert(lang.COULD_NOT_LOAD_USERS)}));P.each(function(){this.name==null&&p.remove(this)});y.each(function(){var V=
false;if(this.mb_id!==undefined){var ba=this;p.each(function(){if(this.id==ba.mb_id){V=true;return false}})}V||p.push(this)});p.sort(function(V,ba){var da=V.name,ta=ba.name;if(da==ta)return 0;return da.toUpperCase()>ta.toUpperCase()?1:-1});return p}function u(e){e instanceof Array||(e=[e]);if(e.length==0)alert(lang.NO_USERS_SELECTED);else{var p={Topic:{id:ca.id,modified:ca.modified}};p.Topic.rights=[];e.each(function(){var y=ca.getUserRight(this);if(y===undefined)y=new client.data.Right({user:this,
access:client.data.TopicAccessConstants.presetFullAccess});p.Topic.rights.add(y.transformStatic())});Z.page.server.update(p,utility.createCallback(Z,function(y){if(y.success)y.unknownUsers&&y.unknownUsers.length>0&&alert(lang.NOT_ALL_USERS_FOUND);else alert(lang.COULD_NOT_UPDATE_RIGHT);n();Ca.reloadAddBar()}))}}function w(e){return ca.userRemovable(e)}function G(e){var p=ca.getUserRight(e);if(p!==undefined){window.setTimeout(function(){Z.page.server.update({Topic:{id:topic.id,modified:topic.modified,
deletedRightIds:[p.id]}},utility.createCallback(Z,function(y){y.success||alert(lang.ERROR_REMOVING_USER);ga();n();Ca.reloadAddBar()}))},1);return true}return false}function M(e,p){$("span.name",e).text(p.current?"("+lang.YOU+")":p.name);$("a.email",e).attr("href","mailto:"+p.email).text(p.email);$("span.online",e).text(p.online?lang.YES:lang.NO);var y=x(p),P=$("a.questions",e).text(y.length>0?y.length:"-");y.length>0&&P.attr("href","javascript:void(0)").bind("click",p,function(){ga();I(p)});(y=p.online&&
p.currentCard)?$("a.card",e).attr("href","javascript:void(0)").text(y.title).bind("click",y,function(ba){ga();Z.openCard(ba.data)}):$("a.card",e).closest("tr").remove();var V=ca.getUserRight(p);y=$("td.access",e);if(!ca.isSharable()||p.current)y.text(V.toString());else{y=utility.createToolbar(true).appendTo(y);utility.createMenuItem(null,null,V.toString()).addClass("okay").appendTo(y).bind("click",function(){for(var ba=$(this),da=utility.createMenu().css("bottom",34),ta=[client.data.TopicAccessConstants.presetReadOnly,
client.data.TopicAccessConstants.presetWriteAccess,client.data.TopicAccessConstants.presetFullAccess,client.data.TopicAccessConstants.owner],ja=0;ja<ta.length;ja++)utility.createMenuItem("",null,client.data.Right.accessLevelString(ta[ja])).bind("click",{right:V,access:ta[ja],menu:da},function(Ra){Ra.data.menu.remove();var ib=Ra.data.right,jb=Ra.data.access;ib.access!=jb&&Z.page.server.update({Topic:{id:ib.topic.id,modified:ib.topic.modified,rights:[{id:ib.id,mask:jb}]}},utility.createCallback(Z,function(Hb){Hb.success?
ba.text(client.data.Right.accessLevelString(jb)):alert(lang.COULD_NOT_UPDATE_RIGHT);n();Ca.reloadAddBar()}))}).appendTo(da);ba.parent().append(da);$(document.body).one("click",da,function(Ra){Ra.data.remove()})});utility.createMenuItem(null,null,lang.REMOVE_USER).appendTo(y).bind("click",p,function(ba){confirm(lang.REMOVE_USER_CONFIRM.replace("#",p.name))&&G(ba.data)})}}function x(e){var p=[];ca.getMarkers().each(function(){this.getBoxNumber()===0&&this.user===e&&p.push(this)});return p}function I(e){var p=
function(){return x(e)};if(p().length>0){var y=Ca.getThumb(e);if(y){y.render(true);var P=$(document.createElement("div")).html(lang.PROBLEM_BROWSE_HTML);$(".name",P).text(e.name);N(p,P,y.item)}}else alert(lang.USER_HAS_NO_PROBLEMS)}function N(e,p,y,P){var V=null;if(typeof e=="function"){V=e;e=e()}P=P!==undefined?P:jQuery.balloon.BalloonPositionConstants.topRight;var ba=$(".links",p);utility.createLink(lang.PREVIOUS).prependTo(ba).click(function(){F(-1)});utility.createLink(lang.NEXT).appendTo(ba).click(function(){F(+1)});
ga();oa=jQuery.showBalloon(y,p,P,function(){sa.emphasizeMarker();oa=undefined});oa.currentMarkers=e;oa.currentMarker=e[0];oa.markerFunction=V;F();return p}function F(e){if(oa&&oa.currentMarkers){if(oa.markerFunction)oa.currentMarkers=oa.markerFunction();var p=oa.currentMarkers.length;if(p==0)ga();else{var y=oa.currentMarkers.indexOf(oa.currentMarker);if(y==-1)y=0;if(e!==undefined){y+=e;if(y>=p)y=0;else if(y<0)y=p-1;oa.currentMarker=oa.currentMarkers[y]}$("span.current",oa).text((y+1).toString()+"/"+
p);T!==oa.currentMarker.card?Z.openCard(oa.currentMarker.card):sa.emphasizeMarker(oa.currentMarker)}}}function R(e){if(e||Q.getCurrentCard()===undefined||Q.getCurrentCard().topic!==ca){Q.load({cards:ca.getCards(),currentCard:T});Q.allowMoving(true);n();z()}else Ca.updateStates();if(T){Aa.unload();Aa.load({tags:T.getTags()});Q.setCurrentCard(T);config.reduceFeatureSet&&Ya.attr("href",config.fullLocationFromOverlay+"#"+T.id);L()}}function n(e){if(ca){var p=[Z.page.server.getCurrentUser()],y=[];ca.getRights().each(function(){if(p.indexOf(this.user)==
-1&&this.access>client.data.TopicAccessConstants.noAccess){if(this.user.name==null||this.user.needsLoading)y.push(this.user);this.user.name!=null&&p.push(this.user)}});Ca.load({users:p,primaryUser:p[0]});y.length>0&&!e&&Z.page.server.loadUsers(y,utility.createCallback(Z,function(P){P.success?n(true):alert(lang.COULD_NOT_LOAD_USERS)}))}}function z(){if(ca){var e=D();for(var p in e){if(!e[p])return;$("span.count",Ta[p]).text(e[p].length);hb&&hb[p].toggle(e[p].length>0)}F()}}function C(e){var p=[];db.each(function(){this.tool==
e.tool&&this.relation==e.relation&&p.push(this)});p.each(function(){db.remove(this)});db.unshift(e)}function L(){var e=nb.get(0).offsetHeight+X.get(0).offsetHeight;e=Qa.get(0).clientHeight-e;e>0&&rb.css("height",e);za.headerBar.css("left",za.get(0).offsetLeft);za.toolbar.css("max-width",rb.width()-za.get(0).offsetLeft-40);U()}function U(e){var p=false;if(e===true){Ma=Ma=="share"?"box":"share";p=true}else if(e!==undefined)if(Ma==e)return;else{Ma=e;p=true}e=X.width();e-=18;var y={},P={},V=!config.reduceFeatureSet&&
(!eb||eb.open.length==0||Ia);if(Ma=="box"){y.width=Math.max(e-430,76);e-=y.width;if(e>0){P.width=e;P.left=y.width+18-2}}else if(Ma=="share"){P.width=Math.max(Math.min(V?204:84,e-76),0);e-=P.width;if(e>0){y.width=e;P.left=y.width+18-2}}$.fn[p?"animate":"css"].call(Cb,y);$.fn[p?"animate":"css"].call(Pa,P)}function Y(){var e=vb.isEditor,p=T!==vb.card||sa.isEditor()!=e,y=ca!==vb.card.topic;Db=T;T=vb.card;ca=T.topic;sb=false;vb=null;va();ea();Na!=undefined&&s();p&&R();sa.openCard(T,e);rb.get(0).scrollTop=
0;window.location.hash=T.id;oa&&sa.emphasizeMarker(oa.currentMarker);if(y){eb=null;gb.text(ca.title);k()}if(T.topic.isShared()){if(y)qb=undefined;b()}C({relation:T});e=[T.topic];p=[];for(y=0;y<e.length;y++)for(var P=e[y].getCards(),V=0;V<P.length;V++){var ba=P[V];ba.needsLoading&&ba!==T&&p.push(ba)}p.length>0&&Z.page.server.loadCards(p,utility.createCallback())}function W(){ea();tb=$.showBalloon(Na,lang.CARD_LOCKED_HTML,jQuery.balloon.BalloonPositionConstants.centerLeft);var e=utility.createToolbar(true).appendTo(tb);
utility.createMenuItem(null,"ok",lang.CHECK_OUT_TRY_AGAIN,function(){b({checkOut:true,card:T});window.clearTimeout(pb);pb=window.setTimeout(aa,fb*1E3)}).appendTo(e)}function ea(){if(tb!==undefined){tb.remove();tb=undefined;s()}}function ga(){if(oa){oa.remove();oa=undefined}}function fa(){if(sa.hasChanged()){window.clearTimeout(pb);pb=window.setTimeout(aa,fb*1E3);var e=utility.createCallback(Z,Ea);sa.saveCard();e=Z.page.server.updateCard(T,sa.getChanges(),e);sa.resetChanges();return e!==undefined&&
e.readyState==4&&e.status==200}else return true}function aa(){Fa()}function Fa(){T&&T.checkedOut==true&&!T.checkingIn&&b({cardToCheckIn:T})}function Da(){O();cb=$.showBalloon(za.shoutboxLink,null,jQuery.balloon.BalloonPositionConstants.centerRight);var e=$(document.createElement("div"));$(document.createElement("h3")).text(lang.SEND_FEEDBACK).appendTo(e);var p=$(document.createElement("div")).addClass("pad").appendTo(e);cb.textarea=$(document.createElement("textarea")).css({height:"100px",width:"100%"}).appendTo(p);
utility.createPanelDialog(e,{},Ga,null,lang.SEND).children().appendTo(cb);cb.textarea.get(0).focus()}function Ga(e){if(e.data.action=="ok"){e=cb.textarea.val();e.length>0?Z.page.server.suggestFeature(e,utility.createCallback(Z,function(p){if(p.success){alert(lang.THANKS_FEEDBACK);O()}else alert(lang.COULD_NOT_SEND_FEEDBACK)})):alert(lang.MESSAGE_EMPTY)}else O()}function O(){if(cb!==undefined){cb.remove();cb=undefined}}function ka(e){var p=$(document.createElement("div")).addClass("full-container layer").click(function(y){y.stopPropagation()});
e&&p.hide();p.appendTo(za);return p}function na(){va();$a=ka();var e=$(document.createElement("h2")).text(lang.CARD_UPDATE_PENDING).appendTo($a);$(document.createElement("div")).addClass("loader show").insertBefore(e)}function va(){if(kb!==undefined){window.clearTimeout(kb);kb=undefined}if($a!==undefined){$a.remove();$a=undefined}}function Ea(e,p){if(e.error)e.error==client.ServerErrors.invalidRevision?alert(lang.CARD_CHANGED_WHILE):ua(p);else if(Eb){var y=za.flashcardBox.attr("href"),P=za.flashcardBox.attr("target");
if(P=="_parent")window.parent.location=y;else if(P=="_self")window.location=y;else window.frames[P].location=y}else{Fb&&b({cardToCheckIn:p.card});if(!sb&&p.card===T){sa.revertChanges();R()}if(sb){Y();sb=false}}}function ua(e){e.overlay=ka();$(document.createElement("h2")).text(lang.CARD_UPDATE_FAILURE.replace("####",'"'+e.card.title+'"')).appendTo(e.overlay);var p=utility.createToolbar(true).appendTo(e.overlay);utility.createMenuItem(null,null,lang.DISMISS_DATA,function(y){y.data.overlay.remove();
T===y.data.card&&sa.revertChanges()},e).appendTo(p);utility.createMenuItem(null,null,lang.RETRY_UPLOAD,function(y){Z.page.server.updateCard(y.data.card,y.data.data,utility.createCallback(Z,Ea));y.data.overlay.remove()},e).appendTo(p)}function wa(){Z.hide();yb.showOverview()}function xa(e){e=e.card;if(!e.topic.isStructurable())return false;var p=Q.getSelectedCards();if(p.indexOf(e)==-1)p=[e];var y=ca.getCards();p.each(function(){y.remove(this)});if(y.length==0)alert(lang.CANNOT_DELETE_LAST);else{var P=
{};P.cards=[];for(var V=0;V<y.length;V++)y[V].transformStatic().each(function(){this.index=V;delete this.title;P.cards.push(this)});P.deletedCardIds=[];p.each(function(){P.deletedCardIds.push(this.id)});if(confirm(lang.X_CARDS_WILL_BE_DELETED.replace("#",p.length))){Q.allowMoving(false);window.setTimeout(function(){ha(P,topic,{index:ca.getIndexOfCard(T),isEditor:topic.isEditable()},Ja)},1);return true}else return false}}function Ha(e){return e.topic&&e.topic.isStructurable()&&e.id}function ab(e,p,
y){var P=e.topic.getCards();P.splice(p,1);P.splice(y,0,e);var V={};V.cards=[];for(var ba=0;ba<P.length;ba++)P[ba].transformStatic().each(function(){this.index=ba;delete this.title;V.cards.push(this)});Q.allowMoving(false);ha(V,topic,{id:T.id,isEditor:topic.isEditable()},Ja);return false}function ya(e){if(ca&&ca.isEditable()){e(utility.createMenuItem("sheet-note.png",null,lang.INSERT_PAGE,function(p){if(ca.isEditable()&&T.topic.getCardCount()<config.CARD_LIMITS[0]){p=p.data.type;var y=ca.getIndexOfCard(T);
y+=1;Gb(ca,new client.data.Card({type:p}),y)}else alert(lang.MAX_NO_OF_CARDS_IN_TOPIC)},{type:client.data.CardTypeConstants.html}));e(utility.createMenuItem("sheet-pdf.png",null,lang.PDF_INSERT_EXPLANATION,function(){var p=utility.requestFloat(Qa,false,function(){Oa.destroy();Oa=undefined}),y=[];ca.each(function(){this.cardType==client.data.CardTypeConstants.pdf&&y.add(this.pdf)});Oa=zb.createInsertUi({container:p,okHandler:qa,allowUpload:true,allowedFiles:y})})).css({right:0,left:"auto"})}}function qa(e,
p){if(e.pageCount!==undefined){var y=utility.createCardsForPages(p,e),P=T.topic.getIndexOfCard(T);if(T.topic.isEditable()&&T.topic.getCardCount()+y.length<=config.CARD_LIMITS[0]){Z.insertCard(T.topic,y,P+1);utility.closeFloat()}else alert(lang.MAX_NO_OF_CARDS_IN_TOPIC)}}function K(e){var p=Q.getSelectedCards();p.length==0&&p.push(T);p.clone().each(function(){var V=this;V.getTags().each(function(){this.title.toLowerCase()==e.toLowerCase()&&p.remove(V)})});if(p.length>0){var y=[];p.each(function(){y.push({id:this.id,
tagIndexes:[0]})});var P=[];P.push(e);Z.page.server.update({Topic:{id:ca.id,modified:ca.modified,newTags:P,cards:y}},utility.createCallback(Z,ia))}else alert(lang.TAG_ALREADY_EXISTS);return true}function S(e){if(!e.id)return true;var p=Q.getSelectedCards();p.length==0&&p.push(T);var y=[];p.each(function(){y.push({id:this.id,deletedTagIds:[e.id]})});Z.page.server.update({Topic:{id:ca.id,modified:ca.modified,cards:y}},utility.createCallback(Z,ia));return false}function ha(e,p,y,P,V){if(e===undefined){var ba=
p.getCards();e={};e.cards=[];for(var da=0;da<ba.length;da++){var ta=ba[da].transformStatic()[0];ta.index=da;V.apply(ba[da],[ta,ba[da]]);e.cards.push(ta)}}lb={data:y,callback:P};return Z.page.server.updateTopic(p,e,utility.createCallback(Z,ia))}function ia(e){wb=false;var p=lb;lb=undefined;if(e.success&&e.topics)p!==undefined&&p.callback!==undefined&&p.callback.apply(Z,[p.data,e.topics[0]]);else{R(true);if(e.error==client.ServerErrors.locked)alert(lang.SHEETS_LOCKED);else if(e.error==client.ServerErrors.invalidRevision){alert(lang.TOPIC_CHANGED_MEANTIME);
la()}else e.error==client.ServerErrors.limitCountReached?alert(lang.TAG_CARD_LIMIT_REACHED):alert(lang.COULD_NOT_UPDATE_TOPIC)}}function la(){Z.page.server.load({Topic:{topics:[ca],fromTime:ca.modified}},utility.createCallback(ca,ra),ca)}function ra(e){e.error&&alert(lang.COULD_NOT_LOAD_TOPIC)}function Ja(e,p){var y=e.id?p.getCardById(e.id):p.getCard(e.index);if(y==null){y=p.getCard(0);if(y==null)return}Z.openCard(y,e.isEditor)}var Ba=45,Za=5,Wa=20,bb=6E3,fb=5,Ia=true;client.PagePlugin.call(this);
var T=null,Db,mb;this.getCard=function(){return T};var sa,pa,zb,Ua,Q,Ca,yb,Z,Va,oa;this.load=function(){Z=this;t();utility.globalSave=function(){Z.saveCard()};Z.page.loadPagePlugin(sa);this.page.server.registerSyncHandler("contents",m);this.page.server.registerSyncHandler("questions",j);this.page.server.registerSyncHandler("checks",j);this.page.server.registerSyncHandler("cards",h);this.page.server.registerSyncHandler("removedMarkers",o);this.page.server.registerSyncHandler("markers",i);this.page.server.registerSyncHandler("topics",
r);this.page.server.registerSyncHandler("tags",l);Va=this.page.server.getCurrentUser().settings;if(Va.notepad===undefined)Va.notepad={};delete Va.lastCardId;client.PagePlugin.prototype.load.call(this);a()};var ob,qb;this.onPluginLoad=function(e){if(e instanceof client.pageplugins.Overview)yb=e;else if(e instanceof client.pageplugins.Trainer)pa=e;else if(e instanceof client.pageplugins.File)zb=e;else if(e instanceof client.pageplugins.Introduction)Ua=e};var nb,za,Aa,X,Cb,Pa,ma,rb,Qa,Xa,Na,La,gb,Ta,
Ya,hb,eb,ub={open:"marker-color.png",solved:"problem.png",repeat:"marker-color.png"},Ka={userClicked:function(e){ga();var p=$(document.createElement("div")).html(lang.USER_INFO_HTML);M(p,e.user);oa=jQuery.showBalloon($(e.item),p,jQuery.balloon.BalloonPositionConstants.topRight);$.browser.msie||oa.css("width","auto")},getShowGoTo:function(e){return!e.current&&e.online&&e.currentCard!=null&&T!==e.currentCard&&e.currentCard.topic!=null},getQuestionCount:function(e){return x(e).length},getUserRight:function(e){return ca.getUserRight(e?
e:Z.page.server.getCurrentUser())},adjustUserRight:function(e,p){Z.page.server.update({Topic:{id:e.topic.id,modified:e.topic.modified,rights:[{id:e.id,mask:p}]}},utility.createCallback(Z,function(y){y.success||alert(lang.COULD_NOT_UPDATE_RIGHT);n();Ca.reloadAddBar()}))},goToClicked:function(e){(function(p){if(p=p.currentCard)p!==T?Z.openCard(p):alert(lang.ALREADY_ON_USERS_CARD)})(e.user)},questionClicked:function(e){I(e.user)}},wb,Gb=this.insertCard=function(e,p,y){if(wb)return false;p=p instanceof
Array?p:[p];for(var P=e.getCards(),V=p.length-1;V>=0;V--)P.splice(y,0,p[V]);var ba={};ba.cards=[];for(V=0;V<P.length;V++){var da=P[V].transformStatic()[0];da.index=V;if(V<y||V>=y+p.length)delete da.title;ba.cards.push(da)}wb=true;return ha(ba,e,{index:y,isEditor:e.isEditable()},Ja)},db=[],Ab;this.show=function(){if(!Ab){Qa.show();$(window).bind("resize",L);L();Ab=true;Ua&&Ua.showHelp(Qa,lang.INTRO_EDIT_TITLE,lang.INTRO_EDIT_HTML,2)}};var Ma;this.hide=function(){if(Ab){ga();Fb=mb=true;sa.closeCard();
fa();sa.closeCard();T=ca=null;$(window).unbind("resize",L);Qa.hide();Q.unload();Ca.unload();Ab=false}};this.openTopic=function(e,p){if(e===undefined||e==null)e=ca;if(p===undefined)p=e.isEditable();if(e.getCardCount()==0)e.isEditable()?Gb(e,new client.data.Card,0):alert(lang.TOPIC_EMPTY);else this.openCard(T!=null&&T.topic===e?T:e.getCard(0),p)};var sb,Eb;this.openCard=function(e,p){topic=e.topic;if(!(topic===undefined||topic==null)){if(p===undefined)p=topic.isEditable();else if(p&&!topic.isEditable())p=
false;if(e.cardType==client.data.CardTypeConstants.pdf){e.needsPassword&&alert(lang.EXPLAIN_LOCKED_SLIDE);p=false;if(e.pdf.title){za.pdfInfo.html(lang.PDF_EXPLAIN).children("b.n").text(e.pdf.title);za.pdfInfo.children("b.p").text(e.page)}}Aa.allowEdit(topic.isTaggable());Ca.allowAdd(topic.isSharable());Q.allowEdit(topic.isEditable());vb={isEditor:p,topic:topic,card:e};if(sa&&T!=null){sa.closeCard();if(fa()==false&&e!=T){kb=window.setTimeout(na,2E3);sb=true;return false}else if(T.checkedOut&&(e!=T||
p!=sa.isEditor()))mb=true}this.show();if(e.needsLoading==true){this.page.server.loadCard(e,utility.createCallback(Z,Y));return false}else{Y();return true}}};this.saveCard=function(){return fa()};var vb,tb,ca=null;this.getTopic=function(){return ca?ca:undefined};var Fb,pb,Bb;this.hideIntro=function(){if(Bb!==undefined){Bb.remove();Bb=undefined}};var cb,$a,kb,Oa,lb;this.unload=function(){this.hide();this.page.server.unregisterSyncHandler("contents",m);this.page.server.unregisterSyncHandler("questions",
j);this.page.server.unregisterSyncHandler("checks",j);this.page.server.unregisterSyncHandler("cards",h);this.page.server.unregisterSyncHandler("removedMarkers",o);this.page.server.unregisterSyncHandler("markers",i);this.page.server.unregisterSyncHandler("topics",r);this.page.server.unregisterSyncHandler("tags",l);Z.page.unloadPagePlugin(sa);va();c();eb=null;ga();Aa.destroy();Qa.remove();Z=null;delete utility.globalSave;delete yb;delete pa;delete zb;delete Ua;client.PagePlugin.prototype.unload.call(this)}};
client.pageplugins.MainView.prototype=new client.PagePlugin;
client.pageplugins.Trainer=function(){function a(){I=$(document.createElement("div")).addClass("mb-cont trainer").hide().appendTo(B.page.container);I.toggleClass("reduce",config.reduceFeatureSet===true);G=$(document.createElement("div")).addClass("top-panel").appendTo(I);titleContainer=$(document.createElement("div")).addClass("title-container").appendTo(I);F=utility.createLink(lang.BACK_TO_OVERVIEW).addClass("overview-back").appendTo(titleContainer).click(function(na){na.stopPropagation();c();B.hide();
N.showOverview()});F.toggle(config.reduceFeatureSet!==true);J=new client.widgets.FlashcardPanel({node:G,dotClicked:function(na){B.gotoNextCard(client.data.FlashcardResultConstants.none,false,na)}});toolPanel=$(document.createElement("div")).addClass("tool-panel").appendTo(G);u=utility.createToolbar().addClass("gradient top").appendTo(toolPanel);Y=$(document.createElement("div")).addClass("flash-container").appendTo(toolPanel);x=$(document.createElement("div")).addClass("center-panel").appendTo(I);
M=$(document.createElement("div")).appendTo(x);utility.setupDesktop(M.css("opacity",D));M.shoutboxLink.hide();var O=$(document.createElement("div")).addClass("super-container").appendTo(G);O=$(document.createElement("div")).addClass("header-wrapper").appendTo(O);var ka=$(document.createElement("div")).addClass("header-bar").appendTo(O);M.headerBar=ka;["center left","center middle","center right","center markerbar"].each(function(){$(document.createElement("div")).addClass("desktop background "+this).appendTo(ka)});
O=$(document.createElement("div")).addClass("panel").appendTo(ka);O=$(document.createElement("div")).addClass("title-bar").appendTo(O);$(document.createElement("div")).addClass("clear").appendTo(O);w=new client.pageplugins.NoteDisplay({container:M.noteContainer,sizeHandler:function(na){na.left=M.get(0).offsetLeft;delete na.height;M.headerBar.css(na)},desktop:M,header:O,superContainer:I,scrollContainer:x,trainingMode:true});B.page.loadPagePlugin(w)}function b(){var O=G.get(0).offsetHeight;O=I.get(0).clientHeight-
O;O>0&&x.css("height",O);M.headerBar.css("left",M.get(0).offsetLeft)}function d(O,ka){O.error?alert(lang.COULD_NOT_LOAD_CARDS):B.trainMarkers(ka,true)}function c(){if(C){var O={Flashcard:{flashcards:[]}};C.each(function(){this.hasChanged&&O.Flashcard.flashcards.push(this.transformStatic())});O.Flashcard.flashcards.length>0&&B.page.server.update(O,utility.createCallback(B,h))}}function h(O){O.error&&alert(lang.COULD_NOT_SYNC_TRAINING)}function m(O){J.unload();J.load({items:O});J.setCurrentDot(aa,Fa)}
function j(O){ga=O.callback;aa=O.flashcard;fa=aa.getMarker().getFlashcardContents(aa);W=$(document.createElement("div")).appendTo(Y);ea=$(document.createElement("div")).appendTo(Y);fa.frontSide?f():k()}function o(O){O=O.data;switch(O.action){case "gotoAnswer":k();break;case "gotoQuestion":f();break;case "showContext":O.toggleClass("active",i());break;case "showEditor":O=w.getCurrentCard();B.hide();U.openCard(O);break}}function i(O,ka){if(O===undefined)O=!Da;M.stop(true,false).animate({opacity:O?q:
D});Y.stop(true,false).animate({opacity:!O||ka?q:D});w.closeCard();w.getCurrentCard()!==aa.getMarker().card&&b();w.trainCard(aa.getMarker().card,aa.getMarker());return Da=O}function f(){ea.contents().remove();fa.frontSide.clone().appendTo(ea);u.children().remove();utility.createMenuItem("train.png","gotoAnswer",lang.GOTO_ANSWER,o,null).attr("accesskey","a").appendTo(u);fa.showCard||i(false);utility.createToolbarSeparator().appendTo(u);utility.createMenuItem("study-tool.png","showContext",lang.SHOW_CONTEXT,
o,null).attr("accesskey","c").appendTo(u).toggleClass("active",Da);utility.createButton("edit.png","showEditor",lang.SHOW_EDITOR,o,null).appendTo(u);g()}function k(){if(fa.backSide){ea.contents().remove();fa.backSide.clone().appendTo(ea);$("[id]",ea).removeAttr("id")}fa.showCard&&i(true,true);if(fa.backSide||fa.showCard){u.children().remove();if(fa.showSelfAssessmentButtons){var O=u;utility.createMenuItem("face-smile.png","answerRight",fa.showCard?lang.REVIEW_RIGHT:lang.ANSWER_RIGHT,l,null).attr("accesskey",
"r").appendTo(O);utility.createButton("face-plain.png","answerUnsure",fa.showCard?lang.REVIEW_UNSURE:lang.ANSWER_UNSURE,l,null).attr("accesskey","e").appendTo(O);utility.createMenuItem("face-sad.png","answerWrong",fa.showCard?lang.REVIEW_WRONG:lang.ANSWER_WRONG,l,null).attr("accesskey","w").appendTo(O)}if(fa.frontSide&&!fa.showCard){utility.createToolbarSeparator().appendTo(O);utility.createMenuItem("train.png","gotoQuestion",lang.GOTO_QUESTION,o,null).attr("accesskey","q").appendTo(u)}utility.createToolbarSeparator().appendTo(O);
utility.createMenuItem("study-tool.png","showContext",lang.SHOW_CONTEXT,o,null).attr("accesskey","c").appendTo(u).toggleClass("active",Da);utility.createButton("edit.png","showEditor",lang.SHOW_EDITOR,o,null).appendTo(O);g()}}function g(){var O=0;u.children().each(function(){O+=this.offsetWidth+4});u.css("width",O)}function l(O){if(aa){var ka=client.data.FlashcardResultConstants.none;switch(O.data.action){case "answerRight":ka=client.data.FlashcardResultConstants.right;break;case "answerUnsure":ka=
client.data.FlashcardResultConstants.neutral;break;case "answerWrong":ka=client.data.FlashcardResultConstants.wrong;break}aa.addResult(ka);aa.answerTime=Math.round((new Date).getTime()/1E3);aa.hasChanged=true;utility.triggerCallback(ga,ka)}}function r(){W&&W.remove();W=null;ea&&ea.remove();ea=null;u.children().remove();Fa=aa;fa=aa=null}function t(){for(var O=$(document.createElement("div")),ka=$(document.createElement("div")).addClass("list-half").appendTo(O),na=[],va=0;va<lang.EXAM_TOPIC_LIST_HEADERS.length;va++)na.push({title:lang.EXAM_TOPIC_LIST_HEADERS[va],
sortable:true,sortKey:va});ka=new client.widgets.TreeView2({container:ka,headers:na});na=$(document.createElement("div")).addClass("bottom-panel trainer gradient").appendTo(O);$(document.createElement("h3")).text(lang.STATS_HEADER).appendTo(na);va=$(document.createElement("div")).appendTo(na);va=new client.widgets.TreeView2({container:va,headers:[new client.widgets.TreeViewHeader({title:lang.EXAM_STAT_HEADERS[0]}),new client.widgets.TreeViewHeader({title:lang.EXAM_STAT_HEADERS[1]})]});var Ea=$(document.createElement("div")).addClass("grey bold").hide().text("("+
lang.NO_CARDS_INFO+")").appendTo(na);O=new client.pageplugins.OverviewCategory({title:lang.EXAM_PREPARATION,container:O,type:"topic",filterNote:lang.FILTER_NOTES_BY,filter:true,updateList:v});na=utility.createToolbar(true).addClass("gradient pad").appendTo(na);utility.createMenuItem(null,"ok",lang.PREPARE_SELECTED).addClass("right").appendTo(na).bind("click",O,function(ua){ua=ua.data;ua.overviewInterface.callPowerFunction("trainFlashcards",ua.flashcards)});O.topicList=ka;O.statList=va;O.updateStats=
s;O.toolbar=na;O.emptyInfo=Ea;O.destroy=function(){this.topicList.destroy();this.statList.destroy()};return O}function v(O){var ka=this,na;if(O instanceof Array)na=O;else{na=ka.topics;if(!O.success){alert(lang.COULD_NOT_LOAD_CARDS);return false}delete O.success;var va=false;for(var Ea in O){va=true;break}if(!va)return false}var ua=ka.overviewInterface,wa=ua.getFilterTags(),xa=[],Ha=[],ab=[],ya={};na.each(function(){var qa=utility.createLink(this.title).bind("click",this,function(bb){ua.callPowerFunction("trainMarkers",
bb.data.getMarkers())}).attr("title",lang.TRAIN_TOPIC),K=[],S=[];this.each(function(){if(wa.length==0||this.hasTag(wa)){S.push(this);this.needsLoading?Ha.push(this):this.each(function(){if(this.trainable()){var bb=this.prepareTraining();if(bb===true)K=K.concat(this.getFlashcards());else if(bb instanceof Array)ab=ab.concat(bb)}})}});var ha=0,ia=0;K.each(function(){ha+=this.getPrepScore();if(this.answerTime>ia)ia=this.answerTime});var la=0;if(this.getCardCount()>0)la=Math.min(Math.round(K.length/this.getCardCount()*
100/2.5),100);var ra=$(document.createElement("div")).addClass("density").text(la.toString()+"%"),Ja=$(document.createElement("div")).addClass("progress"),Ba=0;if(K.length>0)Ba=Math.round(ha/K.length*100);Ja.text(Ba+"%");var Za=$(document.createElement("div")).addClass("progress"),Wa=new Date(ia*1E3);Za.text(ia>0?utility.getChangeString(Wa):"("+lang.NEVER+")");ra.addClasses=Ja.addClasses=Za.addClasses="col-tiny middle";qa=new client.widgets.TextTreeViewItem({info:[this.title,la,Ba,Wa],items:[qa,ra,
Ja,Za],addClasses:"topic border selected",icon:"rep-act-small.png",onCheck:E,showCheck:true,initialCheck:true});qa.topic=this;qa.date=Wa;qa.mod=this.modified;qa.category=ka;xa.push(qa);ya[this.id]={flashcards:K,cards:S}});xa.sort(function(qa,K){return K.mod-qa.mod});xa.sort(function(qa,K){return K.date-qa.date});this.topicList.unload();this.topicList.addItems(xa);this.topicList.paginate(H);this.topicList.load();this.topics=na;this.items=xa;this.filterTags=wa;this.topicInfos=ya;this.updateStats();
if(Ha.length>0||ab.length>0){O={};if(Ha.length>0){O.Content={contents:Ha};O.Markers={parents:Ha}}B.page.server.prepareLoad(ab,O);B.page.server.load(O,utility.createCallback(this,v))}}function E(O){this.item.toggleClass("selected",O);this.category.updateStats()}function s(){var O=0,ka=0,na=0,va=0,Ea=[];this.items.each(function(){this.check()&&Ea.push(this.topic)});var ua=[],wa=[],xa=this.topicInfos;Ea.each(function(){if(xa[this.id]){ua=ua.concat(xa[this.id].cards);wa=wa.concat(xa[this.id].flashcards)}});
wa.each(function(){if(this.answerTime>0){O++;ka+=this.answerTime;na+=this.level;va+=this.getPrepScore()}});var Ha;if(O>0){Ha=ka/O*1E3;Ha=(new Date).getTime()-Ha;Ha=Math.round(Ha/1E3/3600/24)}var ab=wa.length>0?va/wa.length:0,ya=ua.length>0?Math.round(wa.length/ua.length):0,qa=[];[{title:lang.NUM_OF_SHEETS,value:ua.length.toString()},{title:lang.NUM_OF_CARDS,value:wa.length.toString()},{title:lang.FLASH_CARDS_PER_SHEET,value:ya},{title:lang.AVG_TIME_SINCE_TRAINING,value:Ha!==undefined?Ha.toString():
"("+lang.NEVER+")",addClasses:"bold"},{title:lang.PREP_SCORE,value:Math.round(ab*100).toString()+"%",addClasses:"bold border"}].each(function(){var K=$(document.createElement("span")).text(this.title);K.addClasses="right";var S=$(document.createElement("span")).text(this.value);S.addClasses="right col-small";K=new client.widgets.TextTreeViewItem({info:[0,0],items:[K,S]});K.addClasses=this.addClasses;qa.push(K)});this.toolbar.toggle(wa.length!=0);this.emptyInfo.toggle(wa.length==0);this.statList.unload();
this.flashcards=wa;if(wa.length>0){this.statList.unload();this.statList.addItems(qa);this.statList.load()}else this.statList.unload()}var D=0.2,q=1,H=10;client.PagePlugin.call(this);var A,B;this.load=function(){B=this;client.PagePlugin.prototype.load.call(this);Ga=[t()];a.call(this);var O=this.page.server.getCurrentUser().settings;if(O.trainer===undefined)O.trainer={};A=0};var J,u,w,G,M,x,I,N,F,R;this.show=function(){if(!R){toolPanel.show();I.show();$(window).bind("resize",b);b();R=true}};this.hide=
function(){if(R){$(window).unbind("resize",b);B.endTraining();I.hide();R=false}};var n,z,C;this.trainFlashcards=function(O){z=O;C=z.clone();G.toggle(z.length>0);if(z.length==0)alert(lang.NO_FLASH_CARDS);else{this.show();m(C,false);currentFlashCard=L=null;this.gotoNextCard(null,null);c();n=window.setInterval(c,6E4)}};this.trainMarkers=function(O,ka){var na=[],va=[];O.each(function(){if(this.trainable()){var Ea=this.prepareTraining();if(Ea===true)na=na.concat(this.getFlashcards());else if(Ea instanceof
Array)va=va.concat(Ea)}});va.length>0&&!ka?this.page.server.load(this.page.server.prepareLoad(va),utility.createCallback(B,d),O):this.trainFlashcards(na);this.show()};this.getPowerFunctions=function(){return{trainFlashcards:function(O){return B.trainFlashcards(O)},trainMarkers:function(O){return B.trainMarkers(O)}}};var L;this.gotoNextCard=function(O,ka,na,va){var Ea=config.MIN_BOX_LEVEL,ua=config.MAX_BOX_LEVEL;if(O!=null&&aa)switch(O){case client.data.FlashcardResultConstants.right:if(aa.level==
ua){aa.level=ua;z.remove(aa)}else aa.level<ua&&aa.level++;break;case client.data.FlashcardResultConstants.neutral:aa.level=Math.max(Ea,aa.level-1);break;case client.data.FlashcardResultConstants.wrong:aa.level=Ea;break;case client.data.FlashcardResultConstants.none:break}if(z.length==0){alert(lang.SESSION_FINISHED);m.apply(this,[C,va]);toolPanel.fadeOut();aa=null}else{if(O=na)z.add(O);else{if(!L||L.length==0){var wa={};for(O=Ea;O<=ua;O++)wa[O]=[];z.each(function(){this.level>=Ea&&this.level<=ua&&
wa[this.level].push(this)});ka=undefined;for(O in wa)if(ka===undefined||wa[O].length>ka.length)ka=wa[O];L=[];var xa=Math.min(10,Math.max(Math.floor(z.length/5),5));ka.each(function(){if(this!==aa||L.length>0){L.push(this);xa--;if(xa==0)return false}});L.length==0&&aa&&L.push(aa);A%2==1&&L.length>0&&L[L.length-1]!==aa&&L.reverse();A++}O=L.shift()}r();if(O){j({flashcard:O,topicName:O.getMarker().card.topic.title,cardLevel:O.level,callback:utility.createCallback(this,this.gotoNextCard)});m.apply(this,
[C,va]);aa=O}}};this.endTraining=function(){r();w.closeCard();window.clearInterval(n);z=C=null};var U;this.onPluginLoad=function(O){if(O instanceof client.pageplugins.MainView)U=O;if(O instanceof client.pageplugins.Overview)N=O};this.onPluginRemove=function(O){O===U&&delete U};this.unload=function(){this.endTraining();ea&&r();aa=Fa=null;Y.remove();Y=null;u.remove();u=null;I.remove();B=I=null;client.PagePlugin.prototype.unload.call(this)};var Y,W,ea,ga,fa,aa,Fa;this.getCurrentFlashcard=function(){return aa||
Fa};var Da=false,Ga;this.getCategories=function(){return config.reduceFeatureSet?[]:Ga.clone()}};client.pageplugins.Trainer.prototype=new client.PagePlugin;
client.pageplugins.Link=function(){function a(q){q.links.length>0&&m.call(s,{})}function b(){D&&D.remove();D=undefined}function d(q){q.stopPropagation();q=$(document.createElement("div")).addClass("dialog top").click(function(B){B.stopPropagation()});$(document.createElement("h3")).text(lang.QUICK_LINK).appendTo(q);var H=utility.createToolbar(true).appendTo(q),A=utility.createInput(lang.LOCATION).addClass("auto");A.bind("keypress",A,c).appendTo(H);utility.createMenuItem(null,"ok",lang.GO).bind("click",
A,c).appendTo(H);$(document.body).one("click",b);b();D=q.css({top:this.offsetHeight+3,left:this.offsetLeft}).appendTo(this.parentNode);A[0].focus()}function c(q){q=q.data;if(!q.hasClass("grey")){q=q.val();if(q.length!=0){if(q.toLowerCase().substr(0,3)=="www")q="http://"+q;l.page.server.update({Link:{links:[{url:q,title:q,type:0}]}},utility.createCallback(l,h))}}}function h(q){q.error?alert(lang.LINK_SAVE_ERROR):b()}function m(q){var H,A;if(q instanceof Array){H=q;A=true}else{H=this.topics;if(q.error){alert(lang.LINK_RETRIEVE_ERROR);
return false}}var B=this.overviewInterface;B.getFilterTags();var J=[];l.page.server.getObjects("link").each(function(){if(this.loaded){var u=utility.createLink(this.title).addClass("title").bind("click",this,function(x){x.preventDefault();x.stopPropagation();var I=x.data;x=$(document.createElement("div"));$(document.createElement("h3")).text(I.getTypeString()+" "+lang.LINK).appendTo(x).makeCollapsible();var N=$(document.createElement("div")).appendTo(x);x.closeHandler=function(){delete I.changes};
l.createEditor(I).appendTo(N);N=utility.createToolbar(true).appendTo(N);utility.createMenuItem(null,"ok",lang.SAVE).bind("click",I,function(F){var R=F.data;if(!R.id&&!R.changes.url&&!R.changes.title)alert(LINK_INCOMPLETE);else l.save(F.data)&&B.showPanel()}).attr("accesskey","o").addClass("right").appendTo(N);utility.createMenuItem(null,null,lang.CANCEL).bind("click",function(){B.showPanel()}).attr("accesskey","n").addClass("right").appendTo(N);B.showPanel(x)});this.typeNum==0&&this.url&&u.attr("href",
this.url);var w=utility.getChangeInfo(this.user,this.modified),G=$(document.createElement("div")).addClass("thumb-navi");G=new client.widgets.TreeViewItem2({panel:G,loaded:false,render:function(){if(!this.loaded){this.item.empty().addClass("hidden");$(document.createElement("td")).attr("colspan",3).append(this.panel).appendTo(this.item);this.loaded=true}}});var M=this.url?this.url:"("+lang.NONE+")";if(M.length>40)M=M.substr(0,20)+"..."+M.substr(M.length-20);u=new client.widgets.TextTreeViewItem({info:[this.title,
this.url,this.modified],items:[u,M,w],subItems:[G],icon:this.getIcon(),showExpander:true,onExpand:j,addClasses:"source border",tag:this});u.date=this.modified;J.push(u)}});J.sort(function(u,w){return w.date-u.date});this.list.unload();this.list.addItems(J);this.list.paginate(config.MAX_LIST_COUNT);this.list.load();A&&l.page.server.refresh({Link:true},utility.createCallback(this,m))}function j(q){if(q&&!this.loaded){this.loaded=true;l.page.server.backtrace({Link:{links:[this.tag]}},utility.createCallback(this,
o),{link:this.tag,panel:this.subItems[0].panel})}}function o(q,H){if(q.success){H=H.tag;var A=H.panel,B=[];q.markerInfos.each(function(){this.card.topic&&B.add(this.card)});if(B.length==0)A.append($(document.createElement("div")).addClass("no-related-text").text(lang.NO_RELATED_CARDS_LINK));else{A.append($(document.createElement("div")).addClass("info-text").text(lang.RELATED_CARDS_LINK));H.topicBar=new client.widgets.ThumbnailBar({node:A});H.topicBar.allowMoving(false);$("div.bar",H.topicBar.getContainer()).css({"font-size":"75%"});
H.thumbs=[];var J={bar:H.topicBar,showChangeFrom:r.lastLogin,smallChanges:true,cardClicked:function(u){this.bar.setCurrentThumb(u)},cardDblClicked:function(u){v.hide();t.openCard(u.card)}};B.each(function(){H.thumbs.push(new client.widgets.CardThumb(this,J))});f.call(H);i(B,utility.createCallback(H,f))}}else alert(q.error)}function i(q,H){var A=false;q.each(function(){if(this.needsLoading){A=true;return false}});A&&l.page.server.loadCards(q,H)}function f(){this.topicBar.load({thumbs:this.thumbs})}
function k(q,H){q.error||!H.loaded?alert("could not load link: "+q.error):l.createEditor(this,true)}function g(q){q.error&&alert(lang.LINK_UPLOAD_ERROR)}client.PagePlugin.call(this);var l,r;this.load=function(){l=this;r=l.page.server.getCurrentUser();var q=$(document.createElement("div"));s=new client.pageplugins.OverviewCategory({title:lang.LINKS,container:q,type:"topic",buttons:[utility.createMenuItem(null,null,lang.CREATE_LINK,d)],updateList:m});q=new client.widgets.TreeView2({container:q,headers:[new client.widgets.TreeViewHeader({title:lang.LINK_TOPIC_LIST_HEADERS[0],
sortable:true,sortKey:0}),new client.widgets.TreeViewHeader({title:lang.LINK_TOPIC_LIST_HEADERS[1],sortable:true,sortKey:1}),new client.widgets.TreeViewHeader({title:lang.LINK_TOPIC_LIST_HEADERS[2],sortable:true,sortKey:2})]});s.list=q;E=[s];this.page.server.registerSyncHandler("links",a)};var t,v;this.onPluginLoad=function(q){if(q instanceof client.pageplugins.MainView)t=q;else if(q instanceof client.pageplugins.Overview)v=q};this.unload=function(){this.page.server.unregisterSyncHandler("links",
a);l=t=null};var E,s;this.getCategories=function(){return E.clone()};var D;this.createEditor=function(q,H){var A;if(H){A=q.changes.editor;if(!q.loaded&&q.id){alert(lang.COULD_NOT_LOAD_LINK);return}}else{A=$(document.createElement("div"));q.changes={editor:A};var B=new Date;if((!q.loaded||B.getTime()-q.lastRefresh.getTime()>6E3)&&q.id){l.page.server.load({Link:{links:[q],fromTime:q.modified}},utility.createCallback(q,k),q);return A}}B=!q.id||q.user.current;$(document.createElement("h3")).text(lang.LOCATION).appendTo(A);
var J,u;if(B){J=$(document.createElement("input")).bind("blur",q,function(w){w=w.data;var G=$(this),M=G.val();if(M.substring(0,3).toLowerCase()=="www"){M="http://"+M;G.val(M)}w.changes.url=M;if(w.changes.url==w.url)w.changes.url=undefined;w.changes.editor.ref.attr("href",w.changes.url||w.url).show()});J.attr("accesskey","l").val(q.url)}else J=$(document.createElement("span")).addClass("title").text(q.url);u=utility.createToolbar(true).addClass("pad").appendTo(A);J.appendTo(u);A.ref=utility.createMenuItem(null,
null,lang.FOLLOW_LINK).attr({href:q.url?q.url:"javascript:void(0)",target:"_blank"}).toggle(q.url?true:false).appendTo(u).addClass("right");u.after('<div class="pad clear"/>');$(document.createElement("h3")).text(lang.TITLE).appendTo(A);if(B){B=$(document.createElement("input")).bind("blur",q,function(w){w=w.data;w.changes.title=$(this).val();if(w.changes.title==w.url)w.changes.title=undefined});B.attr("accesskey","l").val(q.title)}else B=$(document.createElement("span")).addClass("title").text(q.title);
J=utility.createToolbar(true).addClass("pad").appendTo(A);B.appendTo(J);J.after('<div class="pad clear"/>');return A};this.save=function(q,H){var A=q.changes;if(A!==undefined){delete A.editor;if(q.id){var B=false;for(var J in A){B=true;break}if(!B)return true;q.changes.id=q.id}else{if(!q.changes.type)q.changes.type=0;if(!q.changes.title){alert(lang.ENTER_TITLE_FOR_REF);return false}if(!q.changes.url){alert(lang.ENTER_URL_FOR_REF);return false}}A={links:[q.changes]};l.page.server.update({Link:A},H?
H:utility.createCallback(l,g),{data:A,link:q})}delete q.changes;return true}};client.pageplugins.Link.prototype=new client.PagePlugin;
client.pageplugins.Question=function(){function a(q){if(q.questions.length>0){b.call(s,{});b.call(D,{})}}function b(q){var H=this.modes,A,B;if(q instanceof Array){A=q;B=true}else{A=this.topics;if(q.error){alert(lang.QUESTION_RETRIEVE_ERROR);return false}}var J=this.overviewInterface;J.getFilterTags();var u=[];l.page.server.getObjects("question").each(function(){if(!(!this.loaded||H.indexOf(this.mode)==-1)){var w=$(document.createElement("div")).html(this.body).text();if(w.length>60)w=w.substr(0,57)+
"...";var G=utility.createLink(w).addClass("title").bind("click",this,function(R){R.stopPropagation();R=R.data;var n=$(document.createElement("div"));$(document.createElement("h3")).text(R.getTitle()).appendTo(n).makeCollapsible();var z=$(document.createElement("div")).addClass("question-dialog").appendTo(n);l.createEditor(R).appendTo(z);z=utility.createToolbar(true).appendTo(z);utility.createMenuItem(null,"ok",lang.SAVE).bind("click",R,function(C){l.save(C.data)&&J.showPanel()}).attr("accesskey",
"o").addClass("right").appendTo(z);utility.createMenuItem(null,null,lang.CANCEL).bind("click",function(){J.showPanel()}).attr("accesskey","n").addClass("right").appendTo(z);J.showPanel(n)}),M=utility.getChangeInfo(this.modifier,this.modified),x=$(document.createElement("div")).addClass("changes").append(utility.getUserInfo(this.user)),I=$(document.createElement("div")).addClass("thumb-navi");I=new client.widgets.TreeViewItem2({panel:I,loaded:false,render:function(){if(!this.loaded){this.item.empty().addClass("hidden");
$(document.createElement("td")).attr("colspan",4).append(this.panel).appendTo(this.item);this.loaded=true}}});var N=$(document.createElement("div")).addClass("count").text(this.getAnswerCount());N.addClasses=M.addClasses="middle col-small";var F=new client.widgets.TextTreeViewItem({info:[w,this.getAnswerCount(),this.user.name,this.modified],items:[G,N,x,M],subItems:[I],icon:this.getIcon(),showExpander:true,onExpand:d,addClasses:"issue border",tag:this});F.date=this.modified;this.getAnswers().each(function(){if(this.modified>
F.date)F.date=this.modified});u.push(F)}});u.sort(function(w,G){return G.date-w.date});this.list.unload();this.list.addItems(u);this.list.paginate(config.MAX_LIST_COUNT);this.list.load();this.topics=A;B&&l.page.server.refresh({Question:true},utility.createCallback(this,b))}function d(q){if(q&&!this.loaded){this.loaded=true;l.page.server.backtrace({Question:{questions:[this.tag]}},utility.createCallback(this,c),{question:this.tag,panel:this.subItems[0].panel})}}function c(q,H){if(q.success){H=H.tag;
var A=H.panel,B=[];q.markerInfos.each(function(){this.card.topic&&B.add(this.card)});if(B.length==0)A.append($(document.createElement("div")).addClass("no-related-text").text(lang.NO_RELATED_CARDS_QUESTION));else{A.append($(document.createElement("div")).addClass("info-text").text(lang.RELATED_CARDS_QUESTION));H.topicBar=new client.widgets.ThumbnailBar({node:A});H.topicBar.allowMoving(false);$("div.bar",H.topicBar.getContainer()).css({"font-size":"75%"});H.thumbs=[];var J={bar:H.topicBar,showChangeFrom:r.lastLogin,
smallChanges:true,cardClicked:function(u){this.bar.setCurrentThumb(u)},cardDblClicked:function(u){v.hide();t.openCard(u.card)}};B.each(function(){H.thumbs.push(new client.widgets.CardThumb(this,J))});m.call(H);h(B,utility.createCallback(H,m))}}else alert(q.error)}function h(q,H){var A=false;q.each(function(){if(this.needsLoading){A=true;return false}});A&&l.page.server.loadCards(q,H)}function m(){this.topicBar.load({thumbs:this.thumbs})}function j(q,H){q.error||!H.loaded?alert(lang.COULD_NOT_LOAD_QUESTION+
": "+q.error):l.createEditor(this,true)}function o(q){q.error&&alert(lang.QUESTION_UPLOAD_ERROR)}function i(q){if(q.getContentText()==""&&$("img",q.body).length==0)return false;if(q.dummy&&q.dummy.parent().length>0&&!q.dummy.removed)return false;else{q.fixListNesting();q.clearFormatting(utility.ClearFormattingConstants.cleanServer);return q.getContent()}}function f(q,H){switch(q){case client.data.QuestionModeConstants.question:case client.data.QuestionModeConstants.relatedQuestion:return H?lang.NO_QUESTION:
lang.ENTER_QUESTION;case client.data.QuestionModeConstants.definition:case client.data.QuestionModeConstants.relatedTerm:return H?lang.NO_EXPRESSION:lang.ENTER_EXPRESSION;case client.data.QuestionModeConstants.issue:return H?lang.NO_QUESTION:lang.DESCRIBE_ISSUE;case client.data.QuestionModeConstants.annotation:return H?lang.NO_ANNOTATION:lang.ENTER_ANNOTATION;case client.data.QuestionModeConstants.feedback:return H?lang.NO_FEEDBACK:lang.ENTER_FEEDBACK;default:return""}}function k(q,H){q.body.contents().remove();
var A=$(q.document.createElement("p")).text(H).appendTo(q.body);q.body.one("change",A,function(B){B.stopPropagation();B=B.data;if(!(B.removed||!B.is(":visible"))){try{B.text("");B.append("<br/>").children().selectNodes()}catch(J){}B.removed=true}});return q.dummy=A}function g(q,H){H=H===true;switch(q){case client.data.QuestionModeConstants.question:return H?lang.NO_ANSWER:lang.ENTER_ANSWER;case client.data.QuestionModeConstants.definition:return H?lang.NO_DEFINITION:lang.ENTER_DEFINITION;case client.data.QuestionModeConstants.issue:return H?
lang.NO_ANSWER:lang.SUGGEST_ANSWER;case client.data.QuestionModeConstants.annotation:case client.data.QuestionModeConstants.relatedTerm:case client.data.QuestionModeConstants.relatedQuestion:case client.data.QuestionModeConstants.feedback:case client.data.QuestionModeConstants.feedbackSolved:return lang.ENTER_COMMENT;default:return""}}client.PagePlugin.call(this);var l,r;this.load=function(){l=this;r=l.page.server.getCurrentUser();var q=$(document.createElement("div"));s=new client.pageplugins.OverviewCategory({title:lang.QUESTIONS,
container:q,type:"topic",buttons:[],updateList:b});s.modes=[client.data.QuestionModeConstants.issue,client.data.QuestionModeConstants.issueForce];var H=$(document.createElement("div"));D=new client.pageplugins.OverviewCategory({title:lang.GLOSSARY,container:H,type:"topic",mode:client.data.QuestionModeConstants.definition,buttons:[],updateList:b});D.modes=[client.data.QuestionModeConstants.definition];q=new client.widgets.TreeView2({container:q,headers:[new client.widgets.TreeViewHeader({title:lang.QUESTION_TOPIC_LIST_HEADERS[0],
sortable:true,sortKey:0}),new client.widgets.TreeViewHeader({title:lang.QUESTION_TOPIC_LIST_HEADERS[1],sortable:true,sortKey:1}),new client.widgets.TreeViewHeader({title:lang.QUESTION_TOPIC_LIST_HEADERS[2],sortable:true,sortKey:2}),new client.widgets.TreeViewHeader({title:lang.QUESTION_TOPIC_LIST_HEADERS[3],sortable:true,sortKey:3})]});s.list=q;H=new client.widgets.TreeView2({container:H,headers:[new client.widgets.TreeViewHeader({title:lang.GLOSSARY_TOPIC_LIST_HEADERS[0],sortable:true,sortKey:0}),
new client.widgets.TreeViewHeader({title:lang.GLOSSARY_TOPIC_LIST_HEADERS[1],sortable:true,sortKey:1}),new client.widgets.TreeViewHeader({title:lang.GLOSSARY_TOPIC_LIST_HEADERS[2],sortable:true,sortKey:2}),new client.widgets.TreeViewHeader({title:lang.GLOSSARY_TOPIC_LIST_HEADERS[3],sortable:true,sortKey:3})]});D.list=H;E=[s,D];this.page.server.registerSyncHandler("questions",a)};var t,v;this.onPluginLoad=function(q){if(q instanceof client.pageplugins.MainView)t=q;else if(q instanceof client.pageplugins.Overview)v=
q};this.unload=function(){this.page.server.unregisterSyncHandler("questions",a);l=null};var E,s,D;this.getCategories=function(){return E.clone()};this.createEditor=function(q,H){var A;if(H){A=q.changes.editor;if(!q.loaded&&q.id){alert(lang.COULD_NOT_LOAD_QUESTION);return}}else{A=$(document.createElement("div")).addClass("editor");q.changes={question:{id:q.id},answers:[],deletedAnswerIds:[],votedAnswerIds:[],unvotedAnswerIds:[],starAnswerId:undefined,editor:A};var B=new Date;if((!q.loaded||B.getTime()-
q.lastRefresh.getTime()>6E3)&&q.id){l.page.server.load({Question:{questions:[q],fromTime:q.modified}},utility.createCallback(q,j),q);return A}}var J=$(document.createElement("div")).addClass("edit-box answer").appendTo(A),u=q.getAnswers();u.sort(function(N,F){return N.modified-F.modified});var w=q.getStar(),G=l.page.server.getCurrentUser();u.each(function(){var N=$(document.createElement("div")).addClass("answer").appendTo(A),F=q.getVoteInfo(this,G),R=$(document.createElement("div")).addClass("controls").appendTo(N);
this.user===G?$(document.createElement("div")).addClass("trash").bind("click",this,function(n){n=n.data;var z=$(this).closest("div.answer");z.toggleClass("deleted");Array.prototype[z.hasClass("deleted")?"add":"remove"].call(n.question.changes.deletedAnswerIds,n.id)}).attr("title",lang.DELETE_THIS_ANSWER).appendTo(R):$(document.createElement("div")).addClass("vote").toggleClass("starred",F.votedFor).bind("click",this,function(n){n=n.data;var z=$(this);z.toggleClass("starred");var C=z.hasClass("starred"),
L=n.question.getVoteFor(n)!==undefined;Array.prototype[C&&!L?"add":"remove"].call(n.question.changes.votedAnswerIds,n.id);Array.prototype[!C&&L?"add":"remove"].call(n.question.changes.unvotedAnswerIds,n.id);z.parent().children("div.votes").text(n.question.getVoteInfo(n).voteCount+(!L&&C?1:0)+(L&&!C?-1:0))}).attr("title",lang.STAR_THIS_ANSWER).appendTo(R);$(document.createElement("div")).addClass("votes").text(F.voteCount).appendTo(R);if(q.mode!=client.data.QuestionModeConstants.issue)$(document.createElement("div")).addClass("star").bind("click",
this,function(n){n=n.data;var z=$(this);z.toggleClass("starred");if(z.hasClass("starred")){$("div.star.starred",A).not(z).removeClass("starred");n.question.changes.starAnswerId=n.id}else n.question.changes.starAnswerId=0}).attr("title",lang.REPEAT_THIS_ANSWER).toggleClass("starred",w?this===w.answer:false).appendTo(R);$(document.createElement("div")).addClass("date").text(utility.getChangeString(this.modified)).appendTo(R);$(document.createElement("div")).addClass("author").text(this.user.name?this.user.name:
this.user.id).appendTo(R);$(document.createElement("div")).addClass("body").html(this.body).appendTo(N)});B=$(document.createElement("div")).addClass("edit-box bottom").appendTo(A);var M=q.user===G,x=$(document.createElement("div")).addClass("date");q!==undefined&&x.text(utility.getChangeString(q.modified));if(M){A.questionEditor=new client.widgets.Editor({node:J,autoHeight:true});A.questionEditor.setupToolbar().append(x);A.questionEditor.load({content:q.body,isEditor:M,loadHandler:function(){q.body||
k(this,f(q.mode));this.window.focus()},attributes:{scrolling:"no"},css:{width:"100%","min-height":60,height:60,margin:0,"background-color":"#fff"}})}else{J.addClass("answer").append(x);$(document.createElement("div")).addClass("author").text(q.user.name?q.user.name:q.user.id).appendTo(J);$(document.createElement("div")).addClass("body").html(q.body).appendTo(J)}J=!q.id&&u.length==0;if(q.needsAnswer()||!J&&q.allowAnswer()){A.answerEditor=new client.widgets.Editor({node:B,autoHeight:true});A.answerEditor.setupToolbar();
A.answerEditor.load({content:null,isEditor:true,loadHandler:function(){k(this,g(q.mode))},attributes:{scrolling:"no"},css:{width:"100%",height:85,"min-height":85,margin:0,"background-color":"#fff"}})}if(!J){B=[];J=function(N,F,R){F=utility.createMenuItem(null,null,F).toggleClass("okay",R);F.bind("click",{question:q,option:N},function(n){n.data.question.changes.question.mode=n.data.option;n=$(this);n.parent().children().removeClass("okay");n.addClass("okay")});return F};if((q.mode==client.data.QuestionModeConstants.issue||
q.mode==client.data.QuestionModeConstants.issueForce)&&q.getAnswerCount()>0)B.push(J(client.data.QuestionModeConstants.issueSolved,lang.MARK_ISSUE_SOLVED,false));if((q.mode==client.data.QuestionModeConstants.issue||q.mode==client.data.QuestionModeConstants.issueSolved)&&q.getAnswerCount()>0)B.push(J(client.data.QuestionModeConstants.question,lang.SAVE_AS_CARD,false));if(q.mode==client.data.QuestionModeConstants.feedback)B.push(J(client.data.QuestionModeConstants.issueForce,lang.CONVERT_ISSUE_FORCE,
false));else if((q.mode==client.data.QuestionModeConstants.issue||q.mode==client.data.QuestionModeConstants.issueSolved)&&q.getAnswerCount()>0)B.push(J(client.data.QuestionModeConstants.issueForce,lang.MARK_ISSUE_FORCE,false));q.mode==client.data.QuestionModeConstants.feedback&&B.push(J(client.data.QuestionModeConstants.feedbackSolved,lang.MARK_FEEDBACK_SOLVED,false));if(q.mode==client.data.QuestionModeConstants.feedbackSolved||q.mode==client.data.QuestionModeConstants.annotation)B.push(J(client.data.QuestionModeConstants.feedback,
lang.CONVERT_FEEDBACK_FORCE,false));if(B.length>0){u=$(document.createElement("div")).addClass("workflow").appendTo(A);$(document.createElement("h3")).text(lang.WORKFLOW_OPTIONS).appendTo(u);var I=utility.createToolbar(true).appendTo(u);J(undefined,lang.MARK_NONE,true).appendTo(I);B.each(function(){this.appendTo(I)});$(document.createElement("div")).addClass("clear").appendTo(I)}}A.closeHandler=function(){delete arguments.callee.question.changes};A.closeHandler.question=q;return A};this.save=function(q,
H){var A=q.changes.editor,B=q.changes,J;if(A&&A.questionEditor!==undefined){if(J=i(A.questionEditor)){if(q.body!=J){if(J.length>config.MAX_TEXT_SIZE){alert(lang.QUESTION_TOO_LONG);return false}B.question.question=J}}else if(q.needsQuestion())if(q.mode!=client.data.QuestionModeConstants.relatedQuestion){alert(f(q.mode,true));return false}else B.question.question=null;if(!B.question.id)B.question.mode=q.mode}if(A&&A.answerEditor!==undefined)if(J=i(A.answerEditor)){if(J.length>config.MAX_TEXT_SIZE){alert(lang.ANSWER_TOO_LONG);
return false}B.answers.push({answer:J})}delete B.editor;delete q.changes;for(var u in B)if(B[u]instanceof Array&&B[u].length==0)B[u]=undefined;l.page.server.update({Question:B},H?H:utility.createCallback(l,o),{data:B,question:q});return true}};client.pageplugins.Question.prototype=new client.PagePlugin;
client.pageplugins.Check=function(){function a(j,o){j.error||!o.loaded?alert(lang.COULD_NOT_LOAD_CHECK+": "+j.error):m.createEditor(this,true)}function b(j){m.confirm(j.data.check,j.data.checkStatus,utility.createCallback(m,d))}function d(j,o){if(j.success){o.check.changes.changeCallback!==undefined&&o.check.changes.changeCallback(o.check);m.fillTable(o.check)}}function c(j){j.error&&alert(lang.COULD_NOT_SAVE_CHECK)}function h(j){j.error&&alert(lang.COULD_NOT_SAVE_CHECK)}client.PagePlugin.call(this);
var m;this.load=function(){m=this};this.onPluginLoad=function(){};this.createEditor=function(j,o){var i,f=j.check,k=j.topic;if(o){i=f.changes.editor;if(!f.loaded&&f.id){alert(lang.COULD_NOT_LOAD_CHECK);return}}else{i=$(document.createElement("div")).addClass("editor check share-bar");f.changes={editor:i,changeCallback:j.changeCallback};var g=new Date;if((!f.loaded||g.getTime()-f.lastRefresh.getTime()>6E3)&&f.id){m.page.server.load({Check:{checks:[f],fromTime:f.modified}},utility.createCallback(j,
a),f);return i}}if(f.id){i.checkTable=new client.widgets.TreeView2({container:i,headers:[new client.widgets.TreeViewHeader({title:lang.USER,sortable:true,sortKey:0}),new client.widgets.TreeViewHeader({title:lang.STATUS,sortable:true,sortKey:1})]});m.fillTable(f)}else{var l=[];k.getRights().each(function(){if(!this.user.current){var r=new client.widgets.UserThumb(this.user);r.selectOnClick=true;r.initSelect=true;l.push(r)}});if(l.length==0)$(document.createElement("p")).html(lang.CHECK_NO_SHARE_HTML).appendTo(i);
else{i.userSelectionBar=new client.widgets.ThumbnailBar({noAutoSize:true,thumbMoving:function(){return false},node:i});i.userSelectionBar.getContainer().addClass("add-bar");f="check"+(new Date).getTime();k=$(document.createElement("input")).attr({type:"checkbox",checked:"checked",id:f}).appendTo(i);$(document.createElement("label")).text(lang.SELECT_ALL).attr({"for":f}).appendTo(i);i.userSelectionBar.load({thumbs:l});k.bind($.browser.msie?"click":"change",i.userSelectionBar,function(r){var t=$(this).is(":checked");
r.data.getThumbs().each(function(){this.setSelected(t)})})}}return i};this.fillTable=function(j){var o=j.changes.editor,i=[],f=$(document.createElement("div")).addClass("name gray").text(lang.CHECK_CREATOR);i.push(new client.widgets.TextTreeViewItem({info:[j.user.name,lang.CHECK_CREATOR],items:[utility.getUserInfo(j.user),f]}));j.statusses.each(function(){var k=j.getStatusString(this),g;g=$(document.createElement("div")).addClass("name").text(k);if(this.user.current&&j.isPending(this)){var l=utility.createToolbar(true);
utility.createMenuItem(null,"ok",lang.CONFIRM).attr("title",lang.CONFIRM_TITLE).appendTo(l).bind("click",{checkStatus:this,check:j},b);g=g.add(l)}else if(!j.isPending(this)){l=utility.getChangeInfo(this.user,this.modified,true);g=g.add(l)}i.push(new client.widgets.TextTreeViewItem({info:[this.user.name,k],items:[utility.getUserInfo(this.user),g]}))});o.checkTable.unload();o.checkTable.addItems(i);o.checkTable.paginate(10,0);o.checkTable.load()};this.confirm=function(j,o,i){var f={checkStatus:{status:client.data.CheckStatusConstants.checked,
id:o.id}};if(f.status!=o.status)m.page.server.update({Check:f},i?i:utility.createCallback(m,c),{data:f,checkStatus:o,check:j})};this.save=function(j,o){var i=j.changes.editor,f=j.changes,k=false;if(i&&i.userSelectionBar!==undefined){var g=[];i.userSelectionBar.getThumbs().each(function(){this.isSelected()&&g.push(this.get().id)});if(g.length>0){f.check={userIds:g};k=true}else{alert(lang.SELECT_AT_LEAST_ONE);return false}}delete f.editor;delete j.changes;if(k)m.page.server.update({Check:f},o?o:utility.createCallback(m,
h),{data:f,check:j});return true};this.unload=function(){m=null}};client.pageplugins.Check.prototype=new client.PagePlugin;
client.pageplugins.File=function(){function a(u){u.files.length>0&&d.call(H,{})}function b(){for(var u=lang.PDF_LIST_HEADERS.clone(),w=0;w<u.length;w++)u[w]=new client.widgets.TreeViewHeader({title:u[w],sortable:true,sortKey:w});return u}function d(){var u=E.page.server.getFiles(client.data.FileTypeConstants.pdf),w=[],G,M=E.page.server.getTopics();u.each(function(){var x=this,I=$(document.createElement("div")).addClass("pdf-info gradient"),N=new client.widgets.TreeViewItem2({panel:I,loaded:false,
render:function(){if(!this.loaded){this.item.empty().addClass("hidden");$(document.createElement("td")).attr("colspan",4).append(this.panel).appendTo(this.item);this.loaded=true}}});if(x.pageCount!==undefined){var F=[];M.each(function(){var C=[];this.each(function(){this.cardType==client.data.CardTypeConstants.pdf&&this.pdf===x&&C.push(this)});C.length>0&&F.push({topic:this,cards:C})});var R=$(document.createElement("div")).css({width:240,"float":"right"}).appendTo(I);$(document.createElement("h3")).text(lang.CREATE_FROM_PDF).appendTo(R);
R=utility.createToolbar(true).appendTo(R);var n=utility.createInput(lang.PAGE_NUMBER).addClass("auto");n.bind("keypress",n,j).appendTo(R);utility.createMenuItem(null,null,lang.GO).bind("click",n,j).appendTo(R);n.pdfInfo=this;R=$(document.createElement("div")).css({"margin-right":280}).appendTo(I);if(F.length>0){$(document.createElement("h3")).text(lang.TOPICS_FEATURING_PDF).appendTo(R);R=new client.widgets.TreeView2({container:R,headers:[new client.widgets.TreeViewHeader({title:lang.PDF_TOPIC_USAGE_HEADERS[0],
sortable:true,sortKey:0}),new client.widgets.TreeViewHeader({title:lang.PDF_TOPIC_USAGE_HEADERS[1]})]});var z=[];F.each(function(){var C=utility.createLink(this.topic.title).bind("click",this.cards[0],function(ga){s.hide();D.openCard(ga.data)}),L=[];this.cards.each(function(){L.indexOf(this.page)==-1&&L.push(this.page)});L.sort();for(var U=false,Y,W=[],ea=1;ea<=x.pageCount+1;ea++){Y=L.indexOf(ea)!=-1;if(U&&!Y){ea-1==U?W.push(U.toString()):W.push(U+"-"+(ea-1));U=false}if(Y&&!U)U=ea}C=new client.widgets.TextTreeViewItem({info:[this.topic.title,
0],items:[C,W.length==0?"("+lang.NONE+")":W.join(",")]});z.push(C)});R.unload();R.addItems(z);R.paginate(config.MAX_LIST_COUNT);R.load()}else{$(document.createElement("h3")).text(lang.START_TAKING_NOTES).appendTo(R);R=utility.createToolbar(true).addClass("transparent").appendTo(R);utility.createMenuItem(null,null,lang.GO).bind("click",x,function(C){C=C.data;for(var L=[],U=1;U<=C.pageCount&&U<=20;U++)L.push(U);o(C,L)}).appendTo(R);x.user.current&&utility.createMenuItem(null,null,lang.DELETE).bind("click",
x,c).appendTo(R)}I.append($(document.createElement("div")).addClass("clear"))}else{I=$(document.createElement("div")).appendTo(I);$(document.createElement("h3")).text(lang.PDF_LOCKED_INFO);R=utility.createToolbar(true).appendTo(I);utility.createMenuItem(null,null,lang.UNLOCK_PDF).bind("click",this,m).appendTo(R);this.user.current&&utility.createMenuItem(null,null,lang.DELETE).bind("click",this,c).appendTo(R)}I=h(this);I.subItems=[N];I.showExpander=true;I.pdf=this;I.date=x.created;w.push(I);if(B&&
x===B)G=N});w.sort(function(x,I){return I.date-x.date});A.unload();A.addItems(w);A.paginate(config.MAX_LIST_COUNT);A.load();G!==undefined&&G.expand(true)}function c(u){confirm(lang.DELETE_UPLOAD_CONFIRM)&&E.page.server.del({Files:[u.data]},utility.createCallback(this,function(w){w.success?d.call(H,{}):alert(lang.COULD_NOT_DELETE_UPLOAD)}))}function h(u){var w=[u.title?u.title:u.filename,u.pageCount!==undefined?u.pageCount:-1,u.encrypted?u.pageCount===undefined?lang.YES:lang.ALREADY_GIVEN:lang.NO,
u.created],G=$(document.createElement("div")).addClass("wrap");u.title?G.html("<strong>"+u.title+"</strong> ("+u.altTitle+")"):G.text(u.filename);u=[G,$(document.createElement("span")).text(w[1]>-1?w[1]:"-"),$(document.createElement("span")).text(w[2]),utility.getChangeInfo(u.user,u.created)];u[1].addClasses=u[2].addClasses=u[3].addClasses="col-tiny middle";return new client.widgets.TextTreeViewItem({items:u,info:w,addClasses:"pdf border"})}function m(u){B=u=u.data;f(u,lang.INSERT_PDF_PASSWORD)}function j(u){if(!(u.type==
"keypress"&&u.keyCode!=13)){var w=u.data;if(w.hasClass("grey"))alert(lang.PAGE_NUM_REQUIRED);else{u=utility.parseNumRange(w.val());w=w.pdfInfo;if(v(u,w))if(w.user.current)o(w,u);else confirm(lang.COPY_FILE_FOR_INSERTION)&&E.page.server.copy({Files:{ids:[w.id]}},utility.createCallback(E,t),{range:u,file:w,callback:o})}}}function o(u,w){var G=utility.createCardsForPages(w,u),M=new client.data.Topic;M.title=lang.NOTES_ON+" "+u.title;G.each(function(){M.addCard(this)});E.page.server.updateTopic(M,M.transformStatic(),
utility.createCallback(E,i))}function i(u){if(u.success&&u.topics){s.hide();D.openTopic(u.topics[0])}else u.error==client.ServerErrors.limitCountReached?alert(lang.TOPIC_COUNT_REACHED):alert(lang.COULD_NOT_UPDATE_TOPIC)}function f(u,w){var G=prompt(w,"");G&&G.length>0&&E.page.server.authorizeFile(u,G,utility.createCallback(E,k))}function k(u,w){if(u.success)d();else u.error==client.ServerErrors.wrongPass?f(w,lang.INSERT_PDF_PASSWORD_AGAIN):alert(lang.GENERAL_PDF_AUTH_ERROR)}function g(u){u.stopPropagation();
s.showCategory(H);u=$(document.createElement("div")).addClass("dialog top").click(function(w){w.stopPropagation()});$(document.createElement("h3")).text(lang.PDF_UPLOAD).appendTo(u);E.createUploadUi().appendTo(u);$(document.body).one("click",l);l();J=u.css({top:this.offsetHeight+3,left:this.offsetLeft}).appendTo(this.parentNode);u.focusFirstEditable()}function l(){J&&J.remove();J=undefined}function r(u){var w=this;w.item.toggleClass("selected",u);u&&w.list.getItems().each(function(){if(this!==w){this.check(false);
this.item.removeClass("selected")}})}function t(u,w){if(u.error||!u.files||u.files.length!=1)alert(lang.COULD_NOT_COPY_PDF);else{for(var G=u.files[0],M=0;M<w.range.length;M++)if(w.range[M]<1||w.range[M]>G.pageCount)return false;w.callback(G,w.range)}}function v(u,w){if(u.length>0){var G=false;u.each(function(){if(this>w.pageCount||this<1){alert(lang.NUMBER_OUT_OF_RANGE);G=true;return false}});return!G}else{alert(lang.PAGE_NUM_REQUIRED);return false}}client.PagePlugin.call(this);var E;this.load=function(){E=
this;E.page.server.getCurrentUser();var u=$(document.createElement("div"));A=new client.widgets.TreeView2({container:u,headers:b()});H=new client.pageplugins.OverviewCategory({title:lang.PDF_FILES,icon:"",type:"static",container:u,buttons:[utility.createMenuItem(null,"upload",lang.UPLOAD_PDF,g).addClass("permanent")],updateList:d});q=[H];this.page.server.registerSyncHandler("files",a)};var s,D;this.onPluginLoad=function(u){if(u instanceof client.pageplugins.MainView)D=u;if(u instanceof client.pageplugins.Overview)s=
u};this.unload=function(){this.page.server.unregisterSyncHandler("files",a);E=null};var q,H;this.getCategories=function(){return q.clone()};var A,B;this.createUploadUi=function(){var u="upload"+(new Date).getTime(),w=$(document.createElement("div"));$(document.createElement("h3")).text(lang.PDF_UPLOAD_HEADING).appendTo(w);$('<iframe name="'+u+'"></iframe>').css("display","none").attr({id:u}).appendTo(w);u=$('<form name="pdfform" method="post" enctype="multipart/form-data"></form>').attr({action:config.uploadPath,
target:u}).appendTo(w);var G;G=utility.createToolbar(true).appendTo(u);$(document.createElement("span")).text(lang.CHOOSE_PDF).appendTo(G);$('<input type="hidden" name="action" value="pdfUpload">').appendTo(u);if(config.customArgs)for(var M in config.customArgs)u.append($('<input type="hidden" name="'+M+'" value="'+config.customArgs[M]+'">'));$('<input accept="application/pdf" type="file" class="file auto" name="file">').attr("size","10").appendTo(G);M=utility.createMenuItem(null,"ok",lang.UPLOAD_BUTTON,
null).appendTo(G);var x=$(document.createElement("div")).addClass("icon-loader pdf").appendTo(G);M.bind("click",u,function(I){x.toggleClass("show",true);I.data.submit()});utility.globalCallback=function(I,N){x.toggleClass("show",false);if(I){l();B=I;E.page.server.loadFiles(utility.createCallback())}else alert(utility.getMessageForUploadError(N))};return w};var J;this.createInsertUi=function(u){function w(x){if(!(x.type=="keypress"&&x.keyCode!=13)){x=x.data;var I=x.field;if(I.hasClass("grey"))alert(lang.PAGE_NUM_REQUIRED);
else{var N;x.items.each(function(){if(this.check()){N=this.pdfInfo;return false}});if(N!==undefined)if(N.encrypted==true&&N.pageCount===undefined){password=prompt(lang.AUTHORIZE_PDF_IMPORT,"");E.page.server.authorizeFile(N,password,utility.createCallback(E,k))}else{I=utility.parseNumRange(I.val());if(v(I,N))if(!N.encrypted&&!N.user.current&&(!x.allowedFiles||x.allowedFiles.indexOf(N)==-1))confirm(lang.COPY_FILE_FOR_INSERTION)&&E.page.server.copy({Files:{ids:[N.id]}},utility.createCallback(E,t),{range:I,
file:N,callback:x.okHandler});else x.okHandler(N,I)}else alert(lang.NO_PDF_SELECTED)}}}var G=$(document.createElement("div")).appendTo(u.container);$(document.createElement("h1")).text(lang.PDF_UPLOAD).appendTo(G);u.allowUpload&&E.createUploadUi().appendTo(G);$(document.createElement("h3")).text(lang.CHOOSE_PDF).appendTo(G);var M=$(document.createElement("div")).appendTo(G);M.addClass("file-list");G.list=new client.widgets.TreeView2({headers:b(),container:M});G.allowedFiles=u.allowedFiles;G.chooser=
$(document.createElement("div")).addClass("pad").appendTo(G);$(document.createElement("h3")).text(lang.IMPORT_PDF_PAGE).appendTo(G.chooser);M=utility.createToolbar(true).appendTo(G.chooser);G.field=utility.createInput(lang.PAGE_NUMBER).addClass("large");G.field.bind("keypress",G,w).appendTo(M);utility.createMenuItem(null,null,lang.GO).bind("click",G,w).appendTo(M);G.updateList=function(){var x=[];E.page.server.getFiles(client.data.FileTypeConstants.pdf).each(function(){var I=h(this);I.onCheck=r;I.showCheck=
true;I.list=G.list;I.pdfInfo=this;I.date=this.created;x.push(I)});x.sort(function(I,N){return N.date-I.date});this.list.unload();this.list.addItems(x);this.list.paginate(config.MAX_LIST_COUNT);this.list.load();x.length>0?this.chooser.fadeIn():this.chooser.hide();this.items=x};G.updateSyncHandler=function(){G.updateList()};E.page.server.registerSyncHandler("files",G.updateSyncHandler);G.destroy=function(){E.page.server.unregisterSyncHandler("files",G.updateSyncHandler);delete this.updateSyncHandler};
G.updateList();G.okHandler=u.okHandler;return G}};client.pageplugins.File.prototype=new client.PagePlugin;
client.pageplugins.NoteDisplay=function(a){function b(e){if(!(!Ua||gb))if(e.markers!==undefined){var p=X.getMarkers();Ya.each(function(){p.remove(this)});ma.clone().each(function(){var y=p.indexOf(this)==-1;if(!this.hasChanged&&!y)this.restore();else if((this.id||!this.hasChanged)&&y){if(Ka===this){alert(lang.CURRENT_MARKER_REMOVED);n();q()}ma.remove(this);N(this)}p.remove(this)});p.each(function(){g(this)})}}function d(e){e.contents.each(function(){if(this===X&&Ua)this.checkedOut||f(true)})}function c(){Z=
$(document.createElement("div")).addClass("title-box").prependTo(a.header);if(a.pen)yb=a.pen.bind("click",ya).attr("accesskey","h").bind("contextmenu",ya);oa=$(document.createElement("div")).addClass("mainContainer").appendTo(a.container);za=$(document.createElement("div")).addClass("markerBar").appendTo(oa);ob=$(document.createElement("div")).addClass("coreWrapper").appendTo(oa);ob.click(function(e){e.stopPropagation()});nb=utility.createLink();if(!a.trainingMode){nb.appendTo(a.desktop).addClass("size-mark");
nb.click(function(){var e=$(document.createElement("div")).html($(lang.TOO_MUCH_CONTENT)),p=$(document.createElement("img")).attr("src",config.imagePath+"sheet-add.png").addClass("like-button");$("p.add-hint",e).before(p);jQuery.showBalloon($(this),e,jQuery.balloon.BalloonPositionConstants.centerRight)})}Q=new client.widgets.Editor({node:ob});qb=$(document.createElement("div")).addClass("coreWrapperPng").appendTo(oa);Ca=new client.widgets.PngEditor({node:qb,mainClickHandler:fa,imageSizeChanged:wa,
drawFinishedHandler:function(){if($a!==undefined){J($a);K();$a=undefined}else a.pen&&a.pen.addClass("active")}});a.trainingMode||Q.setupToolbar({node:a.toolbar,additionalHandlers:{8:h}})}function h(){ma.each(function(){this.adjustClass();x();Ka&&Ka.range.addClass("focus")})}function m(e){if(Q.body!=null&&pa){$.browser.mozilla&&utility.mozilla.removeEnterKeyHandler(Q.document);Ha(false)}pa=e;if(Va){Va.remove();Va=null}if(X.topic.isEditable()&&!a.trainingMode){Va=$.createEditableLabel();Va.bind("beforeedit",
function(p,y){pa&&a.beginEdit();Cb=true;y.maxlength=60}).bind("afteredit",function(p,y){Cb=false;if(X){if(y.oldText!=y.text){Xa.title=y.text;Ia.updateTitle();Oa=true}if(X.isHtml()){Q.focus();Pa?Pa.selectNodes():k()}y.focus=false}});Va.attr("accesskey","t")}else Va=$(document.createElement("span"));Va.addClass("title").appendTo(Z);if(a.toolbar){a.toolbar.children().not(".always").toggle(pa);a.toolbar.children().filter(".pdf").toggle(X.isPdf())}if(Q.document==null)Q.load({loadHandler:j,isEditor:pa});
else Q.changeMode(pa)&&j()}function j(){Aa.body=Q.body;Aa.document=Q.document;Aa.window=Q.window;Aa.server=Ia.page.server;Aa.triggerChange=function(){if(pa){contentChanged=true;a.beginEdit()}Oa=true};Aa.displayTool=D;Aa.getTopics=H;Aa.getCard=A;Aa.openCard=B;Aa.addMarker=G;Aa.selectMarker=R;Aa.getMarkers=M;Aa.removeMarker=I;Aa.getMarkerBar=W;Aa.getMarkerBarOffset=ea;Aa.getCurrentUser=o;Aa.getPlugins=i;if(pa){Q.body.removeClass("study-tool");$.browser.mozilla&&utility.mozilla.setupEnterKeyHandler(Q.document,
s);Ha(true)}else Q.body.addClass("study-tool");f(rb)}function o(){return Ia.page.server.getCurrentUser()}function i(){return Ia.page.getLoadedPlugins()}function f(e){if(e)ma.each(function(){if(!this.rangeStore)this.rangeStore=this.range.toRangeString()});else Xa={};gb=true;sb=Qa=false;Pa=null;if(X.isHtml()){qb.hide();ob.show();Q.load();a.trainingMode||nb.fadeIn();if(X.content)Q.body.html(X.content);else if(pa){Q.body.contents().remove();dummyText=lang.CLICK_TO_ENTER;Pa=$(Q.document.createElement("p")).appendTo(Q.body);
Pa.text(dummyText);Qa=true;$(Q.document).one("click",E);$($.browser.msie?Q.body:Q.document).one("dragenter",E)}else Q.body.html("<p>"+lang.CARD_EMPTY+"</p>")}else if(X.cardType==client.data.CardTypeConstants.pdf){ob.hide();nb.hide();qb.show();Ca.unload();Ca.load({url:config.viewPath+"&id="+X.pdf.id+"&page="+X.page,areas:[]});Ca.setDrawingMode(!a.trainingMode&&Za)}a.pen&&a.pen.removeClass("active");if(Aa.isEditor=pa){Na=$("[id]",Q.body);X.edited=true}eb=[];Ya=[];var p=e?ma:X.getMarkers();ma=[];for(var y=
0;y<p.length;y++){var P=p[y];a.trainingMode&&P!==Ta||g(P,e)}if(X.isHtml())for(y=0;y<T.length;y++){p=T[y];p.displayInterface=Aa;p.load()}gb=false;if(ma.length>0){y=$("img",Q.body);Ab=y.length;y.one("load",aa)}contentChanged=false;Oa=e==true&&Oa||Ya.length>0;if(X.isHtml()){if(pa){Q.body.bind("beginchange",Ga);a.pen&&Q.body.bind("change",ka);Q.body.bind("afterdrop",va);Q.body.bind("endchange",na)}$(Q.window).bind("resize",Da);$(Q.body).bind("mouseup",l);$(Q.body).bind("click",fa);ua(true)}$(document).bind("click",
t);$(document).bind("keypress",v).bind("keydown",v);Eb=0;Ua=true;Ia.updateTitle();if(Qa&&pa){Va.triggerHandler("click");zb=false}if(zb){zb=false;X.isHtml()&&Q.focus()}if(X.content||X.pdf){x();if(X.isHtml()&&pa){if(kb===undefined||kb.card!==X||!jQuery.restoreSelection(kb,{context:document}))k();kb=undefined}}rb=false}function k(){for(var e=Q.body,p;(e=e.contents(":last")).length>0&&e[0].nodeType==1;)p=e;if(p!==undefined){p.contents(":last");p.selectNodes({collapse:p.is("br")})}}function g(e,p){if(X.isHtml()){e.range=
$.fromRangeString(e.rangeStore,Q.body.get(0));if(e.range!=null&&e.range.containsVisibleElements()){e.range=$("*",e.range.parent()).filter(function(){return e.range.index(this)!=-1});eb.remove(e)||hb.remove(e);G(e,p)}else F(e,true)}else if(X.cardType==client.data.CardTypeConstants.pdf)if(e.rangeStore!=""){var y=JSON.parse(e.rangeStore);delete e.range;var P=[];y.each(function(){var V=Ca.addArea({l:this.l,t:this.t,b:this.b,r:this.r});P.push(V);V.tag=e;e.range=e.range?e.range.add(V.div):V.div});if(e.range!==
undefined&&(!a.trainingMode||Ba)){e.range.bind("click",e,u);e.range.areas=P}eb.remove(e)||hb.remove(e);G(e,p)}else{Ya.push(e);F(e)}}function l(e){if($a!==undefined&&$.buttonCode(e.button)==0){if($.hasSelection(Q.body)){if(!pa&&X.isHtml()){var p=$.getSelection({parent:Q.body,disableSurrounding:true,returnNullIfCollapsed:true});p&&p.selectNodes()}e.stopPropagation();J($a)}r()}}function r(){if($a!==undefined){Q.body.removeClass("highlight-cursor");a.pen&&a.pen.removeClass("active");K();$a=undefined}}
function t(e){if($.buttonCode(e.button)==0){Fa();r();Ca.setDrawingMode(false)}}function v(e){var p=!e.shiftKey&&!e.altKey&&e.metaKey;if((e.type=="keypress"&&e.which==115||e.type=="keydown"&&e.which==83)&&p){e.preventDefault();mb.saveCard()}}function E(){if(Pa){try{Pa.text("");Pa.append("<br/>").children().selectNodes()}catch(e){}Pa=null}}function s(e,p){Na.replaceElement(e,p);for(var y=0;y<ma.length;y++)ma[y].range.replaceElement(e,p);Q.body.triggerHandler("change",{})}function D(e){if(La||e===undefined)q();
if(e!==undefined){if(e.coords!==undefined){La=$(document.createElement("div")).addClass("tool-window").css(e.coords);e.showCloser&&utility.createLink().addClass("close-button").appendTo(La).click(q);La.append(e.content.children()).appendTo(oa).click(function(y){y.stopPropagation()})}else La=utility.requestFloat(a.superContainer,true).append(e.content.children()).animate({top:0});if(e.handler!==undefined)La.closeHandler=e.handler;La.closeOnClick=e.clickCloses;var p;e.noFocus||(p=function(){$(this).focusFirstEditable()});
e.coords!==undefined&&La.hide().fadeIn("normal",p);return La}}function q(){if(La){if(Ka&&Ka.hasChanged)Oa=true;if(La.closeHandler!==undefined){La.closeHandler.call();delete La.closeHandler}La.fadeOut("normal",function(){$(this).remove()})}La=null}function H(){return Ia.page.server.getTopics()}function A(){return X}function B(e){mb.openCard(e,e.topic.isEditable())}function J(e){var p={};p.cancel=false;e.loading(p);if(!p.cancel){p=eb.remove(e)||hb.remove(e);var y;if(X.isHtml()){if(y=$.getSelection({parent:Q.body,
disableSurrounding:!pa,returnNullIfCollapsed:true}))y=y.not("br")}else if(X.cardType==client.data.CardTypeConstants.pdf&&Ca.hasLastArea()){var P=Ca.addArea(Ca.getLastArea());P.tag=e;y=P.div;y.areas=[P];P.div.bind("click",e,u);Ca.setDrawingMode(Za)}if(y&&y.length>0){X.isHtml()&&$.clearSelection(Q.document);e.range=y;e.isMine=true;e.user=Ia.page.server.getCurrentUser();G(e);p||R(e);Oa=true}else if(pa)alert(lang.SEL_REQUIRED_HIGHLIGHT);else{y&&X.isHtml()&&$.clearSelection(Q.document);z(e,"marker")}}}
function u(e){e.stopPropagation();R(e.data)}function w(e){e.stopPropagation();if(Ka){F(Ka);I(Ka);Oa=true}else alert(lang.NO_MARKER_FOR_DEL)}function G(e,p){e.displayInterface=Aa;ma.push(e);e.card=X;if(!e.id){e.hasChanged=true;e instanceof client.markers.QuestionMarker&&sa&&pa&&X.topic.isSharable()&&sa.showHelp(a.container,lang.INTRO_SHARE_TITLE,lang.INTRO_SHARE_HTML,4)}if(!pa||Ja)e.adjustClass();p||e.load();if(e.startMarker){var y=e.startMarker;if(Ta===e){y=e.startMarker;if(a.trainingMode&&!Ba)y=
y.clone(false);e.trainMarker=y.addClass("emphasize");Ia.scrollIntoView(e)}y.appendTo(za).disableContextMenu()}e.endMarker&&!a.trainingMode&&e.endMarker.appendTo(za);x();e.id||la()}function M(){return ma.clone()}function x(){if(!(gb||!ma)){var e=function(ja,Ra,ib){var jb;do{jb=false;for(var Hb=0;Hb<Ra.length;Hb++){var Sa=Ra[Hb],xb;if(xb=Sa){xb={left:Sa.left>=ja.left&&Sa.left<=ja.right,right:Sa.right>=ja.left&&Sa.right<=ja.right,top:Sa.top>=ja.top&&Sa.top<=ja.bottom,bottom:Sa.bottom>=ja.top&&Sa.bottom<=
ja.bottom,embedded:ja.left>=Sa.left&&ja.left<=Sa.right&&ja.top>=Sa.top&&ja.top<=Sa.bottom};xb=(xb.left||xb.right)&&(xb.top||xb.bottom)||xb.embedded}if(xb){jb=Sa.right-ja.left+1;Sa=Sa.bottom-ja.top+1;if(ja.right+jb>ib||Sa<jb){ja.top+=Sa;ja.bottom+=Sa;ja.right-=ja.left;ja.left=0}else{ja.right+=jb;ja.left+=jb}jb=true}}}while(jb)};if(pa){if(Ma!==undefined)Ma.range=Q.body.children();for(var p=0;p<ma.length;p++){var y=ma[p];if(!y.range||!y.range.containsVisibleElements()){F(y);gb=true;I(y);gb=false;p--}}var P=
$(".marker",Q.body);for(p=0;p<ma.length;p++){y=ma[p];P=P.not(y.range.get())}P.removeMarkerClass()}if(ma.length!=0){P=[];for(p=0;p<ma.length;p++){y=ma[p];var V={};V.handled=false;y.update(V);if(!V.handled){V=a.trainingMode?y.trainMarker:y.startMarker;var ba=y.getModInfo();if(ba.modified>fb){y.changeDiv&&y.changeDiv.remove();ba=utility.getChangeInfo(ba.modifier,ba.modified,true);y.changeDiv=ba.appendTo(za)}var da=null;ba=null;if(V&&(pa||y.range.containsVisibleElements())){da=y.range.getFirstAndLast();
var ta=V.get(0);da=da.first;if(X.isHtml())ba=utility.getRelativePosition(da,Q.body[0]);else if(X.cardType==client.data.CardTypeConstants.pdf)ba={top:da.offsetTop,left:da.offsetLeft};da=null;da={left:0,top:ba.top,right:ta.offsetWidth+(y.changeDiv?70:0),bottom:ba.top+ta.offsetHeight};e(da,P,70);P.push(da);V.css({top:da.top,left:da.left+6});y.changeDiv&&y.changeDiv.css({top:da.top,left:da.left+6+16});y===Ka&&ub&&ub.css("top",da.top)}}}}}}function I(e){if(Ka==e){gb=true;n();gb=false}if(ma.indexOf(e)>
-1){Oa=true;Ya.push(e);ma.remove(e);N(e);la()}x()}function N(e,p){var y=a.trainingMode?e.trainMarker:e.startMarker;delete e.trainMarker;if(e.changeDiv){y=y.add(e.changeDiv);delete e.changeDiv}var P=e.endMarker;e.unload();a.trainingMode||e.restore();if(X.isHtml()&&(!pa||Ja)){var V=e.range;if(!p)for(var ba=0;ba<ma.length;ba++)V=V.not(ma[ba].range.get());V.removeMarkerClass()}else X.cardType==client.data.CardTypeConstants.pdf&&e.range.areas.each(function(){Ca.removeArea(this)});e.range=null;e.displayInterface=
null;if(y){y.remove();y.hasClass("emphasize")&&y.removeClass("emphasize")}P&&P.remove()}function F(e,p){if(e.trashable())(p?eb:hb).push(e.clone())}function R(e){if(Ka!=e){n();if(e){e.range.addClass("focus");Ka=e;e.selected=true;if(e.startMarker&&e.startMarker.is("a")){e.startMarker.addClass("selected");e.startMarker[0].focus()}e.onSelect();var p=Ia.page.server.getCurrentUser();if(!a.trainingMode&&(X.topic.isEditable()||e.user==p)&&e.startMarker&&e.startMarker.parent().length>0){ub=utility.createButton(e.trashable()?
"bin-small.png":"delete-small.png",null,e.trashable()?lang.MOVE_TO_TRASH:lang.REMOVE_THIS,w);ub.css({top:e.startMarker.get(0).offsetTop,left:74,width:16,height:16}).appendTo(za)}}}}function n(){if(Ka){Ka.startMarker&&Ka.startMarker.is("a")&&Ka.startMarker.removeClass("selected");Ka.range.removeClass("focus");if(ub){ub.remove();ub=null}var e=Ka;delete Ka.selected;Ka=null;e.onDeselect();if(e.hasChanged)Oa=true;x()}}function z(e,p){var y=$(this);db=null;Gb=p;wb=$("*",Q.body);wb.bind("mouseover",C).bind("mouseout",
L).bind("click",e,U);currentTool=y}function C(){db||(db=$(this).addClass("pointer highlight"))}function L(){if(db){db.removeClass("pointer highlight");db=null}}function U(e){if(Gb=="marker"){e.stopPropagation();e.preventDefault();e=e.data;e.range=$(this);Y();e.isMine=true;e.user=Ia.page.server.getCurrentUser();G(e);R(e);Oa=true}}function Y(){L();if(wb){wb.unbind("click",U).unbind("mouseover",C).unbind("mouseout",L);wb=null}db=Gb=null}function W(){return za}function ea(e){return utility.getRelativeOffset(e,
za[0])}function ga(e){e.stopPropagation();var p=e.data.fc;delete e.data;p.call(this,e);S()}function fa(e){if(e===undefined||$.buttonCode(e.button)==0){if(X.isHtml())for(e=0;e<T.length;e++)T[e].onMainClick();$a===undefined&&S();a.mainClickHandler!==undefined&&a.mainClickHandler.call(Ia);La&&La.closeOnClick&&q()}}function aa(){Ab--;if(Ab<=0){ua();x()}}function Fa(){n();S();Y();q()}function Da(){x();a.sizeHandler!==undefined&&a.sizeHandler({width:a.desktop.width()})}function Ga(){if(Ua){Pa&&E();Oa=contentChanged=
true;a.beginEdit();x();window.clearTimeout(lb);lb=undefined;O()}}function O(){if(!sb&&Qa&&!Ma&&config.reference!==undefined&&(config.reference.auto||config.reference.link)&&client.markers.ReferenceMarker!==undefined){sb=true;var e=false;ma.each(function(){if(this.tool=="reference")e=true});if(!e){var p;if(config.reference.auto===true){if(window.parent.mbGetUrl!==undefined&&window.parent.mbGetTitle!==undefined){var y=window.parent.mbGetUrl(),P=window.parent.mbGetTitle();if(P===undefined)P=y;if(y!==
undefined)p=new client.data.Link({title:P,link:y})}}else p=new client.data.Link({title:config.reference.title,url:config.reference.link,type:client.data.LinkTypeConstants.platform});p!==undefined&&Ia.page.server.update({Link:{links:[{title:p.title,url:p.url,type:p.typeNum}]}},utility.createCallback(Ia,function(V,ba){if(V.success&&X===ba){Ma=new client.markers.ReferenceMarker;Ma.hasChanged=true;Ma.range=Q.body.children();var da=new client.data.Relation;da.object=V.links[0];Ma.relationsStore=[da];Ma.sharedStore=
true;Ma.restore();delete Ma.relationsStore;delete Ma.sharedStore;G(Ma);Oa=true;sb=Qa=false}}),X)}}}function ka(){if(Ua){for(var e=0;e<T.length;e++)T[e].onChange();x();e=$.hasSelection(Q.body);a.pen&&a.pen.toggleClass("active",e&&Q.isFocussed());ua();sa&&Eb>=3&&sa.showHelp(a.container,lang.INTRO_HIGHLIGHT_TITLE,lang.INTRO_HIGHLIGHT_HTML,3);Eb++}}function na(){la()}function va(){Ea();Q.clearFormatting(utility.ClearFormattingConstants.cleanServer|utility.ClearFormattingConstants.cleanMarker|utility.ClearFormattingConstants.removeNoAttrSpan,
Q.body)}function Ea(){function e(){if(p.length>0)if(p.length==1&&p[0].nodeType==3&&jQuery.trim(p[0].nodeValue).length==0)$(p[0]).remove();else{var P=$(Q.document.createElement("p"));P.insertBefore(p[0]);P.append(p)}}var p=[],y=["p","h1","h2","h3","h4","h5","h6","pre","br","ul","ol","table"];Q.body.contents().each(function(){if(this.nodeType==1){var P=this.tagName.toLowerCase();if(y.indexOf(P)>-1){if(p.length>0){e();p=[]}P=="br"&&$(this).remove()}else p.push(this)}else this.nodeType==3&&p.push(this)});
e()}function ua(e){var p=new Date;if(!ca||ca<p.getTime()-vb){ca=p.getTime();p=Q.body[0].scrollHeight;if($.browser.msie)p=Q.body[0].scrollHeight;p=Math.max(p,376);var y={};if(tb!=p||e){y.height=p+18;tb=p}if(e)y.width="auto";if(y.width||y.height)xa(y)}else{window.clearTimeout(Fb);Fb=window.setTimeout(ua,vb+1)}}function wa(e,p){qb.css("height",p);xa({width:e+176,height:p+18})}function xa(e){pb=e;a.desktop.css(e);if(a.sizeHandler!==undefined){e.width=a.desktop.width();a.sizeHandler(e)}}function Ha(e){if(!$.browser.msie)window.onbeforeunload=
e?ab:null}function ab(e){if(Oa){if(e)e.returnValue=lang.CONFIRM_CLOSE;return lang.CONFIRM_CLOSE}}function ya(e){e.stopPropagation();e.preventDefault();if(X){var p=X.isHtml()&&pa,y=!Pa;p&&a.beginEdit();if(p&&Pa){E();Q.focus()}S();e=$(document.createElement("div")).addClass("overlay marker").hide().appendTo(a.superContainer);$(document.createElement("h2")).text(lang.INSERT_MARKER).appendTo(e);var P=$(document.createElement("div")).addClass("row").appendTo(e);if(p){var V=$(document.createElement("div")).addClass("plugins menu").toggleClass("column",
p&&y).appendTo(P);$(document.createElement("h3")).text(lang.INSERT_PLUGIN_HEADING).appendTo(V);T.each(function(){this.loadMenuCreation(function(ta,ja,Ra,ib){if(ta=="-")return utility.createMenuItemSeparator().appendTo(V);else{ja=utility.createMenuItem(ja,"","",ga,{fc:Ra});if(ib){$(document.createElement("strong")).text(ta).appendTo(ja);$(document.createElement("span")).text(ib).appendTo(ja);ja.addClass("desc")}else ja.text(ta);ja.appendTo(V);return ja}})})}if(y){if(!pa&&X.isHtml()){var ba=$.getSelection({parent:Q.body,
disableSurrounding:true,returnNullIfCollapsed:true});ba&&ba.selectNodes()}var da=$(document.createElement("div")).addClass("markers menu").toggleClass("column",p&&y).appendTo(P);$(document.createElement("h3")).text(lang.INSERT_MARKER_HEADING).appendTo(da);Db.each(function(){this.createMenuItems&&this.createMenuItems(function(ta,ja,Ra,ib){if(ta=="-")return utility.createMenuItemSeparator().appendTo(da);else{ja=utility.createMenuItem(ja,"","",qa);if(ib){$(document.createElement("strong")).text(ta).appendTo(ja);
$(document.createElement("span")).text(ib).appendTo(ja);ja.addClass("desc")}else ja.text(ta);ja.tag=Ra;ja.appendTo(da);return ja}})});p=function(ta,ja){if(ta.length>0){$(document.createElement("h3")).text(ja).appendTo(da);ta.each(function(){this.displayInterface=Aa;var Ra=this.createTrashMenuItem();this.displayInterface=null;if(Ra){Ra=utility.createMenuItem(Ra.icon,"",Ra.label,qa);Ra.tag=this;Ra.appendTo(da)}})}};p(hb,lang.INSERT_CLIPBOARD_HEADING);p(eb,lang.INSERT_LOST_HEADING)}p=-1;if(y=$("div.header-bar:first",
a.superContainer).get(0))p=a.superContainer.width()-y.offsetLeft-y.offsetWidth+27;e.css({top:a.superContainer.height()-2,right:Math.max(p,-1)});Bb=$(this).addClass("active");cb=e.fadeIn()}}function qa(e){e.stopPropagation();var p=e.data;e=p.tag;delete p.tag;p=X.isHtml()&&$.hasSelection(Q.body)||X.cardType==client.data.CardTypeConstants.pdf&&Ca.hasLastArea();S();if(p)J(e);else{if(X.isHtml()&&!$.browser.msie)Q.body.addClass("highlight-cursor");else X.cardType==client.data.CardTypeConstants.pdf&&Ca.setDrawingMode(true);
a.pen.toggleClass("active",true);K();bb=$.showBalloon(a.pen,lang.HIGHLIGHTER_EXPLANATION,jQuery.balloon.BalloonPositionConstants.topMiddle,undefined,Wa,"highlighterclick",void 0);$a=e}}function K(){if(bb){bb.remove();bb=null}}function S(){if(Bb){Bb.removeClass("active");Bb=undefined}if(cb){cb.remove();cb=null}}function ha(e){if(Ua){Ua=false;if(X.isHtml())for(var p=0;p<T.length;p++){var y=T[p];y.displayInterface&&y.unload();y.displayInterface=null}window.clearTimeout(lb);lb=undefined;if(Pa){Pa.remove();
$(Q.document).unbind("click",E)}Fa();x();Ma=undefined;if(X.isHtml()){if(pa){Q.body.unbind("beginchange",Ga);a.pen&&Q.body.unbind("change",ka);Q.body.unbind("afterdrop",va);Q.body.unbind("endchange",na)}$(Q.window).bind("resize",Da);$(Q.body).bind("mouseup",l);$(Q.body).bind("click",fa)}$(document).unbind("click",t);$(document).unbind("keypress",v).unbind("keydown",v);e!==true&&ia();if(X.isHtml()&&pa){kb=jQuery.storeSelection({context:Q.document});if(kb!==undefined)kb.card=X;Na=null}X.isHtml()&&Q.unload();
ma.each(function(){N(this,true)});Va&&Va.cancelEdit&&Va.cancelEdit();X=ma=Ta=Ya=eb=null}}function ia(){window.clearTimeout(lb);lb=undefined;if(X.isHtml()&&pa){Q.fixListNesting();Ea();Q.clearFormatting(utility.ClearFormattingConstants.cleanServer|utility.ClearFormattingConstants.removeNoAttrSpan|utility.ClearFormattingConstants.removeEmptySpan|utility.ClearFormattingConstants.cleanMarker,Q.body);var e=Na.get();$("*:not(br)",Q.body).each(function(){if(this.nodeType==1&&(this.getAttribute("id")==null||
this.getAttribute("id")==""||e.indexOf(this)==-1))this.setAttribute("id",utility.getFreeName(this.ownerDocument))})}Xa.markers=[];for(var p=0;p<ma.length;p++){var y=ma[p];Oa=Oa||y.hasChanged;if(y.hasChanged||!y.id){var P=y.transformStatic();Xa.markers.push(P);y.id||delete y.card}y.hasChanged=false}Xa.markers.length==0&&delete Xa.markers;Xa.deletedMarkerIds=[];X.getMarkers().each(function(){var V=this,ba=false;ma.each(function(){if(this===V){ba=true;return false}});ba||Xa.deletedMarkerIds.push(this.id)});
Xa.deletedMarkerIds.length==0&&delete Xa.deletedMarkerIds;if(X.isHtml()&&pa&&contentChanged){n();if($("*",Q.body).filter(":not(br):not(p)").length==0&&Q.body.text()==""){Xa.content=null;X.edited=false}else{p=$.browser.msie?Q.body:Q.body.clone(false);$(".marker",p).removeMarkerClass();Xa.content=p.html();$.browser.msie&&ma.each(function(){this.adjustClass()})}Na=$("[id]",Q.body)}}function la(){var e=!Ua||cb!=null||Cb||Pa||$a||X.type==client.data.CardTypeConstants.html&&$.hasSelection(Q.body);e||ma.each(function(){if(this.delaySave()){e=
true;return false}});!e&&X.isHtml()&&pa&&T.each(function(){if(this.delaySave()){e=true;return false}});if(e){window.clearTimeout(lb);lb=window.setTimeout(la,ra*1E3)}else mb.saveCard()}client.PagePlugin.call(this);var ra=1,Ja=true,Ba=true,Za=true,Wa,bb,fb,Ia,T,Db;this.load=function(){Ia=this;T=Ia.page.server.getDisplayPlugins();Db=Ia.page.server.getMarkerTypes();Aa=new client.pageplugins.NoteDisplayInterface;c();var e=this.page.server.getCurrentUser();fb=e.lastLoginStamp;e=e.settings;if(e.display===
undefined)e.display={};Wa=e.display;hb=[];client.PagePlugin.prototype.load.call(this);this.page.server.registerSyncHandler("contents",d);this.page.server.registerSyncHandler("markers",b)};var mb,sa;this.onPluginLoad=function(e){if(e instanceof client.pageplugins.MainView)mb=e;else if(e instanceof client.pageplugins.Introduction)sa=e};var pa;this.isEditor=function(){return pa};var zb,Ua;this.openCard=function(e,p){this.closeCard();p=p&&e.topic.isEditable()&&!a.trainingMode;if(e!==X)zb=true;X=e;Q.document==
null||pa!=p?m(p):f()};this.switchMode=function(e){rb=true;m(e)};this.trainCard=function(e,p){if(X!==e||p!==undefined&&Ta!==p){if(p!==undefined)Ta=p;this.openCard(e,false)}};this.closeCard=function(){Ua&&ha()};this.saveCard=function(){if(Ua){Fa();ia()}};var Q,Ca,yb,Z,Va,oa,ob,qb,nb,za,Aa,X;this.getCurrentCard=function(){if(!Ua)return null;return X};var Cb;this.updateTitle=function(){if(X&&Ua)Va.text(Xa.title||X.title)};var Pa,ma,rb,Qa,Xa,Na,La;this.revertChanges=function(){if(Ua){var e=X;ha(true);
X=e;f()}};this.scrollIntoView=function(e){var p=a.trainingMode?e.trainMarker:e.startMarker;e=p[0].offsetTop;p=p[0].offsetWidth/2;p-=a.scrollContainer.height()/2;a.scrollContainer.animate({scrollTop:e+p})};this.showMarkers=function(e){$.fn[e?"fadeIn":"fadeOut"].call(za)};this.getMarkers=M;this.getMarkerCount=function(){return ma.length};var gb;this.updateMarkers=x;var Ta;this.emphasizeMarker=function(e){Ta&&Ta!==e&&ma.indexOf(Ta)>-1&&Ta.startMarker&&Ta.startMarker.removeClass("emphasize");if(e&&ma.indexOf(e)>
-1){e.startMarker.addClass("emphasize");Ia.scrollIntoView(e)}Ta=e};var Ya,hb,eb,ub,Ka,wb,Gb,db,Ab,Ma,sb,Eb,vb=100,tb,ca,Fb,pb,Bb,cb,$a;this.checkTrainable=function(){return client.Marker.checkTrainable(ma)};var kb,Oa;this.hasChanged=function(){return Oa};var lb;this.getChanges=function(){return Xa};this.resetChanges=function(){Xa={};contentChanged=Oa=false};this.unload=function(){hb=null;K();this.closeCard();$.browser.mozilla&&utility.mozilla.removeEnterKeyHandler(Q.document);Ha(false);Q.unload();
Q.destroy();Q=null;Ca.unload();Ca=null;Aa.destroy();Aa=null;yb.removeAttr("accesskey");yb.unbind("click",ya).unbind("contextmenu",ya);oa.remove();X=content=ma=Ya=Ia=oa=yb=za=null;delete mb;delete sa;this.page.server.unregisterSyncHandler("contents",d);this.page.server.unregisterSyncHandler("markers",b);client.PagePlugin.prototype.unload.call(this)}};client.pageplugins.NoteDisplay.prototype=new client.PagePlugin;client.pageplugins.NoteDisplayInterface=function(){this.destroy()};
client.pageplugins.NoteDisplayInterface.prototype.isEditor=false;client.pageplugins.NoteDisplayInterface.prototype.body=null;client.pageplugins.NoteDisplayInterface.prototype.server=null;client.pageplugins.NoteDisplayInterface.prototype.document=null;client.pageplugins.NoteDisplayInterface.prototype.window=null;
client.pageplugins.NoteDisplayInterface.prototype.destroy=function(){this.getPlugins=this.getCurrentUser=this.getMarkerBarOffset=this.getMarkerBar=this.removeMarker=this.getMarkers=this.selectMarker=this.addMarker=this.openCard=this.getCard=this.getTopics=this.displayTool=this.triggerChange=this.server=this.window=this.document=this.body=null};client.pageplugins.NoteDisplayInterface.prototype.displayTool=function(){};client.pageplugins.NoteDisplayInterface.prototype.getCard=function(){};
client.pageplugins.NoteDisplayInterface.prototype.getTopics=function(){};client.pageplugins.NoteDisplayInterface.prototype.openCard=function(){};client.pageplugins.NoteDisplayInterface.prototype.addMarker=function(){};client.pageplugins.NoteDisplayInterface.prototype.selectMarker=function(){};client.pageplugins.NoteDisplayInterface.prototype.getMarkers=function(){};client.pageplugins.NoteDisplayInterface.prototype.removeMarker=function(){};
client.pageplugins.NoteDisplayInterface.prototype.getMarkerBar=function(){};client.pageplugins.NoteDisplayInterface.prototype.getMarkerBarOffset=function(){};client.pageplugins.NoteDisplayInterface.prototype.getCurrentUser=function(){};client.pageplugins.NoteDisplayInterface.prototype.getPlugins=function(){};client.pageplugins.NoteDisplayInterface.prototype.triggerChange=function(){};client.pageplugins.NoteDisplayPlugin=function(){this.displayInterface=null};
client.pageplugins.NoteDisplayPlugin.prototype.displayInterface=null;client.pageplugins.NoteDisplayPlugin.prototype.load=function(){};client.pageplugins.NoteDisplayPlugin.prototype.onChange=function(){};client.pageplugins.NoteDisplayPlugin.prototype.unload=function(){};client.pageplugins.NoteDisplayPlugin.prototype.onMainClick=function(){};client.pageplugins.NoteDisplayPlugin.prototype.delaySave=function(){return false};client.pageplugins.NoteDisplayPlugin.prototype.loadMenuCreation=function(){};
client.pageplugins.displayplugins.Image=function(){function a(){var q=$(g.displayInterface.document.createElement("img"));q.css({"float":"right",padding:"0 0 10px 10px",width:"auto",height:"auto"}).attr({border:"0"});if(g.displayInterface.body.insertNearSelection(q,true)===false)alert(lang.SELECT_FOR_INSERTION);else{l=true;c(q,true)}}function b(q){if(q===undefined)q=$("img:not(.equation,.tex,.texrender)",g.displayInterface.body);q.bind("click",d).bind("contextmenu",d)}function d(q){q.stopPropagation();
c($(this),false)}function c(q,H){r&&f();D=q;var A=$(document.createElement("div")),B=utility.createPanelDialog(A,{},undefined,lang.IMAGE_EDITOR),J;J="upload"+(new Date).getTime();var u,w,G,M;$(document.createElement("h3")).text(lang.IMAGE_UPLOAD_HEADING).appendTo(A);$('<iframe name="'+J+'"></iframe>').css("display","none").attr({id:J}).appendTo(A);J=$('<form name="imageform" method="post" enctype="multipart/form-data"></form>').attr({action:config.uploadPath,target:J}).appendTo(A);G=utility.createToolbar(true).addClass("pad").appendTo(J);
$(document.createElement("span")).text(lang.PICTURE).appendTo(G);$('<input type="hidden" name="action" value="imageUpload">').appendTo(J);M=g.displayInterface.getCard().topic.id;$('<input type="hidden" name="topic" value="'+M+'">').appendTo(J);if(config.customArgs)for(w in config.customArgs)J.append($('<input type="hidden" name="'+w+'" value="'+config.customArgs[w]+'">'));$('<input accept="image/gif,image/jpeg,image/pjpeg,image/png,image/x-bmp" type="file" class="file auto" name="file">').attr("size",
"10").appendTo(G);utility.createMenuItemSeparator().appendTo(G);w=utility.createMenuItem(null,"ok",lang.UPLOAD_BUTTON).appendTo(G);var x=$(document.createElement("div")).addClass("icon-loader pdf").appendTo(G);w.bind("click",J,function(F){x.toggleClass("show",true);F.data.submit()});$(document.createElement("div")).addClass("clear pad").appendTo(A);$(document.createElement("h3")).text(lang.IMAGE_LOCATION_HEADING).appendTo(A);G=utility.createToolbar(true).addClass("pad").appendTo(A);$(document.createElement("span")).text(lang.LOCATION).appendTo(G);
J=$(document.createElement("input")).attr("type","text").addClass("large").attr({size:"20"}).appendTo(G);J.val(q.attr("src"));if(H)u=utility.createMenuItem(null,null,lang.INSERT,null).appendTo(G);$(document.createElement("div")).addClass("clear").appendTo(G);$(document.createElement("h3")).text(lang.IMAGE_ADJUST_HEADING).makeCollapsible().appendTo(A);M=$(document.createElement("div")).appendTo(A);A={};G=utility.createToolbar().addClass("pad").appendTo(M);$(document.createElement("span")).text(lang.FLOAT_STYLE).appendTo(G);
A.left=utility.createButton("image-align-left.png","left",lang.FLOAT_LEFT,h).appendTo(G);A.right=utility.createButton("image-align-right.png","right",lang.FLOAT_RIGHT,h).appendTo(G);A.none=utility.createButton("image-align-none.png","none",lang.FLOAT_NONE,h).appendTo(G);w=utility.createToolbar().addClass("pad").appendTo(M).toggle(!H);$(document.createElement("span")).text(lang.WIDTH).appendTo(w);G=$(document.createElement("input")).attr("type","text").attr("size","10").appendTo(w);$(document.createElement("label")).text(lang.HEIGHT).appendTo(w);
w=$(document.createElement("input")).attr("type","text").attr("size","10").appendTo(w);var I={maxlength:"5",size:"3",type:"text"},N=utility.createToolbar().addClass("pad").appendTo(M).toggle(!H);$(document.createElement("span")).text(lang.PADDING_STYLE).appendTo(N);$(document.createElement("label")).text(lang.PADDING_LEFT).appendTo(N);v=$(document.createElement("input")).attr(I).appendTo(N);$(document.createElement("label")).text(lang.PADDING_RIGHT).appendTo(N);E=$(document.createElement("input")).attr(I).appendTo(N);
M=utility.createToolbar().addClass("pad").appendTo(M).toggle(!H);$(document.createElement("span")).text(lang.PADDING_STYLE).appendTo(M);$(document.createElement("label")).text(lang.PADDING_TOP).appendTo(M);s=$(document.createElement("input")).attr(I).appendTo(M);$(document.createElement("label")).text(lang.PADDING_BOTTOM).appendTo(M);t=$(document.createElement("input")).attr(I).appendTo(M);if(!H){M=utility.createMenuItem(null,null,H?lang.INSERT:lang.CLOSE).addClass("right").attr("accesskey","o").appendTo(B.toolbar);
M.bind("click",f);B.toolbar.append()}M=utility.createMenuItem(null,null,H?lang.CANCEL:lang.DELETE).appendTo(B.toolbar);H?u.bind("click",{img:q,box:J},function(F){F=F.data.box.val();if(F.length==0)alert(lang.NO_URL_GIVEN);else try{i();o(F);f()}catch(R){alert(lang.URL_INVALID+R)}}):J.bind("blur",{img:q,box:J},function(F){try{o(F.data.box.val())}catch(R){alert(lang.URL_INVALID+R)}});w.bind("blur",{elm:q,property:"height",def:"auto"},j).val(q.css("height"));G.bind("blur",{elm:q,property:"width",def:"auto"},
j).val(q.css("width"));v.bind("blur",{elm:q,property:"padding-left",def:"0px"},j);E.bind("blur",{elm:q,property:"padding-right",def:"0px"},j);s.bind("blur",{elm:q,property:"padding-top",def:"0px"},j);t.bind("blur",{elm:q,property:"padding-bottom",def:"0px"},j);m();switch(q.css("float").toLowerCase()){case "left":A.left.addClass("okay");break;case "right":A.right.addClass("okay");break;default:A.none.addClass("okay");break}M.bind("click",q,H?f:function(F){F=F.data;f();F.remove();g.displayInterface.triggerChange()});
g.displayInterface.displayTool({content:B,handler:k,offset:H?150:50,clickCloses:!H});utility.globalCallback=H?function(F,R){x.toggleClass("show",false);if(F){i();o(config.viewPath+"&id="+F.id);f()}else alert(utility.getMessageForUploadError(R))}:function(F,R){x.toggleClass("show",false);if(F){o(config.viewPath+"&id="+F.id);f()}else alert(utility.getMessageForUploadError(R))};r=true}function h(q){q=q.data;q.parent().children().removeClass("okay");q.addClass("okay");q=q.action;if(D.css("float")!==q){D.css("float",
q);D.css({"padding-right":q=="left"?10:0,"padding-left":q=="right"?10:0,"padding-bottom":q=="none"?0:10});m();g.displayInterface.triggerChange()}}function m(){if(D){v.val(D.css("padding-left"));E.val(D.css("padding-right"));s.val(D.css("padding-top"));t.val(D.css("padding-bottom"))}}function j(q){var H=q.data.elm,A=q.data.property;try{var B=$(this).val();if(B=="")B=q.data.def;else if(utility.isInteger(B))B+="px";H.css(A,B);$(this).val(H.css(A));g.displayInterface.triggerChange()}catch(J){alert(lang.INVALID.replace("#",
B))}}function o(q){try{D.attr("src",q)}catch(H){}g.displayInterface.triggerChange();l=false}function i(){b(D);D.selectNodes({collapse:false})}function f(){r&&g.displayInterface.displayTool()}function k(){r=false;if(D){l&&D.remove();D=null}delete utility.globalCallback}var g;this.load=function(){g=this;this.displayInterface.isEditor&&b()};this.onChange=function(){this.displayInterface.isEditor&&b()};this.loadMenuCreation=function(q){this.displayInterface.isEditor&&q(lang.INSERT_IMAGE,"insert-image.png",
a,lang.INSERT_IMAGE_TIP)};var l;this.unload=function(){g=null};var r,t,v,E,s,D;this.delaySave=function(){return r}};client.pageplugins.displayplugins.Image.prototype=new client.pageplugins.NoteDisplayPlugin;
client.pageplugins.displayplugins.Link=function(){function a(){if($.hasSelection(g.displayInterface.document)){l=g.displayInterface.body.takeSelection($(document.createElement("a")).attr("href",""));d(l);i(l)}else alert(lang.LINK_REQUIRES_SELECTION)}function b(){r&&g.displayInterface.displayTool();if(t)t=v=t=null}function d(s){var D=g.displayInterface.isEditor?m:c;s.bind("click",D);g.displayInterface.isEditor&&s.bind("contextmenu",D)}function c(s){s.stopPropagation();s.preventDefault();var D=$(this);
s=D.attr("href");if(D.hasClass("cardlink")){D=-1;if((D=s.lastIndexOf("#"))>-1)s=s.substr(D);if(s.substr(0,1)=="#"){s=s.substr(1);(s=h(parseInt(s)))&&g.displayInterface.openCard(s)}}else window.open(s,"MediabirdExternal")}function h(s){for(var D,q=g.displayInterface.getTopics(),H=0;H<q.length;H++)if(D=q[H].getCardById(s))break;return D}function m(s){s.stopPropagation();s.preventDefault();E!==this&&j(this)}function j(s){var D=utility.getRelativePosition(s,g.displayInterface.body[0]);D.top+=s.offsetHeight;
var q=$(document.createElement("div")),H=utility.createToolbar(true).appendTo(q),A=utility.createMenuItem(null,"ok",lang.FOLLOW_LINK).appendTo(H).bind("click",s,function(J){J.preventDefault();b();c.call(J.data,J)}),B=$(s).attr("href");if(o($(s))!="card")A.attr({href:B,title:lang.FOLLOW_LINK+" "+B});else(B=h(parseInt(B.substr(1))))&&A.attr({title:lang.OPEN_SHEET+" "+B.title});utility.createMenuItem(null,null,lang.EDIT_LINK).appendTo(H).bind("click",s,function(J){i($(J.data))});utility.createMenuItem(null,
null,lang.REMOVE).appendTo(H).bind("click",s,f);g.displayInterface.displayTool({content:q,coords:D,clickCloses:true,showCloser:true,noFocus:true,handler:function(){E=undefined}});E=s}function o(s){var D=s.attr("href");if(D===undefined)return"url";return s.hasClass("cardlink")?"card":D.toLowerCase().substr(0,7)=="mailto:"?"email":"url"}function i(s){t=s;var D,q,H,A=s.attr("href")||"",B=o(s);if(B=="email")A=A.substr(7);else if(B=="card"){D=-1;if((D=A.lastIndexOf("#"))>-1)A=A.substr(D)}var J=$(document.createElement("div")),
u=utility.createPanelDialog(J,undefined,undefined,lang.LINK_HEADING);v=$(document.createElement("select")).attr("name","type").addClass("auto").append($(document.createElement("option")).val("url").text(lang.TYPE_URL)).append($(document.createElement("option")).val("email").text(lang.TYPE_EMAIL));var w=utility.createToolbar().addClass("pad").append($(document.createElement("span")).text(lang.LINK_TYPE)).append(v);urlRow=utility.createToolbar().addClass("pad").append($(document.createElement("span")).text(lang.LOCATION)).append(q=
$(document.createElement("input")).attr("type","text").addClass("large").val(A));urlRow.css("display",B!="card"?"":"none");D=$(document.createElement("select")).addClass("large");topicRow=utility.createToolbar().append($(document.createElement("span")).text(lang.TOPIC)).append(D);H=utility.createMenuItem(null,null,lang.CLOSE,null).addClass("right").appendTo(u.toolbar);utility.createMenuItem(null,null,lang.REMOVE,null).appendTo(u.toolbar).bind("click",s.get(0),f);H.bind("click",s,function(){b()});
topicRow.css("display",B=="card"?"":"none");D.append($(document.createElement("option")).text("").val("")).css("max-width","300px");H=g.displayInterface.getTopics();H.sort(utility.titleSorter);g.displayInterface.getCard();for(var G=-1,M=0;M<H.length;M++){var x=H[M];if(B=="card"&&A.length>1&&A.substr(0,1)=="#"&&x.getCardById(parseInt(A.substr(1)))!=null)G=M;D.append($(document.createElement("option")).text(x.title).val(""+M))}v.val(B);v.bind("change",{url:urlRow,topicRow:topicRow,topicSelector:D},
function(I){var N=$(this).val()=="card";I.data.url.css("display",!N?"":"none");I.data.topicRow.css("display",N?"":"none")});J.append(w).append(urlRow).append(topicRow);q.bind("blur",{element:s,box:q},k);g.displayInterface.displayTool({content:u,handler:function(){r=false},clickCloses:true}).addClass("small");r=true}function f(s){s=$(s.data);s.contents().insertBefore(s);s.remove();g.displayInterface.displayTool();g.displayInterface.triggerChange()}function k(s){var D=s.data.element;s=s.data.box.val();
if(v.val()=="email")s="mailto:"+s;D.attr("href",s);D.removeClass("cardlink");D.selectNodes({collapse:false});g.displayInterface.triggerChange()}var g;this.load=function(){g=this;d($("a",this.displayInterface.body))};this.loadMenuCreation=function(s){this.displayInterface.isEditor&&s(lang.INSERT_LINK,"link.png",a,lang.INSERT_LINK_TIP).attr("accesskey","l")};var l;this.unload=function(){g=null};var r;this.onChange=function(){this.displayInterface.isEditor&&d($("a",this.displayInterface.body))};var t,
v,E;this.delaySave=function(){return r}};client.pageplugins.displayplugins.Link.prototype=new client.pageplugins.NoteDisplayPlugin;
client.pageplugins.displayplugins.Table=function(){function a(){var k=$('<table><tr><th class="r"><br/></th><th><br/></th></tr><tr><td class="r"><br/></td><td><br/></td></tr></table>',i.displayInterface.document);if(i.displayInterface.body.insertNearSelection(k,true)===false)alert(lang.SELECT_FOR_INSERTION);else{i.displayInterface.triggerChange();c(k.eq(0));$("th:first",k).selectNodes()}}function b(k,g){function l(s,D){var q=$(i.displayInterface.document.createElement("br")),H=$(i.displayInterface.document.createElement("p")).append(q);
$.fn[D?"insertBefore":"insertAfter"].call(H,s);q.selectNodes()}if(k===undefined)k=$("table",i.displayInterface.body);k.bind("click",d).bind("contextmenu",d);for(var r=0;r<k.length;r++){var t=k.eq(r),v=$("tr",t),E=!k.hasClass("no-header");v.each(function(){var s=$(this);s.children(E?"td":"th").each(function(){var D=$(this),q=D.attr("colspan"),H=$(i.displayInterface.document.createElement(E?"th":"td")).append(D.contents());D.replaceWith(H);q!==undefined&&H.attr("colspan",q)});E=false;s=s.children("td,th");
s.not(":last").addClass("r");s.filter(":last").removeClass("r")});t.removeAttr("style");if(g)if(!t.parent().is("p,h1,h2,h3,h4,h5,h6,pre,br,ul,ol,table")){t.prev().is("p,h1,h2,h3,h4,h5,h6,pre,br,ul,ol,table")||l(t,true);t.next().is("p,h1,h2,h3,h4,h5,h6,pre,br,ul,ol,table")||l(t,false)}}}function d(k){k.stopPropagation();k=$(this);c(k)}function c(k){if(!(f!==undefined&&k.index(f)==0)){f=k;var g=m(),l=$(document.createElement("div")),r=utility.createToolbar().appendTo(l).css({padding:2});utility.createButton("insert-columns.png",
"addcol",lang.INSERT_COLUMN,j).appendTo(r);utility.createButton("insert-rows.png","addrow",lang.INSERT_ROW,j).appendTo(r);utility.createButton("delete-columns.png","delcol",lang.DELETE_COLUMN,j).appendTo(r);utility.createButton("delete-rows.png","delrow",lang.DELETE_ROW,j).appendTo(r);utility.createMenuItem(null,null,lang.DELETE_TABLE).attr("accesskey","r").appendTo(r).bind("click",k,o);f.toolWindow=i.displayInterface.displayTool({content:l,coords:g,showCloser:true,clickCloses:true,noFocus:true,handler:function(){f=
undefined}})}}function h(k){var g=!k.ctrlKey&&!k.altKey&&!k.metaKey,l=k.which==9&&g;if(l){var r=$.getSelection({context:i.displayInterface.document,disableSurrounding:true});if(r.length>0)r=r.closest("td,th");if(r.length>0){g=r.closest("table");var t=$("th,td",g);r=t.index(r);if(l){k.preventDefault();r+=k.shiftKey?-1:1;if(r<t.length&&r>=0)t.eq(r).selectNodes();else if(k.shiftKey)g.prev().selectNodes({collapse:false});else{k=$(i.displayInterface.document.createElement("tr")).html($("tr:last",g).html());
k.children().empty();g.append(k);$("td,th",k).eq(0).append(i.displayInterface.document.createElement("br")).selectNodes()}}return false}}}function m(){var k=utility.getRelativePosition(f.get(0),i.displayInterface.body[0]);k.top+=f.height();k.height=28;k.width=220;if(k.left+k.width>client.pageplugins.NoteDisplay.DISPLAY_WIDTH)k.left=client.pageplugins.NoteDisplay.DISPLAY_WIDTH-k.width;if(f.toolWindow!==undefined)f.toolWindow.css(k);else return k}function j(k){k.stopPropagation();var g=$.getSelection({context:i.displayInterface.document,
disableSurrounding:true}).filter(":last"),l=$("tr",f);g=g.parents("table").index(f)==0?g.closest("td,th"):l.filter(":last").children("td,th").filter(":last");var r=g.closest("tr");l.index(r);var t=r.children("td,th").index(g),v=k.data.action.search("add")==0;switch(k.data.action){case "addrow":k=$(i.displayInterface.document.createElement("tr")).html(r.html());k.children().empty();k.insertAfter(r);k.children(":first").html("&nbsp;").selectNodes();i.displayInterface.triggerChange();break;case "delrow":r.next().children("td,th").filter(":first").selectNodes();
r.remove();i.displayInterface.triggerChange();break;case "addcol":case "delcol":l.each(function(){var E=0;$("td,th",this).each(function(){var s=$(this),D=parseInt(s.attr("colspan"));if(isNaN(D)||D==0)D=1;E+=D;if(E>t){if(v)s.after($(i.displayInterface.document.createElement("td")));else{D--;if(D==0){s.next().selectNodes();s.remove()}else s.attr("colspan",D)}return false}})});i.displayInterface.triggerChange();break}if(!v)if($("td,th",f).length==0){f.remove();i.displayInterface.displayTool();return}m();
b(f)}function o(k){k.data.remove();i.displayInterface.displayTool();i.displayInterface.triggerChange()}var i;this.load=function(){i=this;if(this.displayInterface.isEditor){b();this.displayInterface.body.bind("keydown",h)}};this.onChange=function(){f!==undefined&&m()};this.onMainClick=function(){this.displayInterface.isEditor&&b(undefined,f!==undefined)};this.loadMenuCreation=function(k){this.displayInterface.isEditor&&k(lang.INSERT_TABLE,"insert-table.png",a,lang.INSERT_TABLE_TIP).attr("accesskey",
"t")};this.unload=function(){i=null;this.displayInterface.isEditor&&this.displayInterface.body.unbind("keydown",h)};var f};client.pageplugins.displayplugins.Table.prototype=new client.pageplugins.NoteDisplayPlugin;
client.pageplugins.displayplugins.HTML=function(){function a(){d(true)}function b(){d(false)}function d(o){m=h.displayInterface.body.takeSelection($(document.createElement("span")));var i=$(document.createElement("div")).addClass("pad"),f;f=$(document.createElement("textarea")).addClass("code").css({width:"100%",height:200}).text(o?m.html():m.text()).appendTo(i);f.insertHTML=o;var k=utility.createPanelDialog(i,{},undefined,o?lang.HTML_CODE:lang.CODE);k.toolbar.append(i=utility.createMenuItem(null,
null,lang.INSERT,null).addClass("right").attr("accesskey","o")).append(o=utility.createMenuItem(null,null,lang.CANCEL,null).addClass("right").attr("accesskey","n"));o.bind("click",function(){m=null;h.displayInterface.displayTool()});i.bind("click",f,c);h.displayInterface.displayTool({content:k,handler:function(){j=false},offset:150});j=true}function c(o){o=o.data;var i=o.val();m.replaceWith(o.insertHTML?$(h.displayInterface.document.createElement("div")).html(i).contents():$(h.displayInterface.document.createElement("pre")).text(i));
m=null;h.displayInterface.triggerChange();h.displayInterface.displayTool()}var h;this.load=function(){h=this};this.loadMenuCreation=function(o){if(this.displayInterface.isEditor){o(lang.INSERT_HTML,"html.png",a,lang.INSERT_HTML_TIP);o(lang.INSERT_CODE,"code.png",b,lang.INSERT_CODE_TIP)}};var m,j;this.delaySave=function(){return j};this.unload=function(){h=null}};client.pageplugins.displayplugins.HTML.prototype=new client.pageplugins.NoteDisplayPlugin;
client.pageplugins.displayplugins.InsertHelper=function(){function a(){alert(lang.EXPLAIN_WIKI_INSERTION)}function b(){alert(lang.EXPLAIN_WORD_INSERTION)}this.loadMenuCreation=function(d){if(this.displayInterface.isEditor){d(lang.INSERT_WIKIPEDIA,"wikipedia.png",a);d(lang.INSERT_WEB,"link-ext.png",a);d(lang.INSERT_WORD,"link-ext.png",b)}}};client.pageplugins.displayplugins.InsertHelper.prototype=new client.pageplugins.NoteDisplayPlugin;
client.pageplugins.displayplugins.LaTeXmage=function(){function a(){var l=$.getSelectionText(f.displayInterface.document);if(l===undefined||l=="")l="$   $";l.replace("\\$","");if(l.indexOf("$")==-1&&l.indexOf("\\begin{")==-1&&l.indexOf("\\[")==-1&&l.indexOf("\\(")==-1)l="$ "+l+" $";var r=f.displayInterface.body.takeSelection($(document.createElement("span")));c(r,l,true)}function b(){if(f.displayInterface.isEditor){var l=$("img.equation,img.texrender,img.tex",f.displayInterface.body);l.filter("img.tex").each(function(){var r=
$(this).attr("alt");r="$"+r+"$";$(this).attr("alt",r)});l.removeClass("tex texrender").addClass("equation").bind("click",d).bind("contextmenu",d)}}function d(l){l.stopPropagation();l=$(this);c(l,l.attr("alt"),false)}function c(l,r,t){var v,E,s=$(document.createElement("div")).addClass("pad");r=$(document.createElement("textarea")).addClass("code").val(r).appendTo(s);var D=utility.createPanelDialog(s,{},undefined,lang.LATEX_EDITOR);v=utility.createMenuItem(null,null,lang.HELP).attr({href:lang.LATEX_HELP_LINK,
target:"_blank"});D.toolbar.append(v);if(t){v=utility.createMenuItem(null,null,lang.AUTO_CONVERT_LATEX,j).addClass("right").attr("title",lang.AUTO_CONVERT_EXPLANATION).css("float","left");D.toolbar.append(v)}E=utility.createMenuItem(null,"ok",t?lang.INSERT:lang.UPDATE,null).addClass("right").attr("accesskey","o").appendTo(D.toolbar);v=utility.createMenuItem(null,null,lang.CANCEL,null).addClass("right").attr("accesskey","n").appendTo(D.toolbar);if(!t){s=utility.createToolbar(true).addClass("pad").appendTo(s);
utility.createMenuItem(null,null,lang.RESET_SIZE,null).appendTo(s).bind("click",l,function(H){H.data.removeAttr("style").removeAttr("width").removeAttr("height");f.displayInterface.triggerChange()});var q=$(document.createElement("input")).attr({type:"checkbox",id:"latexBlockCheck"}).appendTo(s);$(document.createElement("label")).attr({"for":"latexBlockCheck"}).text(lang.BLOCK_MODE).appendTo(s);q.get(0).checked=l.hasClass("block");q.bind("change",l,function(H){jQuery.fn[this.checked?"addClass":"removeClass"].call(H.data,
"block");f.displayInterface.triggerChange()})}v.bind("click",function(){f.displayInterface.displayTool()});E.bind("click",{field:r,createNew:t,node:l},m);f.displayInterface.displayTool({content:D,handler:h,offset:130});k=true}function h(){k=false}function m(l){var r=l.data.createNew,t=l.data.node;l=l.data.field.val();o(l,t,r);k&&f.displayInterface.displayTool()}function j(){var l=f.displayInterface.body,r=[];$("*",l).add(l).contents().filter(function(){return this.nodeType==3}).each(function(){for(var t,
v,E=[["\\[","\\]"],["\\(","\\)"],["$","$","\\"]],s=true,D=this;s;){s=false;E.each(function(){var q=this[0],H=this[1];t=D.nodeValue.indexOf(q);if(t>-1){v=t+1;if(q=="$"&&D.nodeValue.substr(t,2)=="$$"){H="$$";v++}do v=D.nodeValue.indexOf(H,(t>v?t:v)+1);while(v>-1&&this.length==3&&D.nodeValue.substr(v-1,1)==this[2]);if(v>-1){q=D.nodeValue.slice(t,v+H.length);var A=D.splitText(t),B=A.nodeValue;B=B.substring(v-t+H.length);if(B.length==0)D.parentNode.removeChild(A);else A.nodeValue=B;H=f.displayInterface.document.createElement("span");
D.parentNode.insertBefore(H,A=D.nextSibling);r.push([q,$(H),true]);if((D=A)!=null&&D.nodeType==3)s=true;return false}}return true})}});r.length>0?r.each(function(){o.apply(f,this)}):alert(lang.AUTO_LATEX_NO_JOBS)}function o(l,r,t){r={source:l,node:r,createNew:t===true};g=true;f.displayInterface.server.renderEquation(l,utility.createCallback(r,i))}function i(l){if(l.success){l=l.files[0];var r=this.source.indexOf("$$")>-1||this.source.indexOf("\\[")>-1&&this.source.indexOf("\\]")>-1||this.source.indexOf("\\begin{")>
-1,t;t=this.createNew?$(f.displayInterface.document.createElement("img")).click(d):this.node;t.attr({src:""});t.attr({src:config.viewPath+"&id="+l.id});try{t.attr("alt",this.source)}catch(v){t.attr("alt",lang.LATEX_SOURCE)}if(!t.hasClass("equation")){t.addClass("equation");$.fn[r?"addClass":"removeClass"].call(t,"block")}if(this.createNew){t.insertBefore(this.node);t.selectNodes({collapse:true});this.node.remove()}f.displayInterface.triggerChange()}else switch(l.error){case client.ServerErrors.invalidData:alert(lang.RENDERING_FAILED);
break;case client.ServerErrors.serverError:alert(lang.COULDNT_COPY_IMAGE);break;case client.ServerErrors.notEnoughQuota:alert(lang.ERROR_QUOTA);break;default:alert(lang.OTHER_ERROR)}g=false}var f;this.load=function(){f=this;config.hasLatex&&b()};this.loadMenuCreation=function(l){this.displayInterface.isEditor&&config.hasLatex&&l(lang.INSERT_LATEX,"equation.png",a,lang.INSERT_LATEX_TIP).attr("accesskey","x")};this.onChange=function(){b()};var k;this.delaySave=function(){return k||g};var g;this.unload=
function(){f=null}};client.pageplugins.displayplugins.LaTeXmage.prototype=new client.pageplugins.NoteDisplayPlugin;client.Marker=function(){this.relations=[]};client.Marker.prototype.loading=function(a){a.cancel=false};client.Marker.prototype.load=function(){};client.Marker.prototype.update=function(a){a.handled=false};client.Marker.prototype.onSelect=function(){};client.Marker.prototype.onDeselect=function(){};client.Marker.prototype.unload=function(){};client.Marker.prototype.destroy=function(){};
client.Marker.prototype.getFlashcardContents=function(){};client.Marker.prototype.prepareTraining=function(){};client.Marker.prototype.hasChanged=false;client.Marker.prototype.id=null;client.Marker.prototype.modified=0;client.Marker.prototype.startMarker=null;client.Marker.prototype.endMarker=null;client.Marker.prototype.rangeStore=null;client.Marker.prototype.range=null;client.Marker.prototype.card=null;client.Marker.prototype.relationsStore=undefined;client.Marker.prototype.relations=undefined;
client.Marker.prototype.postLoad=function(){};client.Marker.prototype.addRelation=function(a){if(!this.relationsStore)this.relationsStore=[];this.relationsStore.add(a);a.marker=this;a.object.relatedMarkers&&a.object.relatedMarkers.add(this)};client.Marker.prototype.removeRelation=function(a){if(this.relationsStore){this.relationsStore.remove(a);delete a.marker;a.object.relatedMarkers&&a.object.relatedMarkers.remove(this)}};
client.Marker.prototype.getRelations=function(){if(!this.relationsStore)return[];return this.relationsStore.clone()};client.Marker.prototype.clearRelations=function(){if(this.relationsStore){this.relationsStore.each(function(){this.marker=undefined});this.relationsStore=[]}};client.Marker.prototype.displayInterface=null;client.Marker.prototype.isMine=undefined;client.Marker.prototype.shared=false;client.Marker.prototype.sharedStore=undefined;
client.Marker.prototype.setShared=function(a){this.sharedStore=a};client.Marker.prototype.user=false;
client.Marker.prototype.transformStatic=function(){var a={};if(this.shared!==this.sharedStore)a.shared=this.shared?1:0;if(this.range){var b;if(this.card.isHtml())b=this.range.toRangeString();else{var d=[];this.range.areas.each(function(){d.push({l:this.l,t:this.t,b:this.b,r:this.r})});b=JSON.stringify(d)}if(this.rangeStore!=b&&(this.isMine||this.card.topic.isEditable()))a.range=b}if(this.hasChanged){var c=[],h=[];this.relations.each(function(){if(this.remove===true&&this.id)h.push(this.id);else!this.id&&
this.object&&c.push({id:this.object.id,type:this.object.type})});if(c.length>0)a.relations=c;if(h.length>0)a.deletedRelationIds=h}if(this.id){a.id=this.id;a.modified=this.modified}else{a.cardId=this.card.id;a.tool=this.tool}return a};client.Marker.prototype.restore=function(){this.relations=[];if(this.relationsStore){var a=this;this.relationsStore.each(function(){a.relations.push(this)})}this.shared=this.sharedStore?true:false};
client.Marker.prototype.clone=function(){var a=new (client.markers[utility.camelCase(this.tool)+"Marker"]);this.relations.each(function(){this.object.dependent||a.addRelation(this.clone())});a.restore();delete a.relationsStore;a.shared=this.shared;a.hasChanged=true;return a};client.Marker.prototype.trashable=function(){return false};client.Marker.prototype.trainable=function(){return false};client.Marker.prototype.getBoxNumber=function(){return false};client.Marker.prototype.createTrashMenuItem=function(){return null};
client.Marker.prototype.adjustClass=function(){var a=["marker"];this.isMine&&a.push("mine");this.range.addClass(a.join(" "))};client.Marker.prototype.delaySave=function(){return false};client.Marker.prototype.getModInfo=function(){var a={modified:this.modified,modifier:this.user};this.getRelations().each(function(){if(this.object.considerMod){var b=this.object.getModInfo(a);if(b.modified>=a.modified)a=b}});return a};
client.Marker.checkTrainable=function(a){var b=false;a.each(function(){if(this.trainable()){b=true;return false}});return b};client.Marker.createMenuItems=function(){};
client.markers.CheckboxMarker=function(){function a(){g.startMarker.css("background-image","url('"+config.imagePath+k.getIcon()+"')");var r;r=k.getTitle();g.startMarker.attr("title",r)}function b(r){switch(r.data.action){case "ok":i=false;result=f.save(k,utility.createCallback(g,d));break;case "cancel":i?g.displayInterface.removeMarker(g):c();return;case "remove":g.displayInterface.removeMarker(g);return}result&&c()}function d(r){if(r.error)alert(lang.COULD_NOT_SAVE_CHECK+": "+r.error);else if(r.checks){k=
r.checks[0];var t=false;this.relations.each(function(){if(this.object===k){t=true;return false}});if(!t){this.relations.push(new client.data.Relation({object:k,marker:this}));this.displayInterface.triggerChange();this.hasChanged=true}}}function c(){if(l!==undefined){g.startMarker.get(0).focus();g.displayInterface.displayTool()}}function h(r){r.preventDefault();r.stopPropagation();if(g.selected)l===undefined&&m();else g.displayInterface.selectMarker(g)}function m(){var r=g.displayInterface.getCard();
l=f.createEditor({check:k,topic:r.topic,changeCallback:j});var t=$(document.createElement("div"));$(document.createElement("h3")).text(lang.CHECKBOX_EDITOR_HEADER).appendTo(t);if(r.topic.isShared())$(document.createElement("p")).text(k.id?lang.CHECKBOX_HELP:lang.CHECKBOX_HELP_NEW).appendTo(t);l.appendTo(t);r=utility.createToolbar(true).addClass("pad").appendTo(t);!k.id&&topic.isShared()&&utility.createMenuItem(null,"ok",lang.SAVE,b).attr("accesskey","o").addClass("right").appendTo(r);utility.createMenuItem(null,
"cancel",k.id?lang.CLOSE:lang.CANCEL,b).attr("accesskey","n").addClass("right").appendTo(r);i||utility.createMenuItem(null,"remove",lang.REMOVE,b).attr({title:lang.REMOVE_MARKER_TITLE}).prependTo(r);r={top:g.startMarker[0].offsetTop};t=g.displayInterface.displayTool({content:t,coords:r,clickCloses:true,handler:o});t.addClass("check");var v=g.displayInterface.getMarkerBar().outerHeight();t.outerHeight();r.top>=v/2&&t.css({top:"auto",bottom:v-r.top-16})}function j(r){if(k===r){g.displayInterface.triggerChange();
g.hasChanged=true}}function o(){a();l=undefined;k&&delete k.changes}client.Marker.call(this);var i,f,k;this.restore=function(){client.Marker.prototype.restore.call(this);this.relations.each(function(){if(this.object instanceof client.data.Check)k=this.object})};var g;this.load=function(){g=this;if(!k){var r=new Date;k=new client.data.Check({user:this.displayInterface.getCurrentUser(),modified:Math.floor(r.getTime()/1E3)});i=true}this.shared=true;this.startMarker=utility.createButton(k.getIcon(),"",
"Marker template",null).css({width:16,height:16}).bind("click",h);a();this.displayInterface.getPlugins().each(function(){if(this instanceof client.pageplugins.Check)f=this})};this.onSelect=function(){m()};this.postLoad=function(){g&&a()};this.getBoxNumber=function(){if(k&&k.id&&k.actionRequired())return 0;return false};var l;this.onSelect=function(){m()};this.onDeselect=function(){i?this.displayInterface.removeMarker(this):c()};this.delaySave=function(){return l!==undefined||!k.id};this.unload=function(){c();
g=this.startMarker=null}};client.markers.CheckboxMarker.prototype=new client.Marker;client.markers.CheckboxMarker.prototype.tool="checkbox";client.markers.CheckboxMarker.createMenuItems=function(a){a(lang.CHECK,"check-full.png",new client.markers.CheckboxMarker,lang.CHECK_TIP).attr("accesskey","c")};
client.markers.QuestionMarker=function(){function a(){g.startMarker.css("background-image","url('"+config.imagePath+f.getIcon(false)+"')");var r;r=f.getTitle();if(f.body)r+=": "+$(document.createElement("div")).html(f.body).text();if(r.length>50)r=r.substr(0,50)+"...";g.startMarker.attr("title",r);g.range&&!g.displayInterface.isEditor&&g.range.attr("title",r);g.adjustClass()}function b(r){r.preventDefault();r.stopPropagation();if(g.selected)l===undefined&&d();else g.displayInterface.selectMarker(g)}
function d(){var r=$(document.createElement("div")),t=$(document.createElement("h3")).text(f.getTitle()).appendTo(r).makeCollapsible();f.needsRange()&&$(document.createElement("span")).addClass("normal").text(lang.SEE_RANGE).appendTo(t);var v=$(document.createElement("div")).addClass("question-editor").appendTo(r);t=i.createEditor(f).appendTo(v);v=utility.createToolbar(true).addClass("pad").appendTo(v);if(g.displayInterface.getCard().topic.isEditable()&&g.isMine){var E=$(document.createElement("input")).attr({type:"checkbox",
id:"sharecheck",title:lang.SHARE_TOOLTIP}).appendTo(v);g.shared&&E.attr("checked","checked");E.bind($.browser.msie?"click":"change",function(){g.shared=this.checked;g.displayInterface.triggerChange();g.hasChanged=true});$(document.createElement("label")).text(lang.SHARE).attr("for","sharecheck").appendTo(v)}else g.shared||$(document.createElement("div")).addClass("share-note").text(lang.NOT_SHARABLE).appendTo(v);utility.createMenuItem(null,"ok",lang.SAVE,c).attr("accesskey","o").addClass("right").appendTo(v);
utility.createMenuItem(null,"cancel",lang.CANCEL,c).attr("accesskey","n").addClass("right").appendTo(v);o||utility.createMenuItem(null,"remove",lang.REMOVE,c).attr({title:lang.REMOVE_MARKER_TITLE}).prependTo(v);l=g.displayInterface.displayTool({content:r,handler:j,clickCloses:false});t.css("max-height",l.closest("div.mainview,div.trainer").children("div.center-panel").height()+30)}function c(r){var t;switch(r.data.action){case "ok":g.hasChanged=true;if(t=i.save(f,utility.createCallback(g,h)))o=false;
break;case "cancel":o?g.displayInterface.removeMarker(g):m();return;case "remove":g.displayInterface.removeMarker(g);return}t&&m()}function h(r){if(r.error)alert(lang.COULD_NOT_SAVE_QUESTION+": "+r.error);else if(r.questions){f=r.questions[0];var t=false;this.relations.each(function(){if(this.object===f){t=true;return false}});if(!t){this.relations.push(new client.data.Relation({object:f,marker:this}));this.displayInterface.triggerChange();this.hasChanged=true}this.checkFlashcard();a()}}function m(){if(l!==
undefined){g.startMarker.get(0).focus();g.displayInterface.displayTool()}}function j(){l=undefined;f&&delete f.changes}client.Marker.call(this);var o,i,f,k;this.restore=function(){client.Marker.prototype.restore.call(this);this.relations.each(function(){if(this.object instanceof client.data.Question)f=this.object;else if(this.object instanceof client.data.Flashcard)k=this.object})};var g;this.load=function(){g=this;if(!f){var r=new Date;f=new client.data.Question({mode:this.questionMode?this.questionMode:
client.data.QuestionModeConstants.question,user:this.displayInterface.getCurrentUser(),modified:Math.floor(r.getTime()/1E3),body:null});o=!this.ignoreSelect;this.shared=!this.ignoreSelect}if(f.id&&!f.loaded)f.needsLoading=true;r=g.displayInterface.getCard().topic.isEditable();this.shared=this.shared&&r;this.checkFlashcard();this.startMarker=utility.createButton(f.getIcon(false),"","",null).css({width:16,height:16}).bind("click",this,b).bind("contextmenu",b);this.displayInterface.getPlugins().each(function(){if(this instanceof
client.pageplugins.Question)i=this});a();if(this.ignoreSelect){f.changes={question:{mode:f.mode,question:null}};i.save(f,utility.createCallback(g,h))}};this.postLoad=function(){g&&a();this.checkFlashcard()};this.onSelect=function(){this.ignoreSelect||d()};this.adjustClass=function(){client.Marker.prototype.adjustClass.call(this);this.range.toggleClass("red",f!==undefined&&f.isAlert())};var l;this.onDeselect=function(){o?this.displayInterface.removeMarker(this):m()};this.trainable=function(){return k!==
undefined&&f!==undefined&&f.id&&(!f.loaded||f.trainable())};this.getBoxNumber=function(){if(this.trainable())return 2;else if(f!==undefined)if(f.isOpen())return 0;else if(f.isPending())return 1;return false};this.prepareTraining=function(){var r=[];if(!f.id)return false;!k.loaded&&k.id&&r.push(k);!f.loaded&&f.id&&r.push(f);if(r.length>0)return r;r=$(document.createElement("div")).css({background:"url('"+config.imagePath+f.getIcon(true)+"') no-repeat","padding-left":24,height:24,overflow:"hidden",
"float":"none"});var t=$(document.createElement("span")).html(f.body).text();if(t.length>100)t=t.substr(0,100)+"...";k.title=r.append($(document.createElement("span")).text(t)).attr("title",t);return true};this.getFlashcards=function(){return k.id?[k]:[]};this.getFlashcardContents=function(){var r=new client.data.FlashcardContents,t;if(f.body){t=f.body;if(f.mode==client.data.QuestionModeConstants.definition)t="<b>"+lang.DEFINITION_QUESTION+"</b> "+t;t=$(document.createElement("img")).attr("src",config.imagePath+
f.getIcon(true)).css({"float":"right",display:"block"}).add($(document.createElement("h3")).text(f.getTitle())).add($(document.createElement("hr"))).add($(document.createElement("div")).html(t))}if(f.body&&!f.needsRange()){var v;v=f.getStarredAnswer().body;r.frontSide=t;r.backSide=$(document.createElement("img")).attr("src",config.imagePath+"definition.png").css({"float":"right",display:"block"}).add($(document.createElement("h3")).text(lang.ANSWER)).add($(document.createElement("hr"))).add($(document.createElement("div")).html(v));
$("a",r.frontSide).attr("target","_blank");$("a",r.backSide).attr("target","_blank")}else{if(!f.body){t=$(document.createElement("p")).css("padding-top",5).html(lang.REPEAT_TITLE);t=$(document.createElement("img")).attr("src",config.imagePath+"repetition.png").css({"float":"right",display:"block"}).add(t)}r.backSide=t;r.showCard=true}r.showSelfAssessmentButtons=true;return r};this.delaySave=function(){return l!==undefined||!f.id};this.unload=function(){this.range&&this.range.removeClass("red");m();
g=this.startMarker=null};this.checkFlashcard=function(){if(!k&&f&&f.trainable()){k=new client.data.Flashcard({marker:this});this.relations.push(new client.data.Relation({object:k,marker:this}));this.hasChanged=true;this.displayInterface&&this.displayInterface.triggerChange()}};this.trashable=function(){return f!==undefined&&f.id&&f.body};this.createTrashMenuItem=function(){var r=f.getIcon(true),t=$(document.createElement("span")).html(f.body).text();if(t.length>15)t=t.substr(0,15)+"...";return{icon:r,
label:t}}};client.markers.QuestionMarker.prototype=new client.Marker;client.markers.QuestionMarker.prototype.tool="question";
client.markers.QuestionMarker.createMenuItems=function(a){var b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.annotation;a(lang.ANNOTATE,"remark.png",b,lang.ANNOTATE_TIP).attr("accesskey","a");b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.feedback;a(lang.FEEDBACK,"feedback.png",b,lang.FEEDBACK_TIP).attr("accesskey","f");b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.issue;a(lang.ASK_QUESTION,
"problem.png",b,lang.ASK_QUESTION_TIP).attr("accesskey","q");b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.question;a(lang.ANSWER_LINK,"flashcard.png",b,lang.ANSWER_LINK_TIP);b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.definition;b.takeQuestionFromSelection=true;a(lang.DEFINE_SELECTION,"definition.png",b,lang.DEFINE_SELECTION_TIP).attr("accesskey","d");b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.relatedTerm;
a(lang.THIS_DEFINES,"def-rel.png",b,lang.THIS_DEFINES_TIP);b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.relatedQuestion;b.ignoreSelect=true;a(lang.REP_MARKER,"repetition.png",b,lang.REP_MARKER_TIP).attr("accesskey","r");b=new client.markers.QuestionMarker;b.questionMode=client.data.QuestionModeConstants.relatedQuestion;a(lang.QUESTION_TO_SELECTION,"rep-quest.png",b,lang.QUESTION_TO_SELECTION_TIP)};
client.markers.RepetitionMarker=function(){function a(o){o.stopPropagation();o=o.data;if(o.selected)j===undefined&&b();else{o.displayInterface.selectMarker(o);b()}}function b(){var o=$(document.createElement("div")),i=utility.createToolbar(true).appendTo(o),f=$(document.createElement("input")).attr("type","checkbox").attr("id","sharecheck").appendTo(i);h.shared&&f.attr("checked","checked");f.bind($.browser.msie?"click":"change",function(){h.shared=this.checked;h.displayInterface.triggerChange();h.hasChanged=
true});$(document.createElement("label")).text(lang.SHARE).attr("for","sharecheck").appendTo(i);o=utility.createPanelDialog(o,{},undefined,lang.REPETITION);o.toolbar.append(utility.createMenuItem(null,null,lang.CLOSE,c));j=h.displayInterface.displayTool({content:o,handler:d,clickCloses:true})}function d(){j=undefined}function c(){if(j!==undefined){h.startMarker.get(0).focus();h.displayInterface.displayTool()}}client.Marker.call(this);this.shared=false;this.restore=function(){client.Marker.prototype.restore.call(this);
this.relations.each(function(){if(this.object instanceof client.data.Flashcard)m=this.object})};var h,m;this.load=function(){h=this;if(!m){m=new client.data.Flashcard({marker:this});this.relations.push(new client.data.Relation({object:m,marker:this}));this.hasChanged=true}this.startMarker=utility.createButton("repetition-small.png","",lang.REP_LEVEL,null).css({width:16,height:16}).bind("click",this,a);this.range&&!this.displayInterface.isEditor&&this.range.attr("title",lang.REP_LEVEL)};var j;this.trainable=
function(){return m!==undefined};this.prepareTraining=function(){if(!m.loaded)return[m];var o=$(document.createElement("div")).css({background:"url('"+config.imagePath+"repetition.png') no-repeat","padding-left":24,height:24,overflow:"hidden","float":"none"}),i=lang.REPEAT+" "+this.card.title;if(i.length>100)i=i.substr(0,100)+"...";m.title=o.append($(document.createElement("span")).text(i)).attr("title",i);return true};this.getFlashcards=function(){return[m]};this.getFlashcardContents=function(){var o=
new client.data.FlashcardContents,i=$(document.createElement("img")).attr("src",config.imagePath+"repetition.png").css({"float":"right",display:"block"}),f=$(document.createElement("p")).css("padding-top",5).html(lang.REPEAT_TITLE);o.backSide=i.add(f);o.showCard=true;o.showSelfAssessmentButtons=true;return o};this.unload=function(){c();this.hasChanged&&m&&m.reset();this.startMarker=null;h=undefined}};client.markers.RepetitionMarker.prototype=new client.Marker;
client.markers.RepetitionMarker.prototype.tool="repetition";
client.markers.ReferenceMarker=function(){function a(){k.startMarker.css("background-image","url('"+config.imagePath+f.getIcon(false)+"')");var l;l=f&&f.title?f.getTitle():lang.LINK_EDIT;if(l.length>50)l=l.substr(0,50)+"...";k.startMarker.attr("title",l);k.range&&!k.displayInterface.isEditor&&k.range.attr("title",l);k.adjustClass()}function b(l){l.preventDefault();l.stopPropagation();if(k.selected)g===undefined&&d();else k.displayInterface.selectMarker(k)}function d(){var l=$(document.createElement("div"));
$(document.createElement("h3")).text(lang.LINK_EDIT).appendTo(l).makeCollapsible();var r=$(document.createElement("div")).appendTo(l);i.createEditor(f).appendTo(r);r=utility.createToolbar(true).addClass("pad").appendTo(r);if(k.displayInterface.getCard().topic.isEditable()&&k.isMine){var t=$(document.createElement("input")).attr({type:"checkbox",id:"sharecheck",title:lang.SHARE_TOOLTIP}).appendTo(r);k.shared&&t.attr("checked","checked");t.bind($.browser.msie?"click":"change",function(){k.shared=this.checked;
k.displayInterface.triggerChange();k.hasChanged=true});$(document.createElement("label")).text(lang.SHARE).attr("for","sharecheck").appendTo(r)}else k.shared||$(document.createElement("div")).addClass("share-note").text(lang.NOT_SHARABLE).appendTo(r);utility.createMenuItem(null,"ok",lang.SAVE,c).attr("accesskey","o").addClass("right").appendTo(r);utility.createMenuItem(null,"cancel",lang.CANCEL,c).attr("accesskey","n").addClass("right").appendTo(r);o||utility.createMenuItem(null,"remove",lang.REMOVE,
c).attr({title:lang.REMOVE_MARKER_TITLE}).prependTo(r);g=k.displayInterface.displayTool({content:l,handler:j,clickCloses:false}).addClass("small");g.focusFirstEditable()}function c(l){if(l.data.action=="ok"){o=false;i.save(f,utility.createCallback(k,h))&&m()}else if(l.data.action=="cancel")m();else l.data.action=="remove"&&k.displayInterface.removeMarker(k)}function h(l){if(l.error)alert("could not update link: "+l.error);else if(l.links){var r=l.links[0],t=false;this.relations.each(function(){if(this.object===
r){t=true;return false}});if(!t){this.relations.push(new client.data.Relation({object:r,marker:this}));this.displayInterface.triggerChange();this.hasChanged=true}a()}}function m(){if(g!==undefined){k.startMarker.get(0).focus();k.displayInterface.displayTool()}}function j(){g=undefined}client.Marker.call(this);var o,i,f;this.restore=function(){client.Marker.prototype.restore.call(this);this.relations.each(function(){if(this.object instanceof client.data.Link){f=this.object;return false}})};var k;this.load=
function(){k=this;if(!f){var l=new Date;f=new client.data.Link({type:this.linkType?this.linkType:client.data.LinkTypeConstants.external,user:this.displayInterface.getCurrentUser(),modified:Math.floor(l.getTime()/1E3),title:"",url:""});o=this.shared=true}if(f.id&&!f.loaded)f.needsLoading=true;this.startMarker=utility.createButton(f.getIcon(false),"","",null).addClass("linkrange").css({width:16,height:16}).bind("click",this,b).bind("contextmenu",b);this.displayInterface.getPlugins().each(function(){if(this instanceof
client.pageplugins.Link)i=this});a()};this.postLoad=function(){k&&a()};this.adjustClass=function(){client.Marker.prototype.adjustClass.call(this);this.range.addClass("transparent")};this.update=function(l){function r(v,E){return E?utility.getRelativePosition(v,k.displayInterface.body[0]):{top:v.offsetTop,left:v.offsetLeft}}l.handled=true;outerElements=this.range.getFirstAndLast();var t=k.displayInterface.getCard();l=r(outerElements.first,t.isHtml());t=r(outerElements.last,t.isHtml());l={top:l.top-
2,height:t.top-l.top+outerElements.last.offsetHeight+4};if(l.top<0)l.top=0;if(l.height<0)l.height=6;this.startMarker.css(l)};this.onSelect=function(){if(!this.ignoreSelect){this.startMarker.height()<=40&&this.startMarker.css("background-image","none");d()}};var g;this.onDeselect=function(){this.startMarker.css("background-image","");o?this.displayInterface.removeMarker(this):m()};this.delaySave=function(){return g!==undefined||!f.id};this.unload=function(){m();k=this.startMarker=null};this.trashable=
function(){return f!==undefined&&f.id&&f.title};this.createTrashMenuItem=function(){var l=f.getIcon(true),r=$(document.createElement("span")).html(f.title).text();if(r.length>15)r=r.substr(0,15)+"...";return{icon:l,label:r}}};client.markers.ReferenceMarker.prototype=new client.Marker;client.markers.ReferenceMarker.prototype.tool="reference";
client.markers.ReferenceMarker.createMenuItems=function(a){var b=new client.markers.ReferenceMarker;b.linkType=client.data.LinkTypeConstants.external;a(lang.REFERENCE,"link.png",b,lang.REFERENCE_TIP).attr("accesskey","l")};
