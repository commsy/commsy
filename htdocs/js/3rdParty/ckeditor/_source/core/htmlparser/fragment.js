//>>built
define("ckeditor/_source/core/htmlparser/fragment",["dijit","dojo","dojox"],function(){CKEDITOR.htmlParser.fragment=function(){this.children=[];this.parent=null;this._={isBlockLike:!0,hasInlineStarted:!1}};(function(){var s=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),u=CKEDITOR.env.ie&&8>CKEDITOR.env.version?{dd:1,dt:1}:{},q={ol:1,ul:1},t=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,
script:1});CKEDITOR.htmlParser.fragment.fromHtml=function(d,g,h){function r(a){var b;if(0<i.length)for(var e=0;e<i.length;e++){var g=i[e],f=g.name,h=CKEDITOR.dtd[f],d=c.name&&CKEDITOR.dtd[c.name];(!d||d[f])&&(!a||!h||h[a]||!CKEDITOR.dtd[a])?(b||(l(),b=1),g=g.clone(),g.parent=c,c=g,i.splice(e,1),e--):f==c.name&&(k(c,c.parent,1),e--)}}function l(){for(;p.length;)k(p.shift(),c)}function k(a,b,e){if(void 0===a.previous){var b=b||c||m,h=c;if(g&&(!b.type||"body"==b.name)){var f,d;if((f=a.attributes&&(d=
a.attributes["data-cke-real-element-type"])?d:a.name)&&!(f in CKEDITOR.dtd.$body||"body"==f||a.isOrphan))c=b,j.onTagOpen(g,{}),a.returnPoint=b=c}if(a._.isBlockLike&&"pre"!=a.name&&"textarea"!=a.name){f=a.children.length;d=a.children[f-1];var i;if(d&&d.type==CKEDITOR.NODE_TEXT)(i=CKEDITOR.tools.rtrim(d.value))?d.value=i:a.children.length=f-1}b.add(a);"pre"==a.name&&(n=!1);"textarea"==a.name&&(o=!1);a.returnPoint?(c=a.returnPoint,delete a.returnPoint):c=e?b:h}}var j=new CKEDITOR.htmlParser,m=h||new CKEDITOR.htmlParser.fragment,
i=[],p=[],c=m,o=!1,n=!1;j.onTagOpen=function(a,b,e,d){b=new CKEDITOR.htmlParser.element(a,b);if(b.isUnknown&&e)b.isEmpty=!0;b.isOptionalClose=a in u||d;if("a"==b.name&&b.attributes.href||CKEDITOR.dtd.$removeEmpty[b.name])i.push(b);else{if("pre"==a)n=!0;else{if("br"==a&&n){c.add(new CKEDITOR.htmlParser.text("\n"));return}"textarea"==a&&(o=!0)}if("br"==a)p.push(b);else{for(;;)if(d=(e=c.name)?CKEDITOR.dtd[e]||(c._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):t,!b.isUnknown&&!c.isUnknown&&!d[a])if(c.isOptionalClose)j.onTagClose(e);
else if(a in q&&e in q)e=c.children,(e=e[e.length-1])&&"li"==e.name||k(e=new CKEDITOR.htmlParser.element("li"),c),!b.returnPoint&&(b.returnPoint=c),c=e;else if(a in CKEDITOR.dtd.$listItem&&e!=a)j.onTagOpen("li"==a?"ul":"dl",{},0,1);else if(e in s&&e!=a)!b.returnPoint&&(b.returnPoint=c),c=c.parent;else if(e in CKEDITOR.dtd.$inline&&i.unshift(c),c.parent)k(c,c.parent,1);else{b.isOrphan=1;break}else break;r(a);l();b.parent=c;b.isEmpty?k(b):c=b}}};j.onTagClose=function(a){for(var b=i.length-1;0<=b;b--)if(a==
i[b].name){i.splice(b,1);return}for(var e=[],d=[],f=c;f!=m&&f.name!=a;)f._.isBlockLike||d.unshift(f),e.push(f),f=f.returnPoint||f.parent;if(f!=m){for(b=0;b<e.length;b++){var h=e[b];k(h,h.parent)}c=f;f._.isBlockLike&&l();k(f,f.parent);if(f==c)c=c.parent;i=i.concat(d)}"body"==a&&(g=!1)};j.onText=function(a){if((!c._.hasInlineStarted||p.length)&&!n&&!o)if(a=CKEDITOR.tools.ltrim(a),0===a.length)return;var b=c.name,d=b?CKEDITOR.dtd[b]||(c._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):t;if(!o&&!d["#"]&&
b in s)j.onTagOpen(b in q?"li":"dl"==b?"dd":"table"==b?"tr":"tr"==b?"td":""),j.onText(a);else{l();r();if(g&&(!c.type||"body"==c.name)&&CKEDITOR.tools.trim(a))this.onTagOpen(g,{},0,1);!n&&!o&&(a=a.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));c.add(new CKEDITOR.htmlParser.text(a))}};j.onCDATA=function(a){c.add(new CKEDITOR.htmlParser.cdata(a))};j.onComment=function(a){l();r();c.add(new CKEDITOR.htmlParser.comment(a))};j.parse(d);for(l(!CKEDITOR.env.ie&&1);c!=m;)k(c,c.parent,1);return m};CKEDITOR.htmlParser.fragment.prototype=
{add:function(d,g){isNaN(g)&&(g=this.children.length);var h=0<g?this.children[g-1]:null;if(h){if(d._.isBlockLike&&h.type==CKEDITOR.NODE_TEXT&&(h.value=CKEDITOR.tools.rtrim(h.value),0===h.value.length)){this.children.pop();this.add(d);return}h.next=d}d.previous=h;d.parent=this;this.children.splice(g,0,d);this._.hasInlineStarted=d.type==CKEDITOR.NODE_TEXT||d.type==CKEDITOR.NODE_ELEMENT&&!d._.isBlockLike},writeHtml:function(d,g){var h;this.filterChildren=function(){var d=new CKEDITOR.htmlParser.basicWriter;
this.writeChildrenHtml.call(this,d,g,!0);d=d.getHtml();this.children=(new CKEDITOR.htmlParser.fragment.fromHtml(d)).children;h=1};!this.name&&g&&g.onFragment(this);this.writeChildrenHtml(d,h?null:g)},writeChildrenHtml:function(d,g){for(var h=0;h<this.children.length;h++)this.children[h].writeHtml(d,g)}}})()});