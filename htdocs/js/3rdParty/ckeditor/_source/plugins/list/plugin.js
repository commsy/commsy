//>>built
define("ckeditor/_source/plugins/list/plugin",["dijit","dojo","dojox"],function(){(function(){function w(c){if(c.editor.readOnly)return null;var f=c.data.path,c=f.blockLimit,f=f.elements,d,e;for(e=0;e<f.length&&(d=f[e])&&!d.equals(c);e++)if(q[f[e].getName()])return this.setState(this.type==f[e].getName()?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);return this.setState(CKEDITOR.TRISTATE_OFF)}function J(c,f,d){function e(a){if((b=g[a?"getFirst":"getLast"]())&&(!b.is||!b.isBlockBoundary())&&(k=f.root[a?
"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(!0)))&&(!k.is||!k.isBlockBoundary({br:1})))c.document.createElement("br")[a?"insertBefore":"insertAfter"](b)}for(var i=CKEDITOR.plugins.list.listToArray(f.root,d),a=[],h=0;h<f.contents.length;h++){var l=f.contents[h];if((l=l.getAscendant("li",!0))&&!l.getCustomData("list_item_processed"))a.push(l),CKEDITOR.dom.element.setMarker(d,l,"list_item_processed",!0)}l=null;for(h=0;h<a.length;h++)l=a[h].getCustomData("listarray_index"),i[l].indent=-1;
for(h=l+1;h<i.length;h++)if(i[h].indent>i[h-1].indent+1){a=i[h-1].indent+1-i[h].indent;for(l=i[h].indent;i[h]&&i[h].indent>=l;)i[h].indent+=a,h++;h--}var g=CKEDITOR.plugins.list.arrayToList(i,d,null,c.config.enterMode,f.root.getAttribute("dir")).listNode,b,k;e(!0);e();g.replace(f.root)}function x(c,f){this.name=c;this.type=f}function A(c,f,d,e){for(var i,a;i=c[e?"getLast":"getFirst"](K);)(a=i.getDirection(1))!==f.getDirection(1)&&i.setAttribute("dir",a),i.remove(),d?i[e?"insertBefore":"insertAfter"](d):
f.append(i,e)}function B(c){var f;(f=function(d){var e=c[d?"getPrevious":"getNext"](r);e&&e.type==CKEDITOR.NODE_ELEMENT&&e.is(c.getName())&&(A(c,e,null,!d),c.remove(),c=e)})();f(1)}function C(c){return function(f){var d=f.children;a:{for(var e=f.children,i=e.length,a=0;a<i;a++)if(f=e[a],f.name&&f.name in y.$list){f=a;break a}f=i}var e=(e=d[f])&&e.previous,h;if(e&&(e.name&&"br"==e.name||e.value&&(h=e.value.match(D))))(!h||!h.index)&&e==d[0]?d[0]=c||CKEDITOR.env.ie?new CKEDITOR.htmlParser.text("\u00a0"):
new CKEDITOR.htmlParser.element("br",{}):"br"==e.name?d.splice(f-1,1):e.value=e.value.replace(D,"")}}function E(c){return c.type==CKEDITOR.NODE_ELEMENT&&(c.getName()in CKEDITOR.dtd.$block||c.getName()in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[c.getName()]["#"]}function F(c,f,d){c.fire("saveSnapshot");d.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var e=d.extractContents();f.trim(!1,!0);var i=f.createBookmark(),a=new CKEDITOR.dom.elementPath(f.startContainer),h=a.lastElement.getAscendant("li",1);(a=
a.block.getBogus())&&a.remove();(a=e.getLast())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("br")&&a.remove();(a=f.startContainer.getChild(f.startOffset))?e.insertBefore(a):f.startContainer.append(e);e=new CKEDITOR.dom.elementPath(d.startContainer);if(e=d.startContainer.getAscendant("li",1))if(a=G(e))h.contains(e)?(A(a,e.getParent(),e),a.remove()):h.append(a);for(;d.checkStartOfBlock()&&d.checkEndOfBlock();)e=new CKEDITOR.dom.elementPath(d.startContainer),h=e.block,h.is("li")&&(e=h.getParent(),h.equals(e.getLast(r))&&
h.equals(e.getFirst(r))&&(h=e)),d.moveToPosition(h,CKEDITOR.POSITION_BEFORE_START),h.remove();d=d.clone();h=c.document.getBody();d.setEndAt(h,CKEDITOR.POSITION_BEFORE_END);d=new CKEDITOR.dom.walker(d);d.evaluator=function(a){return r(a)&&!v(a)};(d=d.next())&&d.type==CKEDITOR.NODE_ELEMENT&&d.getName()in CKEDITOR.dtd.$list&&B(d);f.moveToBookmark(i);f.select();c.selectionChange(1);c.fire("saveSnapshot")}function G(c){return(c=c.getLast(r))&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in q?c:null}var q=
{ol:1,ul:1},L=CKEDITOR.dom.walker.whitespaces(),M=CKEDITOR.dom.walker.bookmark(),r=function(c){return!(L(c)||M(c))},v=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(c,f,d,e,i){if(!q[c.getName()])return[];e||(e=0);d||(d=[]);for(var a=0,h=c.getChildCount();a<h;a++){var l=c.getChild(a);l.type==CKEDITOR.NODE_ELEMENT&&l.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(l,f,d,e+1);if("li"==l.$.nodeName.toLowerCase()){var g={parent:c,indent:e,element:l,contents:[]};
if(i)g.grandparent=i;else if(g.grandparent=c.getParent(),g.grandparent&&"li"==g.grandparent.$.nodeName.toLowerCase())g.grandparent=g.grandparent.getParent();f&&CKEDITOR.dom.element.setMarker(f,l,"listarray_index",d.length);d.push(g);for(var b=0,k=l.getChildCount(),j;b<k;b++)j=l.getChild(b),j.type==CKEDITOR.NODE_ELEMENT&&q[j.getName()]?CKEDITOR.plugins.list.listToArray(j,f,d,e+1,g.grandparent):g.contents.push(j)}}return d},arrayToList:function(c,f,d,e,i){d||(d=0);if(!c||c.length<d+1)return null;for(var a,
h=c[d].parent.getDocument(),l=new CKEDITOR.dom.documentFragment(h),g=null,b=d,k=Math.max(c[d].indent,0),j=null,n,m,p=e==CKEDITOR.ENTER_P?"p":"div";;){var o=c[b];a=o.grandparent;n=o.element.getDirection(1);if(o.indent==k){if(!g||c[b].parent.getName()!=g.getName())g=c[b].parent.clone(!1,1),i&&g.setAttribute("dir",i),l.append(g);j=g.append(o.element.clone(0,1));n!=g.getDirection(1)&&j.setAttribute("dir",n);for(a=0;a<o.contents.length;a++)j.append(o.contents[a].clone(1,1));b++}else if(o.indent==Math.max(k,
0)+1)m=c[b-1].element.getDirection(1),b=CKEDITOR.plugins.list.arrayToList(c,null,b,e,m!=n?n:null),!j.getChildCount()&&CKEDITOR.env.ie&&!(7<h.$.documentMode)&&j.append(h.createText("\u00a0")),j.append(b.listNode),b=b.nextIndex;else if(-1==o.indent&&!d&&a){q[a.getName()]?(j=o.element.clone(!1,!0),n!=a.getDirection(1)&&j.setAttribute("dir",n)):j=new CKEDITOR.dom.documentFragment(h);var g=a.getDirection(1)!=n,s=o.element,z=s.getAttribute("class"),u=s.getAttribute("style"),x=j.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&
(e!=CKEDITOR.ENTER_BR||g||u||z),t,y=o.contents.length;for(a=0;a<y;a++){t=o.contents[a];if(t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary()){g&&!t.getDirection()&&t.setAttribute("dir",n);var v=t,w=s.getAttribute("style");w&&v.setAttribute("style",w.replace(/([^;])$/,"$1;")+(v.getAttribute("style")||""));z&&t.addClass(z)}else x&&(m||(m=h.createElement(p),g&&m.setAttribute("dir",n)),u&&m.setAttribute("style",u),z&&m.setAttribute("class",z),m.append(t.clone(1,1)));j.append(m||t.clone(1,1))}j.type==
CKEDITOR.NODE_DOCUMENT_FRAGMENT&&b!=c.length-1&&((n=j.getLast())&&n.type==CKEDITOR.NODE_ELEMENT&&"_moz"==n.getAttribute("type")&&n.remove(),j.getLast(r)&&n.type==CKEDITOR.NODE_ELEMENT&&n.getName()in CKEDITOR.dtd.$block||j.append(h.createElement("br")));n=j.$.nodeName.toLowerCase();!CKEDITOR.env.ie&&("div"==n||"p"==n)&&j.appendBogus();l.append(j);g=null;b++}else return null;m=null;if(c.length<=b||Math.max(c[b].indent,0)<k)break}if(f)for(c=l.getFirst();c;){if(c.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(f,
c),c.getName()in CKEDITOR.dtd.$listItem&&(d=c,h=i=e=void 0,e=d.getDirection()))){for(i=d.getParent();i&&!(h=i.getDirection());)i=i.getParent();e==h&&d.removeAttribute("dir")}c=c.getNextSourceNode()}return{listNode:l,nextIndex:b}}};var N=/^h[1-6]$/,K=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);x.prototype={exec:function(c){var f=c.document,d=c.config,e=c.getSelection(),i=e&&e.getRanges(!0);if(i&&!(1>i.length)){if(this.state==CKEDITOR.TRISTATE_OFF)if(f=f.getBody(),f.getFirst(r)){var a=1==i.length&&
i[0];(d=a&&a.getEnclosedNode())&&d.is&&this.type==d.getName()&&this.setState(CKEDITOR.TRISTATE_ON)}else d.enterMode==CKEDITOR.ENTER_BR?f.appendBogus():i[0].fixBlock(1,d.enterMode==CKEDITOR.ENTER_P?"p":"div"),e.selectRanges(i);for(var d=e.createBookmarks(!0),f=[],h={},i=i.createIterator(),l=0;(a=i.getNextRange())&&++l;){var g=a.getBoundaryNodes(),b=g.startNode,k=g.endNode;b.type==CKEDITOR.NODE_ELEMENT&&"td"==b.getName()&&a.setStartAt(g.startNode,CKEDITOR.POSITION_AFTER_START);k.type==CKEDITOR.NODE_ELEMENT&&
"td"==k.getName()&&a.setEndAt(g.endNode,CKEDITOR.POSITION_BEFORE_END);a=a.createIterator();for(a.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;g=a.getNextParagraph();)if(!g.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(h,g,"list_block",1);for(var j=new CKEDITOR.dom.elementPath(g),b=j.elements,k=0,j=j.blockLimit,n,m=b.length-1;0<=m&&(n=b[m]);m--)if(q[n.getName()]&&j.contains(n)){j.removeCustomData("list_group_object_"+l);(b=n.getCustomData("list_group_object"))?b.contents.push(g):(b=
{root:n,contents:[g]},f.push(b),CKEDITOR.dom.element.setMarker(h,n,"list_group_object",b));k=1;break}k||(k=j,k.getCustomData("list_group_object_"+l)?k.getCustomData("list_group_object_"+l).contents.push(g):(b={root:k,contents:[g]},CKEDITOR.dom.element.setMarker(h,k,"list_group_object_"+l,b),f.push(b)))}}for(n=[];0<f.length;)if(b=f.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(q[b.root.getName()]){g=c;i=b;b=h;l=n;k=CKEDITOR.plugins.list.listToArray(i.root,b);j=[];for(a=0;a<i.contents.length;a++)if(m=
i.contents[a],(m=m.getAscendant("li",!0))&&!m.getCustomData("list_item_processed"))j.push(m),CKEDITOR.dom.element.setMarker(b,m,"list_item_processed",!0);for(var m=i.root.getDocument(),p=void 0,o=void 0,a=0;a<j.length;a++){var s=j[a].getCustomData("listarray_index"),p=k[s].parent;if(!p.is(this.type))o=m.createElement(this.type),p.copyAttributes(o,{start:1,type:1}),o.removeStyle("list-style-type"),k[s].parent=o}g=CKEDITOR.plugins.list.arrayToList(k,b,null,g.config.enterMode);b=void 0;k=g.listNode.getChildCount();
for(a=0;a<k&&(b=g.listNode.getChild(a));a++)b.getName()==this.type&&l.push(b);g.listNode.replace(i.root)}else{k=c;g=b;a=n;j=g.contents;i=g.root.getDocument();l=[];1==j.length&&j[0].equals(g.root)&&(b=i.createElement("div"),j[0].moveChildren&&j[0].moveChildren(b),j[0].append(b),j[0]=b);g=g.contents[0].getParent();for(m=0;m<j.length;m++)g=g.getCommonAncestor(j[m].getParent());p=k.config.useComputedState;k=b=void 0;p=void 0===p||p;for(m=0;m<j.length;m++)for(o=j[m];s=o.getParent();){if(s.equals(g)){l.push(o);
!k&&o.getDirection()&&(k=1);o=o.getDirection(p);null!==b&&(b=b&&b!=o?null:o);break}o=s}if(!(1>l.length)){j=l[l.length-1].getNext();m=i.createElement(this.type);a.push(m);for(p=a=void 0;l.length;)a=l.shift(),p=i.createElement("li"),a.is("pre")||N.test(a.getName())?a.appendTo(p):(a.copyAttributes(p),b&&a.getDirection()&&(p.removeStyle("direction"),p.removeAttribute("dir")),a.moveChildren(p),a.remove()),p.appendTo(m);b&&k&&m.setAttribute("dir",b);j?m.insertBefore(j):m.appendTo(g)}}else this.state==CKEDITOR.TRISTATE_ON&&
q[b.root.getName()]&&J.call(this,c,b,h);for(m=0;m<n.length;m++)B(n[m]);CKEDITOR.dom.element.clearAllMarkers(h);e.selectBookmarks(d);c.focus()}}};var y=CKEDITOR.dtd,D=/[\t\r\n ]*(?:&nbsp;|\xa0)$/,H={elements:{}},u;for(u in y.$listItem)H.elements[u]=C();var I={elements:{}};for(u in y.$listItem)I.elements[u]=C(!0);CKEDITOR.plugins.add("list",{init:function(c){var f=c.addCommand("numberedlist",new x("numberedlist","ol")),d=c.addCommand("bulletedlist",new x("bulletedlist","ul"));c.ui.addButton("NumberedList",
{label:c.lang.numberedlist,command:"numberedlist"});c.ui.addButton("BulletedList",{label:c.lang.bulletedlist,command:"bulletedlist"});c.on("selectionChange",CKEDITOR.tools.bind(w,f));c.on("selectionChange",CKEDITOR.tools.bind(w,d));c.on("key",function(e){var d=e.data.keyCode;if("wysiwyg"==c.mode&&d in{8:1,46:1}){var a=c.getSelection().getRanges()[0];if(a.collapsed){var h=8==d,f=c.document.getBody(),g=new CKEDITOR.dom.walker(a.clone());g.evaluator=function(a){return r(a)&&!v(a)};d=a.clone();if(h){var b,
k;if((b=(new CKEDITOR.dom.elementPath(a.startContainer)).contains(q))&&a.checkBoundaryOfElement(b,CKEDITOR.START)&&(b=b.getParent())&&b.is("li")&&(b=G(b)))k=b,b=b.getPrevious(r),d.moveToPosition(b&&v(b)?b:k,CKEDITOR.POSITION_BEFORE_START);else if(g.range.setStartAt(f,CKEDITOR.POSITION_AFTER_START),g.range.setEnd(a.startContainer,a.startOffset),(b=g.previous())&&b.type==CKEDITOR.NODE_ELEMENT&&(b.getName()in q||b.is("li"))){if(!b.is("li"))g.range.selectNodeContents(b),g.reset(),g.evaluator=E,b=g.previous();
k=b;d.moveToElementEditEnd(k)}k&&(F(c,d,a),e.cancel())}else if(b=a.startContainer.getAscendant("li",1))g.range.setEndAt(f,CKEDITOR.POSITION_BEFORE_END),k=(f=b.getLast(r))&&E(f)?f:b,h=0,(b=g.next())&&b.type==CKEDITOR.NODE_ELEMENT&&b.getName()in q&&b.equals(f)?(h=1,b=g.next()):a.checkBoundaryOfElement(k,CKEDITOR.END)&&(h=1),h&&b&&(a=a.clone(),a.moveToElementEditStart(b),F(c,d,a),e.cancel());setTimeout(function(){c.selectionChange(1)})}}})},afterInit:function(c){if(c=c.dataProcessor)c.dataFilter.addRules(H),
c.htmlFilter.addRules(I)},requires:["domiterator"]})})()});