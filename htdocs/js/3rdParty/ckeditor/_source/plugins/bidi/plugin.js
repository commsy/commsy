//>>built
define("ckeditor/_source/plugins/bidi/plugin",["dijit","dojo","dojox"],function(){(function(){function r(a){var c=a.editor,e=a.data.path;if(!c.readOnly){var b=c.config.useComputedState,d,b=void 0===b||b;if(!b)for(d=e.lastElement;d&&!(d.getName()in m||d.is("body"));){var i=d.getParent();if(!i)break;d=i}d=d||e.block||e.blockLimit;d.is("body")&&(e=c.getSelection().getRanges()[0].getEnclosedNode())&&e.type==CKEDITOR.NODE_ELEMENT&&(d=e);d&&(b=b?d.getComputedStyle("direction"):d.getStyle("direction")||
d.getAttribute("dir"),c.getCommand("bidirtl").setState("rtl"==b?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),c.getCommand("bidiltr").setState("ltr"==b?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF))}c=a.editor;a=a.data.path.block||a.data.path.blockLimit;c.fire("contentDirChanged",a?a.getComputedStyle("direction"):c.lang.dir)}function n(a,c,e,b){if(!a.isReadOnly()){CKEDITOR.dom.element.setMarker(b,a,"bidi_processed",1);for(b=a;(b=b.getParent())&&!b.is("body");)if(b.getCustomData("bidi_processed")){a.removeStyle("direction");
a.removeAttribute("dir");return}b="useComputedState"in e.config?e.config.useComputedState:1;if((b?a.getComputedStyle("direction"):a.getStyle("direction")||a.hasAttribute("dir"))!=c)a.removeStyle("direction"),b?(a.removeAttribute("dir"),c!=a.getComputedStyle("direction")&&a.setAttribute("dir",c)):a.setAttribute("dir",c),e.forceNextSelectionCheck()}}function s(a,c,e){var b=a.getCommonAncestor(!1,!0),a=a.clone();a.enlarge(e==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);
if(a.checkBoundaryOfElement(b,CKEDITOR.START)&&a.checkBoundaryOfElement(b,CKEDITOR.END)){for(var d;b&&b.type==CKEDITOR.NODE_ELEMENT&&(d=b.getParent())&&1==d.getChildCount()&&!(b.getName()in c);)b=d;return b.type==CKEDITOR.NODE_ELEMENT&&b.getName()in c&&b}}function q(a){return function(c){var e=c.getSelection(),b=c.config.enterMode,d=e.getRanges();if(d&&d.length){for(var i={},f=e.createBookmarks(),d=d.createIterator(),g,j=0;g=d.getNextRange(1);){var h=g.getEnclosedNode();if(!h||h&&!(h.type==CKEDITOR.NODE_ELEMENT&&
h.getName()in o))h=s(g,p,b);h&&n(h,a,c,i);var k=new CKEDITOR.dom.walker(g),l=f[j].startNode,m=f[j++].endNode;k.evaluator=function(a){return!!(a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in p&&!(a.getName()==(b==CKEDITOR.ENTER_P?"p":"div")&&a.getParent().type==CKEDITOR.NODE_ELEMENT&&"blockquote"==a.getParent().getName())&&a.getPosition(l)&CKEDITOR.POSITION_FOLLOWING&&(a.getPosition(m)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING)};for(;h=k.next();)n(h,a,c,i);g=
g.createIterator();for(g.enlargeBr=b!=CKEDITOR.ENTER_BR;h=g.getNextParagraph(b==CKEDITOR.ENTER_P?"p":"div");)n(h,a,c,i)}CKEDITOR.dom.element.clearAllMarkers(i);c.forceNextSelectionCheck();e.selectBookmarks(f);c.focus()}}}function t(a){var c=a==j.setAttribute,e=a==j.removeAttribute,b=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(d,i){if(!this.getDocument().equals(CKEDITOR.document)){var f;if(f=d==(c||e?"dir":"direction")||"style"==d&&(e||b.test(i))){a:{f=this;for(var g=f.getDocument().getBody().getParent();f;){if(f.equals(g)){f=
!1;break a}f=f.getParent()}f=!0}f=!f}if(f&&(f=this.getDirection(1),g=a.apply(this,arguments),f!=this.getDirection(1)))return this.getDocument().fire("dirChanged",this),g}return a.apply(this,arguments)}}var p={table:1,ul:1,ol:1,blockquote:1,div:1},o={},m={};CKEDITOR.tools.extend(o,p,{tr:1,p:1,div:1,li:1});CKEDITOR.tools.extend(m,o,{td:1});CKEDITOR.plugins.add("bidi",{requires:["styles","button"],init:function(a){var c=function(b,c,e,f){a.addCommand(e,new CKEDITOR.command(a,{exec:f}));a.ui.addButton(b,
{label:c,command:e})},e=a.lang.bidi;c("BidiLtr",e.ltr,"bidiltr",q("ltr"));c("BidiRtl",e.rtl,"bidirtl",q("rtl"));a.on("selectionChange",r);a.on("contentDom",function(){a.document.on("dirChanged",function(b){a.fire("dirChanged",{node:b.data,dir:b.data.getDirection(1)})})})}});for(var j=CKEDITOR.dom.element.prototype,l=["setStyle","removeStyle","setAttribute","removeAttribute"],k=0;k<l.length;k++)j[l[k]]=CKEDITOR.tools.override(j[l[k]],t)})()});