//>>built
define("ckeditor/_source/plugins/selection/plugin",["dijit","dojo","dojox"],function(){(function(){function u(){try{var a=this.getSelection();if(a&&a.document.getWindow().$){var b=a.getStartElement(),c=new CKEDITOR.dom.elementPath(b);if(!c.compare(this._.selectionPreviousPath))this._.selectionPreviousPath=c,this.fire("selectionChange",{selection:a,path:c,element:b})}}catch(d){}}function q(){g=!0;l||(t.call(this),l=CKEDITOR.tools.setTimeout(t,200,this))}function t(){l=null;g&&(CKEDITOR.tools.setTimeout(u,
0,this),g=!1)}function r(a){function b(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in CKEDITOR.dtd.$removeEmpty}function c(b){var d=a.document.getBody();return!b.is("body")&&1==d.getChildCount()}var d=a.startContainer,i=a.startOffset;return d.type==CKEDITOR.NODE_TEXT?!1:!CKEDITOR.tools.trim(d.getHtml())?b(d)||c(d):b(d.getChild(i-1))||b(d.getChild(i))}function s(a){return a&&a.getCustomData("cke-fillingChar")}function k(a){var b=a&&a.removeCustomData("cke-fillingChar");if(b){var c,d=(a=
a.getSelection().getNative())&&"None"!=a.type&&a.getRangeAt(0);if(1<b.getLength()&&d&&d.intersectsNode(b.$)){c=[a.anchorOffset,a.focusOffset];d=a.focusNode==b.$&&0<a.focusOffset;a.anchorNode==b.$&&0<a.anchorOffset&&c[0]--;d&&c[1]--;var i;if(!a.isCollapsed)i=a.getRangeAt(0),i.setStart(a.anchorNode,a.anchorOffset),i.setEnd(a.focusNode,a.focusOffset),i=i.collapsed;i&&c.unshift(c.pop())}b.setText(b.getText().replace(/\u200B/g,""));c&&(b=a.getRangeAt(0),b.setStart(b.startContainer,c[0]),b.setEnd(b.startContainer,
c[1]),a.removeAllRanges(),a.addRange(b))}}var l,g,h={modes:{wysiwyg:1,source:1},readOnly:CKEDITOR.env.ie||CKEDITOR.env.webkit,exec:function(a){switch(a.mode){case "wysiwyg":a.document.$.execCommand("SelectAll",!1,null);a.forceNextSelectionCheck();a.selectionChange();break;case "source":a=a.textarea.$,CKEDITOR.env.ie?a.createTextRange().execCommand("SelectAll"):(a.selectionStart=0,a.selectionEnd=a.value.length),a.focus()}},canUndo:!1};CKEDITOR.plugins.add("selection",{init:function(a){if(CKEDITOR.env.webkit){a.on("selectionChange",
function(){var b=a.document,d=b&&s(b);d&&(d.getCustomData("ready")?k(b):d.setCustomData("ready",1))});a.on("beforeSetMode",function(){k(a.document)});var b,c,d=function(){var d=a.document,f=s(d);f&&(d=d.$.defaultView.getSelection(),"Caret"==d.type&&d.anchorNode==f.$&&(c=1),b=f.getText(),f.setText(b.replace(/\u200B/g,"")))},i=function(){var d=a.document,f=s(d);f&&(f.setText(b),c&&(d.$.defaultView.getSelection().setPosition(f.$,f.getLength()),c=0))};a.on("beforeUndoImage",d);a.on("afterUndoImage",i);
a.on("beforeGetData",d,null,null,0);a.on("getData",i)}a.on("contentDom",function(){var b=a.document,d=b.getBody(),c=b.getDocumentElement();if(CKEDITOR.env.ie){var i,j,m=1;d.on("focusin",function(a){if("BODY"==a.data.$.srcElement.nodeName)if(a=b.getCustomData("cke_locked_selection"))a.unlock(1),a.lock();else if(i&&m){try{i.select()}catch(d){}i=null}});d.on("focus",function(){j=1;o()});d.on("beforedeactivate",function(a){a.data.$.toElement||(j=0,m=1)});CKEDITOR.env.ie&&a.on("blur",function(){try{b.$.selection.empty()}catch(a){}});
c.on("mousedown",function(){m=0});c.on("mouseup",function(){m=1});var g;d.on("mousedown",function(b){2==b.data.$.button&&"None"==a.document.$.selection.type&&(g=a.window.getScrollPosition());j=0});d.on("mouseup",function(b){if(2==b.data.$.button&&g)a.document.$.documentElement.scrollLeft=g.x,a.document.$.documentElement.scrollTop=g.y;g=null;j=1;setTimeout(function(){o(!0)},0)});d.on("keydown",h);d.on("keyup",function(){j=1;o()});if((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&"BackCompat"!=b.$.compatMode)c.on("mousedown",
function(a){function b(a){a=a.data.$;if(e){var c=d.$.createTextRange();try{c.moveToPoint(a.x,a.y)}catch(i){}e.setEndPoint(0>e.compareEndPoints("StartToStart",c)?"EndToEnd":"StartToStart",c);e.select()}}a=a.data.$;if(a.y<c.$.clientHeight&&a.y>d.$.offsetTop+d.$.clientHeight&&a.x<c.$.clientWidth){var e=d.$.createTextRange();try{e.moveToPoint(a.x,a.y)}catch(i){}c.on("mousemove",b);c.on("mouseup",function(a){c.removeListener("mousemove",b);a.removeListener();e.select()})}});if(CKEDITOR.env.ie8)c.on("mouseup",
function(a){if("html"==a.data.getTarget().getName()){var a=CKEDITOR.document.$.selection,d=a.createRange();"None"!=a.type&&d.parentElement().ownerDocument==b.$&&d.select()}});b.on("selectionchange",o);var h=function(){j=0},o=function(b){if(j){var d=a.document,c=a.getSelection(),e=c&&c.getNative();if(b&&e&&"None"==e.type&&!d.$.queryCommandEnabled("InsertImage"))CKEDITOR.tools.setTimeout(o,50,this,!0);else{var f;if(!e||!e.type||!("Control"!=e.type&&(f=e.createRange())&&(f=f.parentElement())&&(f=f.nodeName)&&
f.toLowerCase()in{input:1,textarea:1}))i=e&&c.getRanges()[0],q.call(a)}}}}else b.on("mouseup",q,a),b.on("keyup",q,a),b.on("selectionchange",q,a);if(CKEDITOR.env.webkit)b.on("keydown",function(b){switch(b.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:k(a.document)}},null,null,10)});a.on("contentDomUnload",a.forceNextSelectionCheck,a);a.addCommand("selectAll",h);a.ui.addButton("SelectAll",{label:a.lang.selectAll,command:"selectAll"});a.selectionChange=
function(a){(a?u:q).call(this)};CKEDITOR.env.ie9Compat&&a.on("destroy",function(){var b=a.getSelection();b&&b.getNative().clear()},null,null,9)}});CKEDITOR.editor.prototype.getSelection=function(){return this.document&&this.document.getSelection()};CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath};CKEDITOR.dom.document.prototype.getSelection=function(){var a=new CKEDITOR.dom.selection(this);return!a||a.isInvalid?null:a};CKEDITOR.SELECTION_NONE=1;CKEDITOR.SELECTION_TEXT=
2;CKEDITOR.SELECTION_ELEMENT=3;CKEDITOR.dom.selection=function(a){var b=a.getCustomData("cke_locked_selection");if(b)return b;this.document=a;this.isLocked=0;this._={cache:{}};if(CKEDITOR.env.ie)try{var c=this.getNative().createRange();if(!c||c.item&&c.item(0).ownerDocument!=this.document.$||c.parentElement&&c.parentElement().ownerDocument!=this.document.$)throw 0;}catch(d){this.isInvalid=!0}return this};var v={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,
textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:CKEDITOR.env.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.$.selection)}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.getWindow().$.getSelection())},getType:CKEDITOR.env.ie?function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_NONE;try{var c=this.getNative(),d=c.type;if("Text"==d)b=CKEDITOR.SELECTION_TEXT;if("Control"==
d)b=CKEDITOR.SELECTION_ELEMENT;if(c.createRange().parentElement)b=CKEDITOR.SELECTION_TEXT}catch(i){}return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_TEXT,c=this.getNative();if(c){if(1==c.rangeCount){var c=c.getRangeAt(0),d=c.startContainer;if(d==c.endContainer&&1==d.nodeType&&1==c.endOffset-c.startOffset&&v[d.childNodes[c.startOffset].nodeName.toLowerCase()])b=CKEDITOR.SELECTION_ELEMENT}}else b=CKEDITOR.SELECTION_NONE;return a.type=b},getRanges:function(){var a=
CKEDITOR.env.ie?function(){function a(b){return(new CKEDITOR.dom.node(b)).getIndex()}var c=function(d,c){d=d.duplicate();d.collapse(c);var e=d.parentElement(),f=e.ownerDocument;if(!e.hasChildNodes())return{container:e,offset:0};for(var n=e.children,g,j,m=d.duplicate(),h=0,k=n.length-1,o=-1,p,l;h<=k;)if(o=Math.floor((h+k)/2),g=n[o],m.moveToElementText(g),p=m.compareEndPoints("StartToStart",d),0<p)k=o-1;else if(0>p)h=o+1;else return CKEDITOR.env.ie9Compat&&"BR"==g.tagName?(n=f.defaultView.getSelection(),
{container:n[c?"anchorNode":"focusNode"],offset:n[c?"anchorOffset":"focusOffset"]}):{container:e,offset:a(g)};if(-1==o||o==n.length-1&&0>p){m.moveToElementText(e);m.setEndPoint("StartToStart",d);f=m.text.replace(/(\r\n|\r)/g,"\n").length;n=e.childNodes;if(!f)return g=n[n.length-1],g.nodeType!=CKEDITOR.NODE_TEXT?{container:e,offset:n.length}:{container:g,offset:g.nodeValue.length};for(e=n.length;0<f&&0<e;)j=n[--e],j.nodeType==CKEDITOR.NODE_TEXT&&(l=j,f-=j.nodeValue.length);return{container:l,offset:-f}}m.collapse(0<
p?!0:!1);m.setEndPoint(0<p?"StartToStart":"EndToStart",d);f=m.text.replace(/(\r\n|\r)/g,"\n").length;if(!f)return{container:e,offset:a(g)+(0<p?0:1)};for(;0<f;)try{j=g[0<p?"previousSibling":"nextSibling"],j.nodeType==CKEDITOR.NODE_TEXT&&(f-=j.nodeValue.length,l=j),g=j}catch(q){return{container:e,offset:a(g)}}return{container:l,offset:0<p?-f:l.nodeValue.length+f}};return function(){var a=this.getNative(),b=a&&a.createRange(),e=this.getType();if(!a)return[];if(e==CKEDITOR.SELECTION_TEXT)return a=new CKEDITOR.dom.range(this.document),
e=c(b,!0),a.setStart(new CKEDITOR.dom.node(e.container),e.offset),e=c(b),a.setEnd(new CKEDITOR.dom.node(e.container),e.offset),a.endContainer.getPosition(a.startContainer)&CKEDITOR.POSITION_PRECEDING&&a.endOffset<=a.startContainer.getIndex()&&a.collapse(),[a];if(e==CKEDITOR.SELECTION_ELEMENT){for(var e=[],f=0;f<b.length;f++){for(var g=b.item(f),h=g.parentNode,j=0,a=new CKEDITOR.dom.range(this.document);j<h.childNodes.length&&h.childNodes[j]!=g;j++);a.setStart(new CKEDITOR.dom.node(h),j);a.setEnd(new CKEDITOR.dom.node(h),
j+1);e.push(a)}return e}return[]}}():function(){var a=[],c,d=this.document,i=this.getNative();if(!i)return a;i.rangeCount||(c=new CKEDITOR.dom.range(d),c.moveToElementEditStart(d.getBody()),a.push(c));for(var e=0;e<i.rangeCount;e++){var f=i.getRangeAt(e);c=new CKEDITOR.dom.range(d);c.setStart(new CKEDITOR.dom.node(f.startContainer),f.startOffset);c.setEnd(new CKEDITOR.dom.node(f.endContainer),f.endOffset);a.push(c)}return a};return function(b){var c=this._.cache;if(c.ranges&&!b)return c.ranges;if(!c.ranges)c.ranges=
new CKEDITOR.dom.rangeList(a.call(this));if(b)for(var d=c.ranges,i=0;i<d.length;i++){var e=d[i];e.getCommonAncestor().isReadOnly()&&d.splice(i,1);if(!e.collapsed){if(e.startContainer.isReadOnly())for(b=e.startContainer;b&&!b.is("body")&&b.isReadOnly();){b.type==CKEDITOR.NODE_ELEMENT&&"false"==b.getAttribute("contentEditable")&&e.setStartAfter(b);b=b.getParent()}var b=e.startContainer,f=e.endContainer,g=e.startOffset,h=e.endOffset,j=e.clone();b&&b.type==CKEDITOR.NODE_TEXT&&(g>=b.getLength()?j.setStartAfter(b):
j.setStartBefore(b));f&&f.type==CKEDITOR.NODE_TEXT&&(h?j.setEndAfter(f):j.setEndBefore(f));b=new CKEDITOR.dom.walker(j);b.evaluator=function(a){if(a.type==CKEDITOR.NODE_ELEMENT&&a.isReadOnly()){var b=e.clone();e.setEndBefore(a);e.collapsed&&d.splice(i--,1);a.getPosition(j.endContainer)&CKEDITOR.POSITION_CONTAINS||(b.setStartAfter(a),b.collapsed||d.splice(i+1,0,b));return!0}return!1};b.next()}}return c.ranges}}(),getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;
var b;this.getNative();switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var c=this.getRanges()[0];if(c){if(c.collapsed)b=c.startContainer,b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent());else{for(c.optimize();;)if(b=c.startContainer,c.startOffset==(b.getChildCount?b.getChildCount():b.getLength())&&!b.isBlockBoundary())c.setStartAfter(b);else break;b=c.startContainer;if(b.type!=CKEDITOR.NODE_ELEMENT)return b.getParent();b=b.getChild(c.startOffset);
if(!b||b.type!=CKEDITOR.NODE_ELEMENT)b=c.startContainer;else for(c=b.getFirst();c&&c.type==CKEDITOR.NODE_ELEMENT;)b=c,c=c.getFirst()}b=b.$}}return a.startElement=b?new CKEDITOR.dom.element(b):null},getSelectedElement:function(){var a=this._.cache;if(void 0!==a.selectedElement)return a.selectedElement;var b=this,c=CKEDITOR.tools.tryThese(function(){return b.getNative().createRange().item(0)},function(){var a,c,e=b.getRanges()[0],f=e.getCommonAncestor(1,1),g={table:1,ul:1,ol:1,dl:1},h;for(h in g)if(a=
f.getAscendant(h,1))break;if(a){f=new CKEDITOR.dom.range(this.document);f.setStartAt(a,CKEDITOR.POSITION_AFTER_START);f.setEnd(e.startContainer,e.startOffset);var j=CKEDITOR.tools.extend(g,CKEDITOR.dtd.$listItem,CKEDITOR.dtd.$tableContent),g=new CKEDITOR.dom.walker(f);h=function(a,b){return function(c,d){if(c.type==CKEDITOR.NODE_TEXT&&(!CKEDITOR.tools.trim(c.getText())||c.getParent().data("cke-bookmark")))return!0;var e;if(c.type==CKEDITOR.NODE_ELEMENT&&(e=c.getName(),"br"==e&&b&&c.equals(c.getParent().getBogus())||
d&&e in j||e in CKEDITOR.dtd.$removeEmpty))return!0;a.halted=1;return!1}};g.guard=h(g);if(g.checkBackward()&&!g.halted&&(g=new CKEDITOR.dom.walker(f),f.setStart(e.endContainer,e.endOffset),f.setEndAt(a,CKEDITOR.POSITION_BEFORE_END),g.guard=h(g,1),g.checkForward()&&!g.halted))c=a.$}if(!c)throw 0;return c},function(){for(var a=b.getRanges()[0],c,e,f=2;f&&(!(c=a.getEnclosedNode())||!(c.type==CKEDITOR.NODE_ELEMENT&&v[c.getName()]&&(e=c)));f--)a.shrink(CKEDITOR.SHRINK_ELEMENT);return e.$});return a.selectedElement=
c?new CKEDITOR.dom.element(c):null},getSelectedText:function(){var a=this._.cache;if(void 0!==a.selectedText)return a.selectedText;var b="",c=this.getNative();this.getType()==CKEDITOR.SELECTION_TEXT&&(b=CKEDITOR.env.ie?c.createRange().text:c.toString());return a.selectedText=b},lock:function(){this.getRanges();this.getStartElement();this.getSelectedElement();this.getSelectedText();this._.cache.nativeSel={};this.isLocked=1;this.document.setCustomData("cke_locked_selection",this)},unlock:function(a){var b=
this.document,c=b.getCustomData("cke_locked_selection");if(c&&(b.setCustomData("cke_locked_selection",null),a)){var b=c.getSelectedElement(),d=!b&&c.getRanges();this.isLocked=0;this.reset();b?this.selectElement(b):this.selectRanges(d)}if(!c||!a)this.isLocked=0,this.reset()},reset:function(){this._.cache={}},selectElement:function(a){if(this.isLocked){var b=new CKEDITOR.dom.range(this.document);b.setStartBefore(a);b.setEndAfter(a);this._.cache.selectedElement=a;this._.cache.startElement=a;this._.cache.ranges=
new CKEDITOR.dom.rangeList(b);this._.cache.type=CKEDITOR.SELECTION_ELEMENT}else b=new CKEDITOR.dom.range(a.getDocument()),b.setStartBefore(a),b.setEndAfter(a),b.select(),this.document.fire("selectionchange"),this.reset()},selectRanges:function(a){if(this.isLocked)this._.cache.selectedElement=null,this._.cache.startElement=a[0]&&a[0].getTouchedStartNode(),this._.cache.ranges=new CKEDITOR.dom.rangeList(a),this._.cache.type=CKEDITOR.SELECTION_TEXT;else{if(CKEDITOR.env.ie){if(1<a.length){var b=a[a.length-
1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;a.length&&(b.removeAllRanges(),CKEDITOR.env.webkit&&k(this.document));for(var c=0;c<a.length;c++){if(c<a.length-1){var d=a[c],g=a[c+1],e=d.clone();e.setStart(d.endContainer,d.endOffset);e.setEnd(g.startContainer,g.startOffset);if(!e.collapsed){e.shrink(CKEDITOR.NODE_ELEMENT,!0);var f=e.getCommonAncestor(),e=e.getEnclosedNode();if(f.isReadOnly()||e&&e.isReadOnly()){g.setStart(d.startContainer,
d.startOffset);a.splice(c--,1);continue}}}d=a[c];g=this.document.$.createRange();f=d.startContainer;d.collapsed&&(CKEDITOR.env.opera||CKEDITOR.env.gecko&&10900>CKEDITOR.env.version)&&f.type==CKEDITOR.NODE_ELEMENT&&!f.getChildCount()&&f.appendText("");if(d.collapsed&&CKEDITOR.env.webkit&&r(d))f=this.document,k(f),e=f.createText("\u200b"),f.setCustomData("cke-fillingChar",e),f=e,d.insertNode(f),(e=f.getNext())&&!f.getPrevious()&&e.type==CKEDITOR.NODE_ELEMENT&&"br"==e.getName()?(k(this.document),d.moveToPosition(e,
CKEDITOR.POSITION_BEFORE_START)):d.moveToPosition(f,CKEDITOR.POSITION_AFTER_END);g.setStart(d.startContainer.$,d.startOffset);try{g.setEnd(d.endContainer.$,d.endOffset)}catch(h){if(0<=h.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))d.collapse(1),g.setEnd(d.endContainer.$,d.endOffset);else throw h;}b.addRange(g)}this.document.fire("selectionchange")}this.reset()}},createBookmarks:function(a){return this.getRanges().createBookmarks(a)},createBookmarks2:function(a){return this.getRanges().createBookmarks2(a)},
selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var d=new CKEDITOR.dom.range(this.document);d.moveToBookmark(a[c]);b.push(d)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=this.getRanges();return a[0].startContainer.getCommonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){this.getStartElement().scrollIntoView()}}})();(function(){var u=CKEDITOR.dom.walker.whitespaces(!0),q=/\ufeff|\u00a0/,t={table:1,tbody:1,tr:1};CKEDITOR.dom.range.prototype.select=
CKEDITOR.env.ie?function(r){var s=this.collapsed,k,l,g,h=this.getEnclosedNode();if(h)try{g=this.document.$.body.createControlRange();g.addElement(h.$);g.select();return}catch(v){}(this.startContainer.type==CKEDITOR.NODE_ELEMENT&&this.startContainer.getName()in t||this.endContainer.type==CKEDITOR.NODE_ELEMENT&&this.endContainer.getName()in t)&&this.shrink(CKEDITOR.NODE_ELEMENT,!0);g=this.createBookmark();var h=g.startNode,a;if(!s)a=g.endNode;g=this.document.$.body.createTextRange();g.moveToElementText(h.$);
g.moveStart("character",1);a?(r=this.document.$.body.createTextRange(),r.moveToElementText(a.$),g.setEndPoint("EndToEnd",r),g.moveEnd("character",-1)):(k=h.getNext(u),k=!(k&&k.getText&&k.getText().match(q))&&(r||!h.hasPrevious()||h.getPrevious().is&&h.getPrevious().is("br")),l=this.document.createElement("span"),l.setHtml("&#65279;"),l.insertBefore(h),k&&this.document.createText("\ufeff").insertBefore(h));this.setStartBefore(h);h.remove();s?(k?(g.moveStart("character",-1),g.select(),this.document.$.selection.clear()):
g.select(),this.moveToPosition(l,CKEDITOR.POSITION_BEFORE_START),l.remove()):(this.setEndBefore(a),a.remove(),g.select());this.document.fire("selectionchange")}:function(){this.document.getSelection().selectRanges([this])}})()});