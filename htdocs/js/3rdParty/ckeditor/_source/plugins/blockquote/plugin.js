//>>built
define("ckeditor/_source/plugins/blockquote/plugin",["dijit","dojo","dojox"],function(){(function(){function j(e){var a=e.editor;if(!a.readOnly)a=a.getCommand("blockquote"),e=e.data.path,e=e.block||e.blockLimit,e=!e||"body"==e.getName()?CKEDITOR.TRISTATE_OFF:e.getAscendant("blockquote",!0)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF,a.state=e,a.fire("state")}var l={exec:function(e){var a=e.getCommand("blockquote").state,i=e.getSelection(),c=i&&i.getRanges(!0)[0];if(c){var h=i.createBookmarks();if(CKEDITOR.env.ie){var f=
h[0].startNode,b=h[0].endNode,d;if(f&&"blockquote"==f.getParent().getName())for(d=f;d=d.getNext();)if(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()){f.move(d,!0);break}if(b&&"blockquote"==b.getParent().getName())for(d=b;d=d.getPrevious();)if(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()){b.move(d);break}}var g=c.createIterator();g.enlargeBr=e.config.enterMode!=CKEDITOR.ENTER_BR;if(a==CKEDITOR.TRISTATE_OFF){for(f=[];a=g.getNextParagraph();)f.push(a);1>f.length&&(a=e.document.createElement(e.config.enterMode==
CKEDITOR.ENTER_P?"p":"div"),b=h.shift(),c.insertNode(a),a.append(new CKEDITOR.dom.text("\ufeff",e.document)),c.moveToBookmark(b),c.selectNodeContents(a),c.collapse(!0),b=c.createBookmark(),f.push(a),h.unshift(b));d=f[0].getParent();c=[];for(b=0;b<f.length;b++)a=f[b],d=d.getCommonAncestor(a.getParent());for(a={table:1,tbody:1,tr:1,ol:1,ul:1};a[d.getName()];)d=d.getParent();for(b=null;0<f.length;){for(a=f.shift();!a.getParent().equals(d);)a=a.getParent();a.equals(b)||c.push(a);b=a}for(;0<c.length;)if(a=
c.shift(),"blockquote"==a.getName()){for(b=new CKEDITOR.dom.documentFragment(e.document);a.getFirst();)b.append(a.getFirst().remove()),f.push(b.getLast());b.replace(a)}else f.push(a);c=e.document.createElement("blockquote");for(c.insertBefore(f[0]);0<f.length;)a=f.shift(),c.append(a)}else if(a==CKEDITOR.TRISTATE_ON){b=[];for(d={};a=g.getNextParagraph();){for(f=c=null;a.getParent();){if("blockquote"==a.getParent().getName()){c=a.getParent();f=a;break}a=a.getParent()}c&&f&&!f.getCustomData("blockquote_moveout")&&
(b.push(f),CKEDITOR.dom.element.setMarker(d,f,"blockquote_moveout",!0))}CKEDITOR.dom.element.clearAllMarkers(d);a=[];f=[];for(d={};0<b.length;)g=b.shift(),c=g.getParent(),g.getPrevious()?g.getNext()?(g.breakParent(g.getParent()),f.push(g.getNext())):g.remove().insertAfter(c):g.remove().insertBefore(c),c.getCustomData("blockquote_processed")||(f.push(c),CKEDITOR.dom.element.setMarker(d,c,"blockquote_processed",!0)),a.push(g);CKEDITOR.dom.element.clearAllMarkers(d);for(b=f.length-1;0<=b;b--){c=f[b];
a:{d=c;for(var g=0,j=d.getChildCount(),k=void 0;g<j&&(k=d.getChild(g));g++)if(k.type==CKEDITOR.NODE_ELEMENT&&k.isBlockBoundary()){d=!1;break a}d=!0}d&&c.remove()}if(e.config.enterMode==CKEDITOR.ENTER_BR)for(c=!0;a.length;)if(g=a.shift(),"div"==g.getName()){b=new CKEDITOR.dom.documentFragment(e.document);c&&g.getPrevious()&&!(g.getPrevious().type==CKEDITOR.NODE_ELEMENT&&g.getPrevious().isBlockBoundary())&&b.append(e.document.createElement("br"));for(c=g.getNext()&&!(g.getNext().type==CKEDITOR.NODE_ELEMENT&&
g.getNext().isBlockBoundary());g.getFirst();)g.getFirst().remove().appendTo(b);c&&b.append(e.document.createElement("br"));b.replace(g);c=!1}}i.selectBookmarks(h);e.focus()}}};CKEDITOR.plugins.add("blockquote",{init:function(e){e.addCommand("blockquote",l);e.ui.addButton("Blockquote",{label:e.lang.blockquote,command:"blockquote"});e.on("selectionChange",j)},requires:["domiterator"]})})()});