//>>built
define("ckeditor/_source/plugins/link/plugin",["dijit","dojo","dojox"],function(){CKEDITOR.plugins.add("link",{requires:["fakeobjects","dialog"],init:function(b){b.addCommand("link",new CKEDITOR.dialogCommand("link"));b.addCommand("anchor",new CKEDITOR.dialogCommand("anchor"));b.addCommand("unlink",new CKEDITOR.unlinkCommand);b.addCommand("removeAnchor",new CKEDITOR.removeAnchorCommand);b.ui.addButton("Link",{label:b.lang.link.toolbar,command:"link"});b.ui.addButton("Unlink",{label:b.lang.unlink,
command:"unlink"});b.ui.addButton("Anchor",{label:b.lang.anchor.toolbar,command:"anchor"});CKEDITOR.dialog.add("link",this.path+"dialogs/link.js");CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js");var c="rtl"==b.lang.dir?"right":"left",e="background:url("+CKEDITOR.getUrl(this.path+"images/anchor.gif")+") no-repeat "+c+" center;border:1px dotted #00f;";b.addCss("a.cke_anchor,a.cke_anchor_empty"+(CKEDITOR.env.ie&&7>CKEDITOR.env.version?"":",a[name],a[data-cke-saved-name]")+"{"+e+"padding-"+
c+":18px;cursor:auto;}"+(CKEDITOR.env.ie?"a.cke_anchor_empty{display:inline-block;}":"")+"img.cke_anchor{"+e+"width:16px;min-height:15px;height:1.15em;vertical-align:"+(CKEDITOR.env.opera?"middle":"text-bottom")+";}");b.on("selectionChange",function(a){if(!b.readOnly){var d=b.getCommand("unlink");(a=a.data.path.lastElement&&a.data.path.lastElement.getAscendant("a",!0))&&"a"==a.getName()&&a.getAttribute("href")&&a.getChildCount()?d.setState(CKEDITOR.TRISTATE_OFF):d.setState(CKEDITOR.TRISTATE_DISABLED)}});
b.on("doubleclick",function(a){var d=CKEDITOR.plugins.link.getSelectedLink(b)||a.data.element;if(!d.isReadOnly())if(d.is("a"))a.data.dialog=d.getAttribute("name")&&(!d.getAttribute("href")||!d.getChildCount())?"anchor":"link",b.getSelection().selectElement(d);else if(CKEDITOR.plugins.link.tryRestoreFakeAnchor(b,d))a.data.dialog="anchor"});b.addMenuItems&&b.addMenuItems({anchor:{label:b.lang.anchor.menu,command:"anchor",group:"anchor",order:1},removeAnchor:{label:b.lang.anchor.remove,command:"removeAnchor",
group:"anchor",order:5},link:{label:b.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:b.lang.unlink,command:"unlink",group:"link",order:5}});b.contextMenu&&b.contextMenu.addListener(function(a){if(!a||a.isReadOnly())return null;a=CKEDITOR.plugins.link.tryRestoreFakeAnchor(b,a);if(!a&&!(a=CKEDITOR.plugins.link.getSelectedLink(b)))return null;var d={};a.getAttribute("href")&&a.getChildCount()&&(d={link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF});if(a&&a.hasAttribute("name"))d.anchor=
d.removeAnchor=CKEDITOR.TRISTATE_OFF;return d})},afterInit:function(b){var c=b.dataProcessor,e=c&&c.dataFilter,c=c&&c.htmlFilter,a=b._.elementsPath&&b._.elementsPath.filters;e&&e.addRules({elements:{a:function(a){var c=a.attributes;if(!c.name)return null;var e=!a.children.length;if(CKEDITOR.plugins.link.synAnchorSelector){var a=e?"cke_anchor_empty":"cke_anchor",g=c["class"];if(c.name&&(!g||0>g.indexOf(a)))c["class"]=(g||"")+" "+a;if(e&&CKEDITOR.plugins.link.emptyAnchorFix)c.contenteditable="false",
c["data-cke-editable"]=1}else if(CKEDITOR.plugins.link.fakeAnchor&&e)return b.createFakeParserElement(a,"cke_anchor","anchor");return null}}});CKEDITOR.plugins.link.emptyAnchorFix&&c&&c.addRules({elements:{a:function(a){delete a.attributes.contenteditable}}});a&&a.push(function(a,c){if("a"==c&&(CKEDITOR.plugins.link.tryRestoreFakeAnchor(b,a)||a.getAttribute("name")&&(!a.getAttribute("href")||!a.getChildCount())))return"anchor"})}});CKEDITOR.plugins.link={getSelectedLink:function(b){try{var c=b.getSelection();
if(c.getType()==CKEDITOR.SELECTION_ELEMENT){var e=c.getSelectedElement();if(e.is("a"))return e}var a=c.getRanges(!0)[0];a.shrink(CKEDITOR.SHRINK_TEXT);return a.getCommonAncestor().getAscendant("a",!0)}catch(d){return null}},fakeAnchor:CKEDITOR.env.opera||CKEDITOR.env.webkit,synAnchorSelector:CKEDITOR.env.ie,emptyAnchorFix:CKEDITOR.env.ie&&8>CKEDITOR.env.version,tryRestoreFakeAnchor:function(b,c){if(c&&c.data("cke-real-element-type")&&"anchor"==c.data("cke-real-element-type")){var e=b.restoreRealElement(c);
if(e.data("cke-saved-name"))return e}}};CKEDITOR.unlinkCommand=function(){};CKEDITOR.unlinkCommand.prototype={exec:function(b){for(var c=b.getSelection(),e=c.createBookmarks(),a=c.getRanges(),d,f=0;f<a.length;f++)d=a[f].getCommonAncestor(!0),(d=d.getAscendant("a",!0))&&a[f].selectNodeContents(d);c.selectRanges(a);b.document.$.execCommand("unlink",!1,null);c.selectBookmarks(e)},startDisabled:!0};CKEDITOR.removeAnchorCommand=function(){};CKEDITOR.removeAnchorCommand.prototype={exec:function(b){var c=
b.getSelection(),e=c.createBookmarks(),a;if(c&&(a=c.getSelectedElement())&&(CKEDITOR.plugins.link.fakeAnchor&&!a.getChildCount()?CKEDITOR.plugins.link.tryRestoreFakeAnchor(b,a):a.is("a")))a.remove(1);else if(a=CKEDITOR.plugins.link.getSelectedLink(b))a.hasAttribute("href")?(a.removeAttributes({name:1,"data-cke-saved-name":1}),a.removeClass("cke_anchor")):a.remove(1);c.selectBookmarks(e)}};CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0})});