//>>built
define("ckeditor/_source/plugins/enterkey/plugin",["dijit","dojo","dojox"],function(){(function(){function n(a,d,c){c=a.config.forceEnterMode||c;if("wysiwyg"!=a.mode)return!1;if(!d)d=a.config.enterMode;setTimeout(function(){a.fire("saveSnapshot");d==CKEDITOR.ENTER_BR?m(a,d,null,c):o(a,d,null,c);a.fire("saveSnapshot")},0);return!0}function p(a){for(var a=a.getSelection().getRanges(!0),d=a.length-1;0<d;d--)a[d].deleteContents();return a[0]}CKEDITOR.plugins.add("enterkey",{requires:["keystrokes","indent"],
init:function(a){a.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(a){n(a)}});a.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(a){"wysiwyg"!=a.mode||n(a,a.config.shiftEnterMode,1)}});a=a.keystrokeHandler.keystrokes;a[13]="enter";a[CKEDITOR.SHIFT+13]="shiftEnter"}});CKEDITOR.plugins.enterkey={enterBlock:function(a,d,c,j){if(c=c||p(a)){var e=c.document,h=c.checkStartOfBlock(),i=c.checkEndOfBlock(),b=(new CKEDITOR.dom.elementPath(c.startContainer)).block;if(h&&
i){if(b&&(b.is("li")||b.getParent().is("li"))){a.execCommand("outdent");return}if(b&&b.getParent().is("blockquote")){b.breakParent(b.getParent());b.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||b.getPrevious().remove();b.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||b.getNext().remove();c.moveToElementEditStart(b);c.select();return}}else if(b&&b.is("pre")){if(!i){m(a,d,c,j);return}}else if(b&&CKEDITOR.dtd.$captionBlock[b.getName()]){m(a,d,c,j);return}var b=d==CKEDITOR.ENTER_DIV?
"div":"p",k=c.splitBlock(b);if(k){var a=k.previousBlock,d=k.nextBlock,h=k.wasStartOfBlock,i=k.wasEndOfBlock,f;if(d)f=d.getParent(),f.is("li")&&(d.breakParent(f),d.move(d.getNext(),1));else if(a&&(f=a.getParent())&&f.is("li"))a.breakParent(f),f=a.getNext(),c.moveToElementEditStart(f),a.move(a.getPrevious());if(!h&&!i){if(d.is("li")&&(f=d.getFirst(CKEDITOR.dom.walker.invisible(!0)))&&f.is&&f.is("ul","ol"))(CKEDITOR.env.ie?e.createText("\u00a0"):e.createElement("br")).insertBefore(f);d&&c.moveToElementEditStart(d)}else{var g,
l;if(a){if(a.is("li")||!q.test(a.getName())&&!a.is("pre"))g=a.clone()}else d&&(g=d.clone());g?j&&!g.is("li")&&g.renameNode(b):f&&f.is("li")?g=f:(g=e.createElement(b),a&&(l=a.getDirection())&&g.setAttribute("dir",l));if(j=k.elementPath){f=0;for(l=j.elements.length;f<l;f++){b=j.elements[f];if(b.equals(j.block)||b.equals(j.blockLimit))break;CKEDITOR.dtd.$removeEmpty[b.getName()]&&(b=b.clone(),g.moveChildren(b),g.append(b))}}CKEDITOR.env.ie||g.appendBogus();g.getParent()||c.insertNode(g);g.is("li")&&
g.removeAttribute("value");if(CKEDITOR.env.ie&&h&&(!i||!a.getChildCount()))c.moveToElementEditStart(i?a:g),c.select();c.moveToElementEditStart(h&&!i?d:g)}CKEDITOR.env.ie||(d?(e=e.createElement("span"),e.setHtml("&nbsp;"),c.insertNode(e),e.scrollIntoView(),c.deleteContents()):g.scrollIntoView());c.select()}}},enterBr:function(a,d,c,j){if(c=c||p(a)){var e=c.document,h=c.checkEndOfBlock(),i=new CKEDITOR.dom.elementPath(a.getSelection().getStartElement()),b=i.block,k=b&&i.block.getName(),i=!1;!j&&"li"==
k?o(a,d,c,j):(!j&&h&&q.test(k)?(h=b.getDirection())?(e=e.createElement("div"),e.setAttribute("dir",h),e.insertAfter(b),c.setStart(e,0)):(e.createElement("br").insertAfter(b),CKEDITOR.env.gecko&&e.createText("").insertAfter(b),c.setStartAt(b.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(b=(i="pre"==k)&&!CKEDITOR.env.gecko?e.createText(CKEDITOR.env.ie?"\r":"\n"):e.createElement("br"),c.deleteContents(),c.insertNode(b),CKEDITOR.env.ie?c.setStartAt(b,CKEDITOR.POSITION_AFTER_END):
(e.createText("\ufeff").insertAfter(b),h&&b.getParent().appendBogus(),b.getNext().$.nodeValue="",c.setStartAt(b.getNext(),CKEDITOR.POSITION_AFTER_START),h=null,CKEDITOR.env.gecko?h=e.createElement("br"):(h=e.createElement("span"),h.setHtml("&nbsp;")),h.insertBefore(b.getNext()),h.scrollIntoView(),h.remove())),c.collapse(!0),c.select(i))}}};var r=CKEDITOR.plugins.enterkey,m=r.enterBr,o=r.enterBlock,q=/^h[1-6]$/})()});