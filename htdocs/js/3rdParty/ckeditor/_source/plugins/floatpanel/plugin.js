//>>built
define("ckeditor/_source/plugins/floatpanel/plugin",["dijit","dojo","dojox"],function(){CKEDITOR.plugins.add("floatpanel",{requires:["panel"]});(function(){function o(a,b,d,g,h){var h=CKEDITOR.tools.genKey(b.getUniqueId(),d.getUniqueId(),a.skinName,a.lang.dir,a.uiColor||"",g.css||"",h||""),e=i[h];if(!e)e=i[h]=new CKEDITOR.ui.panel(b,g),e.element=d.append(CKEDITOR.dom.element.createFromHtml(e.renderHtml(a),b)),e.element.setStyles({display:"none",position:"absolute"});return e}var i={},n=!1;CKEDITOR.ui.floatPanel=
CKEDITOR.tools.createClass({$:function(a,b,d,g){d.forceIFrame=1;var h=b.getDocument(),g=o(a,h,b,d,g||0),e=g.element,l=e.getFirst().getFirst();e.disableContextMenu();this.element=e;this._={editor:a,panel:g,parentElement:b,definition:d,document:h,iframe:l,children:[],dir:a.lang.dir};a.on("mode",function(){this.hide()},this)},proto:{addBlock:function(a,b){return this._.panel.addBlock(a,b)},addListBlock:function(a,b){return this._.panel.addListBlock(a,b)},getBlock:function(a){return this._.panel.getBlock(a)},
showBlock:function(a,b,d,g,h){var e=this._.panel,l=e.showBlock(a);this.allowBlur(!1);n=1;this._.returnFocus=this._.editor.focusManager.hasFocus?this._.editor:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement);var j=this.element,i=this._.iframe,a=b.getDocumentPosition(j.getDocument()),m="rtl"==this._.dir,f=a.x+(g||0),k=a.y+(h||0);if(m&&(1==d||4==d))f+=b.$.offsetWidth;else if(!m&&(2==d||3==d))f+=b.$.offsetWidth-1;if(3==d||4==d)k+=b.$.offsetHeight-1;this._.panel._.offsetParentId=b.getId();j.setStyles({top:k+
"px",left:0,display:""});j.setOpacity(0);j.getFirst().removeStyle("width");if(!this._.blurSet)b=CKEDITOR.env.ie?i:new CKEDITOR.dom.window(i.$.contentWindow),CKEDITOR.event.useCapture=!0,b.on("blur",function(a){this.allowBlur()&&(a=a.data.getTarget(),!(a.getName&&"iframe"!=a.getName())&&this.visible&&!this._.activeChild&&!n&&(delete this._.returnFocus,this.hide()))},this),b.on("focus",function(){this._.focused=!0;this.hideChild();this.allowBlur(!0)},this),CKEDITOR.event.useCapture=!1,this._.blurSet=
1;e.onEscape=CKEDITOR.tools.bind(function(a){if(this.onEscape&&!1===this.onEscape(a))return!1},this);CKEDITOR.tools.setTimeout(function(){var a=CKEDITOR.tools.bind(function(){var a=j.getFirst();if(l.autoSize){var c=l.element.$;if(CKEDITOR.env.gecko||CKEDITOR.env.opera)c=c.parentNode;if(CKEDITOR.env.ie)c=c.document.body;c=c.scrollWidth;CKEDITOR.env.ie&&CKEDITOR.env.quirks&&0<c&&(c+=(a.$.offsetWidth||0)-(a.$.clientWidth||0)+3);a.setStyle("width",c+4+"px");l.element.addClass("cke_frameLoaded");c=l.element.$.scrollHeight;
CKEDITOR.env.ie&&CKEDITOR.env.quirks&&0<c&&(c+=(a.$.offsetHeight||0)-(a.$.clientHeight||0)+3);a.setStyle("height",c+"px");e._.currentBlock.element.setStyle("display","none").removeStyle("display")}else a.removeStyle("height");m&&(f-=j.$.offsetWidth);j.setStyle("left",f+"px");var c=e.element.getWindow(),a=j.$.getBoundingClientRect(),c=c.getViewPaneSize(),b=a.width||a.right-a.left,d=a.height||a.bottom-a.top,g=m?a.right:c.width-a.left,h=m?c.width-a.right:a.left;m?g<b&&(f=h>b?f+b:c.width>b?f-a.left:f-
a.right+c.width):g<b&&(f=h>b?f-b:c.width>b?f-a.right+c.width:f-a.left);b=a.top;c.height-a.top<d&&(k=b>d?k-d:c.height>d?k-a.bottom+c.height:k-a.top);CKEDITOR.env.ie&&(c=a=new CKEDITOR.dom.element(j.$.offsetParent),"html"==c.getName()&&(c=c.getDocument().getBody()),"rtl"==c.getComputedStyle("direction")&&(f=CKEDITOR.env.ie8Compat?f-2*j.getDocument().getDocumentElement().$.scrollLeft:f-(a.$.scrollWidth-a.$.clientWidth)));var a=j.getFirst(),i;(i=a.getCustomData("activePanel"))&&i.onHide&&i.onHide.call(this,
1);a.setCustomData("activePanel",this);j.setStyles({top:k+"px",left:f+"px"});j.setOpacity(1)},this);e.isLoaded?a():e.onLoad=a;CKEDITOR.tools.setTimeout(function(){i.$.contentWindow.focus();this.allowBlur(!0)},0,this)},CKEDITOR.env.air?200:0,this);this.visible=1;this.onShow&&this.onShow.call(this);n=0},hide:function(a){if(this.visible&&(!this.onHide||!0!==this.onHide.call(this)))if(this.hideChild(),CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur(),this.element.setStyle("display",
"none"),this.visible=0,this.element.getFirst().removeCustomData("activePanel"),a=!1!==a&&this._.returnFocus)CKEDITOR.env.webkit&&a.type&&a.getWindow().$.focus(),a.focus()},allowBlur:function(a){var b=this._.panel;if(void 0!=a)b.allowBlur=a;return b.allowBlur},showAsChild:function(a,b,d,g,h,e){if(!(this._.activeChild==a&&a._.panel._.offsetParentId==d.getId()))this.hideChild(),a.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=
a,this._.focused=!1,a.showBlock(b,d,g,h,e),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie8&&CKEDITOR.env.ie6Compat)&&setTimeout(function(){a.element.getChild(0).$.style.cssText+=""},100)},hideChild:function(){var a=this._.activeChild;a&&(delete a.onHide,delete a._.returnFocus,delete this._.activeChild,a.hide())}}});CKEDITOR.on("instanceDestroyed",function(){var a=CKEDITOR.tools.isEmpty(CKEDITOR.instances),b;for(b in i){var d=i[b];a?d.destroy():d.element.hide()}a&&(i={})})})()});