//>>built
define("ckeditor/_source/plugins/bbcode/plugin",["dijit","dojo","dojox"],function(){(function(){function A(a){var b={};(a||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,g,e){b[g.toLowerCase()]=e});return b}function B(a){return a.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(a,c,g,e){c=parseInt(c,10).toString(16);g=parseInt(g,10).toString(16);e=parseInt(e,10).toString(16);a=[c,g,e];for(c=0;c<a.length;c++)a[c]=("0"+a[c]).slice(-2);return"#"+
a.join("")})}CKEDITOR.on("dialogDefinition",function(a){var b;b=a.data.name;a=a.data.definition;"link"==b?(a.removeContents("target"),a.removeContents("upload"),a.removeContents("advanced"),b=a.getContents("info"),b.remove("emailSubject"),b.remove("emailBody")):"image"==b&&(a.removeContents("advanced"),b=a.getContents("Link"),b.remove("cmbTarget"),b=a.getContents("info"),b.remove("txtAlt"),b.remove("basic"))});var j={b:"strong",u:"u",i:"em",color:"span",size:"span",quote:"blockquote",code:"code",
url:"a",email:"span",img:"span","*":"li",list:"ol"},v={strong:"b",b:"b",u:"u",em:"i",i:"i",code:"code",li:"*"},k={strong:"b",em:"i",u:"u",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},w={color:"color",size:"font-size"},x={url:"href",email:"mailhref",quote:"cite",list:"listType"},m=CKEDITOR.dtd,y=CKEDITOR.tools.extend({table:1},m.$block,m.$listItem,m.$tableContent,m.$list),C=/\s*(?:;\s*|$)/,o={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",
indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},z={},p=[],q;for(q in o)z[o[q]]=q,p.push(o[q].replace(/\(|\)|\:|\/|\*|\-|\|/g,function(a){return"\\"+a}));var p=RegExp(p.join("|"),"g"),D=function(){var a=[],b={nbsp:"\u00a0",shy:"\u00ad",gt:">",lt:"<"},c;for(c in b)a.push(c);a=RegExp("&("+a.join("|")+");","g");return function(c){return c.replace(a,function(e,a){return b[a]})}}();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/ig}};
CKEDITOR.BBCodeParser.prototype={parse:function(a){for(var b,c,g=0;b=this._.bbcPartsRegex.exec(a);){c=b.index;if(c>g)this.onText(a.substring(g,c),1);g=this._.bbcPartsRegex.lastIndex;if((c=(b[1]||b[3]||"").toLowerCase())&&!j[c])this.onText(b[0]);else if(b[1]){var e=j[c],h={},i={};if(b=b[2])if("list"==c&&(isNaN(b)?/^[a-z]+$/.test(b)?b="lower-alpha":/^[A-Z]+$/.test(b)&&(b="upper-alpha"):b="decimal"),w[c]){"size"==c&&(b+="%");i[w[c]]=b;b=h;var f="",d=void 0;for(d in i)var r=(d+":"+i[d]).replace(C,";"),
f=f+r;b.style=f}else x[c]&&(h[x[c]]=b);if("email"==c||"img"==c)h.bbcode=c;this.onTagOpen(e,h,CKEDITOR.dtd.$empty[e])}else if(b[3])this.onTagClose(j[c])}if(a.length>g)this.onText(a.substring(g,a.length),1)}};CKEDITOR.htmlParser.fragment.fromBBCode=function(a){function b(e){if(0<i.length)for(var a=0;a<i.length;a++){var b=i[a],c=b.name,h=CKEDITOR.dtd[c],f=d.name&&CKEDITOR.dtd[d.name];if((!f||f[c])&&(!e||!h||h[e]||!CKEDITOR.dtd[e]))b=b.clone(),b.parent=d,d=b,i.splice(a,1),a--}}function c(e,a){var b=d.children.length,
c=0<b&&d.children[b-1],b=!c&&s.getRule(k[d.name],"breakAfterOpen"),c=c&&c.type==CKEDITOR.NODE_ELEMENT&&s.getRule(k[c.name],"breakAfterClose"),h=e&&s.getRule(k[e],a?"breakBeforeClose":"breakBeforeOpen");f&&(b||c||h)&&f--;f&&e in y&&f++;for(;f&&f--;)d.children.push(new CKEDITOR.htmlParser.element("br"))}function g(e,a){c(e.name,1);var a=a||d||h,b=a.children.length;e.previous=0<b&&a.children[b-1]||null;e.parent=a;a.children.push(e);if(e.returnPoint)d=e.returnPoint,delete e.returnPoint}var e=new CKEDITOR.BBCodeParser,
h=new CKEDITOR.htmlParser.fragment,i=[],f=0,d=h,r;e.onTagOpen=function(a,h,f){var l=new CKEDITOR.htmlParser.element(a,h);if(CKEDITOR.dtd.$removeEmpty[a])i.push(l);else{var t=d.name,n=t&&(CKEDITOR.dtd[t]||(d._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span));if(n&&!n[a]){var n=!1,u;a==t?g(d,d.parent):(a in CKEDITOR.dtd.$listItem?(e.onTagOpen("ul",{}),u=d):(g(d,d.parent),i.unshift(d)),n=!0);d=u?u:d.returnPoint||d.parent;if(n){e.onTagOpen.apply(this,arguments);return}}b(a);c(a);l.parent=d;l.returnPoint=
r;r=0;l.isEmpty?g(l):d=l}};e.onTagClose=function(a){for(var e=i.length-1;0<=e;e--)if(a==i[e].name){i.splice(e,1);return}for(var b=[],c=[],h=d;h.type&&h.name!=a;)h._.isBlockLike||c.unshift(h),b.push(h),h=h.parent;if(h.type){for(e=0;e<b.length;e++)a=b[e],g(a,a.parent);d=h;g(h,h.parent);if(h==d)d=d.parent;i=i.concat(c)}};e.onText=function(e){var a=CKEDITOR.dtd[d.name];if(!a||a["#"])c(),b(),e.replace(/([\r\n])|[^\r\n]*/g,function(a,e){if(void 0!==e&&e.length)f++;else if(a.length){var b=0;a.replace(p,
function(e,c){g(new CKEDITOR.htmlParser.text(a.substring(b,c)),d);g(new CKEDITOR.htmlParser.element("smiley",{desc:z[e]}),d);b=c+e.length});b!=a.length&&g(new CKEDITOR.htmlParser.text(a.substring(b,a.length)),d)}})};for(e.parse(CKEDITOR.tools.htmlEncode(a));d.type;)a=d.parent,g(d,a),d=a;return h};CKEDITOR.htmlParser.BBCodeWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[],rules:[]};this.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("*",
{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0});this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1})},proto:{setRules:function(a,b){var c=this._.rules[a];c?CKEDITOR.tools.extend(c,b,!0):this._.rules[a]=b},getRule:function(a,b){return this._.rules[a]&&this._.rules[a][b]},openTag:function(a,b){if(a in j){this.getRule(a,"breakBeforeOpen")&&this.lineBreak(1);this.write("[",a);var c=b.option;c&&this.write("=",c);this.write("]");this.getRule(a,
"breakAfterOpen")&&this.lineBreak(1)}else"br"==a&&this._.output.push("\n")},openTagClose:function(){},attribute:function(){},closeTag:function(a){a in j&&(this.getRule(a,"breakBeforeClose")&&this.lineBreak(1),"*"!=a&&this.write("[/",a,"]"),this.getRule(a,"breakAfterClose")&&this.lineBreak(1))},text:function(a){this.write(a)},comment:function(){},lineBreak:function(){if(!this._.hasLineBreak&&this._.output.length)this.write("\n"),this._.hasLineBreak=1},write:function(){this._.hasLineBreak=0;this._.output.push(Array.prototype.join.call(arguments,
""))},reset:function(){this._.output=[];this._.hasLineBreak=0},getHtml:function(a){var b=this._.output.join("");a&&this.reset();return D(b)}}});var s=new CKEDITOR.htmlParser.BBCodeWriter;CKEDITOR.plugins.add("bbcode",{requires:["htmldataprocessor","entities"],beforeInit:function(a){CKEDITOR.tools.extend(a.config,{enterMode:CKEDITOR.ENTER_BR,basicEntities:!1,entities:!1,fillEmptyBlocks:!1},!0)},init:function(a){function b(a){var a=CKEDITOR.htmlParser.fragment.fromBBCode(a),b=new CKEDITOR.htmlParser.basicWriter;
a.writeHtml(b,g);return b.getHtml(!0)}var c=a.config,g=new CKEDITOR.htmlParser.filter;g.addRules({elements:{blockquote:function(a){var b=new CKEDITOR.htmlParser.element("div");b.children=a.children;a.children=[b];if(b=a.attributes.cite){var c=new CKEDITOR.htmlParser.element("cite");c.add(new CKEDITOR.htmlParser.text(b.replace(/^"|"$/g,"")));delete a.attributes.cite;a.children.unshift(c)}},span:function(a){var b;if(b=a.attributes.bbcode){if("img"==b)a.name="img",a.attributes.src=a.children[0].value,
a.children=[];else if("email"==b)a.name="a",a.attributes.href="mailto:"+a.children[0].value;delete a.attributes.bbcode}},ol:function(a){if(a.attributes.listType){if("decimal"!=a.attributes.listType)a.attributes.style="list-style-type:"+a.attributes.listType}else a.name="ul";delete a.attributes.listType},a:function(a){if(!a.attributes.href)a.attributes.href=a.children[0].value},smiley:function(a){a.name="img";var b=a.attributes.desc,i=c.smiley_images[CKEDITOR.tools.indexOf(c.smiley_descriptions,b)],
i=CKEDITOR.tools.htmlEncode(c.smiley_path+i);a.attributes={src:i,"data-cke-saved-src":i,title:b,alt:b}}}});a.dataProcessor.htmlFilter.addRules({elements:{$:function(b){var c=b.attributes,i=A(c.style),f,d=b.name;if(d in v)d=v[d];else if("span"==d)if(f=i.color)d="color",f=B(f);else{if(f=i["font-size"])if(c=f.match(/(\d+)%$/))f=c[1],d="size"}else if("ol"==d||"ul"==d){if(f=i["list-style-type"])switch(f){case "lower-alpha":f="a";break;case "upper-alpha":f="A"}else"ol"==d&&(f=1);d="list"}else if("blockquote"==
d){try{var g=b.children[0],j=b.children[1],k="cite"==g.name&&g.children[0].value;if(k)f='"'+k+'"',b.children=j.children}catch(m){}d="quote"}else if("a"==d){if(f=c.href)-1!==f.indexOf("mailto:")?(d="email",b.children=[new CKEDITOR.htmlParser.text(f.replace("mailto:",""))],f=""):((d=1==b.children.length&&b.children[0])&&d.type==CKEDITOR.NODE_TEXT&&d.value==f&&(f=""),d="url")}else if("img"==d){b.isEmpty=0;if((i=c["data-cke-saved-src"])&&-1!=i.indexOf(a.config.smiley_path))return new CKEDITOR.htmlParser.text(o[c.alt]);
b.children=[new CKEDITOR.htmlParser.text(i)]}b.name=d;f&&(b.attributes.option=f);return null},br:function(a){if((a=a.next)&&a.name in y)return!1}}},1);a.dataProcessor.writer=s;a.on("beforeSetMode",function(c){c.removeListener();c=a._.modes.wysiwyg;c.loadData=CKEDITOR.tools.override(c.loadData,function(a){return function(c){return a.call(this,b(c))}})})},afterInit:function(a){var b;if(a._.elementsPath)(b=a._.elementsPath.filters)&&b.push(function(b){var g=b.getName(),e=k[g]||!1;"link"==e&&0===b.getAttribute("href").indexOf("mailto:")?
e="email":"span"==g?b.getStyle("font-size")?e="size":b.getStyle("color")&&(e="color"):"img"==e&&(b=b.data("cke-saved-src"))&&0===b.indexOf(a.config.smiley_path)&&(e="smiley");return e})}})})()});