//>>built
define("ckeditor/_source/plugins/htmldataprocessor/plugin",["dijit","dojo","dojox"],function(){(function(){function i(a){for(var c=a.children.length,b=a.children[c-1];b&&b.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(b.value);)b=a.children[--c];return b}function j(a,c){var b=a.children,d=i(a);d&&((c||!CKEDITOR.env.ie)&&d.type==CKEDITOR.NODE_ELEMENT&&"br"==d.name&&b.pop(),d.type==CKEDITOR.NODE_TEXT&&q.test(d.value)&&b.pop())}function k(a,c){return function(b){j(b,!a);var d;d=!a;!d&&(!c||"function"==
typeof c&&!1===c(b))||d&&CKEDITOR.env.ie&&(7<document.documentMode||b.name in CKEDITOR.dtd.tr||b.name in CKEDITOR.dtd.$listItem)?d=!1:(d=i(b),d=!d||d&&(d.type==CKEDITOR.NODE_ELEMENT&&"br"==d.name||"form"==b.name&&"input"==d.name));d&&(a||CKEDITOR.env.ie?b.add(new CKEDITOR.htmlParser.text("\u00a0")):b.add(new CKEDITOR.htmlParser.element("br",{})))}}function r(a){a=a.attributes;"false"!=a.contenteditable&&(a["data-cke-editable"]=a.contenteditable?"true":1);a.contenteditable="false"}function s(a){a=
a.attributes;switch(a["data-cke-editable"]){case "true":a.contenteditable="true";break;case "1":delete a.contenteditable}}function t(a){return a.replace(u,function(a,b,d){return"<"+b+d.replace(v,function(a,b){return!/^on/.test(b)&&-1==d.indexOf("data-cke-saved-"+b)?" data-cke-saved-"+a+" data-cke-"+CKEDITOR.rnd+"-"+a:a})+">"})}function w(a){return a.replace(x,function(a){return"<cke:encoded>"+encodeURIComponent(a)+"</cke:encoded>"})}function y(a){return a.replace(z,function(a,b){return decodeURIComponent(b)})}
function A(a){return a.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+l+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function m(a){return a.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}function B(a,c){var b=c._.dataStore;return a.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)}).replace(/\{cke_protected_(\d+)\}/g,function(a,c){return b&&b[c]||""})}function C(a,
c){for(var b=[],d=c.config.protectedSource,e=c._.dataStore||(c._.dataStore={id:1}),g=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,d=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi].concat(d),a=a.replace(/<\!--[\s\S]*?--\>/g,function(a){return"<\!--{cke_tempcomment}"+(b.push(a)-1)+"--\>"}),f=0;f<d.length;f++)a=a.replace(d[f],function(a){a=a.replace(g,function(a,c,d){return b[d]});return/cke_temp(comment)?/.test(a)?a:"<\!--{cke_temp}"+(b.push(a)-1)+"--\>"});a=a.replace(g,function(a,c,d){return"<\!--"+
l+(c?"{C}":"")+encodeURIComponent(b[d]).replace(/--/g,"%2D%2D")+"--\>"});return a.replace(/(['"]).*?\1/g,function(a){return a.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(a,b){e[e.id]=decodeURIComponent(b);return"{cke_protected_"+e.id++ +"}"})})}var q=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,l="{cke_protected}",f=CKEDITOR.dtd,n="caption,colgroup,col,thead,tfoot,tbody".split(","),g=CKEDITOR.tools.extend({},f.$block,f.$listItem,f.$tableContent),e;for(e in g)"br"in f[e]||delete g[e];delete g.pre;var o=
{elements:{},attributeNames:[[/^on/,"data-cke-pa-on"]]},p={elements:{}};for(e in g)p.elements[e]=k();var h={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(a){var c=a.attributes;if(c){if(c["data-cke-temp"])return!1;for(var b=["name","href","src"],d,e=0;e<b.length;e++)d="data-cke-saved-"+b[e],d in c&&delete c[b[e]]}return a},table:function(a){a.children.sort(function(a,b){return a.type==CKEDITOR.NODE_ELEMENT&&
b.type==a.type?CKEDITOR.tools.indexOf(n,a.name)>CKEDITOR.tools.indexOf(n,b.name)?1:-1:0})},embed:function(a){var c=a.parent;if(c&&"object"==c.name){var b=c.attributes.width,c=c.attributes.height;b&&(a.attributes.width=b);c&&(a.attributes.height=c)}},param:function(a){a.children=[];a.isEmpty=!0;return a},a:function(a){if(!a.children.length&&!a.attributes.name&&!a.attributes["data-cke-saved-name"])return!1},span:function(a){"Apple-style-span"==a.attributes["class"]&&delete a.name},pre:function(a){CKEDITOR.env.ie&&
j(a)},html:function(a){delete a.attributes.contenteditable;delete a.attributes["class"]},body:function(a){delete a.attributes.spellcheck;delete a.attributes.contenteditable},style:function(a){var c=a.children[0];c&&c.value&&(c.value=CKEDITOR.tools.trim(c.value));if(!a.attributes.type)a.attributes.type="text/css"},title:function(a){var c=a.children[0];c&&(c.value=a.attributes["data-cke-title"]||"")}},attributes:{"class":function(a){return CKEDITOR.tools.ltrim(a.replace(/(?:^|\s+)cke_[^\s]*/g,""))||
!1}}};if(CKEDITOR.env.ie)h.attributes.style=function(a){return a.replace(/(^|;)([^\:]+)/g,function(a){return a.toLowerCase()})};for(e in{input:1,textarea:1})o.elements[e]=r,h.elements[e]=s;var u=/<(a|area|img|input)\b([^>]*)>/gi,v=/\b(on\w+|href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,x=/(?:<style(?=[ >])[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,z=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,D=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,E=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,
F=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi;CKEDITOR.plugins.add("htmldataprocessor",{requires:["htmlwriter"],init:function(a){var c=a.dataProcessor=new CKEDITOR.htmlDataProcessor(a);c.writer.forceSimpleAmpersand=a.config.forceSimpleAmpersand;c.dataFilter.addRules(o);c.dataFilter.addRules(p);c.htmlFilter.addRules(h);var b={elements:{}};for(e in g)b.elements[e]=k(!0,a.config.fillEmptyBlocks);c.htmlFilter.addRules(b)},onLoad:function(){!("fillEmptyBlocks"in CKEDITOR.config)&&(CKEDITOR.config.fillEmptyBlocks=
1)}});CKEDITOR.htmlDataProcessor=function(a){this.editor=a;this.writer=new CKEDITOR.htmlWriter;this.dataFilter=new CKEDITOR.htmlParser.filter;this.htmlFilter=new CKEDITOR.htmlParser.filter};CKEDITOR.htmlDataProcessor.prototype={toHtml:function(a,c){var a=C(a,this.editor),a=t(a),a=w(a),a=a.replace(D,"$1cke:$2"),a=a.replace(F,"<cke:$1$2></cke:$1>"),a=a.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),b=new CKEDITOR.dom.element("div");b.setHtml("a"+a);var a=b.getHtml().substr(1),a=a.replace(RegExp(" data-cke-"+
CKEDITOR.rnd+"-","ig")," "),a=a.replace(E,"$1$2"),a=y(a),a=m(a),b=CKEDITOR.htmlParser.fragment.fromHtml(a,c),d=new CKEDITOR.htmlParser.basicWriter;b.writeHtml(d,this.dataFilter);a=d.getHtml(!0);return a=A(a)},toDataFormat:function(a,c){var b=this.writer,d=CKEDITOR.htmlParser.fragment.fromHtml(a,c);b.reset();d.writeHtml(b,this.htmlFilter);b=b.getHtml(!0);b=m(b);return b=B(b,this.editor)}}})()});