//>>built
define("dojox/grid/enhanced/plugins/Printer","dojo/_base/declare,dojo/_base/html,dojo/_base/Deferred,dojo/_base/lang,dojo/_base/sniff,dojo/_base/xhr,dojo/_base/array,dojo/query,dojo/DeferredList,../_Plugin,../../EnhancedGrid,./exporter/TableWriter".split(","),function(i,g,m,e,j,n,k,l,o,p,q){i=i("dojox.grid.enhanced.plugins.Printer",p,{name:"printer",constructor:function(a){this.grid=a;this._mixinGrid(a);a.setExportFormatter(function(a,d,h,c){return d.format(h,c)})},_mixinGrid:function(){var a=this.grid;
a.printGrid=e.hitch(this,this.printGrid);a.printSelected=e.hitch(this,this.printSelected);a.exportToHTML=e.hitch(this,this.exportToHTML);a.exportSelectedToHTML=e.hitch(this,this.exportSelectedToHTML);a.normalizePrintedGrid=e.hitch(this,this.normalizeRowHeight)},printGrid:function(a){this.exportToHTML(a,e.hitch(this,this._print))},printSelected:function(a){this.exportSelectedToHTML(a,e.hitch(this,this._print))},exportToHTML:function(a,b){var a=this._formalizeArgs(a),d=this;this.grid.exportGrid("table",
a,function(h){d._wrapHTML(a.title,a.cssFiles,a.titleInBody+h).then(b)})},exportSelectedToHTML:function(a,b){var a=this._formalizeArgs(a),d=this;this.grid.exportSelected("table",a.writerArgs,function(h){d._wrapHTML(a.title,a.cssFiles,a.titleInBody+h).then(b)})},_loadCSSFiles:function(a){a=k.map(a,function(a){a=e.trim(a);if(".css"===a.substring(a.length-4).toLowerCase())return n.get({url:a});var d=new m;d.callback(a);return d});return o.prototype.gatherResults(a)},_print:function(a){var b,d=this,h=
function(b){b=b.document;b.open();b.write(a);b.close();d.normalizeRowHeight(b)};if(window.print)if(j("chrome")||j("opera"))b=window.open("javascript: ''","","status=0,menubar=0,location=0,toolbar=0,width=1,height=1,resizable=0,scrollbars=0"),h(b),b.print(),b.close();else{b=this._printFrame;var c=this.grid.domNode;if(!b){var f=c.id+"_print_frame";if(!(b=g.byId(f)))b=g.create("iframe"),b.id=f,b.frameBorder=0,g.style(b,{width:"1px",height:"1px",position:"absolute",right:0,bottom:0,border:"none",overflow:"hidden"}),
j("ie")||g.style(b,"visibility","hidden"),c.appendChild(b);this._printFrame=b}b=b.contentWindow;h(b);b.focus();b.print()}},_wrapHTML:function(a,b,d){return this._loadCSSFiles(b).then(function(b){var c,f=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',"<html ",g._isBodyLtr()?"":'dir="rtl"',"><head><title>",a,'</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>'];for(c=0;c<b.length;++c)f.push('<style type="text/css">',
b[c],"</style>");f.push("</head>");0>d.search(/^\s*<body/i)&&(d="<body>"+d+"</body>");f.push(d,"</html>");return f.join("")})},normalizeRowHeight:function(a){var a=l(".grid_view",a.body),b=k.map(a,function(a){return l(".grid_header",a)[0]}),d=k.map(a,function(a){return l(".grid_row",a)}),h=d[0].length,c,f,e=0;for(c=a.length-1;0<=c;--c)f=g.contentBox(b[c]).h,f>e&&(e=f);for(c=a.length-1;0<=c;--c)g.style(b[c],"height",e+"px");for(b=0;b<h;++b){e=0;for(c=a.length-1;0<=c;--c)f=g.contentBox(d[c][b]).h,f>
e&&(e=f);for(c=a.length-1;0<=c;--c)g.style(d[c][b],"height",e+"px")}d=0;h=g._isBodyLtr();for(c=0;c<a.length;++c)g.style(a[c],h?"left":"right",d+"px"),d+=g.marginBox(a[c]).w},_formalizeArgs:function(a){a=a&&e.isObject(a)?a:{};a.title=""+a.title||"";if(!e.isArray(a.cssFiles))a.cssFiles=[a.cssFiles];a.titleInBody=a.title?["<h1>",a.title,"</h1>"].join(""):"";return a}});q.registerPlugin(i,{dependency:["exporter"]});return i});