//>>built
define("dojox/app/controllers/HistoryHash","dojo/_base/lang,dojo/_base/declare,dojo/topic,dojo/on,../Controller,dojo/hash".split(","),function(e,f,d,h,g){return f("dojox.app.controllers.HistoryHash",g,{constructor:function(a){this.events={startTransition:this.onStartTransition};this.inherited(arguments);d.subscribe("/dojo/hashchange",e.hitch(this,function(a){this._onHashChange(a)}));this._historyStack=[];this._historyLen=0;this._previous=this._next=this._current=null;this._newHistoryLen=this._oldHistoryLen=
this._index=0;this._addToHistoryStack=!1;this._detail=null;this._startTransitionEvent=!1;var b=window.location.hash;b&&1<b.length&&(b=b.substr(1));this._historyStack.push({hash:b,url:window.location.href,detail:{target:b}});this._historyLen=window.history.length;this._index=this._historyStack.length-1;this._current=b;this._historyDiff=window.history.length-this._historyStack.length},onStartTransition:function(a){var b=a.detail.target,c=/#(.+)/;!b&&c.test(a.detail.href)&&(b=a.detail.href.match(c)[1]);
b=a.detail.url||"#"+b;this._oldHistoryLen=window.history.length;window.location.hash=b;this._addToHistoryStack=!0;this._detail=a.detail;this._startTransitionEvent=!0},_addHistory:function(a){this._historyStack.push({hash:a,url:window.location.href,detail:{target:a}});this._historyLen=window.history.length;this._index=this._historyStack.length-1;this._previous=this._current;this._current=a;this._next=null;this._historyDiff=window.history.length-this._historyStack.length;this._addToHistoryStack=!1},
_onHashChange:function(a){if(0>this._index||this._index>window.history.length-1)throw Error("Application history out of management.");this._newHistoryLen=window.history.length;if(this._oldHistoryLen>this._newHistoryLen)this._historyStack.splice(this._newHistoryLen-this._historyDiff-1,this._historyStack.length-1),this._historyLen=this._historyStack.length,this._oldHistoryLen=0;if(this._addToHistoryStack&&this._oldHistoryLen===this._newHistoryLen)this._historyStack.splice(this._newHistoryLen-this._historyDiff-
1,this._historyStack.length-1),this._addHistory(a);else{if(this._historyLen<window.history.length)this._addHistory(a),this._startTransitionEvent||this.app.trigger("transition",{viewId:a});else if(a!=this._current)if(a===this._previous)this._back(a,this._historyStack[this._index].detail);else if(a===this._next)this._forward(a,this._historyStack[this._index].detail);else{for(var b=-1,c=this._index;0<c;c--)if(a===this._historyStack[c].hash){b=c;break}if(-1===b)for(c=this._index;c<this._historyStack.length;c++)if(a===
this._historyStack[c].hash){b=c;break}0<b<this._historyStack.length&&this._go(b,b-this._index)}this._startTransitionEvent=!1}},_back:function(a,b){this._next=this._historyStack[this._index].hash;this._index--;this._previous=0<this._index?this._historyStack[this._index-1].hash:null;this._current=a;d.publish("/app/history/back",{viewId:a,detail:b});this.app.trigger("transition",{viewId:a,opts:{reverse:!0}})},_forward:function(a,b){this._previous=this._historyStack[this._index].hash;this._index++;this._next=
this._index<this._historyStack.length-1?this._historyStack[this._index+1].hash:null;this._current=a;d.publish("/app/history/forward",{viewId:a,detail:b});this.app.trigger("transition",{viewId:a,opts:{reverse:!1}})},_go:function(a,b){if(0>a||a>window.history.length-1)throw Error("Application history.go steps out of management.");this._index=a;this._current=this._historyStack[a].hash;this._previous=this._historyStack[a-1]?this._historyStack[a-1].hash:null;this._next=this._historyStack[a+1]?this._historyStack[a+
1].hash:null;d.publish("/app/history/go",{viewId:this._current,step:b,detail:this._historyStack[a].detail});this.app.trigger("transition",0<b?{viewId:this._current,opts:{reverse:!1}}:{viewId:this._current,opts:{reverse:!0}})}})});