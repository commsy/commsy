//>>built
define("dojox/socket",["dojo","dojo/on","dojo/Evented","dojo/cookie","dojo/_base/url"],function(c,l,m){function e(a){"string"==typeof a&&(a={url:a});return j?dojox.socket.WebSocket(a,!0):dojox.socket.LongPoll(a)}var j=window.WebSocket;dojox.socket=e;e.WebSocket=function(a,f){var b=new j(new c._Url(document.baseURI.replace(/^http/i,"ws"),a.url));b.on=function(a,c){b.addEventListener(a,c,!0)};var h;c.connect(b,"onopen",function(){h=!0});c.connect(b,"onclose",function(){h||f&&e.replace(b,dojox.socket.LongPoll(a),
!0)});return b};e.replace=function(a,f,b){function h(b){(f.addEventListener||f.on).call(f,b,function(b){l.emit(a,b.type,b)},!0)}a.send=c.hitch(f,"send");a.close=c.hitch(f,"close");b&&h("open");c.forEach(["message","close","error"],h)};e.LongPoll=function(a){function f(){0==d.readyState&&b("open",{});g.length||d.send()}function b(a,b,c){if(d["on"+a])b.ioArgs=c&&c.ioArgs,b.type=a,l.emit(d,a,b)}var h=!1,e=!0,j,g=[],d={send:function(n){var k=c.delegate(a);k.rawBody=n;clearTimeout(j);var i=e?(e=!1)||d.firstRequest(k):
d.transport(k);g.push(i);i.then(function(e){d.readyState=1;g.splice(c.indexOf(g,i),1);g.length||(j=setTimeout(f,a.interval));e&&b("message",{data:e},i)},function(a){g.splice(c.indexOf(g,i),1);if(!h&&(b("error",{error:a},i),!g.length))d.readyState=3,b("close",{wasClean:!1},i)});return i},close:function(){d.readyState=2;h=!0;for(var a=0;a<g.length;a++)g[a].cancel();d.readyState=3;b("close",{wasClean:!0})},transport:a.transport||c.xhrPost,args:a,url:a.url,readyState:0,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,
on:m.prototype.on,firstRequest:function(a){var b=a.headers||(a.headers={});b.Pragma="start-long-poll";try{return this.transport(a)}finally{delete b.Pragma}}};d.connect=d.on;setTimeout(f);return d};return e});