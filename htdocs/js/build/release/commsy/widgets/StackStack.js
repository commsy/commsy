//>>built
define("commsy/widgets/StackStack","dojo/_base/declare,dijit/_WidgetBase,commsy/base,dijit/_TemplatedMixin,dojo/_base/lang,dojo/dom-construct,dojo/dom-attr,dojo/on,dojo/query,dojo/topic".split(","),function(g,j,k,l,e,c,n,h,i,m){return g([k,j,l],{baseClass:"CommSyWidget",widgetHandler:null,itemId:null,currentPage:1,maxPage:1,entriesPerPage:20,search:"",constructor:function(b){b=b||{};g.safeMixin(this,b);this.restrictions={buzzwords:[],tags:[]}},postCreate:function(){this.inherited(arguments);this.itemId=
this.from_php.ownRoom.id;m.subscribe("newOwnRoomItem",e.hitch(this,function(){this.updateList()}));this.updateList()},updateList:function(){c.empty(this.itemListNode);this.AJAXRequest("widget_stack","getListContent",{search:this.search.toLowerCase(),start:(this.currentPage-1)*this.entriesPerPage,numEntries:this.entriesPerPage,buzzwordRestrictions:dojo.map(this.restrictions.buzzwords,function(b){return b.id}),tagRestrictions:dojo.map(this.restrictions.tags,function(b){return b.id})},e.hitch(this,function(b){dojo.forEach(b.items,
e.hitch(this,function(a,b){var f=c.create("div",{className:0==b%2?"row_even even_sep_search":"row_odd odd_sep_search"},this.itemListNode,"last"),d=c.create("div",{className:"column_280"},f,"last"),d=c.create("p",{},d,"last"),g=c.create("a",{id:"listItem"+a.itemId,className:"stack_link",href:"#",innerHTML:a.title},d,"last"),d=c.create("div",{className:"column_45"},f,"last"),d=c.create("p",{},d,"last");0<a.fileCount&&c.create("a",{className:"attachment",href:"#",innerHTML:a.fileCount},d,"last");d=c.create("div",
{className:"column_65"},f,"last");d=c.create("p",{},d,"last");c.create("img",{src:this.from_php.template.tpl_path+"img/netnavigation/"+a.image.img,title:a.image.text},d,"last");d=c.create("div",{className:"column_90"},f,"last");c.create("p",{innerHTML:a.modificationDate},d,"last");d=c.create("div",{className:"column_155"},f,"last");c.create("p",{innerHTML:a.creator},d,"last");c.create("div",{className:"clear"},f,"last");require(["commsy/popups/ClickDetailPopup"],e.hitch(this,function(b){(new b).init(g,
{iid:a.itemId,module:a.module,contextId:this.itemId,versionId:a.versionId})}))}));this.maxPage=Math.ceil(b.total/this.entriesPerPage);this.currentPageNode.innerHTML=Math.min(this.currentPage,this.maxPage);this.maxPageNode.innerHTML=this.maxPage}))},addBuzzwordRestriction:function(b,a){0==dojo.filter(this.restrictions.buzzwords,function(a){return a.id==b}).length&&0==this.restrictions.buzzwords.length&&(this.restrictions.buzzwords.push({id:b,name:a}),this.updateBuzzwordRestrictions(),this.updateList())},
addTagRestriction:function(b,a){0==dojo.filter(this.restrictions.tags,function(a){return a.id==b}).length&&0==this.restrictions.tags.length?this.restrictions.tags.push({id:b,name:a}):this.restrictions.tags[0]={id:b,name:a};this.updateTagRestrictions();this.updateList()},onClickPaging20:function(){this.entriesPerPage=20;this.currentPage=1;this.paging20.innerHTML="<strong>20</strong>";this.paging50.innerHTML="50";this.updateList()},onClickPaging50:function(){this.entriesPerPage=50;this.currentPage=
1;this.paging20.innerHTML="20";this.paging50.innerHTML="<strong>50</strong>";this.updateList()},onClickPagingFirst:function(){if(1<this.currentPage)this.currentPage=1;this.updateList()},onClickPagingPrev:function(){1<this.currentPage&&this.currentPage--;this.updateList()},onClickPagingNext:function(){this.currentPage<this.maxPage&&this.currentPage++;this.updateList()},onClickPagingLast:function(){if(this.currentPage<this.maxPage)this.currentPage=this.maxPage;this.updateList()},onClickSearch:function(){this.search=
this.searchNode.value;this.updateList()},onBuzzwordRestrictionRemove:function(b){var a=i("li#"+b,this.buzzwordRestrictionsNode)[0];a&&c.destroy(a);this.restrictions.buzzwords=dojo.filter(this.restrictions.buzzwords,function(a){return a.id!=b});this.updateList()},onTagRestrictionRemove:function(b){var a=i("li#"+b,this.tagRestrictionsNode)[0];a&&c.destroy(a);this.restrictions.tags=dojo.filter(this.restrictions.tags,function(a){return a.id!=b});this.updateList()},updateBuzzwordRestrictions:function(){c.empty(this.buzzwordRestrictionsNode);
dojo.forEach(this.restrictions.buzzwords,e.hitch(this,function(b){var a=c.create("li",{id:b.id,className:"float-left"},this.buzzwordRestrictionsNode,"last");c.create("span",{innerHTML:b.name},a,"last");a=c.create("a",{href:"#"},a,"last");c.create("img",{src:this.from_php.template.tpl_path+"img/cross.gif"},a,"last");h(a,"click",e.hitch(this,function(){this.onBuzzwordRestrictionRemove(b.id)}))}))},updateTagRestrictions:function(){c.empty(this.tagRestrictionsNode);dojo.forEach(this.restrictions.tags,
e.hitch(this,function(b){var a=c.create("li",{id:b.id,className:"float-left"},this.tagRestrictionsNode,"last");c.create("span",{innerHTML:b.name},a,"last");a=c.create("a",{href:"#"},a,"last");c.create("img",{src:this.from_php.template.tpl_path+"img/cross.gif"},a,"last");h(a,"click",e.hitch(this,function(){this.onTagRestrictionRemove(b.id)}))}))}})});