//>>built
define("commsy/widgets/Portfolio","dojo/_base/declare,dijit/_WidgetBase,commsy/base,dijit/_TemplatedMixin,dojo/_base/lang,dojo/dom-construct,dojo/dom-attr,dojo/_base/xhr,dojo/query,dojo/on,dojo/topic,dijit/layout/TabContainer,dijit/layout/ContentPane".split(","),function(e,f,g,h,c,j,k,l,m,n,i){return e([g,f,h],{baseClass:"CommSyPortfolioWidget",widgetHandler:null,constructor:function(a){a=a||{};e.safeMixin(this,a);this.myPortfolioTabNode=null},postCreate:function(){this.inherited(arguments);this.itemId=
this.from_php.ownRoom.id;i.subscribe("updatePortfolios",c.hitch(this,function(){this.loadPortfolios()}))},startup:function(){},afterParse:function(){this.myPortfolioTabNode=dijit.byId("myPortfolioTabNode");this.activatedPortfolioTabNode=dijit.byId("activatedPortfolioTabNode");this.myPortfolioTabNode.watch("selectedChildWidget",c.hitch(this,function(a,b,d){this.onTabChanged(a,b,d,!0)}));this.activatedPortfolioTabNode.watch("selectedChildWidget",c.hitch(this,function(a,b,d){this.onTabChanged(a,b,d,
!1)}));this.loadPortfolios();require(["commsy/popups/ClickPortfolioPopup"],c.hitch(this,function(a){(new a).init(this.createNewPortfolioNode,{iid:"NEW",module:"portfolioItem"})}))},loadPortfolios:function(){var a=this.myPortfolioTabNode.getChildren();dojo.forEach(a,c.hitch(this,function(b){"CommSyPortfolioItemWidget"===b.baseClass&&(this.myPortfolioTabNode.removeChild(b),b.destroyRecursive())}));a=this.activatedPortfolioTabNode.getChildren();dojo.forEach(a,c.hitch(this,function(b){"CommSyPortfolioItemWidget"===
b.baseClass&&(this.activatedPortfolioTabNode.removeChild(b),b.destroyRecursive())}));this.AJAXRequest("portfolio","getPortfolios",{},c.hitch(this,function(b){dojo.forEach(b.myPortfolios,c.hitch(this,function(b){this.addPortfolio(b,this.myPortfolioTabNode)}));dojo.forEach(b.activatedPortfolios,c.hitch(this,function(b){this.addPortfolio(b,this.activatedPortfolioTabNode)}))}))},addPortfolio:function(a,b,d){d=d||!1;this.widgetHandler.loadWidget("widgets/PortfolioItem",{portfolioId:a.id,title:a.title}).then(c.hitch(this,
function(a){a=a.handle;b.addChild(a,0);d&&b.selectChild(a);"myPortfolioTabNode"===b.id&&(a=this.myPortfolioTabNode.getChildren(),dojo.forEach(a,c.hitch(this,function(a){"startPortfolio"===a.id&&this.myPortfolioTabNode.removeChild(a)})))}))},onTabChanged:function(a,b,c,e){"CommSyPortfolioItemWidget"===c.baseClass?c.init(e):"newPortfolioNode"===c.id&&this.createNewPortfolioNode.click()}})});