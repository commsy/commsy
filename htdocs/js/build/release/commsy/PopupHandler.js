//>>built
define("commsy/PopupHandler","dojo/_base/declare,commsy/base,dojo/on,dojo/_base/lang,dojo/query,dojo/dom-class,dojo/dom-attr,dojo/dom-construct,dojo/dom-style,dijit/Tooltip,dojo/i18n!./nls/tooltipErrors,dojo/NodeList-traverse".split(","),function(l,m,h,b,d,i,f,j,o,k,n){return l(m,{is_open:!1,contentNode:null,features:[],featureHandles:[],module:null,fct:null,editType:null,version_id:null,contextId:null,constructor:function(){this.errorNodes=[]},onCreate:function(){h(this.contentNode,"click",b.hitch(this,
function(){this.closeErrorTooltips()}))},setupTabs:function(){var a=d("div.tab_navigation a",this.contentNode),e=d("div#popup_tabcontent div.tab, div.popup_tabcontent div.tab",this.contentNode);h(a,"click",b.hitch(this,function(c){dojo.forEach(a,function(a){i.add(a,"pop_tab")});i.replace(c.target,"pop_tab_active","pop_tab");dojo.forEach(e,b.hitch(this,function(a){var b=f.get(c.target,"href");b===f.get(a,"id")?(i.remove(a,"hidden"),d("input[name='form_data["+b+"]']",this.contentNode)[0]||j.create("input",
{type:"hidden",className:"tabStatus",name:"form_data["+b+"]",value:!0},this.contentNode,"last")):i.add(a,"hidden")}));c.preventDefault()}))},setupFeatures:function(){dojo.forEach(this.features,b.hitch(this,function(a){"editor"===a&&dojo.forEach(d("div.ckeditor",this.contentNode),b.hitch(this,function(e,c){require(["commsy/ckeditor"],b.hitch(this,function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][c]=new b;this.featureHandles[a][c].create(e)}))}));"tree"===a&&dojo.forEach(d("div.tree",
this.contentNode),b.hitch(this,function(e,c){require(["commsy/tree"],b.hitch(this,function(g){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][c]=new g({followUrl:!1,checkboxes:!0,expanded:!1,item_id:this.item_id,room_id:this.contextId});this.featureHandles[a][c].setupTree(e,b.hitch(this,function(a){a.model.fetchItemsWithChecked({match:!0},b.hitch(this,function(c){dojo.forEach(c,b.hitch(this,function(b){b=a.model.getItemAttr(b,"item_id");d("input[name='form_data[tags]'][value='"+
b+"']",this.contentNode)[0]||j.create("input",{type:"hidden",name:"form_data[tags]",value:b},d("div#tags_tab")[0],"last")}))}));h(a.tree,"open",b.hitch(this,function(c){dojo.forEach(c.children,b.hitch(this,function(b){a.model.getItemAttr(b,"match")&&(b=a.model.getItemAttr(b,"item_id"),(b=d("input[type='hidden'][value='"+b+"']",d("div#tags_tab")[0])[0])&&j.destroy(b))}))}))}),"tags"==this.editType)}))}));"upload"===a&&dojo.forEach(d("div.uploader",this.contentNode),b.hitch(this,function(e,c){require(["commsy/Uploader"],
b.hitch(this,function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][c]=new b;this.featureHandles[a][c].setup(e)}))}));"upload-single"===a&&dojo.forEach(d("div.uploader-single",this.contentNode),b.hitch(this,function(e,c){require(["commsy/Uploader"],b.hitch(this,function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][c]=new b({single:!0});this.featureHandles[a][c].setup(e)}))}));"netnavigation"===a&&require(["commsy/Netnavigation"],b.hitch(this,
function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][0]=new b;this.featureHandles[a][0].init(this.uri_object.cid,this.item_id,this.module,this.from_php.template.tpl_path,"netnavigation"==this.editType)}));"path"===a&&require(["commsy/Path"],b.hitch(this,function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][0]=new b;this.featureHandles[a][0].init(this.uri_object.cid,this.item_id,this.from_php.template.tpl_path)}));"calendar"===a&&dojo.forEach(d("input.datepicker",
this.contentNode),b.hitch(this,function(d,c){require(["commsy/Calendar"],b.hitch(this,function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][c]=new b;this.featureHandles[a][c].setup(d)}))}));"colorpicker"===a&&dojo.forEach(d("input.colorpicker",this.contentNode),b.hitch(this,function(d,c){require(["commsy/Colorpicker"],b.hitch(this,function(b){this.featureHandles[a]=this.featureHandles[a]||[];this.featureHandles[a][c]=new b;this.featureHandles[a][c].setup(d)}))}))}))},
submit:function(a,e){e=e||[];this.setupLoading();this.closeErrorTooltips();var c=[];"rubric_popup"==this.fct&&(c=[{name:"iid",value:this.item_id},{name:"editType",value:this.editType}]);var g={form_data:c,module:this.module,additional:e},h=a.nodeLists;dojo.forEach(a.tabs,function(a){a.query=d("div#"+a.id);delete a.id;h=h.concat(a)});dojo.forEach(h,function(a){var b=a.group||null;dojo.forEach(a.query,function(a){var c=null,c="INPUT"===a.tagName||"SELECT"===a.tagName||"TEXTAREA"===a.tagName?[a]:d("input[name^='form_data'], select[name^='form_data'], textarea[name^='form_data']",
a);dojo.forEach(c,function(a){var c=!1,d=f.get(a,"type");if("checkbox"===d||"radio"===d){if(!0===a.checked&&"false"!==f.get(a,"aria-checked")||"true"===f.get(a,"aria-checked")||"mixed"===f.get(a,"aria-checked"))c=!0}else c=!0;if(c)if(c=f.get(a,"value"),""===c&&(c=""),b){var e=null;dojo.some(g.form_data,function(a,c){e=c;return a.name===b})||(g.form_data.push({name:b,value:[]}),e=g.form_data.length-1);g.form_data[e].value.push(c)}else/form_data\[(.*)\]/.exec(f.get(a,"name")),g.form_data.push({name:RegExp.$1,
value:c})})})});this.AJAXRequest(this.fct,"save",g,b.hitch(this,function(a){this.onPopupSubmitSuccess(a);this.destroyLoading()}),b.hitch(this,function(a){if("error"===a.status&&"101"===a.code){var b=d("div#mandatory_missing",this.contentNode)[0];i.remove(b,"hidden");this.scrollToNodeAnimated(b)}else if("error"===a.status&&"111"===a.code)this.onPopupSubmitError(a);this.onPopupSubmitError(a)}))},onPopupSubmitError:function(a){this.destroyLoading();switch(a.code){case "113":a=d("a[href='buzzwords_tab']",
this.contentNode)[0]||d("a[href='tags_tab']",this.contentNode)[0],k.show(n.generalTagsBuzzwords113,a),this.errorNodes.push(a)}},closeErrorTooltips:function(){dojo.forEach(this.errorNodes,b.hitch(function(a){k.hide(a)}));this.errorNodes=[]},close:function(){this.featureHandles.upload&&dojo.forEach(this.featureHandles.upload,function(a){a.destroy()});this.featureHandles["upload-single"]&&dojo.forEach(this.featureHandles["upload-single"],function(a){a.destroy()});this.closeErrorTooltips();this.is_open=
!1}})});