//>>built
define("commsy/popups/ToggleRoomConfiguration","dojo/_base/declare,commsy/TogglePopupHandler,dojo/query,dojo/dom-class,dojo/dom-attr,dojo/dom-construct,dojo/on,dojo/_base/lang".split(","),function(i,j,b,e,f,h,g,c){return i(j,{sendImages:[],constructor:function(a,b){this.popup_button_node=a;this.contentNode=b;this.module="configuration";this.features=["editor","upload","upload-single","colorpicker"];this.registerPopupClick()},onTogglePopup:function(){!0===this.is_open?(e.add(this.popup_button_node,
"tm_settings_hover"),e.remove(this.contentNode,"hidden")):(e.remove(this.popup_button_node,"tm_settings_hover"),e.add(this.contentNode,"hidden"))},setupSpecific:function(){var a=b("input#add_community_room",this.contentNode)[0];a&&g(a,"click",c.hitch(this,function(){this.onClickAssignCommunityRoom()}));g(b("input#add_additional_status",this.contentNode)[0],"click",c.hitch(this,function(){this.onClickAdditionalStatus()}));this.updateConfigurationSchemaPreview();g(b("select#room_color_choice",this.contentNode)[0],
"change",c.hitch(this,function(){this.updateConfigurationSchemaPreview()}));dojo.forEach(b("input[name='form_data[member_check]']",this.contentNode),c.hitch(this,function(a){"withcode"===f.get(a,"value")?g(a,"click",function(){f.set(b("input#code",this.contentNode)[0],"disabled",!1)}):g(a,"click",function(){f.set(b("input#code",this.contentNode)[0],"disabled",!0)})}));a=b("select#moderation_rubric",this.contentNode)[0];this.updateUsageHints(f.get(a,"value"));g(a,"change",c.hitch(this,function(){var a=
b("select#moderation_rubric",this.contentNode)[0];this.updateUsageHints(f.get(a,"value"))}));var d=b("select#mailtext_rubric",this.contentNode)[0],a=b("option:checked",d)[0];this.updateMailText(f.get(a,"id"));g(d,"change",c.hitch(this,function(){var a=b("option:checked",d)[0];this.updateMailText(f.get(a,"id"))}));a=b("select#additional_agb_description_text",this.contentNode)[0];this.updateUsageContract(f.get(a,"value"));g(a,"change",c.hitch(this,function(){var a=b("select#additional_agb_description_text",
this.contentNode)[0];this.updateUsageContract(f.get(a,"value"))}));dojo.ready(c.hitch(this,function(){this.featureHandles["upload-single"][0].setCallback(c.hitch(this,function(a){var d=b("div.filePreview",this.featureHandles["upload-single"][0].uploader.form)[0];h.empty(d);h.create("img",{src:"commsy.php?cid="+this.uri_object.cid+"&mod=picture&fct=getTemp&fileName="+a.file},d,"last");this.sendImages.push({part:"room_logo",fileInfo:a})}));this.featureHandles["upload-single"][1].setCallback(c.hitch(this,
function(a){var d=b("div.filePreview",this.featureHandles["upload-single"][0].uploader.form)[0];h.empty(d);h.create("img",{src:"commsy.php?cid="+this.uri_object.cid+"&mod=picture&fct=getTemp&fileName="+a.file},d,"last");this.sendImages.push({part:"room_bg",fileInfo:a})}))}));require(["commsy/Accounts"],c.hitch(this,function(a){a=new a;a.init(this.cid,this.from_php.template.tpl_path);var d=this.from_php.autoOpenPopup;if(d){var c=b("a[href='"+d.tab+"']")[0];c&&(a.setStatus(d.parameters.filter),c.click())}}));
(a=b("#submit_delete_wordpress",this.contentNode)[0])&&g(a,"click",c.hitch(this,function(){this.button_delete=new dijit.form.Button({label:"Blog endg&uuml;ltig l&ouml;schen",onClick:c.hitch(this,function(){this.onPopupSubmit({part:"external_configuration",action:"delete_wordpress"});this.dialog.destroyRecursive()})});this.button_cancel=new dijit.form.Button({label:"Abbrechen",onClick:c.hitch(this,function(){this.dialog.destroyRecursive()})});this.dialog=new dijit.Dialog({title:"Wordpress l&ouml;schen",
content:"<b style='color:#ff0000;'>Achtung: Alle Daten im Blog werden gel&ouml;scht. Dieser Vorgang kann nicht r&uuml;ckg&auml;ngig gemacht werden!</b><br/><br/>"});dojo.place(this.button_delete.domNode,this.dialog.containerNode);dojo.place(this.button_cancel.domNode,this.dialog.containerNode);this.dialog.show()}));(a=b("#submit_delete_wiki",this.contentNode)[0])&&g(a,"click",c.hitch(this,function(){this.button_delete=new dijit.form.Button({label:"Wiki endg&uuml;ltig l&ouml;schen",onClick:c.hitch(this,
function(){this.onPopupSubmit({part:"external_configuration",action:"delete_wiki"});this.dialog.destroyRecursive()})});this.button_cancel=new dijit.form.Button({label:"Abbrechen",onClick:c.hitch(this,function(){this.dialog.destroyRecursive()})});this.dialog=new dijit.Dialog({title:"Wiki l&ouml;schen",content:"<b style='color:#ff0000;'>Ein gel&ouml;schtes Wiki kann nicht wieder rekonstruiert werden. M&ouml;chten Sie dieses Wiki endg&uuml;ltig l&ouml;schen?</b><br/><br/>"});dojo.place(this.button_delete.domNode,
this.dialog.containerNode);dojo.place(this.button_cancel.domNode,this.dialog.containerNode);this.dialog.show()}));(a=b("#submit_delete_room",this.contentNode)[0])&&g(a,"click",c.hitch(this,function(){this.button_delete=new dijit.form.Button({label:"Raum endg&uuml;ltig l&ouml;schen",onClick:c.hitch(this,function(){this.onPopupSubmit({part:"room_configuration",action:"delete_room"});this.dialog.destroyRecursive()})});this.button_cancel=new dijit.form.Button({label:"Abbrechen",onClick:c.hitch(this,function(){this.dialog.destroyRecursive()})});
this.dialog=new dijit.Dialog({title:"Raum l&ouml;schen",content:"<b style='color:#ff0000;'>Achtung: Der gesamte Raum und alle Daten im Raum werden gel&ouml;scht. Dieser Vorgang kann nicht r&uuml;ckg&auml;ngig gemacht werden!</b><br/><br/>"});dojo.place(this.button_delete.domNode,this.dialog.containerNode);dojo.place(this.button_cancel.domNode,this.dialog.containerNode);this.dialog.show()}))},onClickAssignCommunityRoom:function(){var a=b("select#room_communityrooms",this.contentNode)[0],d=f.get(a,
"value");if(!isNaN(d)&&-1<d){var c=!1;dojo.forEach(b("input[name^='form_data[communityroomlist_']"),function(a){if(/form_data\[communityroomlist_([0-9]*)\]/.exec(f.get(a,"name"))[1]==d)return c=!0,!1});if(!1===c){var e=b("div#assigned_community_rooms",this.contentNode)[0];h.create("input",{id:"room_communityroomlist",type:"checkbox",checked:!0,value:d,name:"form_data[communityroomlist_"+d+"]"},e,"last");a=f.get(b("option[value='"+d+"']",a)[0],"innerHTML");h.create("span",{innerHTML:a},e,"last")}}},
onClickAdditionalStatus:function(){var a=b("input#status")[0],d=f.get(a,"value");f.set(a,"value","");if(""!==d){var a=b("div#additional_status_list")[0],c=5;dojo.forEach(b("input",a),function(a,d){d=/form_data\[additional_status_([0-9]*)\]/.exec(f.get(a,"name"))[1];d>=c&&(c=parseInt(d)+1)});h.create("input",{type:"checkbox",checked:!0,value:d,name:"form_data[additional_status_"+c+"]"},a,"last");h.create("span",{innerHTML:d},a,"last")}},updateConfigurationSchemaPreview:function(){var a=b("select#room_color_choice option:checked",
this.contentNode)[0],d=f.get(a,"value");f.get(a,"innerHTML");var a=b("div#room_color_preview img",this.contentNode)[0],c=b("div#room_color_preview",this.contentNode)[0],g=b("div#room_color_own",this.contentNode)[0];"individual"===d?(e.add(c,"hidden"),e.remove(g,"hidden")):(e.remove(c,"hidden"),e.add(g,"hidden"),f.set(a,"src","templates/themes/"+d+"/preview.gif"))},updateUsageHints:function(a){dojo.forEach(b("input[id^='moderation_title_']",this.contentNode),function(a){e.add(a,"hidden")});dojo.forEach(b("div[id^='moderation_description_'], textarea[id^='moderation_description_']",
this.contentNode),function(a){e.add(a.parentNode,"hidden")});e.remove(b("input#moderation_title_"+a,this.contentNode)[0],"hidden");e.remove(b("div#moderation_description_"+a+", textarea#moderation_description_"+a,this.contentNode)[0].parentNode,"hidden")},updateMailText:function(a){a=/mail_text_([0-9]*)/.exec(a)[1];dojo.forEach(b("textarea[id^='moderation_mail_body_']",this.contentNode),function(a){e.add(a.parentNode,"hidden");e.add(a.parentNode.parentNode,"hidden")});dojo.forEach(b("textarea#moderation_mail_body_de_"+
a+", textarea#moderation_mail_body_en_"+a,this.contentNode),function(a){e.remove(a.parentNode,"hidden");e.remove(a.parentNode.parentNode,"hidden")})},updateUsageContract:function(a){dojo.forEach(b("div[id^='agb_text_']",this.contentNode),function(a){e.add(a.parentNode,"hidden");e.add(a.parentNode.parentNode,"hidden")});a=b("div[id^='agb_text_"+a+"']")[0];e.remove(a.parentNode,"hidden");e.remove(a.parentNode.parentNode,"hidden")},onPopupSubmit:function(a){var c=a.part,a=a.action;dojo.forEach(this.featureHandles.editor,
function(a){a.getInstance();var c=a.getNode().parentNode;f.set(b("input[type='hidden']",c)[0],"value",a.getInstance().getData())});this.submit({tabs:[{id:c}],nodeLists:[]},{part:c,action:a})},onPopupSubmitSuccess:function(a){0<this.sendImages.length?this.AJAXRequest("popup","save",{module:"configuration",additional:{part:this.sendImages[0].part,fileInfo:this.sendImages[0].fileInfo}},c.hitch(this,function(){this.sendImages[1]?this.AJAXRequest("popup","save",{module:"configuration",additional:{part:this.sendImages[1].part,
fileInfo:this.sendImages[1].fileInfo}},function(){location.reload()}):location.reload()})):a?location.href="commsy.php?cid="+a:location.reload()}})});