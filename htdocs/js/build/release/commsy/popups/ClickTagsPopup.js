//>>built
define("commsy/popups/ClickTagsPopup","dojo/_base/declare,commsy/ClickPopupHandler,dojo/query,dojo/dom-class,dojo/_base/lang,dojo/dom-construct,dojo/dom-attr,dojo/dom-style,dojo/on,dojo/NodeList-traverse".split(","),function(i,j,e,k,c,f,d,l,g){return i(j,{constructor:function(){},init:function(a,b){this.triggerNode=a;this.module="tags";this.tree=null;this.features=[];this.contextId=b.contextId;this.registerPopupClick()},setupSpecific:function(){require(["commsy/EditTree"],c.hitch(this,function(a){this.tree=
new a({followUrl:!1,checkboxes:!1,room_id:this.contextId,expanded:!1,item_id:this.item_id});this.tree.setupTree(e("div.tree",this.contentNode)[0],c.hitch(this,function(a){g(a.tree,"open",c.hitch(this,function(){this.tree.addCreateAndRenameToAllLabels()}))}))}));var a=e("select#tag_merge_one")[0],b=e("select#tag_merge_two")[0];g(a,"change",c.hitch(this,function(a){this.enableAllOptionsExceptOne(b,d.get(a.target,"value"))}));g(b,"change",c.hitch(this,function(b){this.enableAllOptionsExceptOne(a,d.get(b.target,
"value"))}));require(["commsy/List"],c.hitch(this,function(a){this.list=new a;this.list.init(this.cid,this.from_php.template.tpl_path,{activatorNode:e("a.list_activator")[0],module:"tags",roomId:this.contextId,OnInitDone:c.hitch(this,function(){this.list.performRequest()})});if(a=e("div#attach_tab input.tag_attach")[0])this.list.requestData.item_id=d.get(a,"id"),this.list.requestData.contextId=this.contextId}));dojo.forEach(e("input.tag_attach"),c.hitch(this,function(a){g(a,"click",c.hitch(this,function(){var b=
d.get(a,"name");this.list.requestData.item_id=b.substr(10,b.length-11);this.list.requestData.contextId=this.contextId;this.list.performRequest();b=d.get((new dojo.NodeList(a)).siblings("label")[0],"innerHTML");d.set(e("div.open_close_head span.text_important")[0],"innerHTML","&bdquo;"+b+"&rdquo;")}))}))},enableAllOptionsExceptOne:function(a,b){var h=e("option",a);dojo.forEach(h,c.hitch(this,function(a){d.get(a,"value")===b?d.set(a,"disabled","disabled"):d.has(a,"disabled")&&d.remove(a,"disabled")}));
if(d.get(a,"value")===b){var f=!1;dojo.some(h,c.hitch(this,function(c){if(f)return!1;c=d.get(c,"value");c!==b&&(d.set(a,"value",c),f=!0)}))}},addTagToLists:function(a){dojo.forEach(e("ul.popup_tag_list"),c.hitch(this,function(b){b=e("div.clear",b)[0];f.create("li",{className:"ui-state-default popup_buzzword_item",innerHTML:a},b,"before")}))},removeTagFromLists:function(a){dojo.forEach(e("li.popup_tag_item"),c.hitch(this,function(b){d.get(b,"innerHTML")===a&&f.destroy(b)}))},addTagToMergeSelects:function(a,
b){var c=e("select#tag_merge_one")[0],d=e("select#tag_merge_two")[0];f.create("option",{value:a,innerHTML:b},c,"last");f.create("option",{value:a,innerHTML:b},d,"last")},removeTagFromMergeSelects:function(a){var b=e("select#tag_merge_one option, select#tag_merge_two option");dojo.forEach(b,c.hitch(this,function(b){d.get(b,"innerHTML")===a&&f.destroy(b)}))},onPopupSubmit:function(a){a=a.part;if("sort_abc"===a)this.onSortABC();else if("merge"==a)this.onMergeTags()},onSortABC:function(){this.AJAXRequest("tags",
"sortABC",{roomId:this.contextId},c.hitch(this,function(){this.close()}))},onMergeTags:function(){var a=d.get(e("select#tag_merge_one")[0],"value"),b=d.get(e("select#tag_merge_two")[0],"value");a!==b&&this.AJAXRequest("tags","mergeTags",{idOne:a,idTwo:b},c.hitch(this,function(){this.close()}),c.hitch(this,function(){}))},onPopupSubmitSuccess:function(){location.reload()}})});