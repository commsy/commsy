//>>built
define("commsy/popups/ClickBuzzwordsPopup","dojo/_base/declare,commsy/ClickPopupHandler,dojo/query,dojo/dom-class,dojo/_base/lang,dojo/dom-construct,dojo/dom-attr,dojo/dom-style,dojo/on,dojo/topic,dojo/NodeList-traverse".split(","),function(k,l,e,n,c,g,f,m,h,i){return k(l,{constructor:function(){},init:function(a,b){this.triggerNode=a;this.module="buzzwords";this.list=null;this.features=[];this.contextId=b.contextId;this.registerPopupClick()},setupSpecific:function(){var a=e("select#buzzword_merge_one")[0],
b=e("select#buzzword_merge_two")[0];h(a,"change",c.hitch(this,function(d){this.enableAllOptionsExceptOne(b,f.get(d.target,"value"))}));h(b,"change",c.hitch(this,function(d){this.enableAllOptionsExceptOne(a,f.get(d.target,"value"))}));require(["commsy/List"],c.hitch(this,function(d){this.list=new d;this.list.init(this.cid,this.from_php.template.tpl_path,{activatorNode:e("a.list_activator")[0],module:"buzzwords",roomId:this.contextId,OnInitDone:c.hitch(this,function(){this.list.performRequest()})});
if(d=e("div#edit_tab input.buzzword_change_name:first-child")[0])this.list.requestData.item_id=f.get(d,"id"),this.list.requestData.contextId=this.contextId}));dojo.forEach(e("input.buzzword_attach"),c.hitch(this,function(d){h(d,"click",c.hitch(this,function(){var a=f.get(d,"name");this.list.requestData.item_id=a.substr(10,a.length-11);this.list.requestData.contextId=this.contextId;this.list.performRequest();a=f.get((new dojo.NodeList(d)).siblings("input.buzzword_change_name")[0],"value");f.set(e("div.open_close_head span.text_important")[0],
"innerHTML","&bdquo;"+a+"&rdquo;")}))}));dojo.forEach(e("input.buzzword_change"),c.hitch(this,function(a){h(a,"click",c.hitch(this,function(){var b=f.get(a,"name"),j=b.substr(10,b.length-11),g=f.get((new dojo.NodeList(a)).siblings("input.buzzword_change_name")[0],"value");this.AJAXRequest("buzzwords","updateBuzzword",{buzzword_id:j,buzzword:g},c.hitch(this,function(){this.list.requestData.item_id===j&&(f.set(e("div.open_close_head span.text_important")[0],"innerHTML","&bdquo;"+g+"&rdquo;"),this.contextId&&
i.publish("newOwnRoomBuzzword",{}))}),c.hitch(this,function(){}))}))}));dojo.forEach(e("input.buzzword_delete"),c.hitch(this,function(a){h(a,"click",c.hitch(this,function(){var b=f.get(a,"name"),b=b.substr(10,b.length-11),e=f.get((new dojo.NodeList(a)).siblings("input.buzzword_change_name")[0],"value");this.AJAXRequest("buzzwords","deleteBuzzword",{buzzword_id:b},c.hitch(this,function(){this.removeBuzzwordFromLists(e);this.removeBuzzwordFromMergeSelects(e);this.removeBuzzwordFromEditTab(e);this.contextId&&
i.publish("newOwnRoomBuzzword",{})}),c.hitch(this,function(){}))}))}))},enableAllOptionsExceptOne:function(a,b){var d=e("option",a);dojo.forEach(d,c.hitch(this,function(a){f.get(a,"value")===b?f.set(a,"disabled","disabled"):f.has(a,"disabled")&&f.remove(a,"disabled")}));if(f.get(a,"value")===b){var g=!1;dojo.some(d,c.hitch(this,function(d){if(g)return!1;d=f.get(d,"value");d!==b&&(f.set(a,"value",d),g=!0)}))}},onPopupSubmit:function(a){a=a.part;"add"===a?this.OnAddNewBuzzword():"merge"==a&&this.OnMergeBuzzwords()},
addBuzzwordToLists:function(a){dojo.forEach(e("ul.popup_buzzword_list"),c.hitch(this,function(b){b=e("div.clear",b)[0];g.create("li",{className:"ui-state-default popup_buzzword_item",innerHTML:a},b,"before")}))},removeBuzzwordFromLists:function(a){dojo.forEach(e("li.popup_buzzword_item"),c.hitch(this,function(b){f.get(b,"innerHTML")===a&&g.destroy(b)}))},addBuzzwordToMergeSelects:function(a,b){var d=e("select#buzzword_merge_one")[0],c=e("select#buzzword_merge_two")[0];g.create("option",{value:a,innerHTML:b},
d,"last");g.create("option",{value:a,innerHTML:b},c,"last")},removeBuzzwordFromMergeSelects:function(a){var b=e("select#buzzword_merge_one option, select#buzzword_merge_two option");dojo.forEach(b,c.hitch(this,function(b){f.get(b,"innerHTML")===a&&g.destroy(b)}))},addBuzzwordToEditTab:function(a,b){var d=e("div#edit_tab div#content_row_one")[0],d=g.create("div",{className:"input_row"},d,"last");g.create("input",{className:"buzzword_change_name size_200",type:"text",value:b},d,"last");g.create("input",
{className:"popup_button buzzword_change mandatory",type:"button",value:"\u00c4ndern",name:"form_data["+a+"]"},d,"last");g.create("input",{className:"popup_button buzzword_attach",type:"button",value:"Eintr\u00e4ge zuordnen",name:"form_data["+a+"]"},d,"last");g.create("input",{className:"popup_button buzzword_delete",type:"button",value:"L\u00f6schen",name:"form_data["+a+"]"},d,"last")},removeBuzzwordFromEditTab:function(a){dojo.forEach(e("input.buzzword_change_name"),c.hitch(this,function(b){if(b.value==
a)return b=(new dojo.NodeList(b)).parents("div.input_row")[0],g.destroy(b),!0}))},OnAddNewBuzzword:function(){var a=c.trim(f.get(e("input#buzzword_create_name")[0],"value"));""!==a&&this.AJAXRequest("buzzwords","createNewBuzzword",{buzzword:a,roomId:this.contextId},c.hitch(this,function(b){this.addBuzzwordToLists(a);this.addBuzzwordToMergeSelects(b.id,a);this.addBuzzwordToEditTab(b.id,a);this.destroyLoading();this.contextId&&i.publish("newOwnRoomBuzzword",{})}),c.hitch(this,function(b){"107"==b.code&&
dojo.forEach(e("li.popup_buzzword_item"),c.hitch(this,function(b){var c=f.get(b,"innerHTML");m.set(b,"color",c===a?"red":"#393939")}));this.destroyLoading()}))},OnMergeBuzzwords:function(){var a=f.get(e("select#buzzword_merge_one")[0],"value"),b=f.get(e("select#buzzword_merge_two")[0],"value");a!==b&&this.AJAXRequest("buzzwords","mergeBuzzwords",{idOne:a,idTwo:b},c.hitch(this,function(b){this.removeBuzzwordFromLists(b.buzzwordOne);this.removeBuzzwordFromLists(b.buzzwordTwo);this.addBuzzwordToLists(b.newBuzzword);
this.removeBuzzwordFromMergeSelects(b.buzzwordOne);this.removeBuzzwordFromMergeSelects(b.buzzwordTwo);this.addBuzzwordToMergeSelects(a,b.newBuzzword);this.destroyLoading();this.contextId&&i.publish("newOwnRoomBuzzword",{})}),c.hitch(this,function(){this.destroyLoading()}))},onPopupSubmitSuccess:function(){}})});