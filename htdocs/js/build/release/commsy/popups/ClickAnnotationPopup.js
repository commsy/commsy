//>>built
define("commsy/popups/ClickAnnotationPopup","dojo/_base/declare,commsy/ClickPopupHandler,dojo/query,dojo/dom-class,dojo/_base/lang,dojo/dom-construct,dojo/dom-attr,dojo/on,dojo/topic".split(","),function(e,f,c,i,g,j,h,k,d){return e(f,{constructor:function(){},init:function(b,a){this.triggerNode=b;this.item_id=a.iid;this.module="annotation";this.contextId=a.contextId;this.ref_iid=a.annotatedId;this.version_id=a.vid;this.setInitData({portfolioId:a.portfolioId,portfolioRow:a.portfolioRow,portfolioColumn:a.portfolioColumn});
this.features=["editor","tree","upload","netnavigation","calendar"];this.registerPopupClick()},setupSpecific:function(){},onPopupSubmit:function(){dojo.forEach(this.featureHandles.editor,function(b){b.getInstance();var a=b.getNode().parentNode;h.set(c("input[type='hidden']",a)[0],"value",b.getInstance().getData())});this.submit({tabs:[{id:"rights_tab"},{id:"buzzwords_tab",group:"buzzwords"},{id:"tags_tab",group:"tags"}],nodeLists:[{query:c("div#files_attached",this.contentNode)},{query:c("div#files_finished",
this.contentNode),group:"files"},{query:c("input[name='form_data[description]']",this.contentNode)},{query:c("input[name='form_data[dayEnd]']",this.contentNode)},{query:c("input[name='form_data[timeEnd]']",this.contentNode)},{query:c("input[name='form_data[title]']",this.contentNode)}]},{contextId:this.contextId,annotatedId:this.ref_iid,versionId:this.version_id,portfolioId:this.initData.portfolioId,portfolioRow:this.initData.portfolioRow,portfolioColumn:this.initData.portfolioColumn})},onPopupSubmitSuccess:function(b){if("NEW"===
this.item_id)this.initData.portfolioId?(d.publish("updatePortfolio",{portfolioId:this.initData.portfolioId}),this.close()):this.featureHandles.netnavigation[0].afterItemCreation(b,g.hitch(this,function(){if(this.contextId){this.close();var a=c("a#listItem"+b)[0];a&&a.click()}else this.reload(b)}));else if(this.initData.portfolioId)d.publish("portfolioOpenAnnotation",{itemId:b}),this.close();else{if(this.contextId){this.close();var a=c("a#listItem"+b)[0];a&&a.click()}else this.reload(b);this.reload(b)}}})});