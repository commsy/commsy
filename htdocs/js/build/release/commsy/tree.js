//>>built
define("commsy/tree","dojo/_base/declare,dojo/dom-construct,dojo/io-query,commsy/base,dojo/on,dojo/_base/lang,cbtree/Tree,dojo/query,cbtree/models/ForestStoreModel,dojo/data/ItemFileWriteStore,cbtree/CheckBox,cbtree/models/StoreModel-API".split(","),function(e,g,h,i,j,d,k,l,m,n,o){return e(i,{followUrl:!0,autoExpandLevel:2,checkboxes:!1,expanded:!1,item_id:null,tree:null,store:null,model:null,room_id:null,constructor:function(a){a=a||{};e.safeMixin(this,a)},setupTree:function(a,b,c){c?this.initDo(a,
b):(c=l("a[href='tags_tab']")[0])&&j(c,"click",d.hitch(this,function(){this.initDo(a,b)}))},initDo:function(a,b){b=b||function(){};this.AJAXRequest("tagtree","getTreeData",{item_id:this.item_id,room_id:this.room_id},d.hitch(this,function(c){c=this.sanitizeResults(c);this.store=new n({data:{identifier:"item_id",label:"title",items:c}});this.model=this.createModel();this.tree=this.createTree();g.empty(a);this.tree.placeAt(a);!0===this.expanded&&this.autoExpandToLevel(this.tree,0,!0);b(this)}))},createModel:function(){return new m({store:this.store,
checkedAttr:"match",checkedStrict:!1})},createTree:function(){return new k({model:this.model,showRoot:!1,persist:!1,checkBoxes:this.checkboxes,onClick:d.hitch(this,function(a,b,c){this.followUrl?("home"==this.uri_object.mod&&this.replaceOrSetURIParam("mod","search"),location.href="commsy.php?"+h.objectToQuery(this.replaceOrSetURIParam("seltag",a.item_id))):"INPUT"!==c.target.nodeName&&(!0===this.model.getChecked(a)?this.model.setChecked(a,!1):this.model.setChecked(a,!0))}),widget:{type:o,args:{multiState:!0},
mixin:function(a){a.value=this.item.item_id[0];a.name="form_data[tags]"}}})},autoExpandToLevel:function(a,b,c){this.expandHelper(a,a.rootNode,0,b,c)},getNumItems:function(a){return this.numHelper(a.rootNode.item)},expandHelper:function(a,b,c,f,e){b=b.getChildren();dojo.forEach(b,d.hitch(this,function(b){e||c<f?a._expandNode(b):a._collapseNode(b);this.expandHelper(a,b,c+1,f,e)}))},numHelper:function(a){var b=0;dojo.forEach(a.children,d.hitch(this,function(a){b+=this.numHelper(a)}));return b+1},iterateCallback:function(a,
b){b(a);this.tree.model.getChildren(a,d.hitch(this,function(a){dojo.forEach(a,d.hitch(this,function(a){this.iterateCallback(a,b)}))}))},sanitizeResults:function(a){dojo.forEach(a,d.hitch(this,function(b,c){if(b.children)0===b.children.length?delete b.children:b.children=this.sanitizeResults(b.children);a[c]=b}));return a},buildPath:function(a,b){b=b||[];b.push(a);var c=this.store.getParents(this.model.fetchItem({item_id:a}))[0];if(c)return this.buildPath(this.store.getIdentity(c),b);b.push(this.tree.rootNode.item.id);
return b.reverse()}})});