//>>built
define("commsy/Accounts","dojo/_base/declare,commsy/base,dojo/_base/lang,dojo/query,dojo/on,dojo/dom-construct,dojo/dom-attr,dojo/dom-style,dojo/_base/array,dojo/NodeList-traverse".split(","),function(j,k,c,b,d,e,f,l,i){return j(k,{cid:null,tpl_path:"",initialized:!1,paging:{current:0},restrictions:{search:"",status:7},store:{pages:1,selected_ids:[]},translations:null,init:function(a,g){this.cid=a;this.tpl_path=g;d(b("#popup_account_tab")[0],"click",c.hitch(this,function(){!1===this.initialized&&
this.AJAXRequest("accounts","getInitialData",{},c.hitch(this,function(a){this.translations=a.translations;this.setupPaging();this.setupRestrictions();this.performRequest();d(b("input[name='accounts_submit_restrictions']")[0],"click",c.hitch(this,function(a){this.paging.current=0;this.performRequest();a.preventDefault()}));d(b("input#list_action_submit")[0],"click",c.hitch(this,function(){this.onActionSubmit()}))}))}))},setupRestrictions:function(){var a=b(".pop_item_content")[0];d(b("select[name='accounts_status_restriction']",
a)[0],"change",c.hitch(this,function(a){this.restrictions.status=f.get(a.target,"value");a.preventDefault()}));d(b("input[name='accounts_search_restriction']",a)[0],"change",c.hitch(this,function(a){this.restrictions.search=f.get(a.target,"value");a.preventDefault()}))},setupPaging:function(){var a=b(".pop_item_navigation")[0];d(b("#first",a)[0],"click",c.hitch(this,function(a){if(0<this.paging.current)this.paging.current=0;a.preventDefault();this.performRequest()}));d(b("#prev",a)[0],"click",c.hitch(this,
function(a){0<this.paging.current&&this.paging.current--;a.preventDefault();this.performRequest()}));d(b("#next",a)[0],"click",c.hitch(this,function(a){this.paging.current+1<this.store.pages&&this.paging.current++;a.preventDefault();this.performRequest()}));d(b("#last",a)[0],"click",c.hitch(this,function(a){if(this.paging.current+1<this.store.pages)this.paging.current=this.store.pages-1;a.preventDefault();this.performRequest()}))},setStatus:function(a){this.restrictions.status=a;var c=b(".pop_item_content")[0],
a=b("select[name='accounts_status_restriction'] option[value='"+a+"']",c)[0];f.set(a,"selected","selected")},performRequest:function(){this.AJAXRequest("accounts","performRequest",{current_page:this.paging.current,restrictions:this.restrictions},c.hitch(this,function(a){var g=b("#popup_accounts #crt_row_area")[0];e.empty(g);dojo.forEach(a.list,c.hitch(this,function(a,b){var c=e.create("div",{className:0===b%2?"pop_row_even":"pop_row_odd"},g,"last"),d=e.create("div",{className:"pop_col_25"},c,"last");
e.create("input",{type:"checkbox",id:"user_"+a.item_id,checked:-1!==i.indexOf(this.store.selected_ids,a.item_id)?!0:!1},d,"last");e.create("div",{className:"pop_col_270",innerHTML:a.fullname},c,"last");e.create("div",{className:"pop_col_150",innerHTML:a.status},c,"last");e.create("div",{className:"pop_col_150",innerHTML:a.email},c,"last");e.create("div",{className:"clear"},c,"last")}));d(b("input[id^='user_']",g),"click",c.hitch(this,function(a){var a=f.get(a.target,"id").substr(5),b=i.indexOf(this.store.selected_ids,
a);-1===b?this.store.selected_ids.push(a):this.store.selected_ids.splice(b,1)}));f.set(b("#pop_item_current_page")[0],"innerHTML",0===a.list.length?0:this.paging.current+1);f.set(b("#pop_item_pages")[0],"innerHTML",a.paging.pages);this.store.pages=a.paging.pages}))},onActionSubmit:function(){var a=f.get(b("select#list_action")[0],"value");this.AJAXRequest("accounts","performUserAction",{ids:this.store.selected_ids,action:a},c.hitch(this,function(){var g=this.store.selected_ids;this.store.selected_ids=
[];this.performRequest();0<g.length&&this.AJAXRequest("popup","getHTML",{ids:g,action:a,module:"configuration_mail"},c.hitch(this,function(f){var h=b("div#popup_accounts_mail")[0];e.empty(h);e.place(f,h,"last");d(b("input[name='send']",h)[0],"click",c.hitch(this,function(){this.sendMail(h,a,g)}));d(b("input[name='abort']",h)[0],"click",c.hitch(this,function(){var a=b("div#popup_accounts_mail")[0];e.empty(a)}))}))}))},sendMail:function(a,d,i){var h=b("input[name='form_data[send_mail]']",a)[0];this.AJAXRequest("accounts",
"sendMail",{sendMail:h?h.checked:!0,modCC:b("input[name='form_data[copy_mod_cc]']",a)[0].checked,modBCC:b("input[name='form_data[copy_mod_bcc]']",a)[0].checked,authCC:b("input[name='form_data[copy_auth_cc]']",a)[0].checked,authBCC:b("input[name='form_data[copy_auth_bcc]']",a)[0].checked,subject:f.get(b("input[name='form_data[subject]']",a)[0],"value"),description:f.get(b("textarea[name='form_data[body]']",a)[0],"value"),ids:i,action:d},c.hitch(this,function(){var a=b("div#popup_accounts_mail")[0];
e.empty(a)}))}})});