//>>built
define("commsy/ListSelection","dojo/_base/declare,commsy/base,dojo/_base/lang,dojo/query,dojo/on,dojo/cookie,dojo/dom-attr,dojo/dom-construct,dojo/_base/array".split(","),function(i,l,d,e,g,f,c,j,k){return i(l,{cookieName:"commsy_list_selection",cookieObject:{lastRubric:null,selectedIDs:[]},currentRubric:null,inputNodes:null,counterNode:null,constructor:function(b){b=b||{};i.safeMixin(this,b)},setup:function(b,a){this.inputNodes=b;this.counterNode=a;this.currentRubric=this.uri_object.mod;var c=f(this.cookieName),
h={};c&&(h=dojo.fromJson(c));this.cookieObject.lastRubric=h.lastRubric||this.currentRubric;this.cookieObject.selectedIDs=h.selectedIDs||[];g(this.inputNodes,"click",d.hitch(this,function(a){this.onClickCheckbox(a.target)}));(c=e("input#delete_confirmselect_option")[0])&&g(c,"click",d.hitch(this,function(a){this.onClickListActionSubmit(a.target)}));(c=e("input#selectAll")[0])&&g(c,"click",d.hitch(this,function(a){this.onSelectAll(a.target)}));this.currentRubric===this.cookieObject.lastRubric?this.restoreSelection():
this.cookieObject.selectedIDs=[];this.cookieObject.lastRubric=this.currentRubric;f(this.cookieName,dojo.toJson(this.cookieObject))},restoreSelection:function(){dojo.forEach(this.inputNodes,d.hitch(this,function(b){var a=c.get(b,"name"),a=a.substr(18).substr(0,a.length-19);-1!==k.indexOf(this.cookieObject.selectedIDs,a)&&c.set(b,"checked","checked")}));this.counterNode&&c.set(this.counterNode,"innerHTML",this.cookieObject.selectedIDs.length)},onClickCheckbox:function(b){var a=c.get(b,"name"),a=a.substr(18).substr(0,
a.length-19);c.get(b,"checked")?this.cookieObject.selectedIDs.push(a):this.cookieObject.selectedIDs.splice(k.indexOf(this.cookieObject.selectedIDs,a),1);f(this.cookieName,dojo.toJson(this.cookieObject));this.restoreSelection()},performListOption:function(b){"listoption_download"==b&&dojo.forEach(this.cookieObject.selectedIDs,d.hitch(this,function(a){a=j.create("a",{href:"commsy.php?cid="+this.uri_object.cid+"&mod=download&fct=action&iid="+a,target:"_blank"},e("body")[0],"last");a.click();j.destroy(a)}))},
onClickListActionSubmit:function(){this.performListOption(c.get(e("select[name='form_data[option][list]']")[0],"value"));this.cookieObject.selectedIDs=[];f(this.cookieName,dojo.toJson(this.cookieObject))},onSelectAll:function(){dojo.forEach(e("div.row_even input[type='checkbox'], div.row_odd input[type='checkbox']"),d.hitch(this,function(b){b.click()}))}})});