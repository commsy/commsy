//>>built
define("commsy/ClickPopupHandler","dojo/_base/declare,commsy/PopupHandler,dojo/on,dojo/_base/lang,dojo/query,dojo/dom-class,dijit/Tooltip,dojo/dom-attr,dojo/dom-construct,dojo/dom-style".split(","),function(c,g,e,b,f,j,k,i,h){return c(g,{triggerNode:null,item_id:null,ref_iid:null,ticks:0,ajaxHTMLSource:"rubric_popup",constructor:function(){this.fct="rubric_popup";this.initData={}},setInitData:function(a){this.initData=a},registerPopupClick:function(){e(this.triggerNode,"click",b.hitch(this,function(a){this.open();
a.preventDefault()}))},open:function(){if(!1===this.is_open){this.is_open=!0;this.setupLoading();var a={module:this.module,iid:this.item_id,ref_iid:this.ref_iid,editType:this.editType,version_id:this.version_id,contextId:this.contextId,date_new:this.date_new};c.safeMixin(a,this.initData);this.AJAXRequest(this.ajaxHTMLSource,"getHTML",a,b.hitch(this,function(a){h.place(a,f("body")[0],"first");this.contentNode=f("div#popup_wrapper")[0];this.scrollToNodeAnimated(this.contentNode);this.setupTabs();this.setupFeatures();
this.setupSpecific();this.setupAutoSave();this.onCreate();e(f("a#popup_close, input#popup_button_abort",this.contentNode),"click",b.hitch(this,function(a){this.close();a.preventDefault()}));e(f("input.submit",this.contentNode),"click",b.hitch(this,function(a){this.setupLoading();this.onPopupSubmit(this.getAttrAsObject(a.target,"data-custom"));a.preventDefault()}));this.is_open=!this.is_open;this.destroyLoading()}))}},setupAutoSave:function(){var a=this.from_php.autosave.mode,e=this.from_php.autosave.limit;
0<a&&require(["dojox/timing","dojox/string/sprintf"],b.hitch(this,function(){var c=new dojox.timing.Timer(1E3);if(2==a)var g=h.create("div",{className:"autosave",innerHTML:"00:00:00"},f("div#crt_actions_area",this.contentNode)[0],"first");c.onTick=b.hitch(this,function(){this.ticks++;if(this.ticks===e)this.onPopupSubmit(this.getAttrAsObject(f("input.submit",this.contentNode)[0],"data-custom"));if(2==a){var d=e-this.ticks,b=Math.floor(d/3600),d=d-3600*b,c=Math.floor(d/60),d=dojox.string.sprintf("%02u:%02u:%02u",
b,c,d-60*c);i.set(g,"innerHTML",d)}});c.start()}))},close:function(){this.inherited(arguments);this.featureHandles.editor&&dojo.forEach(this.featureHandles.editor,function(a){a.destroy()});this.featureHandles.calendar&&dojo.forEach(this.featureHandles.calendar,function(a){a.destroy()});h.destroy(this.contentNode);this.destroyLoading();this.is_open=!1}})});