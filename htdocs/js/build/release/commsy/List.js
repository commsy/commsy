//>>built
define("commsy/List","dojo/_base/declare,commsy/base,dojo/_base/lang,dojo/query,dojo/on,dojo/dom-construct,dojo/dom-attr,dojo/dom-style,dojo/fx,dojo/NodeList-traverse".split(","),function(i,k,a,c,d,e,f,j){return i(k,{constructor:function(a){a=a||{};i.safeMixin(this,a);this.restrictions={search:"",rubric:"all",type:2,only_linked:!1};this.cid=null;this.tpl_path="";this.initialized=!1;this.paging={current:0};this.store={pages:1,selected:0,after_item_creation:[]};this.config=null;this.requestData={item_id:null}},
init:function(b,h,g){this.cid=b;this.tpl_path=h;this.config=g;this.config.contentNode=this.config.contentNode||c("body")[0];d(this.config.activatorNode,"click",a.hitch(this,function(){!1===this.initialized&&this.AJAXRequest(this.config.module,"getInitialData",{},a.hitch(this,function(h){var g=c("select[name='netnavigation_rubric_restriction']",this.config.contentNode)[0];dojo.forEach(h.rubrics,function(a){e.create("option",{value:a.value,innerHTML:a.text,disabled:a.disabled},g,"last")});this.setupPaging();
this.setupRestrictions();d(c("input[name='netnavigation_submit_restrictions']",this.config.contentNode)[0],"click",a.hitch(this,function(a){this.paging.current=0;this.performRequest();a.preventDefault()}));this.config.OnInitDone&&this.config.OnInitDone();this.initialized=!0}))}))},setupRestrictions:function(){var b=c("div.pop_item_content",this.config.contentNode)[0],h=c("select[name='netnavigation_type_restriction']",this.config.contentNode)[0];h&&d(h,"change",a.hitch(this,function(a){this.restrictions.type=
f.get(a.target,"value");a.preventDefault()}));d(c("select[name='netnavigation_rubric_restriction']",b)[0],"change",a.hitch(this,function(a){this.restrictions.rubric=f.get(a.target,"value");a.preventDefault()}));d(c("input[name='netnavigation_search_restriction']",b)[0],"change",a.hitch(this,function(a){this.restrictions.search=f.get(a.target,"value");a.preventDefault()}));d(c("input[name='netnavigation_linked_restriction']",b)[0],"change",a.hitch(this,function(a){this.restrictions.only_linked=!0===
f.get(a.target,"checked")?!0:!1;a.preventDefault()}))},setupPaging:function(){var b=c(".pop_item_navigation",this.config.contentNode)[0];d(c("a",b)[0],"click",a.hitch(this,function(a){if(0<this.paging.current)this.paging.current=0;a.preventDefault();this.performRequest()}));d(c("a",b)[1],"click",a.hitch(this,function(a){0<this.paging.current&&this.paging.current--;a.preventDefault();this.performRequest()}));d(c("a",b)[2],"click",a.hitch(this,function(a){this.paging.current+1<this.store.pages&&this.paging.current++;
a.preventDefault();this.performRequest()}));d(c("a",b)[3],"click",a.hitch(this,function(a){if(this.paging.current+1<this.store.pages)this.paging.current=this.store.pages-1;a.preventDefault();this.performRequest()}))},performRequest:function(){var b={module:this.module,current_page:this.paging.current,restrictions:this.restrictions,roomId:this.config.roomId};a.mixin(b,this.requestData);this.AJAXRequest(this.config.module,"performRequest",b,a.hitch(this,function(b){var g=c("#crt_row_area, .crt_row_area",
this.config.contentNode)[0];e.empty(g);dojo.forEach(b.list,function(a,b){var c=!1;"user"===this.module&&!0===a.system_label&&(c=!0);var d=e.create("div",{className:0===b%2?"pop_row_even":"pop_row_odd"},g,"last"),f=e.create("div",{className:"pop_col_25"},d,"last");e.create("input",{type:"checkbox",id:"linked_"+a.item_id,checked:a.checked,disabled:c},f,"last");e.create("div",{className:"pop_col_270",innerHTML:a.title},d,"last");e.create("div",{className:"pop_col_150",innerHTML:a.modification_date},
d,"last");e.create("div",{className:"pop_col_150",innerHTML:a.modificator},d,"last");e.create("div",{className:"clear"},d,"last")});this.store.selected=b.num_selected_total;dojo.forEach(c("input[type='checkbox']",g),a.hitch(this,function(b){var c=(new dojo.NodeList(b)).parents("div[class^='pop_row_']")[0],e=j.get(c,"backgroundColor");d(b,"change",a.hitch(this,function(d){var g=f.get(b,"checked"),d={link_id:f.get(d.target,"id").substr(7),checked:g};a.mixin(d,this.requestData);j.set(c,"backgroundColor",
"#D1D1D1");this.AJAXRequest(this.config.module,"updateLinkedItem",d,a.hitch(this,function(){dojo.anim(c,{backgroundColor:e});!0===g?this.store.selected++:this.store.selected--}))}))}));f.set(c("#pop_item_current_page, .pop_item_current_page",this.config.contentNode)[0],"innerHTML",0===b.list.length?0:this.paging.current+1);f.set(c("#pop_item_pages, .pop_item_pages",this.config.contentNode)[0],"innerHTML",b.paging.pages);this.store.pages=b.paging.pages}))}})});