//>>built
define("commsy/Netnavigation","dojo/_base/declare,commsy/base,dojo/_base/lang,dojo/query,dojo/on,dojo/dom-construct,dojo/dom-attr,dojo/dom-style,dojo/fx,dojo/NodeList-traverse".split(","),function(i,l,c,e,f,d,g,k,m){return i(l,{cid:null,item_id:null,module:null,tpl_path:"",initialized:!1,paging:{current:0},restrictions:{search:"",rubric:"all",type:2,only_linked:!1},store:{pages:1,selected:0,after_item_creation:[]},constructor:function(a){a=a||{};i.safeMixin(this,a)},init:function(a,h,b,d,g){this.cid=
a;this.item_id=h;this.module=b;this.tpl_path=d;g?this.initDo():(a=e("#popup_netnavigation_attach_new")[0])&&f(a,"click",c.hitch(this,function(){this.initDo()}))},initDo:function(){!1===this.initialized&&this.AJAXRequest("netnavigation","getInitialData",{module:this.module},c.hitch(this,function(a){var h=e("select[name='netnavigation_rubric_restriction']")[0];dojo.forEach(a.rubrics,function(b){d.create("option",{value:b.value,innerHTML:b.text,disabled:b.disabled},h,"last")});this.setupPaging();this.setupRestrictions();
f(e("input[name='netnavigation_submit_restrictions']")[0],"click",c.hitch(this,function(b){this.paging.current=0;this.performRequest();b.preventDefault()}));this.performRequest();this.initialized=!0}))},setupRestrictions:function(){var a=e("div.pop_item_content")[0],d=e("select[name='netnavigation_type_restriction']")[0];d&&f(d,"change",c.hitch(this,function(b){this.restrictions.type=g.get(b.target,"value");b.preventDefault()}));f(e("select[name='netnavigation_rubric_restriction']",a)[0],"change",
c.hitch(this,function(b){this.restrictions.rubric=g.get(b.target,"value");b.preventDefault()}));f(e("input[name='netnavigation_search_restriction']",a)[0],"change",c.hitch(this,function(b){this.restrictions.search=g.get(b.target,"value");b.preventDefault()}));f(e("input[name='netnavigation_linked_restriction']",a)[0],"change",c.hitch(this,function(b){this.restrictions.only_linked=!0===g.get(b.target,"checked")?!0:!1;b.preventDefault()}))},setupPaging:function(){var a=e(".pop_item_navigation")[0];
f(e("#first",a)[0],"click",c.hitch(this,function(a){if(0<this.paging.current)this.paging.current=0;a.preventDefault();this.performRequest()}));f(e("#prev",a)[0],"click",c.hitch(this,function(a){0<this.paging.current&&this.paging.current--;a.preventDefault();this.performRequest()}));f(e("#next",a)[0],"click",c.hitch(this,function(a){this.paging.current+1<this.store.pages&&this.paging.current++;a.preventDefault();this.performRequest()}));f(e("#last",a)[0],"click",c.hitch(this,function(a){if(this.paging.current+
1<this.store.pages)this.paging.current=this.store.pages-1;a.preventDefault();this.performRequest()}))},performRequest:function(){this.AJAXRequest("netnavigation","performRequest",{item_id:this.item_id,module:this.module,current_page:this.paging.current,restrictions:this.restrictions},c.hitch(this,function(a){var h=e("#popup_netnavigation #crt_row_area")[0];d.empty(h);dojo.forEach(a.list,function(b,a){var e=!1;"user"===this.module&&!0===b.system_label&&(e=!0);var c=d.create("div",{className:0===a%
2?"pop_row_even":"pop_row_odd"},h,"last"),f=d.create("div",{className:"pop_col_25"},c,"last");d.create("input",{type:"checkbox",id:"linked_"+b.item_id,checked:b.checked,disabled:e},f,"last");d.create("div",{className:"pop_col_270",innerHTML:b.title},c,"last");d.create("div",{className:"pop_col_150",innerHTML:b.modification_date},c,"last");d.create("div",{className:"pop_col_150",innerHTML:b.modificator},c,"last");d.create("div",{className:"clear"},c,"last")});this.store.selected=a.num_selected_total;
dojo.forEach(e("input[type='checkbox']",h),c.hitch(this,function(a){var h=(new dojo.NodeList(a)).parents("div[class^='pop_row_']")[0],n=k.get(h,"backgroundColor");f(a,"change",c.hitch(this,function(f){var i=g.get(a,"checked"),j=g.get(f.target,"id").substr(7),f={item_id:this.item_id,link_id:j,checked:i};k.set(h,"backgroundColor","#D1D1D1");this.AJAXRequest("netnavigation","updateLinkedItem",f,c.hitch(this,function(a){dojo.anim(h,{backgroundColor:n});if(!0===i){this.store.selected++;var b=a.linked_item.link_text,
c=d.create("li",{id:"item_"+j},e("div#netnavigation_list ul")[0],"first"),c=d.create("div",{className:"netnavigation"},c,"last"),f=d.create("a",{target:"_self",href:"commsy.php?cid="+this.cid+"&mod="+a.linked_item.module+"&fct=detail&iid="+a.linked_item.linked_iid,title:a.linked_item.title},c,"last");d.create("img",{src:this.tpl_path+"img/netnavigation/"+a.linked_item.img,title:a.linked_item.title},f,"last");d.create("a",{target:"_self",href:"commsy.php?cid="+this.cid+"&mod="+a.linked_item.module+
"&fct=detail&iid="+a.linked_item.linked_iid,title:a.linked_item.title,innerHTML:" "+b},c,"last");e("a#popup_path_tab")[0]&&(c=d.create("li",{className:"netnavigation"},e("ul#popup_path_list")[0],"last"),d.create("input",{type:"checkbox",id:"path_"+a.linked_item.linked_iid,checked:!1},c,"last"),d.create("img",{src:this.tpl_path+"img/netnavigation/"+a.linked_item.img},c,"last"),d.create("span",{innerHTML:b},c,"last"))}else{this.store.selected--;var g=e("div#netnavigation_list li#item_"+j)[0];m.wipeOut({node:g,
onEnd:function(){d.destroy(g)}}).play();e("a#popup_path_tab")[0]&&(a=e("ul#popup_path_list input#path_"+j)[0],d.destroy(a.parentNode))}}))}))}));g.set(e("#pop_item_current_page")[0],"innerHTML",0===a.list.length?0:this.paging.current+1);g.set(e("#pop_item_pages")[0],"innerHTML",a.paging.pages);this.store.pages=a.paging.pages}))},afterItemCreation:function(a,d){var b=[];dojo.forEach(e("div#netnavigation_list li"),function(a){b.push(g.get(a,"id").substr(5))});var f=b.length,i=0;0===b.length?d():dojo.forEach(b,
c.hitch(this,function(b){this.AJAXRequest("netnavigation","updateLinkedItem",{item_id:a,link_id:b,checked:!0},function(){i++;i===f&&d()},function(){},!0)}))}})});