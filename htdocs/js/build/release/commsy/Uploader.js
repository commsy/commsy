//>>built
define("commsy/Uploader","dojo/_base/declare,commsy/base,dojo/_base/lang,dojox/embed/Flash,dojox/form/Uploader,dijit/ProgressBar,dojox/form/uploader/FileList,dojo/dom-construct,dojo/dom-attr,dojo/on,dijit/form/Button,dojo/query,dojo/_base/connect".split(","),function(f,h,c,k,l,i,m,j,g,d,n,e){return f(h,{uploader:null,loadingImgNode:null,progressbar:null,single:!1,callback:null,constructor:function(a){a=a||{};f.safeMixin(this,a)},setCallback:function(a){this.callback=a},setup:function(a){dojo.require("dojox/form/uploader/plugins/IFrame");
dojo.ready(c.hitch(this,function(){this.uploader=new dojox.form.Uploader({multiple:!0,uploadOnSelect:!1,"class":"fileSelector",isDebug:!1,url:"commsy.php?cid="+this.uri_object.cid+"&mod=ajax&fct=upload&action=upload"},e("input.fileSelector",a)[0]);d(this.uploader,"begin",c.hitch(this,function(b){this.onUploadBegin(b)}));d(this.uploader,"complete",c.hitch(this,function(b){this.onUploadComplete(b)}));d(this.uploader,"error",c.hitch(this,function(b){this.onUploadError(b)}));d(this.uploader,"progress",
c.hitch(this,function(b){this.onProgress(b)}));d(this.uploader,"change",c.hitch(this,function(){var b=this.uri_object.mod;"todo"===b?b="step":"discussion"===b&&(b="discarticle");this.uploader.upload({file_upload_rubric:b});this.setupLoading()}));this.uploader.startup()}))},onUploadBegin:function(){this.progressbar=new i({value:"0%",className:"ui-progressbar"});this.progressbar.placeAt(e("div.fileList")[0])},onUploadComplete:function(a){this.destroyLoading();if(this.callback)this.callback(a);else{var b=
e("div#files_finished")[0];a.length||(a=[a]);dojo.forEach(a,c.hitch(this,function(a,c){j.create("input",{type:"checkbox",checked:"checked",name:"form_data[file_"+c+"]",value:a.file_id},b,"last");g.set(b,"innerHTML",g.get(b,"innerHTML")+a.name+"</br>")}))}},onUploadError:function(){},onProgress:function(a){this.progressbar.set("value",a.percent);"100%"===a.percent&&this.progressbar.destroy(!1)},destroy:function(){this.uploader.destroy(!1)}})});