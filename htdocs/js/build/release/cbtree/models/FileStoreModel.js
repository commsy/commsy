//>>built
define("cbtree/models/FileStoreModel","dojo/_base/array,dojo/_base/declare,dojo/_base/lang,dojo/_base/window,dojo/aspect,./TreeStoreModel".split(","),function(e,g,c,h,i,j){return g([j],{deferItemLoadingUntilExpand:!0,queryOptions:null,sort:null,rootLabel:"ROOT",rootId:"$rootDir$",moduleName:"cbTree/models/FileStoreModel",constructor:function(a){var b=this.store;this.root={store:this,root:!0,id:this.rootId,label:this.rootLabel,children:a.rootChildren};this.root[this.checkedAttr]=this.checkedState;
this.hasFakeRoot=!0;this._validateStore=!1;a.queryOptions&&this._setQueryOptions(a.queryOptions);a.sort&&this._setSortFields(a.sort);if(b.getFeatures()["dojo.data.api.Notification"])this.connects=this.connects.concat([i.after(b,"onClose",c.hitch(this,"onStoreClose"),!0)])},_setQueryOptions:function(a){if(c.isObject(a))this.queryOptions=a},_setSortFields:function(a){if(c.isArray(a)){var b=!0;e.forEach(a,function(a){c.isObject(a)||(b=!1)});if(b)this.sort=a}},getChildren:function(a,b,d){var f=this.store;
a===this.root?this.root.children?b(this.root.children):this.store.fetch({query:this.query,queryOptions:this.queryOptions,sort:this.sort,onComplete:c.hitch(this,function(a){this.root.children=a;b(a)}),onError:d}):f.fetchChildren({item:a,query:this.query,queryOptions:this.queryOptions,sort:this.sort,onError:d,scope:this,onComplete:function(a){b(a)}})},getParents:function(a){var b=[];if(a)return a!==this.root&&(b=this.store.getParents(a),!b.length)?[this.root]:b},mayHaveChildren:function(a){return a===
this.root||this.inherited(arguments)},fetchItemByIdentity:function(a){if(a.identity==this.root.id){var b=a.scope?a.scope:h.global;a.onItem&&a.onItem.call(b,this.root)}else this.inherited(arguments)},getIcon:function(a){if(this.iconAttr)return a!==this.root?this.store.getValue(a,this.iconAttr):this.root[this.iconAttr]},getIdentity:function(a){return a===this.root?this.root.id:this.inherited(arguments)},getLabel:function(a){return a===this.root?this.root.label:this.inherited(arguments)},isItem:function(a){return a===
this.root?!0:this.inherited(arguments)},isChildOf:function(a,b){if(a===this.root){if(-1!==e.indexOf(this.root.children,b))return!0}else return this.inherited(arguments)},deleteItem:function(a,b,d,f,c){c=c||window.global;if(a===this.root){var e=this.root.children||[];if(0<e.length&&(!b||b.call(c,a)))for(a=0;a<e.length;a++)this.store.deleteItem(e[a],null,d,f,c)}else return this.store.deleteItem(a,b,d,f,c)},newItem:function(){throw Error(this.moduleName+"::newItem(): Operation not allowed on a File Store.");
},pasteItem:function(a,b,d){var c=b="";this.store.isItem(a)&&(c=this.store.getDirectory(a),d!==this.root&&(b=d.directory?this.store.getPath(d):this.store.getDirectory(d)),c!==b&&(d=b+"/"+this.store.getLabel(a),this.store.renameItem(a,d)))},onDeleteItem:function(a){-1!=e.indexOf(this.root.children,a)&&this._requeryTop();this.inherited(arguments)},onNewItem:function(a,b){b?(this.getChildren(b.item,c.hitch(this,function(a){this.onChildrenChange(b.item,a)})),this._updateCheckedParent(a,!0)):this._requeryTop()},
onSetItem:function(a,b,c,f){this._queryAttrs.length&&-1!=e.indexOf(this._queryAttrs,b)&&this._requeryTop();this.inherited(arguments)},onStoreClose:function(){},_requeryTop:function(){var a=this.root.children||[];this.store.fetch({query:this.query,queryOptions:this.queryOptions,sort:this.sort,onComplete:c.hitch(this,function(b){this.root.children=b;if(a.length!=b.length||e.some(a,function(a,c){return b[c]!=a}))this.onChildrenChange(this.root,b),this._updateCheckedParent(b[0],!0)})})}})});