//>>built
define("cbtree/models/ItemWriteStoreEX",["dojo/_base/array","dojo/_base/lang","dojo/data/ItemFileWriteStore"],function(h,f,g){f.extend(g,{_validated:!1,addReference:function(a,b,c,e){if(!this.isItem(a)||!this.isItem(b))throw Error("ItemWriteStoreEX::addReference(): refItem and/or parentItem is not a valid store item");if(a!==b){var d;b[c]?(d=b[c],this._addReferenceToMap(a,b,c),"number"===typeof e?b[c].splice(e,0,a):b[c].push(a)):(this._addReferenceToMap(a,b,c),b[c]=[a]);this.onSet(b,c,d,b[c]);return!0}throw Error("ItemWriteStoreEX::addReference(): parent and reference items are identical");
},attachToRoot:function(a){this.isRootItem(a)||(a[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(a),this.onRoot(a,"attach"))},detachFromRoot:function(a){this.isRootItem(a)&&(this._removeArrayElement(this._arrayOfTopLevelItems,a),delete a[this._rootItemPropName],this.onRoot(a,"detach"))},getIdentifierAttr:function(){this._loadFinished||this._forceLoad();return this._getIdentifierAttribute()},getParents:function(a){var b=[],c;if(a){if(a=a[this._reverseRefMap]||a["backup_"+this._reverseRefMap])for(c in a)b.push(this._getItemByIdentity(c));
return b}},isRootItem:function(a){this._assertIsItem(a);return a[this._rootItemPropName]?!0:!1},isValidated:function(){return this._validated},itemExist:function(a){var b,c;if("object"!=typeof a&&"undefined"!=typeof a)throw Error("ItemWriteStoreEX::itemExist(): argument is not an object");this._assert(!this._saveInProgress);b=this.getIdentifierAttr();if(b!==Number&&this._itemsByIdentity){a=a[b];if("undefined"===typeof a)throw Error("ItemWriteStoreEX::itemExist(): item has no identity");if(this._pending._deletedItems[a])throw Error("ItemWriteStoreEX::itemExist(): item is pending deletion");
c=this._itemsByIdentity[a]}return c},loadStore:function(a){function b(a,b){var c=b.loadArgs||null,d=c.scope;e.onLoad(a);c&&c.onComplete&&c.onComplete.call(d,a)}var c=a.scope||window.global,e=this;if(this._loadFinished)onComplete&&onComplete.call(c,this._allFileItems.length);else{a={queryOptions:{deep:!0},loadArgs:a,onBegin:b,onError:a.onError,scope:this};try{this.fetch(a)}catch(d){if(onError)onError.call(c,d);else throw d;}}},onDelete:function(a){if(!0===a[this._rootItemPropName])this.onRoot(a,"delete")},
onNew:function(a){if(this.isRootItem(a))this.onRoot(a,"new")},onLoad:function(){},onRoot:function(){},setValidated:function(a){this._validated=Boolean(a)},removeReference:function(a,b,c){if(!this.isItem(a)||!this.isItem(b))throw Error("ItemWriteStoreEX::removeReference(): refItem and/or parentItem is not a valid store item");if(b[c]){this._removeReferenceFromMap(a,b,c);var e=b[c];if(this._removeArrayElement(b[c],a))return this._isEmpty(b[c])&&delete b[c],this.onSet(b,c,e,b[c]),!0}return!1}})});