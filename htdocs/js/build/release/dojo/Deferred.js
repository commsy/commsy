//>>built
define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(r,s,o,p,m){var q=Object.freeze||function(){},k=function(b,a,c,d,e){2===a&&h.instrumentRejected&&0===b.length&&h.instrumentRejected(c,!1,d,e);for(e=0;e<b.length;e++)n(b[e],a,c,d)},n=function(b,a,c,d){var e=b[a],f=b.deferred;if(e)try{var i=e(c);if(i&&"function"===typeof i.then){b.cancel=i.cancel;i.then(l(f,1),l(f,2),l(f,0));return}g(f,1,i)}catch(j){g(f,2,j)}else g(f,a,c);2===
a&&h.instrumentRejected&&h.instrumentRejected(c,!!e,d,f.promise)},l=function(b,a){return function(c){g(b,a,c)}},g=function(b,a,c){if(!b.isCanceled())switch(a){case 0:b.progress(c);break;case 1:b.resolve(c);break;case 2:b.reject(c)}},h=function(b){var a=this.promise=new p,c=this,d,e,f,i=!1,j=[];Error.captureStackTrace&&(Error.captureStackTrace(c,h),Error.captureStackTrace(a,h));this.isResolved=a.isResolved=function(){return 1===d};this.isRejected=a.isRejected=function(){return 2===d};this.isFulfilled=
a.isFulfilled=function(){return!!d};this.isCanceled=a.isCanceled=function(){return i};this.progress=function(b,e){if(d){if(!0===e)throw Error("This deferred has already been fulfilled.");return a}k(j,0,b,null,c);return a};this.resolve=function(b,f){if(d){if(!0===f)throw Error("This deferred has already been fulfilled.");return a}k(j,d=1,e=b,null,c);j=null;return a};var g=this.reject=function(b,h){if(d){if(!0===h)throw Error("This deferred has already been fulfilled.");return a}Error.captureStackTrace&&
Error.captureStackTrace(f={},g);k(j,d=2,e=b,f,c);j=null;return a};this.then=a.then=function(b,c,i){var g=[i,b,c];g.cancel=a.cancel;g.deferred=new h(function(a){return g.cancel&&g.cancel(a)});d&&!j?n(g,d,e,f):j.push(g);return g.deferred.promise};this.cancel=a.cancel=function(a,c){if(d){if(!0===c)throw Error("This deferred has already been fulfilled.");}else{if(b)var f=b(a),a="undefined"===typeof f?a:f;i=!0;if(d){if(2===d&&e===a)return a}else return"undefined"===typeof a&&(a=new o),g(a),a}};q(a)};h.prototype.toString=
function(){return"[object Deferred]"};m&&m(h);return h});