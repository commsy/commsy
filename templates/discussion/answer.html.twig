{% import 'utils/macros.html.twig' as macros %}
{% import 'item/macros.html.twig' as macrosItem %}
{% import 'discussion/macros.html.twig' as macrosDiscussion %}

<article id="answer_{{ count }}" class="uk-comment">
    <header class="uk-comment-header">
        {# avatar #}
        {% if not article.modificatorItem.isDeleted and article.modificatorItem.isUser %}
            {{ macros.userIconLink(article.modificatorItem, 42, true, ['uk-border-circle', 'uk-comment-avatar']) }}
        {% else %}
            {{ macros.userIcon(article.modificatorItem, 42, true, ['uk-border-circle', 'uk-comment-avatar']) }}
        {% endif %}

        <h4 class="uk-comment-title">
            {{ macros.userFullname(article.modificatorItem) }}
        </h4>
        <div class="uk-comment-meta">
            {{ article.modificationDate|craue_date }} {{ article.modificationDate|craue_time }} | {{ macrosDiscussion.anchorLinks(loop, count) }}
        </div>
    </header>
    <div class="uk-comment-body">
        <div class="uk-grid">
            <div id="description{{ article.itemId }}" class="cs-edit-section cs-toggle uk-width-8-10" data-uk-observe data-cs-edit="{{ {
                'editUrl': path('app_item_editdescription', {'roomId': article.contextId, 'itemId': article.itemId}),
                'cancelEditUrl': path('app_item_canceledit', {'roomId': article.contextId, 'itemId': article.itemId}),
                'toggleSelect': '#edit_toggle_' ~ article.itemId
            }|json_encode|e('html_attr') }}">
                {{ article.description|decodeHtmlEntity|raw }}
            </div>

            {# right actions #}
            <div class="uk-width-2-10 uk-flex uk-flex-right cs-edit">

                {# section actions #}
                {# NOTE: `getHasOverwrittenContent()` returns true for articles with answers which were "deleted" but should instead have their content overwritten to keep the discussion hierarchy intact. #}
                {% if not article.hasOverwrittenContent -%}
                    {% if is_granted('ITEM_EDIT', 'NEW') %}
                        {# edit #}
                        {% if is_granted('ITEM_EDIT', article.itemId) %}
                            <div id="edit_toggle_{{ article.itemId }}" class="uk-display-inline" data-edit-title="{{ "edit"|trans({}) }}">
                                <a href="#" class="uk-icon-hover uk-icon-small uk-icon-edit"></a>
                            </div>
                        {% endif %}

                        {# answer #}
                        <a class="newArticle uk-margin-left" href="#" id="newArticle" data-article-url="{{ path('app_discussion_createanswer', {'roomId': roomId, 'itemId': discussion.itemId, 'answerTo': article.itemId }) }}">
                            <i class="uk-icon-hover uk-icon-small uk-icon-reply"></i>
                        </a>

                        {# delete #}
                        {% if is_granted('ITEM_EDIT', article.itemId) %}
                            <a href="#" class="uk-margin-left cs-edit" data-cs-action="{{ {
                                'url': path('app_discussionarticle_xhrdelete', {'roomId': roomId, 'itemId': article.itemId}),
                                'action': 'delete',
                                'itemId': article.itemId,
                                'errorMessage': '<i class="uk-icon-medium uk-icon-info"></i>' ~ 'action error'|trans,
                                'mode': 'click',
                                'itemType': article.itemType,
                                'title': 'list choice'|trans({},'rubric')|capitalize,
                                'confirmQuestion': 'confirm delete'|trans({},'rubric'),
                                'confirmCancel': 'confirm delete cancel'|trans({},'rubric'),
                                'confirmOk': 'confirm delete confirm'|trans({},'rubric')
                            }|json_encode|e('html_attr') }}">
                                <i class="uk-icon-hover uk-icon-small uk-icon-trash-o"></i>
                            </a>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        </div>

        {# files #}
        {% if not article.hasOverwrittenContent -%}
            <div class="uk-margin-top" data-cs-edit="{{ {
                'editUrl': path('app_upload_uploadform', {'roomId': article.contextId, 'itemId': article.itemId}),
                'cancelEditUrl': path('app_item_canceledit', {'roomId': article.contextId, 'itemId': article.itemId})
            }|json_encode|e('html_attr') }}">
                {{ macrosItem.files_simple(article) }}
            </div>
        {%- endif %}
    </div>

    <hr>
</article>
